{
  "version": 3,
  "sources": ["../../dictionaries/en.mjs", "../../../lib/dictionary.mjs", "../../../lib/hooks.mjs", "../../../lib/layer/decorate.mjs", "../../../lib/layer/fade.mjs", "../../../lib/layer/featureFields.mjs", "../../../lib/layer/featureFormats.mjs", "../../../lib/layer/featureHover.mjs", "../../../lib/layer/featureStyle.mjs", "../../../lib/layer/format/googleMapTiles.mjs", "../../../lib/layer/format/mapboxStyle.mjs", "../../../lib/layer/format/maplibre.mjs", "../../../lib/layer/format/mvt.mjs", "../../../lib/layer/format/tiles.mjs", "../../../lib/layer/format/vector.mjs", "../../../lib/layer/format/_format.mjs", "../../../lib/layer/styleParser.mjs", "../../../lib/layer/themes/basic.mjs", "../../../lib/layer/themes/categorized.mjs", "../../../lib/layer/themes/distributed.mjs", "../../../lib/layer/themes/graduated.mjs", "../../../lib/layer/_layer.mjs", "../../../lib/location/create.mjs", "../../../lib/location/decorate.mjs", "../../../lib/location/get.mjs", "../../../lib/location/nnearest.mjs", "../../../lib/location/_location.mjs", "../../../lib/mapview/addLayer.mjs", "../../../lib/mapview/allFeatures.mjs", "../../../lib/mapview/attribution.mjs", "../../../lib/mapview/fitView.mjs", "../../../lib/mapview/geoJSON.mjs", "../../../lib/mapview/geometry.mjs", "../../../lib/mapview/getBounds.mjs", "../../../lib/mapview/infotip.mjs", "../../../lib/mapview/interactions/draw.mjs", "../../../lib/mapview/interactions/highlight.mjs", "../../../lib/mapview/interactions/modify.mjs", "../../../lib/mapview/interactions/snap.mjs", "../../../lib/mapview/interactions/zoom.mjs", "../../../lib/mapview/locate.mjs", "../../../lib/mapview/popup.mjs", "../../../lib/mapview/removeLayer.mjs", "../../../lib/mapview/_mapview.mjs", "../../../lib/plugins/admin.mjs", "../../../lib/plugins/dark_mode.mjs", "../../../lib/plugins/feature_info.mjs", "../../../lib/plugins/fullscreen.mjs", "../../../lib/plugins/layer_order.mjs", "../../../lib/plugins/link_button.mjs", "../../../lib/plugins/locator.mjs", "../../../lib/plugins/login.mjs", "../../../lib/plugins/svg_templates.mjs", "../../../lib/plugins/test.mjs", "../../../lib/plugins/userIDB.mjs", "../../../lib/plugins/userLayer.mjs", "../../../lib/plugins/userLocale.mjs", "../../../lib/plugins/zoomBtn.mjs", "../../../lib/plugins/zoomToArea.mjs", "../../../lib/plugins/_plugins.mjs", "../../../lib/utils/esmImport.mjs", "../../../lib/utils/uhtml.mjs", "../../../lib/utils/compose.mjs", "../../../lib/utils/convert.mjs", "../../../lib/utils/copyToClipboard.mjs", "../../../lib/utils/csvDownload.mjs", "../../../lib/utils/csvUpload.mjs", "../../../lib/utils/dataURLtoBlob.mjs", "../../../lib/utils/gazetteer.mjs", "../../../lib/utils/getCurrentPosition.mjs", "../../../lib/utils/hexa.mjs", "../../../lib/utils/jsonParser.mjs", "../../../lib/utils/keyvalue_dictionary.mjs", "../../../lib/utils/loadDictionary.mjs", "../../../lib/utils/loadPlugins.mjs", "../../../lib/utils/merge.mjs", "../../../lib/utils/mobile.mjs", "../../../lib/utils/numericFormatter.mjs", "../../../lib/utils/olStyle.mjs", "../../../lib/utils/paramString.mjs", "../../../lib/utils/ping.mjs", "../../../lib/utils/polygonIntersectFeatures.mjs", "../../../lib/utils/proj4.mjs", "../../../lib/utils/promiseAll.mjs", "../../../lib/utils/queryParams.mjs", "../../../lib/utils/scriptElement.mjs", "../../../lib/utils/svgSymbols.mjs", "../../../lib/utils/svgTemplates.mjs", "../../../lib/utils/temporal.mjs", "../../../lib/utils/textFile.mjs", "../../../lib/utils/userIndexedDB.mjs", "../../../lib/utils/userLocale.mjs", "../../../lib/utils/versionCheck.mjs", "../../../lib/utils/verticeGeoms.mjs", "../../../lib/utils/xhr.mjs", "../../../lib/utils/_utils.mjs", "../../../lib/mapp.mjs"],
  "sourcesContent": ["export default {\n  cancel: 'Cancel',\n  circle_config: 'Circle configuration',\n  confirm: 'Confirm',\n  confirm_delete:\n    'Are you sure you want to delete this feature? This cannot be undone.',\n  create: 'Create',\n  csv_upload_failed: 'Data import failed, please try again.',\n  csv_upload_import: 'Import From CSV',\n  csv_upload_number_of_columns_imported:\n    'The number of columns in your imported file',\n  csv_upload_number_of_columns_required:\n    'is not the same as the number of columns required',\n  csv_upload_rows_imported: 'Rows Imported',\n  csv_upload_success: 'Data imported successfully',\n  dark_mode: 'Colour Mode',\n  delete: 'Delete',\n  delete_geometry: 'Delete Geometry',\n  delete_vertex: 'Remove vertex',\n  document_upload_failed: 'Document upload failed.',\n  drag_and_drop_doc: 'Drag and drop or add document',\n  drag_and_drop_image: 'Drag and drop or add image',\n  draw_circle: 'Circle from Centre',\n  draw_circle_2pt: 'Manual Circle',\n  draw_dialog_begin_drawing: 'Begin Drawing - Click anywhere on the map',\n  draw_dialog_cancel_drawing: 'Cancel Drawing - ESC Key',\n  draw_dialog_remove_vertex: 'Remove Last Vertex - Right Click',\n  draw_dialog_save: 'Save - Double Click',\n  draw_dialog_save_single: 'Save - Single Click',\n  draw_dialog_title: 'Drawing Instructions',\n  draw_line: 'Line',\n  draw_point: 'Point',\n  draw_polygon: 'Polygon',\n  draw_position: 'Current Position',\n  draw_rectangle: 'Rectangle',\n  edit_dialog_cancel_drawing:\n    'Cancel Drawing - Click on the cancel button to cancel the drawing.',\n  edit_dialog_modify_shape:\n    'Edit Shape- Drag a vertex to modify the shape, or add a new vertex on the polygon.',\n  edit_dialog_remove_vertex: 'Remove Vertex - Click on a vertex to remove it.',\n  edit_dialog_save: 'Save - Click on the save button to save your changes.',\n  edit_dialog_title: 'Editing Instructions',\n  feature_info: 'Feature Info',\n  filter_searchbox_placeholder: 'Search',\n  icon_scaling_cluster: 'Cluster Icon Scale',\n  icon_scaling_cluster_log: 'Cluster Log Scale',\n  icon_scaling_field: 'Toggle Field Icon Scaling',\n  icon_scaling_label: 'Icon Scale',\n  icon_scaling_no_scaling: 'No Scaling',\n  icon_scaling_select_one: 'Select a field',\n  icon_scaling_title: 'Icon Scaling',\n  icon_scaling_zoom_in: 'Zoom-in Scale',\n  icon_scaling_zoom_out: 'Zoom-out Scale',\n  identical_values_filter:\n    'This field contains only one distinct value and cannot be filtered on.',\n  image_upload_failed: 'Image upload failed.',\n  information: 'Information',\n  invalid_geometry: 'Invalid geometry',\n  invalid_lat_lon:\n    'The provided Coordinates do not fall within the selected Locale.',\n  invalid_lat_long_range:\n    'Invalid coordinates: Latitude and longitude values must be within valid ranges.',\n  invalid_entry_value: 'Unable to update location with invalid entry value.',\n  layer_add_new_location: 'Add new locations',\n  layer_dataview_header: 'Data Views',\n  filter_clear_all: 'Clear all filters',\n  layer_filter_dropdown_select: 'Select Multiple',\n  layer_filter_greater_than: 'Greater than',\n  filter_header: 'Filter',\n  layer_filter_less_than: 'Less than',\n  filter_reset_all: 'Reset all filters',\n  filter_select: 'Select filter from list',\n  layer_filter_set_filter: 'Set filter',\n  layer_grid_legend_ratio: 'Display colour as a ratio to the size',\n  layer_group_hide_layers: 'Hide all layers in group',\n  layer_style_cluster: 'Multiple locations',\n  layer_style_display_hover: 'Enable hover',\n  layer_style_display_labels: 'Display labels',\n  layer_style_header: 'Style',\n  layer_style_opacity: 'Change layer opacity:',\n  layer_style_select_label: 'Select field to use as label',\n  layer_style_select_theme: 'Select thematic style',\n  layer_style_switch_all: 'switch all',\n  layer_style_switch_caption: 'Click on labels to switch visibility or',\n  layer_visibility: 'Toggle visibility',\n  layer_zoom_to_extent: 'Zoom to filtered layer extent',\n  layers: 'Layers',\n  link: 'Link',\n  loading: 'Loading',\n  location_clear_all: 'Clear locations',\n  location_new_failed: 'Creating new location has failed.',\n  location_no_location_selected: 'No Locations selected',\n  location_close_without_save: 'Close location without saving changes?',\n  location_delete: 'Delete location',\n  location_listview_full: 'The listview for locations is full.',\n  location_remove: 'Remove feature from selection',\n  location_save: 'Save changes to cloud',\n  location_save_changes: 'Save your changes to this location?',\n  location_zoom: 'Zoom map to feature bounds',\n  location_update_failed: 'Location update has failed.',\n  locations: 'Locations',\n  login_email: 'E-mail',\n  login_password: 'Password',\n  login_button: 'Log In',\n  login_invalid:\n    'Invalid email or password does not meet the requirement of minimum 12 characters.',\n  login_verification_note:\n    'Your account must be verified by following a verification link sent to the email address and approved by an administrator before you are able to log in.',\n  login_registration_link: 'Register a new account or reset your password.',\n  modify_geometry: 'Modify Geometry',\n  filter_btn_label: 'Filters',\n  filter_btn_title: 'Open Filtering View',\n  filter_count: 'Location(s) match filter criteria',\n  filter_dialog_title: 'Filter Panel',\n  filter_in_viewport: 'viewport based.',\n  filter_not_in_viewport: 'all locations not just those in viewport.',\n  gazetteer: 'Search for a location',\n  no_data_filter: 'This field contains no data and cannot be filtered on.',\n  no_layers: 'No accessible layers in locale.',\n  no_locales:\n    'Your account has been verified and approved, but you do not have access to any locales. This is likely as an administrator has not given you the required roles. Please contact an administrator to resolve this.',\n  no_options_available: 'No options available.',\n  no_results: 'No results for this search',\n  ok: 'OK',\n  pill_component_remove: 'Remove',\n  pin: 'Pin',\n  query_failed: 'Query failed.',\n  radius: 'Radius',\n  register_agree: 'I agree',\n  register_email: 'E-mail',\n  register_error:\n    'Please make sure credentials meet the security requirements.',\n  register_login: 'Already registered? Login.',\n  register_new_password:\n    'New Password (min. length 12, must contain a digit, upper, and lower case character)',\n  register_next: 'What happens next? Confirming your account',\n  register_next_info:\n    'XYZ/MAPP will attempt to deliver an email to your email address. You must click on the link in the email to verify that you are the account holder. Please check your spam folder if you can not find this email. You will need to contact a site administrator if you are unable to access the verification link. Newly registered accounts must be approved by a site administrator once verified.',\n  register_privacy: 'Privacy Agreement',\n  register_privacy_agreement:\n    'User account data may be stored in a third party database. Passwords are encrypted at rest. Administrator will never ask for your password. User account data will not be shared with a third party. Administrator may disable, block, or remove your account. Please refer to the XYZ/MAPP documentation to remove your stored account details. You must agree to these conditions in order to register your account.',\n  register_reset: 'Register or Reset Password',\n  register_retype_password: 'Re-type password',\n  register_title: 'Registration',\n  remove_document_confirm:\n    'Are you sure to remove this document? This cannot be undone.',\n  remove_image_confirm:\n    'Are you sure to remove the image? This cannot be undone.',\n  remove_item_confirm: 'Remove item?',\n  remove_last_vertex: 'Remove last vertex',\n  report: 'Report',\n  save: 'Save',\n  toolbar_admin: 'Open account admin view',\n  toolbar_current_location: 'Current location',\n  toolbar_fullscreen: 'Fullscreen mapview',\n  toolbar_login: 'Log in',\n  toolbar_logout: 'Log out',\n  toolbar_zoom_in: 'Zoom in',\n  toolbar_zoom_out: 'Zoom out',\n  toolbar_zoom_to_area: 'Zoom to area',\n  units: 'Units',\n  user_locale_desc: 'Below is a list of your current saved locales:',\n  user_locale_specific: 'Your locales are specific to you.',\n  user_locale_context:\n    'Each project includes where your map is positioned, the layers that you see on the map and how they are styled. ',\n  user_locale_save: 'Name your project, and click the save button.',\n  zoom_to: 'Zoom to Extent',\n};\n", "/**\n## /dictionary\n\nThe dictionary module exports a proxy object to get values from the mapp.dictionaries{}.\n\n@module /dictionary\n*/\n\nimport en from '../public/dictionaries/en.mjs';\n\nexport const dictionary = new Proxy({}, { get });\n\n/**\n@function get\n\n@description\nThe proxy getter will check whether the mapp.language is supported by the mapp.dictionaries or set 'en' english as default language.\n\nA check will be performed if the key exists in the english dictionary of the key doesn't exist in the language dictionary.\n\nThe key itself will be returned if no lookup exists in the language or english mapp.dictionaries.\n\n@param {string} key The property key of the requested dictionary entry.\n*/\nfunction get(target, key, receiver) {\n  if (!Object.hasOwn(mapp.dictionaries, mapp.language)) {\n    // Set language to english if mapp.language is not supported by mapp.dictionaries.\n    console.warn(\n      `'${mapp.language}' mapp.language is not supported by mapp.dictionaries.`,\n    );\n    mapp.language = 'en';\n  }\n\n  // Check whether key exists in dictionaries language.\n  if (Object.hasOwn(mapp.dictionaries[mapp.language], key)) {\n    return mapp.dictionaries[mapp.language][key];\n  }\n\n  // Check whether key exists in english dictionary.\n  if (Object.hasOwn(mapp.dictionaries.en, key)) {\n    return mapp.dictionaries.en[key];\n  }\n\n  return key;\n}\n\nexport const dictionaries = { en };\n", "/**\n## /hooks\n\nThe mapp.hooks{} module parses, updates, and stores URL parameter.\n\n```js\n{\n  current: {\n    layers: [],\n    locations: [],\n  },\n  set,\n  parse,\n  remove,\n  removeAll,\n  push,\n  filter,\n}\n```\n\n@module /hooks\n*/\n\nconst hooks = {\n  current: {\n    layers: [],\n    locations: [],\n  },\n  filter,\n  parse,\n  push,\n  remove,\n  removeAll,\n  set,\n};\n\nexport default hooks;\n\n/**\n@function parse\n\n@description\nThe method parses key/value pairs of URL searchParams from the document window.location.href.\n*/\nfunction parse() {\n  const url = new URL(window.location.href);\n\n  // Iterate over the search parameters\n  for (const [key, value] of url.searchParams.entries()) {\n    // string 'false' should be boolean false\n    if (value === 'false') {\n      hooks.current[key] = false;\n      continue;\n    }\n    // string 'true' should be boolean true\n    if (value === 'true') {\n      hooks.current[key] = true;\n      continue;\n    }\n    // layers and locations should always be arrays\n    if (key === 'locations' || key === 'layers') {\n      hooks.current[key] = decodeURIComponent(value).split(',');\n      continue;\n    }\n\n    hooks.current[key] = value.includes(',')\n      ? decodeURIComponent(value).split(',')\n      : value;\n  }\n\n  // Strip token from url\n  if (hooks.current.token) {\n    url.searchParams.delete('token');\n    window.history.replaceState({}, document.title, url.toString());\n    delete hooks.current.token;\n  }\n}\n\n/**\n@function set\n \n@description\nThe set method will assign a URL params object to the hooks.current{} before calling the pushState() method.\n\n@param {Object} _hooks A params object to be assigned to the hooks.current.\n*/\nfunction set(_hooks) {\n  Object.assign(hooks.current, _hooks);\n\n  pushState();\n}\n\n/**\n@function remove\n \n@description\nRemove key from mapp.hooks.current and URI. Array properties will be emptied. Other properties will be deleted.\n\n@param {string} key hooks.current{} property key.\n*/\nfunction remove(key) {\n  if (Array.isArray(hooks.current[key])) {\n    // Empty array.\n    hooks.current[key].length = 0;\n  } else {\n    delete hooks.current[key];\n  }\n\n  pushState();\n}\n\n/**\n@function removeAll\n \n@description\nIterate through all hooks.current property keys and call the remove method with the key argument.\n*/\nfunction removeAll() {\n  Object.keys(hooks.current).forEach((key) => remove(key));\n\n  pushState();\n}\n\n/**\n@function push\n \n@description\nAssigns the val param to the hooks.current[key] property.\n\n@param {string} key hooks.current{} property key.\n@param {*} val hooks.current[key] property val.\n*/\nfunction push(key, val) {\n  if (hooks.current[key]) {\n    if (hooks.current[key].indexOf(val) < 0) hooks.current[key].push(val);\n  } else {\n    hooks.current[key] = [val];\n  }\n\n  pushState();\n}\n\n/**\n@function filter\n \n@description\nFilter [remove] a value from an hooks.current array property.\n\nThis is requiired to strip a location.hook from the [selected] locations.\n\n@param {string} key hooks.current{} array property key.\n@param {*} val hooks.current[key] array property val.\n*/\nfunction filter(key, val) {\n  if (!Array.isArray(hooks.current[key])) return;\n\n  hooks.current[key] = hooks.current[key].filter((el) => el !== val);\n\n  pushState();\n}\n\n/**\n@function pushState\n \n@description\nPushes changes in the hooks.current to the window URL.\n*/\nfunction pushState() {\n  try {\n    window.history.pushState(\n      {},\n      document.title,\n      `?${mapp.utils.paramString(hooks.current)}`,\n    );\n  } catch (me) {\n    console.log(me);\n  }\n}\n", "/**\n## /layer/decorate\n\nDecorates a layer object with additional properties and methods.\n\nA mapview must be assigned to the layer object in order to decorate a layer.\n\nThe layer decorator passes the layer to a defined format method which assigns the Openlayers layer object (L).\n\nCommon interface methods such as layer.show, and hide are assigned to the layer object.\n\nA blank layer.filter object will be set if the filter has not been defined in the JSON layer.\n\nAny plugins matching layer keys will be executed with the layer being passed as argument to the plugin method.\n\nThe layer object is returned from the decorator.\n\n@requires /layer/formats\n@requires /utils/keyvalue_dictionary\n\n@module /layer/decorate\n*/\n\n/**\n@function decorator\n@async\n\n@description\nThe layer decorator method create mapp-layer typedef object from a json-layer.\n\n@param {object} layer JSON layer.\n@property {boolean} layer.featureLocation Locations will be gotten from layer.features.\n\n@returns {Promise<layer>} Decorated Mapp Layer.\n*/\nexport default async function decorate(layer) {\n  // Replace keyvalue_dictionary entries if required.\n  mapp.utils.keyvalue_dictionary(layer);\n\n  // Check layer format.\n  if (!Object.hasOwn(mapp.layer.formats, layer.format)) {\n    console.warn(`Layer: ${layer.key}; ${layer.format} format unavailable.`);\n    return;\n  }\n\n  // Decorate layer format methods.\n  await mapp.layer.formats[layer.format](layer);\n\n  // If layer does not exist, return.\n  if (!layer.L) return;\n\n  // Assign show, hide, and other methods to the layer object.\n  Object.assign(layer, {\n    changeEnd,\n    geomCurrent,\n    getExtent,\n    hide,\n    hideCallbacks: [],\n    remove,\n    removeCallbacks: [],\n    show,\n    showCallbacks: [],\n    tableCurrent,\n    update,\n    zoomToExtent,\n  });\n\n  layer.name ??= layer.key;\n\n  // Format methods, eg mvt may already assign a changeEnd callback method.\n  layer.changeEndCallbacks ??= [];\n\n  // Warn if outdated layer.draw.delete configuration is used.\n  if (layer.draw?.delete) {\n    console.warn(\n      `Layer: ${layer.key}, please move draw.delete to use layer.deleteLocation:true.`,\n    );\n  }\n\n  // Set layer filter.\n  layer.filter = {\n    current: {},\n    ...layer.filter,\n  };\n\n  if (Array.isArray(layer.featureSet)) {\n    layer.featureSet = new Set(layer.featureSet);\n  }\n\n  // Set layer opacity from style.\n  layer.L.setOpacity(layer.style?.opacity || 1);\n\n  // Check which infoj entries should be skipped.\n  if (Array.isArray(layer.infoj_skip)) {\n    layer.infoj\n      .filter((entry) =>\n        [entry.key, entry.field, entry.query, entry.type, entry.group]\n\n          // Some object property value is included in infoj_skip array.\n          .some((val) => layer.infoj_skip.includes(val)),\n      )\n\n      // Set skipEntry flag if some entry property is included in infoj_skip array.\n      .forEach((entry) => (entry.skipEntry = true));\n  }\n\n  //Remove edit property from infoj entries on featureLocation layer.\n  layer.featureLocation && layer?.infoj?.forEach((entry) => delete entry.edit);\n\n  // Call layer and/or plugin methods.\n  Object.keys(layer).forEach((key) => {\n    typeof mapp.layer[key] === 'function' && mapp.layer[key]?.(layer);\n    typeof mapp.plugins[key] === 'function' && mapp.plugins[key]?.(layer);\n  });\n\n  return layer;\n}\n\n/**\n@function getExtent\n@async\n\n@description\nSend a query to the layer_extent query template with a POST body if the layer has an array of ID defined as featureSet or featureLookup.\n\n@param {layer} layer\n@property {array} [layer.featureSet] The layer has an of feature id.\n@property {array} [layer.featureLookup] The layer has lookup features.\n\n@returns {array} an array of floats, representing the extent\n*/\nasync function getExtent() {\n  const layer = this;\n\n  let ids = [];\n  if (Array.isArray(layer.featureLookup)) {\n    // Get array of ids from lookup features.\n    ids = layer.featureLookup.map(\n      (feature) => feature[layer.featureLookupId || 'id'],\n    );\n  } else if (\n    Array.isArray(layer.featureSet) ||\n    layer.featureSet instanceof Set\n  ) {\n    ids = [...layer.featureSet];\n  } else if (layer.L && layer.format !== 'mvt') {\n    // return extent from Openlayers source.\n    return layer.L.getSource().getExtent();\n  }\n\n  const body = ids.length\n    ? JSON.stringify({\n        ids: ids,\n      })\n    : undefined;\n\n  const response = await mapp.utils.xhr({\n    url:\n      `${layer.mapview.host}/api/query/layer_extent?` +\n      mapp.utils.paramString({\n        filter: layer.filter?.current,\n        geom: layer.geomCurrent(),\n        layer: layer.source_key || layer.key,\n        locale: layer.mapview.locale.key,\n        proj: layer.srid,\n        srid: layer.mapview.srid,\n        table:\n          layer.table ||\n          Object.values(layer.tables)[0] ||\n          Object.values(layer.tables)[1],\n      }),\n    body,\n  });\n\n  return response;\n}\n\n/**\n@function show\n\n@description\nShows the layer on the map.\n*/\nfunction show() {\n  // Push the layer into the layers hook array.\n  this.mapview.hooks && mapp.hooks.push('layers', this.key);\n\n  this.display = true;\n\n  try {\n    // Add layer to map\n    this.mapview.Map.addLayer(this.L);\n  } catch {\n    // Will catch assertation error when layer is already added.\n  }\n\n  // Reload layer data if available.\n  this.reload instanceof Function && this.reload();\n\n  // Add layer attribution to mapview attribution.\n  this.mapview.attribution?.check();\n\n  // Execute showCallbacks\n  this.showCallbacks?.forEach((fn) => fn instanceof Function && fn(this));\n}\n\n/**\n@function hide\n\n@description\nHides the layer from the map.\n*/\nfunction hide() {\n  this.display = false;\n\n  // Remove OL layer from mapview.\n  this.mapview.Map.removeLayer(this.L);\n\n  // Remove layer attribution from mapview attribution.\n  this.mapview.attribution?.check();\n\n  // Filter the layer from the layers hook array.\n  if (this.mapview.hooks && !this.zoomDisplay) {\n    mapp.hooks.filter('layers', this.key);\n  }\n\n  // Execute hideCallbacks\n  this.hideCallbacks?.forEach((fn) => fn instanceof Function && fn(this));\n}\n\n/**\n@function tableCurrent\n\n@description\nReturns the current table associated with the layer.\n\n@returns {string} The current table associated with the layer.\n*/\nfunction tableCurrent() {\n  // Return the current table if it exists.\n  if (this.table) return this.table;\n\n  let table;\n\n  if (!this.tables) return false;\n\n  // Get current zoom level from mapview.\n  const zoom = parseInt(this.mapview.Map.getView().getZoom());\n\n  // Get zoom level keys from layer.tables object.\n  const zoomKeys = Object.keys(this.tables);\n\n  // Get first zoom level key from array.\n  const minZoomKey = parseInt(zoomKeys[0]);\n  const maxZoomKey = parseInt(zoomKeys[zoomKeys.length - 1]);\n\n  // Get the table for the current zoom level.\n  table = this.tables[zoom];\n\n  // Get the first table if the current zoom level is smaller than the min.\n  table = zoom < minZoomKey ? this.tables[minZoomKey] : table;\n\n  // Get the last table if the current zoom level is larger than the max.\n  table = zoom > maxZoomKey ? this.tables[maxZoomKey] : table;\n\n  return table;\n}\n\n/**\n@function geomCurrent\n\n@description\nReturns the current geometry associated with the layer.\n\n@returns {string} The current geometry associated with the layer.\n*/\nfunction geomCurrent() {\n  // Return the current geometry if it exists.\n  if (!this.geoms) return this.geom;\n\n  let geom;\n\n  // Get current zoom level from mapview.\n  const zoom = parseInt(this.mapview.Map.getView().getZoom());\n\n  // Get zoom level keys from layer.tables object.\n  const zoomKeys = Object.keys(this.geoms);\n\n  // Get first zoom level key from array.\n  const minZoomKey = parseInt(zoomKeys[0]);\n  const maxZoomKey = parseInt(zoomKeys[zoomKeys.length - 1]);\n\n  // Get the geometry for the current zoom level.\n  geom = this.geoms[zoom];\n\n  // Get the first geometry if the current zoom level is smaller than the min.\n  geom = zoom < minZoomKey ? this.geoms[minZoomKey] : geom;\n\n  // Get the last geometry if the current zoom level is larger than the max.\n  geom = zoom > maxZoomKey ? this.geoms[maxZoomKey] : geom;\n\n  return geom;\n}\n\n/**\n@function zoomToExtent\n@async\n\n@description\nZooms to a specific extent on the map.\n\n@param {Object} params - Parameters for zooming to extent.\n@returns {Promise<boolean>} A promise that resolves with a boolean indicating the success of the operation.\n*/\nasync function zoomToExtent(params) {\n  // Zooms to a specific extent.\n  const layer = this;\n\n  const response = await layer.getExtent();\n\n  // If failed to fetch response or the response is an empty array\n  if (!response || (Array.isArray(response) && response.length === 0)) {\n    return false;\n  }\n\n  layer.mapview.fitView(\n    // fit the map view within bounds\n    response,\n    params,\n  );\n\n  return true;\n}\n\n/**\n@function changeEnd\n@this layer\n\n@description\nThe layer.changeEnd method will be called from the mapview.changeEnd method. The method will check whether a layer should be displayed on the current zoom level.\n\nThe method will iterate over the changeEndCallbacks array methods.\n*/\nfunction changeEnd() {\n  if (this.tables) {\n    // Layer is out of zoom range.\n    if (!this.tableCurrent()) {\n      if (this.display) {\n        // Layer should be shown if possible.\n        this.zoomDisplay = true;\n        this.hide();\n      }\n    } else if (this.zoomDisplay) {\n      // Prevents layer.show() being fired on zoom change within range.\n      delete this.zoomDisplay;\n\n      // Show layer if within zoomDisplay range.\n      this.show();\n    }\n  }\n\n  if (this.display && !this.zoomDisplay && this.params?.viewport) {\n    this.reload();\n  }\n\n  for (const fn of this.changeEndCallbacks) {\n    if (typeof fn === 'function') fn(this);\n  }\n}\n\n/**\n@function update\n@async\n\n@description\nThe layer.update() method receives a json layer and attempts to decorate a new layer.\n\nThe layer itself will be removed once the newly decorated layer view as been inserted before the existing layer view.\n\nThe new layer will be returned from the method.\n\n@param {json} jsonLayer A json layer object.\n@returns {layer} A decorated mapp layer.\n*/\nasync function update(jsonLayer) {\n  const layer = this;\n\n  jsonLayer.mapview = layer.mapview;\n\n  const newLayer = await mapp.layer.decorate(jsonLayer);\n\n  if (!newLayer.L) {\n    console.warn('Updated layer could not be decorated');\n    return;\n  }\n\n  const layersnode = document.getElementById('layers');\n\n  if (layersnode) {\n    mapp.ui.layers.view(newLayer);\n\n    layersnode?.insertBefore(newLayer.view, layer.view);\n  }\n\n  layer.remove();\n\n  newLayer.mapview.layers[layer.key] = newLayer;\n\n  newLayer.display && newLayer.show();\n\n  return newLayer;\n}\n\n/**\n@function remove\n\n@description\nThe layer.remove method will remove the layer view from the document. Hide the layer in the mapview and finally dispose the Openlayers layer before the layer object is deleted from the mapview.layers{}.\n*/\nfunction remove() {\n  const layer = this;\n\n  // Remove view element from document if exists.\n  layer.view?.remove();\n\n  layer.hide();\n\n  layer.L?.dispose();\n\n  layer.removeCallbacks.forEach((fn) => typeof fn === 'function' && fn(this));\n\n  delete layer.mapview.layers[layer.key];\n}\n", "/**\n### /layer/fade\n\nThe fade will occur during the zoom in and out as well as changing the view port.\n\n### \uD83C\uDFAF Target Opacity Calculation: \nDepending on whether fading in or out, the target opacity is calculated. \nIf fading out, the opacity is reduced by 20% or brought to a minimum of 0. \nIf fading in, the opacity is increased by 20% or limited to a maximum of 1.\n\n### \u23F1\uFE0F Animation Duration and Timing: \nThe animation duration is set to 100 milliseconds (adjustable), and the start time of the animation is recorded.\n\n### \uD83D\uDCCA Opacity Update Function: \nThe `updateOpacity` function is used to calculate the current time and elapsed time since the animation started.\n\n### \uD83C\uDF1F Interpolation and Opacity Update:\nIf the elapsed time is less than the animation duration, interpolation is used to smoothly transition the opacity between `currentOpacity` and `targetOpacity`. \nThe `requestAnimationFrame` is used to schedule the next frame of the animation. \nWhen the animation duration has elapsed, the layer's opacity is set to the `targetOpacity`, concluding the animation.\n\n### \uD83D\uDE80 Starting the Animation: \nThe animation is triggered by calling the `updateOpacity` function.\n\n### \u23F3 Setting New Timeout:\nA new fade timeout is set for the next step of the fade animation after the specified duration has passed, ensuring the animation continues until the desired opacity is reached.\n\n@module /layer/fade\n*/\n\n/**\n@function fade\n\n@description\nThe fade method calls itself iteratively change the opacity in steps of 0.2 until the target canvas is fully transparent.\n\n@param {layer} layer The Mapp layer object.\n@param {boolean} out The layer will be faded out if the boolean out param is true.\n*/\nexport default function fade(layer, out) {\n  // Check if the layer has a fade property.\n  if (!layer?.fade) return;\n\n  // Clear current fade process.\n  clearTimeout(layer.fade);\n\n  // Get current opacity.\n  const currentOpacity = layer.L.getOpacity();\n\n  let targetOpacity;\n\n  if (out) {\n    // Layer is completely transparent.\n    if (currentOpacity <= 0) return;\n\n    // Reduce opacity by 20%.\n    targetOpacity = Math.max(currentOpacity - 0.2, 0);\n  } else {\n    // Layer is completely opaque.\n    if (currentOpacity >= 1) return;\n\n    // Increase opacity by 20%.\n    targetOpacity = Math.min(currentOpacity + 0.2, 1);\n  }\n\n  const duration = 100; // Animation duration in milliseconds\n\n  const startTime = Date.now();\n  const updateOpacity = () => {\n    // Current time used to calculate the elapsed time.\n    const currentTime = Date.now();\n\n    const elapsedTime = currentTime - startTime;\n\n    // If elapsed time is less than the animation duration, then we will use interpolation.\n    if (elapsedTime < duration) {\n      const progress = elapsedTime / duration;\n      const interpolatedOpacity =\n        currentOpacity + (targetOpacity - currentOpacity) * progress;\n      layer.L.setOpacity(interpolatedOpacity);\n\n      // Continue updating opacity.\n      requestAnimationFrame(updateOpacity);\n    } else {\n      // Animation complete, set the final opacity.\n      layer.L.setOpacity(targetOpacity);\n    }\n  };\n\n  // Start the animation.\n  updateOpacity();\n\n  // Set the new fade timeout.\n  layer.fade = setTimeout(() => fade(layer, out), duration);\n}\n", "/**\n## /layer/featureFields\n\nThe featureFields module exports methods to reset and process the layer.featureFields{} object.\n\nThe layer.featureFields{} object has field properties for each field in the layer.params.fields[] array.\n\nThe layer.params.fields[] array will be populated from the fieldsArray method prior to requesting features to be added to an Openlayers layer source.\n\nThe featureFields.process() method will be called from the featureFormats methods while creating Openlayers features.\n\n@module /layer/featureFields\n*/\n\n/**\n@function reset\n\n@description\nfeatureFields.reset(layer) method will reset the layer.featureFields{} object and create empty field.values[] arrays each field in the layer.params.fields[] array.\n\n@param {layer} layer A decorated mapp layer object.\n@property {Object} layer.params\n@property {Array} params.fields Array of strings for feature property fields.\n*/\nexport function reset(layer) {\n  if (!layer.params.fields) return;\n\n  // Create featureFields object if nullish.\n  layer.featureFields ??= {};\n\n  layer.params.fields.forEach((field) => {\n    // Set empty values array.\n    layer.featureFields[field] = {\n      values: [],\n    };\n  });\n}\n\n/**\n@function process\n\n@description\nThe featureFields.process(layer) method will calculate the distribution of featureFields fields.values[] for featureStyle methods.\n\n@param {layer} layer A decorated mapp layer object.\n@property {layer-style} layer.style The layer style configuration.\n@property {Object} style.icon_scaling Configuration to scale style icons for point features.\n@property {Object} style.theme The current theme to style features according to their properties.\n*/\nexport async function process(layer) {\n  if (layer.style.icon_scaling?.field) {\n    const numbers = layer.featureFields[layer.style.icon_scaling?.field].values\n      .map(Number)\n      .filter((n) => !isNaN(n));\n\n    layer.style.icon_scaling.max = Math.max(...numbers);\n  }\n\n  // Check if the distribution method is defined in the distribution object.\n  if (Object.hasOwn(distribution, layer.style?.theme?.distribution)) {\n    // Call the corresponding distribution function.\n    await distribution[layer.style.theme.distribution](layer);\n\n    layer.L.changed();\n\n    // The legend method renders into the layer.style.legend\n    mapp.ui.layers.legends[layer.style.theme.type](layer);\n  }\n}\n\nexport const distribution = {\n  count,\n  jenks,\n};\n\n/**\n@function jenks\n\n@description\nThe jenks distribution method requires the stats.jenks utility method to calculate natural breaks within the `featureFields.values[]` array.\n\n@param {layer} layer A decorated mapp layer object.\n*/\nasync function jenks(layer) {\n  const theme = layer.style.theme;\n\n  const n = Math.min(\n    layer.featureFields[theme.field].values.length,\n    theme.categories.length,\n  );\n\n  // Parse array values as float.\n  layer.featureFields[theme.field].values = layer.featureFields[\n    theme.field\n  ].values\n    .filter((val) => val !== null)\n    .map(Number.parseFloat);\n\n  const simpleStatistics = await mapp.utils.simpleStatistics();\n\n  // Compute Jenks natural breaks.\n  layer.featureFields[theme.field].jenks = simpleStatistics.jenks(\n    layer.featureFields[theme.field].values,\n    n,\n  );\n\n  let value;\n\n  theme.categories.forEach((cat, i) => {\n    value =\n      value === layer.featureFields[theme.field].jenks[i]\n        ? undefined\n        : layer.featureFields[theme.field].jenks[i];\n\n    cat.value = value;\n\n    // Format category label using numeric formatter utility.\n    // legend object is passed as part of the params, such as suffix, prefix, round.\n    // see numericFormatter.mjs for notes on params available.\n    cat.label = mapp.utils.formatNumericValue({\n      ...theme.legend,\n      value,\n    });\n  });\n}\n\n/**\n@function count\n\n@description\nThe count distribution method counts values in the `featureFields.values[]` array.\n\n@param {layer} layer A decorated mapp layer object.\n*/\nfunction count(layer) {\n  const theme = layer.style.theme;\n\n  if (Array.isArray(theme.fields)) {\n    theme.fields.forEach((field) => {\n      layer.featureFields[field].values.forEach((val) => {\n        // Increment count for each value.\n        layer.featureFields[field][val] ??= 0;\n        layer.featureFields[field][val]++;\n      });\n    });\n  } else if (theme.field) {\n    layer.featureFields[theme.field].values.forEach((val) => {\n      // Increment count for each value.\n      layer.featureFields[theme.field][val] ??= 0;\n      layer.featureFields[theme.field][val]++;\n    });\n  }\n}\n\n/**\n@function fieldsArray\n\n@description\nThe fieldsArray method checks the layer params and style to create a Set of fields which are required as feature properties.\n\nAn array without duplicates or undefined fields is returned from the Set.\n\n@param {layer} layer A decorated mapp vector layer.\n@returns {array} Array of feature fields.\n*/\nexport function fieldsArray(layer) {\n  const fieldsSet = new Set([\n    layer.params.default_fields,\n    layer.style.theme?.field,\n    layer.style.label?.field,\n    layer.style.icon_scaling?.field,\n    layer.cluster?.label,\n  ]);\n\n  if (Array.isArray(layer.style.theme?.fields)) {\n    layer.style.theme.fields.forEach(fieldsSet.add, fieldsSet);\n  }\n\n  return Array.from(fieldsSet)\n    .flat()\n    .filter((field) => !!field);\n}\n", "/**\n## /layer/featureFormats\n\nThe featureFormats module exports utility methods to process the response data from layer queries into Openlayers features.\n\n@module /layer/featureFormats\n*/\n\n/**\n@function cluster\n\n@description\nThe cluster function processes an array of feature data and returns an array of OpenLayers features to be added to the layer source.\n\nIt creates Point geometries from coordinate pairs, extracts count and ID information, and assigns additional properties based on the layer's field definitions.\n\nThe function also tracks the maximum count across all features in the layer.cluster.max_size property.\n\n@param {layer} layer A layer object, likely an OpenLayers layer.\n@param {Array} features An array of feature data, where each feature is represented as an array.\n@property {layer-cluster} layer.cluster The vector layer cluster configuration.\n@property {integer} cluster.max_size The length of features in the largest cluster feature.\n@property {Object} layer.params\n@property {Array} layer.params.fields Array of field names for additional feature properties.\n@returns {Array} Array of OpenLayers Feature objects.\n*/\nexport function cluster(layer, features) {\n  layer.cluster.max_size = 1;\n\n  return features.map((vals, i) => {\n    const geometry = new ol.geom.Point(vals.shift());\n\n    const count = vals.shift();\n\n    layer.cluster.max_size =\n      layer.cluster.max_size > count ? layer.cluster.max_size : count;\n\n    const id = vals.shift();\n\n    const properties = { count };\n\n    layer.params.fields.forEach((field, i) => {\n      properties[field] = vals[i];\n    });\n\n    return new ol.Feature({\n      geometry,\n      id,\n      ...properties,\n    });\n  });\n}\n\n/**\n@function geojson\n\n@description\nThe geojson featureFormats method processes an array of wkt features and returns Openlayers features to be added to the layer source.\n\nThe geometry of the features will be projected from the layer.srid data projection to the layer.mapview.srid projection for display in the mapview.Map.\n\nThe layer.params.fields[] property values will be added to the layer.featureFields field values arrays to be processed by the featureFields.process() method.\n\n@param {layer} layer A decorated mapp layer object.\n@param {array} features An array of WKT features.\n@property {string} layer.srid Feature data projection.\n@property {Object} layer.params\n@property {Array} params.fields Array of field names for feature properties.\n\n@returns {array} Array of Openlayers features.\n*/\nexport function geojson(layer, features) {\n  const formatGeojson = new ol.format.GeoJSON();\n\n  mapp.layer.featureFields.reset(layer);\n\n  return features.map((feature) => {\n    // Populate featureFields values array with feature property values.\n    layer.params.fields?.forEach((field) => {\n      layer.featureFields[field].values.push(feature.properties[field]);\n    });\n\n    return new ol.Feature({\n      geometry: formatGeojson.readGeometry(feature.geometry, {\n        dataProjection: 'EPSG:' + layer.srid,\n        featureProjection: 'EPSG:' + layer.mapview.srid,\n      }),\n      id: feature.id,\n      ...feature.properties,\n    });\n  });\n}\n\n/**\n@function wkt\n\n@description\nThe wkt featureFormats method processes an array of wkt features and returns Openlayers features to be added to the layer source.\n\nThe geometry of the features will be projected from the layer.srid data projection to the layer.mapview.srid projection for display in the mapview.Map.\n\nThe layer.params.fields[] property values will be added to the layer.featureFields field values arrays to be processed by the featureFields.process() method.\n\n@param {layer} layer A decorated mapp layer object.\n@param {array} features An array of WKT features.\n@property {string} layer.srid Feature data projection.\n@property {Object} layer.params\n@property {Array} params.fields Array of field names for feature properties.\n\n@returns {array} Array of Openlayers features.\n*/\nexport function wkt(layer, features) {\n  if (!Array.isArray(features)) return;\n\n  const formatWKT = new ol.format.WKT();\n\n  mapp.layer.featureFields.reset(layer);\n\n  const olFeatures = features.map((feature) => {\n    const properties = {};\n\n    // Append params.fields to an array of id, and wkt_geometry which are the first and second entries in a wkt feature record.\n    const wkt_fields = Array.from(\n      new Set(['id', 'wkt_geometry', ...layer.params.fields]),\n    );\n\n    // Populate featureFields values array with feature property values.\n    wkt_fields?.forEach((field, i) => {\n      layer.featureFields[field]?.values?.push(feature[i]);\n\n      properties[field] = feature[i];\n    });\n\n    const geometry = formatWKT.readGeometry(properties.wkt_geometry, {\n      dataProjection: 'EPSG:' + layer.srid,\n      featureProjection: 'EPSG:' + layer.mapview.srid,\n    });\n\n    // Return feature from geometry with properties.\n    return new ol.Feature({\n      geometry,\n      ...properties,\n    });\n  });\n\n  // Process featureFields for dynamic theming.\n  mapp.layer.featureFields.process(layer);\n\n  return olFeatures;\n}\n\n/**\n@function wkt_properties\n\n@description\nIn order to process featureFields for tiled datasets it is required to request the feature properties separate from the vector tile geometries.\n\nThe property features do not have a geometry property and the wkt_properties method does not return an array of Openlayers features.\n\nThe feature properties are assigned to the layer.featuresObject{} with the feature ID as property key for lookup of the properties in the featureStyle method.\n\nThe layer.params.fields[] property values will be added to the layer.featureFields field values arrays to be processed by the featureFields.process() method.\n\n@param {layer} layer A decorated mapp layer object.\n@param {array} features An array of WKT features.\n@property {Object} layer.featuresObject Store feature properties with the feature ID as property key for lookup in the featureStyle method.\n@property {Object} layer.params\n@property {Array} params.fields Array of field names for feature properties.\n*/\nexport function wkt_properties(layer, features) {\n  mapp.layer.featureFields.reset(layer);\n\n  for (const feature of features) {\n    const properties = {\n      id: feature[0],\n    };\n\n    // Assign field key and value to properties object\n    layer.params.fields?.forEach((field, i) => {\n      layer.featureFields[field].values.push(feature[i + 1]);\n\n      properties[field] = feature[i + 1];\n    });\n\n    layer.featuresObject[feature.shift()] = properties;\n  }\n\n  mapp.layer.featureFields.process(layer);\n}\n\n/**\n@function wkth3\n@async\n\n@description\nThe wkth3 featureFormats method processes an array of wkth3 features and returns Openlayers features to be added to the layer source.\n\nA wkth3 feature is an array with the first entry being the cellid. Subsequent array entries are cell properties required to for the featureStyle render.\n\nThe layer.params.fields[] property values will be added to the layer.featureFields field values arrays to be processed by the featureFields.process() method.\n\nAn attempt will be made to look up an Openlayers geometry object from the cellGeomMap.\n\nOtherwise the coordinates will be parsed from the cell id with h3js.cellToBoundary() method.\n\nAn Openlayers polygon geometry will be created from the parsed coordinates. The geometry object will be stored in the cellGeomMap.\n\nThe wkt layer format is recommended for the \"wkth3\" featureFormat. \n\nThe geometry field is required for the request viewport parameter. This is used to limit the data displayed to the current mapview extent.\n\nThe \"no_geom\" flag should be set to not return the geometry with the wkt features.This is as it is not required for rendering the h3 cells.\n\nThe \"qID\" flag should return the h3 cell id from the database table for lookup to find the h3 geometry. \n\nThe assignment of properties to the cellGeomMap requires each h3 cell to be unique, thus the qID should return a unique h3 cell id for each feature.\n\n```js\n\"format\": \"wkt\",\n\"srid\": \"4326\",\n\"geom\": \"geom_4326\",\n\"params\": {\n  \"viewport\": true,\n  \"no_geom\": true\n},\n\"featureFormat\": \"wkth3\",\n\"qID\": \"h3res9\",\n```\n\n\n@param {layer} layer A decorated mapp layer object.\n@param {array} features An array of wkth3 features.\n@property {string} layer.srid Feature data projection.\n@property {Object} layer.params\n@property {Array} params.fields Array of field names for feature properties.\n\n@returns {array} Array of Openlayers features.\n*/\nconst cellGeomMap = new Map();\nexport async function wkth3(layer, features) {\n  const h3js = await mapp.utils.esmImport('h3-js@4.4.0');\n\n  if (!Array.isArray(features)) return;\n\n  mapp.layer.featureFields.reset(layer);\n\n  const olFeatures = features.map((feature) => {\n    const properties = {};\n\n    // Append params.fields to an array of id, and wkt_geometry which are the first and second entries in a wkt feature record.\n    const wkt_fields = Array.from(new Set(['id', ...layer.params.fields]));\n\n    // Populate featureFields values array with feature property values.\n    for (const [i, field] of Object.values(wkt_fields).entries()) {\n      layer.featureFields[field]?.values?.push(feature[i]);\n\n      properties[field] = feature[i];\n    }\n\n    let geometry = cellGeomMap.get(properties.id);\n\n    if (!geometry) {\n      const longLat = h3js\n        .cellToBoundary(properties.id)\n        .map((lL) => lL.reverse());\n\n      // Add first coord pair to close polygon ring.\n      longLat.push(longLat[0]);\n\n      geometry = new ol.geom.Polygon([longLat]).transform(\n        'EPSG:4326',\n        'EPSG:3857',\n      );\n\n      cellGeomMap.set(properties.id, geometry);\n    }\n\n    // Return feature from geometry with properties.\n    return new ol.Feature({\n      geometry,\n      ...properties,\n    });\n  });\n\n  // Process featureFields for dynamic theming.\n  mapp.layer.featureFields.process(layer);\n\n  return olFeatures;\n}\n", "/**\n## /layer/featureHover\n\n@module /layer/featureHover\n*/\n\n/**\n@function featureHover\n\n@description\nThe featureHover method will send an xhr request for the provided feature argument. The returned string value will be displayed in an infotip element in the feature layer mapview.\n\n@param {object} feature\n@param {layer} layer A decorated mapp layer object.\n*/\nexport default function featureHover(feature, layer) {\n  // The hover method must only execute if the display flag is set.\n  if (!layer.style.hover.display) return;\n\n  // Store current highlight (feature) key.\n  const featureKey = layer.mapview.interaction?.current?.key?.toString();\n\n  if (!featureKey) return;\n\n  const table = layer.tableCurrent();\n\n  if (!table) return;\n\n  const paramString = mapp.utils.paramString({\n    coords:\n      feature.properties.count > 1 &&\n      ol.proj.transform(\n        feature.getGeometry().getCoordinates(),\n        `EPSG:${layer.mapview.srid}`,\n        `EPSG:${layer.srid}`,\n      ),\n    field: layer.style.hover.field,\n    filter: feature.properties.count > 1 && layer.filter?.current,\n    geom: layer.geom,\n    id: feature.properties.id,\n    layer: layer.key,\n    layer_template: layer.params?.layer_template,\n    locale: layer.mapview.locale.key,\n    qID: layer.qID,\n    table,\n    template: layer.style.hover.query || 'infotip',\n  });\n\n  mapp.utils\n    .xhr({\n      url: `${layer.mapview.host}/api/query?${paramString}`,\n      cache: true,\n      debounce: { key: 'hover', delay: 100 },\n    })\n    .then((response) => {\n      // Check whether there is a response to display.\n      if (!response) return;\n\n      if (typeof layer.style.hover.render === 'function') {\n        const content = layer.style.hover.render(response);\n        layer.mapview.infotip(content);\n        return;\n      }\n\n      // Check whether the response label field has a value.\n      if (response.label == '') return;\n\n      // Check whether highlight feature is still current.\n      if (layer.mapview.interaction?.current?.key !== featureKey) return;\n\n      // Display the response label as infotip.\n      layer.mapview.infotip(response.label);\n    })\n    .catch((_error) => {});\n}\n", "/**\n## /layer/featureStyle\n\nThis module exports a style function for a layer\n\n@module /layer/featureStyle\n*/\n\n/**\n@function featureStyle\n@description\nReturns a style function for OL vector layers.\n\n@param {layer} layer\n@property {layer-style} layer.style The layer style config.\n@property {Boolean} [style.cache] The feature style should be retrieved from the feature 'Styles' property.\n\n@returns {function} The style function for the layer.\n*/\nexport default function featureStyle(layer) {\n  /**\n  @function Style\n  @description\n  Style functions process [vector] features and return an OL style to the layer render.\n  */\n  return function Style(feature) {\n    // Style caching must be enabled with flag.\n    if (layer.style.cache === true) {\n      // Check for and return existing Styles object.\n      const Styles = feature.get('Styles');\n\n      if (Styles) return Styles;\n    }\n\n    // Assign feature properties.\n    featureProperties(feature);\n\n    if (feature.properties === null) {\n      // The feature will not be visible.\n      return null;\n    }\n\n    // Set style.default as feature.style.\n    feature.style = layer.style.default;\n\n    if (Object.hasOwn(mapp.layer.themes, layer.style.theme?.type)) {\n      // Apply theme style to style object.\n      mapp.layer.themes[layer.style.theme?.type]?.(layer.style.theme, feature);\n    }\n\n    // The feature must not be displayed.\n    if (feature.style === null) return;\n\n    // Style cluster point features.\n    clusterStyle(feature);\n\n    // Assign highlight style if required.\n    highlightStyle(feature);\n\n    // Assign label style if required.\n    labelStyle(feature);\n\n    // Assign selected style if required.\n    selectedStyle(feature);\n\n    // IconScalingStyle will scale icons based on the feature properties\n    iconScalingStyle(feature);\n\n    return mapp.utils.style(feature.style, feature);\n  };\n\n  /**\n  @function featureProperties\n  @description\n  Assigns feature properties based on layer configuration.\n\n  @param {Object} feature The feature object.\n  */\n  function featureProperties(feature) {\n    feature.properties = feature.getProperties();\n\n    if (\n      layer.featureSet?.size &&\n      !layer.featureSet.has(feature.properties.id)\n    ) {\n      feature.properties = null;\n      return;\n    }\n\n    // Assign MVT feature properties from the layer featuresObject.\n    if (layer.featuresObject) {\n      if (Object.hasOwn(layer.featuresObject, feature.properties.id)) {\n        Object.assign(\n          feature.properties,\n          layer.featuresObject[feature.properties.id],\n        );\n      } else {\n        feature.properties = null;\n        return;\n      }\n    }\n\n    // Check whether feature is in lookup.\n    if (Array.isArray(layer.featureLookup)) {\n      // Find feature with matching ID property in the featureLookup\n      const lookupFeature = layer.featureLookup.find(\n        (f) => f[layer.featureLookupId || 'id'] === feature.properties.id,\n      );\n\n      // Do not style features not found in the lookup array.\n      if (!lookupFeature) {\n        feature.properties = null;\n        return;\n      }\n\n      // Assign feature.properties from the lookupFeature for subsequent styling\n      Object.assign(feature.properties, lookupFeature);\n    }\n\n    // Geojson / WKT features may have a properties property\n    if (feature.properties?.properties) {\n      // This shouldn't happen anymore.\n      console.warn(`Feature with properties.properties`);\n      Object.assign(feature.properties, feature.properties.properties);\n      delete feature.properties.properties;\n    }\n  }\n\n  /**\n  @function clusterStyle\n  @description\n  Applies cluster style to the feature based on layer configuration.\n\n  @param {Object} feature - The feature object.\n  */\n  function clusterStyle(feature) {\n    if (!feature.properties?.count) return;\n\n    if (feature.properties.count === 1) return;\n\n    if (!layer.style.cluster) return;\n\n    const clusterScale = parseFloat(layer.style.cluster.clusterScale);\n\n    // Spread cluster style into feature.style.\n    feature.style = {\n      ...feature.style,\n      ...layer.style.cluster,\n    };\n\n    // Cluster icons will NOT scale different to single locations if the clusterScale is not set in the cluster style.\n    if (clusterScale) {\n      // The clusterScale will be added to the icon scale.\n      feature.style.clusterScale = layer.style.cluster.logScale\n        ? // A natural log will be applied to the cluster scaling.\n          (Math.log(clusterScale) / Math.log(layer.cluster?.max_size)) *\n          Math.log(feature.properties.size || feature.properties.count)\n        : // A fraction of the icon clusterScale will be added to the items scale for all but the biggest cluster location.\n          1 +\n          (clusterScale / layer.cluster?.max_size) *\n            (feature.properties.size || feature.properties.count);\n    }\n\n    // Setting a zoomInScale will INCREASE the scale of icons on higher zoom levels.\n    if (layer.style.cluster.zoomInScale) {\n      feature.style.zoomInScale =\n        layer.style.cluster.zoomInScale * layer.mapview.Map.getView().getZoom();\n    }\n\n    // Setting a zoomOutScale will DECREASE the scale of icons on higher zoom levels.\n    if (layer.style.cluster.zoomOutScale) {\n      feature.style.zoomOutScale =\n        layer.style.cluster.zoomOutScale /\n        layer.mapview.Map.getView().getZoom();\n    }\n  }\n\n  /**\n  @function highlightStyle\n  @description\n  Applies highlight style to the feature based on layer configuration.\n\n  @param {Object} feature The feature object.\n  */\n  function highlightStyle(feature) {\n    // Layer must have a highlight style.\n    if (!layer.style.highlight) return;\n\n    // Layer must have a highlighted feature stored as layer.highlighted.\n    if (!layer.highlight) return;\n\n    // The layer.highlight must be a match for the feature ID.\n    if (layer.highlight !== (feature.get('id') || feature.getId())) return;\n\n    feature.style = {\n      ...feature.style,\n      ...layer.style.highlight,\n    };\n  }\n\n  /**\n  @function labelStyle\n  @description\n  Applies label style to the feature based on layer configuration.\n\n  @param {Object} feature The feature object.\n  */\n  function labelStyle(feature) {\n    // A feature requires properties to create a label.\n    if (!feature.properties) return;\n\n    // Only styled features can be labelled.\n    if (!feature.style) return;\n\n    // The label must be displayed.\n    if (!layer.style.label?.display) {\n      delete feature.style.label;\n      return;\n    }\n\n    feature.style.label = structuredClone(layer.style.label);\n\n    // Assign count value as text if label.count is truthy.\n    feature.style.label.text =\n      (feature.style.label.count &&\n        feature.properties.count > 1 &&\n        feature.properties.count) ||\n      undefined;\n\n    feature.style.label.text ??=\n      feature.properties[feature.style.label.field] || feature.properties.label;\n\n    // Delete style.label if minZoom exceeds current zoom.\n    feature.style.label?.minZoom > layer.mapview.Map.getView().getZoom() &&\n      delete feature.style.label;\n\n    // Delere style.label if current zoom exceeds maxZoom.\n    feature.style.label?.maxZoom < layer.mapview.Map.getView().getZoom() &&\n      delete feature.style.label;\n  }\n\n  /**\n  @function selectedStyle\n  @description\n  Applies selected style to the feature based on layer configuration.\n\n  @param {Object} feature The feature object.\n  */\n  function selectedStyle(feature) {\n    // Return before lookup in mapview.locations object.\n    if (layer.style.selected === undefined) return;\n\n    // Check whether the feature referenced in mapview.locations\n    if (layer.mapview?.locations[`${layer.key}!${feature.properties.id}`]) {\n      feature.style = layer.style.selected;\n    }\n  }\n\n  /**\n  @function iconScalingStyle\n  @description\n  Applies the icon scale based on the value of the field supplied in layer.style.icon_scaling.field\n\n  @param {Object} feature The feature object.\n  */\n  function iconScalingStyle(feature) {\n    if (!layer.style.icon_scaling?.field) return;\n\n    let fieldValue = Number(feature.properties[layer.style.icon_scaling.field]);\n\n    if (feature.properties.features?.length > 1) {\n      // Do not scale cluster feature icons.\n      if (!layer.style.icon_scaling.cluster) return;\n\n      fieldValue = 0;\n\n      feature.properties.features.forEach((f) => {\n        // Add field value of each feature in cluster.\n        fieldValue += Number(f.getProperties()[layer.style.icon_scaling.field]);\n      });\n\n      if (layer.style.icon_scaling.cluster === 'avg') {\n        // Average fieldValue by dividing the cluster size.\n        fieldValue /= feature.properties.features.length;\n      }\n    }\n\n    if (isNaN(fieldValue)) return;\n\n    // fieldValue cannot be negative, so we will set it to 0 (no scaling).\n    // This is to prevent negative scaling which would shrink the icon.\n    if (fieldValue < 0) fieldValue = 0;\n\n    const factor =\n      layer.style.icon_scaling.scaleFactor || layer.style.icon_scaling.max || 1;\n\n    // fieldScale must be bigger than 1 to prevent shrinking.\n    feature.style.fieldScale = 1 + fieldValue / factor;\n  }\n}\n", "/**\n## /layer/formats/googleMapTiles\n\nThe module exports the \"googleMapTiles\" format method for the Mapp layer decorator method.\n\n@module /layer/formats/googleMapTiles\n*/\n\n/**\n@function googleMapTiles\n@async\n@description\nThe format method assigns an Openlayers [layer/WebGLTile]{@link https://openlayers.org/en/latest/apidoc/module-ol_layer_WebGLTile-WebGLTileLayer.html} class object as L property to the Mapp layer object.\n   \n@param {layer} layer The layer object.\n*/\nexport default async function googleMapTiles(layer) {\n  layer.style ??= {};\n\n  layer.style.mapType ??= 'roadmap';\n\n  layer.L = new ol.layer.WebGLTile({\n    className: `mapp-layer-${layer.key}`,\n    key: layer.key,\n    source: new ol.source.Google({\n      highDpi: true,\n      key: layer.apiKey,\n      layerTypes: layer.style.layerTypes,\n      mapType: layer.style.mapType,\n      scale: 'scaleFactor2x',\n    }),\n    zIndex: layer.zIndex,\n  });\n}\n", "/**\n### /layer/formats/mapboxStyle\n\nThe mapboxStyle layer format requires the ol-mapbox-style plugin for the native display of mapbox style tile layer in Openlayers.\n\nThe plugin is loaded from a script tag through the scriptElement utility method.\n\nCSP access to `cdn.jsdelivr.net` is required in order to import the ol-mapbox-style plugin.\n\n@requires ol-mapbox-style\n@requires /utils/scriptElement\n\n@module /layer/formats/mapboxStyle\n*/\n\n/**\n@function mapboxStyle\n\n@description\nThe mapboxStyle method creates an Openlayers VectorTile layer and assigns a mapbox style through the ol-mapbox-style plugin.\n\n@param {layer} layer JSON layer\n@property {Object} layer.style\n@property {string} style.URL The location of a mvt stylesheet.\n@property {string} layer.accessToken An accessToken is required to access tiles and stylesheets from the Mapbox API.\n\n@returns {layer} layer decorated with format methods.\n*/\nexport default async function mapboxStyle(layer) {\n  await mapp.utils.scriptElement(\n    'https://cdn.jsdelivr.net/npm/ol-mapbox-style@13.0.1/dist/olms.js',\n  );\n\n  layer.L = new ol.layer.VectorTile({\n    declutter: true,\n    zIndex: layer.zIndex,\n  });\n\n  olms.applyStyle(layer.L, layer.style.URL, { accessToken: layer.accessToken });\n}\n", "/**\n## /layer/formats/maplibre\n\nThe module exports the \"maplibre\" format method for the Mapp layer decorator method.\n\nThe maplibre format module imports the maplibre-gl library from esm and assigns the right-to-left [rtl] language module to display arabic labels correctly.\n\nThe mapbox-gl-rtl-text plugin must be loaded to support left-to-right [eg. arabic] text.\n\n@requires /utils/esmImport\n@requires @mapbox/mapbox-gl-rtl-text\n\n@module /layer/formats/maplibre\n*/\n\nlet MaplibreGL;\n\n/**\n@function maplibre\n\n@description\nThe maplibre format method will create a new MaplibreGL.Map() class object in a layer.container element. The layer.container is prepended to the Openlayers mapview.Map target element. A custom Openlayers.layer object will position the Maplibre Map object and return the rendered map into the container.\n\n@param {layer} layer JSON layer\n@property {Object} layer.style\n@property {string} style.URL The location of a mvt stylesheet.\n@property {string} layer.accessToken An accessToken is required to access tiles and stylesheets from the Mapbox API.\n@property {boolean} layer.preserveDrawingBuffer The preserveDrawingBuffer flag is required in order to render to canvas for screenshots.\n\n@returns {layer} layer decorated with format methods.\n*/\nexport default async function maplibre(layer) {\n  if (!MaplibreGL) {\n    MaplibreGL = await mapp.utils.esmImport('maplibre-gl@5.5.0');\n\n    MaplibreGL.setRTLTextPlugin(\n      'https://cdn.jsdelivr.net/npm/@mapbox/mapbox-gl-rtl-text@0.3.0/dist/mapbox-gl-rtl-text.min.js',\n      true, // Lazy load the plugin\n    );\n  }\n\n  const className = `mapp-layer-${layer.key} maplibre`;\n\n  layer.container = mapp.utils.html.node`<div\n    class=${className}\n    style=\"visibility: hidden; position: absolute; width: 100%; height: 100%;\">`;\n\n  layer.mapview.Map.getTargetElement().prepend(layer.container);\n\n  // Check mapbox style URL and accessToken\n  if (layer.style?.URL && layer.accessToken) {\n    const testUrl = normalizeStyleURL(layer.style.URL, layer.accessToken);\n\n    layer.style.object = await mapp.utils.xhr(testUrl);\n\n    // The format method must return without creating a layer or even importing the maplibre library if it is not possible to retrieve a mapbox style object.\n    if (layer.style.object instanceof Error) {\n      return;\n    }\n  }\n\n  // A layer style object is required to render vector tiles.\n  if (!layer.style?.object) {\n    console.warn(\n      `${layer.key} failed to load, check that an access token and a style.URL are provided.`,\n    );\n    return;\n  }\n\n  const maplibreMap = new MaplibreGL.Map({\n    attributionControl: false,\n    boxZoom: false,\n    container: layer.container,\n    doubleClickZoom: false,\n    dragPan: false,\n    dragRotate: false,\n    interactive: false,\n    keyboard: false,\n    pitchWithRotate: false,\n    pixelRatio: 1,\n    canvasContextAttributes: {\n      preserveDrawingBuffer: layer.preserveDrawingBuffer,\n    },\n    scrollZoom: false,\n    style: layer.style?.object,\n    touchZoomRotate: false,\n    transformRequest: (url, resourceType) => {\n      if (url.indexOf('mapbox:') === 0) {\n        return transformMapboxUrl(url, resourceType, layer.accessToken);\n      }\n\n      // Do any other transforms you want\n      return { url };\n    },\n  });\n\n  if (!Map) return;\n\n  // The Maplibre Map control must resize with mapview Map targetElement.\n  layer.mapview.Map.getTargetElement().addEventListener('resize', () =>\n    maplibreMap.resize(),\n  );\n\n  // Handle layer.style.zIndex deprecation.\n  if (layer.style.zIndex) {\n    console.warn(\n      `Layer: ${layer.key}, layer.style.zIndex has been deprecated. Use layer.zIndex instead.`,\n    );\n  }\n\n  layer.L = new ol.layer.Layer({\n    key: layer.key,\n    render: (frameState) => {\n      if (!layer.display) return;\n\n      layer.container.style.visibility = 'visible';\n\n      // adjust view parameters in mapbox\n      maplibreMap.jumpTo({\n        animate: false,\n        bearing: (-frameState.viewState.rotation * 180) / Math.PI,\n        center: ol.proj.toLonLat(frameState.viewState.center),\n        zoom: frameState.viewState.zoom - 1,\n      });\n\n      return layer.container;\n    },\n    zIndex: layer.zIndex,\n  });\n}\n\n// transformMapboxUrl and supporting functions are taken from https://github.com/rowanwins/maplibregl-mapbox-request-transformer\n\nfunction transformMapboxUrl(url, resourceType, accessToken) {\n  if (url.indexOf('/styles/') > -1 && url.indexOf('/sprite') === -1) {\n    return {\n      url: normalizeStyleURL(url, accessToken),\n    };\n  }\n\n  if (url.indexOf('/sprites/') > -1) {\n    return {\n      url: normalizeSpriteURL(url, accessToken),\n    };\n  }\n\n  if (url.indexOf('/fonts/') > -1) {\n    return {\n      url: normalizeGlyphsURL(url, accessToken),\n    };\n  }\n\n  if (url.indexOf('/v4/') > -1) {\n    return {\n      url: normalizeSourceURL(url, accessToken),\n    };\n  }\n\n  if (resourceType === 'Source') {\n    return {\n      url: normalizeSourceURL(url, accessToken),\n    };\n  }\n}\n\nfunction parseUrl(url) {\n  const parts = url.match(/^(\\w+):\\/\\/([^/?]*)(\\/[^?]+)?\\??(.+)?/);\n\n  if (!parts) {\n    throw new Error('Unable to parse URL object');\n  }\n\n  return {\n    authority: parts[2],\n    params: parts[4] ? parts[4].split('&') : [],\n    path: parts[3] || '/',\n    protocol: parts[1],\n  };\n}\n\nfunction formatUrl(urlObject, accessToken) {\n  const apiUrlObject = parseUrl('https://api.mapbox.com');\n\n  urlObject.protocol = apiUrlObject.protocol;\n  urlObject.authority = apiUrlObject.authority;\n  urlObject.params.push(`access_token=${accessToken}`);\n\n  const params = urlObject.params.length\n    ? `?${urlObject.params.join('&')}`\n    : '';\n\n  return `${urlObject.protocol}://${urlObject.authority}${urlObject.path}${params}`;\n}\n\nfunction normalizeStyleURL(url, accessToken) {\n  const urlObject = parseUrl(url);\n\n  urlObject.path = `/styles/v1${urlObject.path}`;\n\n  return formatUrl(urlObject, accessToken);\n}\n\nfunction normalizeGlyphsURL(url, accessToken) {\n  const urlObject = parseUrl(url);\n\n  urlObject.path = `/fonts/v1${urlObject.path}`;\n\n  return formatUrl(urlObject, accessToken);\n}\n\nfunction normalizeSourceURL(url, accessToken) {\n  const urlObject = parseUrl(url);\n\n  urlObject.path = `/v4/${urlObject.authority}.json`;\n  urlObject.params.push('secure');\n\n  return formatUrl(urlObject, accessToken);\n}\n\nfunction normalizeSpriteURL(url, accessToken) {\n  const urlObject = parseUrl(url);\n  const path = urlObject.path.split('.');\n\n  urlObject.path = `/styles/v1${path[0]}/sprite.${path[1]}`;\n\n  return formatUrl(urlObject, accessToken);\n}\n", "/**\n## /layer/formats/mvt\n\nThe module exports the \"mvt\" format method for the Mapp layer decorator method.\n\n@requires /layer/featureFormats\n@requires /layer/featureStyle\n@requires /layer/styleParser\n\n@module /layer/formats/mvt\n*/\n\n/**\n@function MVT\n\n@description\nThe MVT format method receives a JSON layer argument from the mapp.layer.decorator and assigns format specific functions to the layer object.\n\nThe SRID of an MVT layer must be 3857.\n\nThe MVT format method will call the styleParser to check the layer.style{} configuration.\n\nA layer.reload() method will be assigned to reload the layer data from rest.\n\nA layer.featureSource will be assigned for feature geometries.\n\nA layer.source will be assigned for render features.\n\n@param {layer} layer JSON layer\n@property {Object} [layer.params] Parameter for layer data queries.\n@property {number} [layer.transition] The transition duration for the layer.\n@property {boolean} [layer.wkt_properties] A flag whether feature properties should be loaded independent from MVT geometries.\n@property {number} [layer.cacheSize] The cache size for the layer tiles.\n*/\n\nexport default function MVT(layer) {\n  // Assign default SRID if nullish.\n  layer.srid ??= '3857';\n\n  // If 4326, return an error as this is not supported anymore.\n  if (layer.srid !== '3857') {\n    console.warn(`Layer ${layer.key} must be set to use SRID 3857.`);\n    return;\n  }\n\n  // Update feature style config.\n  mapp.layer.styleParser(layer);\n\n  // Set default layer params if nullish.\n  layer.params ??= {};\n\n  if (layer.mvt_cache) {\n    console.warn(`Layer ${layer.key} mvt_cache has been disabled.`);\n  }\n\n  // MVT query must not have a viewport, this is defined by the tile extent.\n  delete layer.params.viewport;\n\n  layer.reload = reload;\n\n  /**\n  @function reload\n\n  @description\n  The reload method executes the wktPropertiesLoad method for MVT layer with wkt_properties features.\n\n  Otherwise the source and featureSource [Openlayers VectorTile]{@link https://openlayers.org/en/latest/apidoc/module-ol_source_VectorTile.html} sources are cleared and refreshed.\n  */\n  function reload() {\n    if (layer.wkt_properties) {\n      wktPropertiesLoad(layer);\n      return;\n    }\n\n    layer.source.clear();\n    layer.source.refresh();\n    layer.featureSource.refresh();\n  }\n\n  // The snapSource is required for snap interactions on vector tile layer.\n  layer.featureSource = new ol.source.VectorTile({\n    cacheSize: 0,\n    format: new ol.format.MVT({\n      featureClass: ol.Feature,\n      //idProperty: 'id'\n    }),\n    tileUrlFunction: tileUrlFunction(layer),\n    transition: 0,\n  });\n\n  // Define source for mvt layer.\n  layer.source = new ol.source.VectorTile({\n    cacheSize: layer.cacheSize || 0,\n    format: new ol.format.MVT(),\n    transition: layer.transition,\n  });\n\n  // Assign wkt properties load method.\n  if (layer.wkt_properties) {\n    layer.source.setTileUrlFunction(wktTileUrlFunction(layer));\n    layer.changeEndCallbacks = [wktPropertiesLoad];\n  } else if (layer.featureLookup) {\n    layer.source.setTileUrlFunction(wktTileUrlFunction(layer));\n  } else {\n    layer.source.setTileUrlFunction(tileUrlFunction(layer));\n  }\n\n  layer.L = new ol.layer.VectorTile({\n    className: `mapp-layer-${layer.key}`,\n    key: layer.key,\n    renderBuffer: 200,\n    source: layer.source,\n    style: mapp.layer.featureStyle(layer),\n    //renderMode: 'vector',\n    zIndex: layer.zIndex,\n  });\n}\n\n/**\n@function tileUrlFunction\n\n@description\nReturns a function that generates the tile URL to request an MVT tile with MVT geometries and properties required for theming.\n\n@param {layer} layer A decorated format:mvt mapp layer.\n\n@returns {function} A function that generates the tile URL for a given tile coordinate.\n*/\n\nfunction tileUrlFunction(layer) {\n  return (tileCoord) => {\n    const table = layer.tableCurrent();\n\n    // The layer has no data for this zoom level.\n    if (!table) {\n      layer.source.clear();\n      return;\n    }\n\n    // The layer does not display and doesn't have clones.\n    if (!layer.display) {\n      layer.source.clear();\n      return;\n    }\n\n    const geom = layer.geomCurrent();\n\n    // Set request params.fields for styling.\n    layer.params.fields = mapp.layer.featureFields.fieldsArray(layer);\n\n    const url = `${layer.mapview.host}/api/query?${mapp.utils.paramString({\n      filter: layer.filter?.current,\n      geom,\n      layer: layer.key,\n      locale: layer.mapview.locale.key,\n      table,\n      template: 'mvt',\n      x: tileCoord[1],\n      y: tileCoord[2],\n      z: tileCoord[0],\n      ...layer.params,\n    })}`;\n\n    return url;\n  };\n}\n\n/**\n@function wktTileUrlFunction\n\n@description\nReturns a function that generates the tile URL to request an MVT tile with MVT geometries and ID only.\n\nFeature properties will be requested independently.\n\n@param {layer} layer A decorated format:mvt mapp layer.\n\n@returns {function} A function that generates the tile URL for a given tile coordinate.\n*/\n\nfunction wktTileUrlFunction(layer) {\n  return (tileCoord) => {\n    const table = layer.tableCurrent();\n\n    // The layer has no data for this zoom level.\n    if (!table) {\n      layer.source.clear();\n      return;\n    }\n\n    // The layer does not display and doesn't have clones.\n    if (!layer.display) {\n      layer.source.clear();\n      return;\n    }\n\n    const geom = layer.geomCurrent();\n\n    const url = `${layer.mapview.host}/api/query?${mapp.utils.paramString({\n      geom,\n      layer: layer.key,\n      layer_template: layer.params?.layer_template,\n      locale: layer.mapview.locale.key,\n      srid: layer.mapview.srid,\n      table,\n      template: 'mvt',\n      x: tileCoord[1],\n      y: tileCoord[2],\n      z: tileCoord[0],\n    })}`;\n\n    return url;\n  };\n}\n\n/**\n@function wktPropertiesLoad\n@async\n\n@description\nThe wktPropertiesLoad method is triggered from the layer.changeEndCallbacks methods array when the mapview view is changed. The method is also triggered from the reload method which is called when the layer display is toggled on.\n\nThe wktPropertiesLoad method send a query to the wkt template. The response is passed to the [featureFormats.wkt_properties]{@link module:/layer/featureFormats~wkt_properties} method.\n\nFinally the layer.L.changed() method is called to trigger the [layer.featureStyle]{@link module:/layer/featureStyle~featureProperties} method which assigns feature properties from the layer.featuresObject.\n\n@param {layer} layer A decorated format:mvt mapp layer.\n*/\nasync function wktPropertiesLoad(layer) {\n  const table = layer.tableCurrent();\n\n  if (!table || !layer.display) {\n    layer.source.clear();\n    return;\n  }\n\n  const geom = layer.geomCurrent();\n\n  layer.params.fields = mapp.layer.featureFields.fieldsArray(layer);\n\n  const bounds = layer.mapview.getBounds();\n\n  // Assign current viewport if queryparam is truthy.\n  const viewport = [\n    bounds.west,\n    bounds.south,\n    bounds.east,\n    bounds.north,\n    layer.mapview.srid,\n  ];\n\n  // Assign current viewport if queryparam is truthy.\n  const z = layer.mapview.Map.getView().getZoom();\n\n  const paramString = mapp.utils.paramString({\n    filter: layer.filter?.current,\n    geom,\n    layer: layer.key,\n    locale: layer.mapview.locale.key,\n    no_geom: true,\n    table,\n    template: 'wkt',\n    viewport,\n    z,\n    ...layer.params,\n  });\n\n  const url = `${layer.mapview.host}/api/query?${paramString}`;\n\n  // Debounce request to prevent the query being sent multiple times on initial load.\n  const response = await mapp.utils.xhr({\n    url,\n    debounce: {\n      key: layer.key,\n      delay: 500,\n    },\n  });\n\n  // The featuresObject should be reset before being populated by the featureFormats.wkt_properties method for use in the featureStyle method.\n  // The featuresObject should be empty if the xhr query fails to provide an array response.\n  layer.featuresObject = {};\n\n  if (Array.isArray(response)) {\n    // Set request params.fields for styling.\n    mapp.layer.featureFormats.wkt_properties(layer, response);\n  }\n\n  // Triggers the featureStyle method.\n  layer.L.changed();\n}\n", "/**\n## /layer/formats/tiles\n\nThe module exports the \"tiles\" format method for the Mapp layer decorator method.\n\n@module /layer/formats/tiles\n*/\n\n/**\n@function tiles\n@description\nThe function takes a layer object as input and performs the following steps:\n\n1. It sets default values for `layer.source` and `layer.projection` if they are not already defined.\n2. It creates a parameter string (`layer.paramString`) using the `mapp.utils.paramString` function, passing `layer.params` as an argument.\n3. It creates a new `ol.layer.Tile` object and assigns it to `layer.L`. The tile layer is configured with the following properties:\n   - `source`: A new instance of the tile source based on layer.source. The source is created using `ol.source[layer.source]` and is configured with the projection, url, and transition properties.\n   - `layer`: The layer object itself, allowing access to layer properties within the tile layer.\n   - `zIndex`: The z-index of the layer.\n   \n@param {layer} layer The layer object.\n@property {string} [layer.source='OSM'] The source of the tile layer (e.g., 'OSM', 'XYZ').\n@property {string} [layer.projection='EPSG:3857'] The projection of the tile layer.\n@property {string} [layer.paramString] The parameter string for the tile layer URL.\n@property {Object} [layer.params] Additional parameters for the tile layer.\n@property {string} layer.URI The base URI for the tile layer.\n@property {Object} [layer.style] The style configuration for the layer.\n@property {number} [layer.zIndex=0] The z-index of the layer.\n@property {ol.layer.Tile} layer.L The OpenLayers tile layer object.\n*/\nexport default (layer) => {\n  layer.source ??= 'OSM';\n\n  layer.projection ??= 'EPSG:3857';\n\n  layer.paramString ??= mapp.utils.paramString(layer.params);\n\n  layer.L = new ol.layer.Tile({\n    className: `mapp-layer-${layer.key}`,\n    key: layer.key,\n    source: new ol.source[layer.source]({\n      projection: layer.projection,\n      transition: 0,\n      url: layer.URI + layer.paramString,\n    }),\n    zIndex: layer.zIndex,\n  });\n\n  if (layer.style?.contextFilter) {\n    layer.L.on('prerender', (evt) => {\n      if (evt.context) {\n        evt.context.filter = layer.style.contextFilter;\n        evt.context.globalCompositeOperation = 'source-over';\n      }\n    });\n\n    layer.L.on('postrender', (evt) => {\n      if (evt.context) {\n        evt.context.filter = 'none';\n      }\n    });\n  }\n};\n", "/**\n## /layer/formats/vector\n\nThe module exports the \"vector\" format method for the Mapp layer decorator method.\n\n@requires /layer/featureFormats\n@requires /layer/featureStyle\n@requires /layer/styleParser\n\n@module /layer/formats/vector\n*/\n\n/**\n@global\n@typedef {Object} layer-cluster\nPoint layer cluster configuration.\n@property {number} [distance] The distance threshold [pixel] for OL source clustering.\n@property {string} [label] The field used for labeling the clusters.\n@property {number} [resolution] The resolution parameter for PostGIS database cluster queries.\n@property {boolean} [hexgrid] Use hexgrid clustering query for PostGIS.\n*/\n\n/**\n@function vector\n\n@description\nCreates Openlayers layer and source for vector format mapp layer.\n\n@param {layer} layer The Mapp layer object.\n@property {string} [layer.srid] The spatial reference system identifier (SRID) for the layer.\n@property {Object} [layer.params={}] Parameters for the layer data query.\n@property {function} layer.setSource Method pass features to layer source.\n@property {function} layer.reload Method to reload layer data.\n@property {Array} [layer.features] An array of features for the layer.\n@property {boolean} [layer.fade] - Flag indicating whether to apply a fade effect to the layer.\n@property {layer-cluster} [layer.cluster] Point layer cluster configuration.\n@property {Object} [layer.source] OpenLayers vector source.\n@property {layer-style} layer.style The mapp-layer style configuration.\n@property {number} [layer.zIndex] The zIndex for the layer canvas element.\n*/\nexport default function vector(layer) {\n  if (!layer.srid) {\n    console.warn(`Vector Layer: ${layer.key} missing SRID.`);\n    return;\n  }\n\n  if (!layer.qID) {\n    console.warn(`Vector Layer: ${layer.key} missing qID property.`);\n    return;\n  }\n\n  // Update feature style config.\n  mapp.layer.styleParser(layer);\n\n  if (layer.properties) {\n    console.warn(\n      `Layer: ${layer.key}, layer.properties{} are no longer required for wkt & geojson datasets.`,\n    );\n  }\n\n  // Set default layer params if nullish.\n  layer.params ??= {};\n  layer.params.fields ??= [];\n\n  layer.featureFormat ??= layer.format;\n\n  clusterConfig(layer);\n\n  layer.setSource = async (features) => {\n    // The layer datasource is empty.\n    if (features === null) {\n      layer.L.setSource(null);\n      mapp.layer.featureFields.reset(layer);\n      mapp.layer.featureFields.process(layer);\n      return;\n    }\n\n    if (!features) return;\n\n    layer.Features = await mapp.layer.featureFormats[layer.featureFormat](\n      layer,\n      [features].flat(),\n    );\n\n    layer.source = new ol.source.Vector({\n      features: layer.Features,\n    });\n\n    delete layer.xhr;\n\n    if (layer.fade) mapp.layer.fade(layer);\n\n    // Geojson is a cluster layer.\n    if (layer.cluster?.distance) {\n      // Create cluster source.\n\n      layer.cluster.source = new ol.source.Cluster({\n        distance: layer.cluster.distance,\n        source: layer.source,\n      });\n\n      layer.L.setSource(layer.cluster.source);\n\n      layer.cluster.source.on('change', (e) => clusterSourceChange(e, layer));\n\n      return;\n    }\n\n    // Set source if not cluster\n    layer.L.setSource(layer.source);\n  };\n\n  // Assign reload method to layer.\n  layer.reload = reload;\n\n  // Create Openlayer Vector Layer\n  layer.L = new ol.layer[(layer.vectorImage && 'VectorImage') || 'Vector']({\n    className: `mapp-layer-${layer.key}`,\n    key: layer.key,\n    style: layer.styleFunction || mapp.layer.featureStyle(layer),\n    zIndex: layer.zIndex,\n  });\n\n  layer.setSource(layer.features);\n}\n\n/**\n@function clusterSourceChange\n\n@description\nThe clusterSourceChange event method is called by changes to the cluster source. The method will map all features in cluster source to return an array of features [counts] for each feature in the cluster source. The largest features count from the array will be assigned as the cluster.max_size.\n\n@param {layer} layer The Mapp layer object.\n@property {layer-cluster} layer.cluster The vector layer cluster configuration.\n@property {integer} cluster.max_size The length of features in the largest cluster feature.\n*/\nfunction clusterSourceChange(e, layer) {\n  delete layer.cluster.max_size;\n\n  const features = layer.cluster.source.getFeatures();\n\n  if (!features.length) return;\n\n  const feature_counts = features.map((F) => {\n    const features = F.get('features');\n\n    // This error indicates and issue with the provided feature geometries in the layer vector source.\n    if (!features.length) {\n      console.error(`Empty cluster feature detected.`);\n      return;\n    }\n\n    // Set cluster feature id for highlight interaction.\n    F.set('id', features[0].get('id'), true);\n\n    if (features.length > 1) {\n      // Set cluster count.\n      F.set('count', features.length, true);\n    } else {\n      const featureProperties = features[0].getProperties();\n\n      // Set feature properties for for single location cluster.\n      Object.entries(featureProperties).forEach((entry) => {\n        F.set(entry[0], entry[1], true);\n      });\n    }\n\n    // Return length for calculation of max_size.\n    return features.length;\n  });\n\n  if (!feature_counts.length) return;\n\n  // Calculate max_size for cluster size styling.\n  layer.cluster.max_size = Math.max(...feature_counts);\n}\n\n/**\n@function reload\n\n@description\nThe layer.reload() method determines the table and geometry for the current zoom level. And uses the layer.params{} to create a request for layer features to be added to the layer source.\n\nThe xhr request is debounced by 100ms to prevent requests in quick succession on panning, scroll, and touch zooming.\n\nThe reload method is bound to the layer object and doesn't require any arguments.\n\n@property {Object} layer.params Parameter for data request.\n@property {Object} layer.timeout Timeout for the xhr request.\n*/\nfunction reload() {\n  const layer = this;\n\n  // Do not reload the layer if features have been assigned.\n  if (layer.features) return;\n\n  const table = layer.tableCurrent();\n\n  if (!table) return;\n\n  const geom = layer.geomCurrent();\n\n  if (layer.fade) mapp.layer.fade(layer, true);\n\n  // Set request params.fields for styling.\n  layer.params.fields = mapp.layer.featureFields.fieldsArray(layer);\n\n  const bounds = layer.mapview.getBounds(layer.srid);\n\n  // Assign current viewport if queryparam is truthy.\n  layer.params.viewport &&= [\n    bounds.west,\n    bounds.south,\n    bounds.east,\n    bounds.north,\n    layer.srid,\n  ];\n\n  // Assign current viewport if queryparam is truthy.\n  layer.params.z &&= layer.mapview.Map.getView().getZoom();\n\n  clearTimeout(layer.timeout);\n\n  layer.timeout = setTimeout(() => {\n    layer.xhr = mapp.utils\n      .xhr(\n        `${layer.mapview.host}/api/query?${mapp.utils.paramString({\n          filter: layer.filter?.current,\n          geom,\n          layer: layer.key,\n          locale: layer.mapview.locale.key,\n          srid: layer.srid,\n          table,\n          template: layer.params.template || layer.format,\n          ...layer.params,\n        })}`,\n      )\n      .then((features) => {\n        // An error will be returned if the xhr fails with a bad request 400.\n        if (features instanceof Error) return;\n\n        layer.setSource(features);\n      });\n  }, 100);\n}\n\n/**\n@function clusterConfig\n\n@description\nConfigures the clustering options for a layer.\n\n@param {Object} layer The layer object.\n@property {string} layer.key The key of the layer.\n@property {string} layer.srid The spatial reference system identifier (SRID) for the layer.\n@property {Object} layer.params Parameter for data request.\n@property {Object} layer.cluster The clustering configuration for the layer.\n@property {number} [cluster.distance] The distance threshold for clustering.\n@property {number} [cluster.resolution] The resolution threshold for clustering.\n@property {boolean} [cluster.hexgrid] Flag indicating whether to use hexgrid clustering.\n*/\nfunction clusterConfig(layer) {\n  // The clusterConfig can not work without the layer having a cluster config object.\n  if (typeof layer.cluster !== 'object') return;\n\n  // Check if both cluster.distance and cluster.resolution are set.\n  if (layer.cluster.distance && layer.cluster.resolution) {\n    console.warn(\n      `Layer: ${layer.key}, cluster.distance and cluster.resolution are mutually exclusive. You cannot use them both on the same layer. Please remove one of them. `,\n    );\n    return;\n  }\n\n  // Check if neither cluster.distance and cluster.resolution are set.\n  if (!layer.cluster.distance && !layer.cluster.resolution) {\n    console.warn(\n      `Layer: ${layer.key}, cluster.distance or cluster.resolution must be set.`,\n    );\n    return;\n  }\n\n  // Check if distance is defined as <1 and layer is a format wkt\n  if (layer.cluster.distance < 1) {\n    console.warn(\n      `Layer: ${layer.key}, cluster.distance is less than 1 [pixel]. The cluster config will be removed.`,\n    );\n\n    // Remove the cluster object\n    delete layer.cluster;\n    return;\n  }\n\n  // If cluster.resolution is used, the layer srid must be set to 3857.\n  if (layer.cluster.resolution) {\n    // Check if resolution is numeric.\n    if (typeof layer.cluster.resolution === 'number') {\n      // Assign resolution as float.\n      layer.params.resolution = parseFloat(layer.cluster.resolution);\n    }\n    // Otherwise, warn and return.\n    else {\n      console.warn(`Layer: ${layer.key}, cluster.resolution must be a number.`);\n      return;\n    }\n\n    // Check if srid is set to 4326, not allowed for cluster layer\n    if (layer.srid === '4326') {\n      console.warn(\n        `Layer: ${layer.key}, srid 4326 is not allowed for cluster.resolution layers.`,\n      );\n      return;\n    }\n\n    // Provide default params for resolution cluster.\n    layer.params.viewport = true;\n    layer.params.z = true;\n\n    // Format is cluster if resolution is set.\n    layer.format = 'cluster';\n\n    // Assign default template.\n    layer.params.template ??= layer.cluster.hexgrid ? 'cluster_hex' : 'cluster';\n  }\n}\n", "/**\n## /layer/formats\nThe module exports as default the formats object to access the format module methods from the layer decorator.\n\n@requires /layer/formats/googleMapTiles\n@requires /layer/formats/mapboxStyle\n@requires /layer/formats/maplibre\n@requires /layer/formats/mvt\n@requires /layer/formats/tiles\n@requires /layer/formats/vector\n\n@module /layer/formats\n*/\n\nimport googleMapTiles from './googleMapTiles.mjs';\nimport mapboxStyle from './mapboxStyle.mjs';\nimport maplibre from './maplibre.mjs';\nimport mvt from './mvt.mjs';\nimport tiles from './tiles.mjs';\nimport vector from './vector.mjs';\n\nexport default {\n  cluster: vector,\n  geojson: vector,\n  googleMapTiles,\n  mapboxStyle,\n  maplibre,\n  mvt,\n  tiles,\n  vector,\n  wkt: vector,\n};\n", "/**\n### /layer/styleParser\n\nThe styleParser module exports the styleParser method as default which is intended to check the consistency of layer styles and issue console warnings in regards to backwards compatibility.\n\n@module /layer/styleParser\n*/\n\n/**\n@global\n@typedef {Object} layer-style\n@property {Boolean} [cache] The feature style should be retrieved from the feature 'Styles' property.\n@property {object} theme The current theme to be rendered.\n@property {feature-style} [default] The default style for features.\n@property {feature-style} [highlight] The style for highlighted features.\n@property {Object} [theme] The theme style configuration.\n@property {Object} [themes] Multiple theme style configurations.\n@property {Object} [hover] The hover style configuration.\n@property {Object} [hovers] Multiple hover style configurations.\n@property {Object} [label] The label style configuration.\n@property {Object} [labels] Multiple label style configurations.\n@property {numeric} [zoomInScale] Icon scale is multiplied with mapview zoom level.\n@property {numeric} [zoomOutScale] Icon scale is divided by mapview zoom level.\n*/\n\nconst iconKeys = new Set(['anchor', 'scale', 'url', 'svg', 'type']);\n\nconst styleKeys = new Set([\n  'zIndex',\n  'strokeColor',\n  'strokeWidth',\n  'strokeOpacity',\n  'fillOpacity',\n  'fillColor',\n  'clusterScale',\n  'zoomInScale',\n  'zoomOutScale',\n  'highlightScale',\n  ...iconKeys,\n]);\n\n/**\n@function styleParser\n\n@description\nThe styleParser method parses and validates the mapp.style object and its properties.\n\nThe styleParser method checks the highlight features style and calls the warnings method.\n\nThe clusterStyle method is called to ensure that cluster layer have a cluster style.\n\nIndividual themes in the themes object are parsed and a theme is assigned to the\n\nThe parseTheme method is called for the layer.style.theme and each of the layer.style.themes.\n\nA lookup will be attempted if the theme property is a string. Otherwise the first theme object property from the themes object is assigned as theme if undefined.\n\nA lookup will be attempted if the hover property is a string. Otherwise the first hover object property from the hovers object is assigned as hover if undefined.\n\nA lookup will be attempted if the label property is a string. Otherwise the first label object property from the labels object is assigned as label if undefined.\n\n@param {layer} layer A json layer object.\n@property {layer-style} layer.style The mapp-layer style configuration.\n@property {feature-style} [style.highlight] The feature style applied to features by the highlight interaction.\n@property {object} [style.theme] The current theme applied to the feature styling.\n@property {array} [style.themes] An array of theme objects available to be applied as the layer.style.theme.\n*/\nexport default function styleParser(layer) {\n  layer.style ??= {};\n\n  if (typeof layer.style.highlight === 'object') {\n    // Ensure that highlight zIndex is always on top.\n    layer.style.highlight.zIndex ??= Infinity;\n    layer.style.highlight.highlightScale ??= layer.style.highlight.scale;\n    delete layer.style.highlight.scale;\n  }\n\n  warnings(layer);\n\n  clusterChecks(layer);\n\n  parseTheme(layer.style.theme, layer);\n\n  if (layer.style?.themes) {\n    Object.keys(layer.style.themes).forEach((key) => {\n      // A theme will be represented by a string if the theme has already been parsed as layer.style.theme{}\n      if (layer.style.themes[key] === key) {\n        layer.style.themes[key] = layer.style.theme;\n        return;\n      }\n\n      // required for the lookup of self referenced objects\n      layer.style.themes[key].key = key;\n\n      if (layer.style.themes[key].skip) {\n        delete layer.style.themes[key];\n        return;\n      }\n\n      // required for the lookup of self referenced objects\n      layer.style.themes[key].key = key;\n\n      // assign key as fallback title\n      layer.style.themes[key].title ??= key;\n\n      parseTheme(layer.style.themes[key], layer);\n    });\n\n    // Assign the first key from themes object as theme string property if undefined.\n    layer.style.theme ??= Object.keys(layer.style.themes)[0];\n\n    // Assign theme property from themes object if string.\n    if (typeof layer.style.theme === 'string') {\n      layer.style.theme = layer.style.themes[layer.style.theme];\n    }\n  }\n\n  handleHovers(layer);\n\n  // Handle multiple labels in layer style.\n  if (layer.style?.labels) {\n    Object.keys(layer.style.labels).forEach((key) => {\n      // required for the lookup of self referenced objects\n      layer.style.labels[key].key = key;\n\n      // assign key as fallback title\n      layer.style.labels[key].title ??= key;\n    });\n\n    // Assign the first key from labels object as label string property if undefined.\n    layer.style.label ??= Object.keys(layer.style.labels)[0];\n\n    // Assign label property from labels object if string.\n    if (typeof layer.style.label === 'string') {\n      layer.style.label = layer.style.labels[layer.style.label];\n    }\n  }\n\n  if (layer.style?.icon_scaling?.fields) {\n    Object.keys(layer.style.icon_scaling.fields).forEach((key) => {\n      // required for the lookup of self referenced objects\n      layer.style.icon_scaling.fields[key].key = key;\n\n      // assign key as fallback title\n      layer.style.icon_scaling.fields[key].title ??= key;\n    });\n\n    // Assign the first key from fields object as field string property if undefined.\n    layer.style.icon_scaling.field ??= Object.values(\n      layer.style.icon_scaling.fields,\n    )[0]?.field;\n  }\n}\n\n/**\n@function warnings\n\n@description\nThe warnings method parses the layer style configuration and warns on legacy configurations while trying to rectify these issues.\n\nThe method ensures that the layer-style object has a default feature-style. The default feature-style must have an icon if the layer is a cluster layer.\n\nThe default is a feature-style which must not contain a style object property.\n\nThe icon object of the default style is checked.\n\nThe layer.hover legacy configuration is checked.\n\nThe layer.style.zIndex legacy configuration is checked.\n\nThe layer.icon_scaling legacy configuartion is checked.\n\n@param {layer} layer A json layer object.\n@property {Object} [layer.cluster] Cluster configuration for a point layer.\n@property {Object} [layer.hover] Legacy configuration for style.hover.\n@property {Object} [layer.icon_scaling] Legacy configuration for style.icon_scaling.\n@property {layer-style} layer.style The mapp-layer style configuration.\n@property {feature-style} style.default Default feature style.\n@property {integer} [style.zIndex] Legacy configuration for layer.zIndex.\n*/\nfunction warnings(layer) {\n  if (!layer.style.default) {\n    console.warn(\n      `Layer: ${layer.key} has no implicit default style. Please add style.default.`,\n    );\n\n    // Assign default style for vector layer.\n    // Non cluster layer do not have a default icon style\n    layer.style.default = layer.cluster\n      ? {\n          icon: {\n            type: 'dot',\n          },\n        }\n      : {\n          fillColor: '#fff9',\n          strokeColor: '#333',\n        };\n  }\n\n  // The default is a feature-style which must not contain a style object property.\n  if (layer.style.default.style) {\n    console.warn(\n      `Layer: ${layer.key} has a style object within the default style configuration.`,\n    );\n\n    layer.style.default = layer.style.default.style;\n\n    delete layer.style.default.style;\n  }\n\n  iconObject(layer.style.default);\n\n  // Handle legacy layer.hover configuration.\n  if (layer.hover) {\n    console.warn(\n      `Layer: ${layer.key}, layer.hover{} should be defined within layer.style{}.`,\n    );\n    layer.style.hover = layer.hover;\n    delete layer.hover;\n  }\n\n  // Handle legacy layer.style.zIndex configuration.\n  if (layer.style.zIndex) {\n    console.warn(\n      `Layer: ${layer.key}, layer.style.zIndex has been deprecated. Use layer.zIndex instead.`,\n    );\n  }\n\n  // Handle legacy layer.icon_scaling configuration.\n  if (layer.icon_scaling) {\n    console.warn(\n      `Layer: ${layer.key}, layer.icon_scaling has been assigned to layer.style.icon_scaling`,\n    );\n\n    layer.style.icon_scaling ??= layer.icon_scaling;\n  }\n}\n\n/**\n@function clusterChecks\n\n@description\nThe clusterChecks styleParser module method checks the style configuration for a cluster layer.\n\nCluster layer are by defintion point layer and must have style.default.icon to represent point feature geometries.\n\nOther vector geometries can not be displayed in a cluster feature layer. Stroke and fill styles will be removed from the style.default{} configuration.\n\nThe style.cluster{} configuration will be spread into a default cluster style object with clusterScale=1.\n\nzoomInScale and zoomOutScale may apply to point features which are not cluster features and are moved to the layer.style.\n\n@param {layer} layer A json layer object.\n@property {layer-style} layer.style The mapp-layer style configuration.\n@property {Object} layer.cluster Cluster configuration for a point layer.\n@property {feature-style} style.default Default feature style.\n@property {feature-style} style.cluster Style for cluster feature.\n@property {feature-style} style.selected Style for features of selected locations.\n*/\nfunction clusterChecks(layer) {\n  if (!layer.cluster) return;\n\n  if (!layer.style.default.icon) {\n    layer.style.default = {\n      icon: {\n        type: 'dot',\n      },\n    };\n\n    console.warn(\n      `Cluster Layer: ${layer.key} has no default icon. 'Dot' will be assigned.`,\n    );\n  }\n\n  // Cluster layer must not have stroke or fill styles.\n  Object.keys(layer.style.default)\n    .filter((key) => !['icon', 'scale'].includes(key))\n    .forEach((key) => {\n      console.warn(\n        `Cluster Layer: ${layer.key}; ${key} key removed from default style.`,\n      );\n\n      delete layer.style.default[key];\n    });\n\n  // Define default style cluster icon\n  layer.style.cluster = {\n    clusterScale: 1,\n    icon: {\n      type: 'dot',\n    },\n    ...layer.style.cluster,\n  };\n\n  if (layer.style.cluster.zoomInScale) {\n    layer.style.zoomInScale = layer.style.cluster.zoomInScale;\n\n    delete layer.style.cluster.zoomInScale;\n  }\n\n  if (layer.style.cluster.zoomOutScale) {\n    layer.style.zoomOutScale = layer.style.cluster.zoomOutScale;\n\n    delete layer.style.cluster.zoomOutScale;\n  }\n\n  if (Array.isArray(layer.style.cluster.icon)) {\n    layer.style.cluster.icon.forEach(iconUrlSVG);\n  } else {\n    iconUrlSVG(layer.style.cluster.icon);\n  }\n}\n\n/**\n@function iconUrlSVG\n\n@description\nThe method assigns the url icon property from the svg icon property. The svg definition will be removed. Previously it was possible to define the URL as url or svg property. This required multiple checks. It is easier to just use the Openlayers url property.\n\n@param {Object} icon A JSON style icon configuration.\n@property {string} icon.url The url for the icon to be rendered on a point feature.\n*/\nfunction iconUrlSVG(icon) {\n  icon.url ??= icon.svg;\n  delete icon.svg;\n}\n\n/**\n@function parseTheme\n\n@description\nThe parseTheme method checks whether a theme and it's categories have consistent style objects.\n\n@param {Object} theme A json theme object.\n@param {layer} layer A json layer object.\n@property {string} theme.type The type of the theme.\n@property {array} theme.categories An ordered array of theme categories.\n@property {layer-style} layer.style The mapp-layer style configuration.\n@property {feature-style} style.default Default feature style.\n*/\nfunction parseTheme(theme, layer) {\n  if (typeof theme !== 'object') return;\n\n  // Check on if the theme.type exists.\n  if (!Object.hasOwn(mapp.layer.themes, theme.type)) {\n    console.warn(`Layer: ${layer.key}; Theme Type: ${theme.type} unavailable.`);\n    return;\n  }\n\n  if (typeof theme.style === 'object') {\n    // Assign the default style to the theme.style\n    theme.style = {\n      ...structuredClone(layer.style.default),\n      ...theme.style,\n    };\n\n    iconObject(theme.style);\n  }\n\n  if (typeof theme.cat === 'object') {\n    theme.categories = Object.keys(theme.cat).map((key) => {\n      const cat = theme.cat[key];\n\n      cat.label ??= key;\n      cat.value ??= key;\n\n      return cat;\n    });\n\n    delete theme.cat;\n  }\n\n  if (Array.isArray(theme.cat_arr)) {\n    theme.categories = theme.cat_arr;\n\n    delete theme.cat_arr;\n  }\n\n  graduatedTheme(theme);\n\n  theme.categories?.forEach((cat) => {\n    cat.label ??= cat.value;\n\n    if (cat.icon) {\n      cat.style = {\n        icon: cat.icon,\n      };\n\n      delete cat.icon;\n    }\n\n    catStyle(cat, layer);\n  });\n\n  // Check validity of categorized theme with multiple fields.\n  if (theme.type === 'categorized' && Array.isArray(theme.fields)) {\n    theme.categories.forEach((cat) => {\n      if (!theme.fields.includes(cat.field)) {\n        console.warn(\n          `Layer: ${layer.key}; Cat ${cat.label} missed valid field.`,\n        );\n      }\n\n      // Multiple field cat theme style must be icon.\n      if (!cat.style.icon) {\n        console.warn(\n          `Layer: ${layer.key}; Cat ${cat.label} has invalid icon style.`,\n        );\n\n        cat.style.icon = { type: 'dot' };\n      }\n    });\n  }\n}\n\n/**\n@function graduatedTheme\n\n@description\nThe checks the order of theme categories according to their value. The method will shortcircuit if the type of the theme is not graduated.\n\n@param {Object} theme A json theme object.\n@param {layer} layer A json layer object.\n@property {string} theme.type The type of the theme.\n@property {string} theme.graduated_breaks The value order of categories, eg. 'less_than' or 'greater_than'\n@property {array} theme.categories An ordered array of theme categories.\n*/\nfunction graduatedTheme(theme) {\n  if (theme.type !== 'graduated') return;\n\n  if (!['less_than', 'greater_than'].includes(theme.graduated_breaks)) {\n    theme.graduated_breaks = 'less_than';\n  }\n\n  theme.categories.forEach((cat) => (cat.value = Number(cat.value)));\n\n  if (theme.graduated_breaks === 'less_than') {\n    theme.categories.sort((a, b) => (a.value > b.value ? 0 : -1));\n  } else {\n    theme.categories.sort((a, b) => (a.value > b.value ? -1 : 0));\n  }\n}\n\n/**\n@function catStyle\n\n@description\nThe catStyle method parses the style object of a theme category object.\n\nCategory themes are attempted to be merged with the default style if possible.\n\n@param {object} cat The category object.\n@param {layer} layer The layer reference for the style/theme/cat object.\n*/\nfunction catStyle(cat, layer) {\n  cat.style ??= {};\n\n  // Style arrays are assumed to be valid.\n  if (Array.isArray(cat.style)) return;\n\n  // Ensure that the icon object is within a style object.\n  if (cat.icon) {\n    cat.style = {\n      icon: cat.icon,\n    };\n    delete cat.icon;\n  }\n\n  const defaultStyle = structuredClone(layer.style.default);\n\n  if (cat.style.icon) {\n    // Do not merge default style into icon array.\n    if (Array.isArray(cat.style.icon)) {\n      cat.style.icon.forEach(iconUrlSVG);\n      return;\n    }\n\n    // Do not merge default style into icon with type definition.\n    if (cat.style.icon.type) return;\n\n    iconUrlSVG(cat.style.icon);\n\n    // Do not merge default style into svg [type] icons.\n    if (cat.style.icon.url) return;\n\n    if (defaultStyle.icon && !Array.isArray(defaultStyle.icon)) {\n      cat.style.icon = {\n        ...defaultStyle.icon,\n        ...cat.style.icon,\n      };\n    }\n\n    return;\n  }\n\n  // Create a mergeStyle from valid styleKeys\n  const mergeStyle = {};\n\n  Object.keys(defaultStyle)\n    .filter((key) => styleKeys.has(key))\n    .forEach((key) => (mergeStyle[key] = defaultStyle[key]));\n\n  cat.style = {\n    ...mergeStyle,\n    ...cat.style,\n  };\n\n  Object.keys(cat)\n    .filter((key) => styleKeys.has(key))\n    .forEach((key) => {\n      cat.style[key] = cat[key];\n      delete cat[key];\n    });\n\n  iconObject(cat.style);\n\n  // Assign default icon if no cat style icon could be created.\n  if (!cat.style.icon && defaultStyle.icon) {\n    console.warn(\n      `Layer:${layer.key}, Failed to evaluate icon: ${JSON.stringify(\n        cat,\n      )}. Default icon will be assigned.`,\n    );\n\n    cat.style.icon = defaultStyle.icon;\n  }\n}\n\n/**\n@function iconObject\n\n@description\nThe iconObject method parses a feature-style object without an icon object to check whether there are icon object specific properties defined in the style object. An icon object will be created from the icon specific properties with these properties being removed from the style object itself.\n\n@param {feature-style} style\n@property {object} [style.icon] The style object already has an icon definition.\n*/\nfunction iconObject(style) {\n  if (Array.isArray(style.icon)) {\n    style.icon.forEach(iconUrlSVG);\n\n    // Turns array of 1 into icon object\n    if (style.icon.length === 1) {\n      style.icon = style.icon[0];\n    }\n    return;\n  }\n\n  // The style object already has an icon object.\n  if (!style.icon) {\n    // Create icon object if style has an iconKey property ['anchor', 'scale', 'url', 'svg', 'type']\n    Object.keys(style)\n      .filter((key) => iconKeys.has(key))\n      .forEach((key) => {\n        style.icon ??= {};\n        style.icon[key] = style[key];\n        delete style[key];\n      });\n  }\n\n  if (!style.icon) return;\n\n  iconUrlSVG(style.icon);\n}\n\n/**\n@description\nThe handleHovers method parses the layer's hover/s properties.\nIt provides fallback values to the hover/s key, title properties as well as assign a featureHover method if not provided.\nIt also assigns the first hover string from the hovers if undefined.\n@param {layer} layer The layer reference for the style/hover/s object.\n@property {layer-style} layer.style The mapp-layer style configuration.\n@property {string} [style.hover] The current hover applied to the feature styling.\n@property {array} [style.hovers] An array of hover objects available to be applied as the layer.style.hover.\n */\nfunction handleHovers(layer) {\n  // Handle multiple hovers in layer style.\n  if (layer.style?.hovers) {\n    Object.keys(layer.style.hovers).forEach((key) => {\n      // required for the lookup of self referenced objects\n      layer.style.hovers[key].key = key;\n\n      // assign key as fallback title\n      layer.style.hovers[key].title ??= key;\n    });\n\n    // Assign the first key from hovers object as hover string property if undefined.\n    layer.style.hover ??= Object.keys(layer.style.hovers)[0];\n\n    // Assign hover property from hovers object if string.\n    if (typeof layer.style.hover === 'string') {\n      layer.style.hover = layer.style.hovers[layer.style.hover];\n    }\n  }\n\n  // Set default featureHover method if not provided.\n  if (layer.style?.hover) {\n    layer.style.hover.method ??= mapp.layer.featureHover;\n  }\n}\n", "/**\n## /layer/themes/basic\n\nThe layer theme module exports a method for basic themes.\n\n@module /layer/themes/basic\n*/\n\n/**\n@function basic\n\n@description\nThe basic [theme] method spreads the theme.style object into the feature.style.\n\n@param {Object} theme The layer.style.theme object.\n@param {Object} feature The feature object.\n*/\nexport default function basic(theme, feature) {\n  // Spread theme style to retain scale property\n  feature.style = {\n    ...feature.style,\n    ...theme.style,\n  };\n}\n", "/**\n## /layer/themes/categorized\n\nThe layer theme module exports a method for categorized themes.\n\n@module /layer/themes/categorized\n*/\n\n/**\n@function categorized\n\n@description\nThe categorized theme method will assign a style from category matching the features properties.\n\nCluster features may not be styled by a categorized theme.\n\nA theme can have a fields array to apply an icon style array for the individual property fields.\n\n@param {Object} theme The theme configuration object.\n@param {Object} feature The feature object.\n@property {Array} theme.categories\n@property {string} [theme.field] The feature property field to theme.\n@property {array} [theme.fields] A fields array to style multiple feature properties.\n@property {Object} feature.properties\n@property {Array} [properties.features] A cluster feature will have a features array property.\n*/\nexport default function categorized(theme, feature) {\n  // The categorized theme requires feature.properties.\n  if (!feature.properties) return;\n\n  // Cluster features can not be styled by category.\n  if (feature.properties.features?.length > 1) return;\n\n  let flat;\n\n  // Theme is using multiple fields.\n  if (Array.isArray(theme.fields)) {\n    // Map different theme fields\n    feature.style.icon = theme.fields\n      .map((field) => {\n        // Get the field value from feature properties\n        const catValue = feature.properties[field];\n\n        // Find category matching field and catValue\n        const cat = theme.categories.find(\n          (cat) =>\n            (cat.value === encodeURIComponent(catValue) ||\n              cat.value === catValue) &&\n            cat.field === field,\n        );\n\n        if (!cat) return;\n\n        flat ||= Array.isArray(cat.style.icon);\n\n        return cat.style.icon;\n\n        // Filter out empty icon entries from map response.\n      })\n      .filter((icon) => !!icon);\n\n    if (flat) {\n      feature.style.icon = feature.style.icon.flat();\n    }\n\n    return;\n  }\n\n  const catValue = feature.properties[theme.field];\n\n  const cat = theme.categories.find(\n    (cat) =>\n      cat.value === encodeURIComponent(catValue) || cat.value === catValue,\n  );\n\n  if (!cat) return;\n\n  if (cat.style === null) {\n    feature.style = null;\n    return;\n  }\n\n  // Spread cat style to retain scale property\n  feature.style = {\n    ...feature.style,\n    ...cat.style,\n  };\n}\n", "/**\n## /layer/themes/distributed\n\nThe layer theme module exports a method for distributed themes.\n\n@module /layer/themes/distributed\n*/\n\n/**\n@function distributed\n@description\nThe distributed theme method assign a style to a feature from the themes categories array.\n\nThe method will iterate of features which intersect the bounding box of the current feature and attempts to assign a category style which isn't used by any intersecting feature.\n\n@param {Object} theme The theme configuration object.\n@param {Object} feature The feature object.\n\n@property {Array} theme.categories An array of category objects.\n@property {Object} feature.properties The properties of the feature.\n@property {string} [theme.field='id'] The field name used for determining the unique value.\n@property {Object} [theme.lookup={}] An object mapping unique values to their assigned styles.\n@property {Array} [theme.boxes=[]] An array of bounding boxes for the features.\n@property {number} [theme.index=0] The current index for assigning styles.\n*/\nexport default function distributed(theme, feature) {\n  theme.lookup ??= {};\n  theme.boxes ??= [];\n  theme.field ??= 'id';\n\n  // Get feature identifier for theme.\n  const val = String(feature.properties[theme.field]);\n\n  // Assign theme.style if val is falsy.\n  if (!val) {\n    return;\n  }\n\n  // The feature field property value already has a style assigned.\n  if (theme.lookup[val]) {\n    feature.style = theme.lookup[val].style;\n    return;\n  }\n\n  // Define as 0 or increase theme.index\n  if (theme.index === undefined) {\n    theme.index = 0;\n  } else {\n    theme.index++;\n  }\n\n  // Reset cat index to 0 if the index reaches the length of the cat array.\n  if (theme.index === theme.categories.length) {\n    theme.index = 0;\n  }\n\n  // Get feature bounding box from geometry extent.\n  const bbox = {\n    extent: feature.getGeometry().getExtent(),\n  };\n\n  if (!bbox.extent) return;\n\n  // A point feature will have matching bbox corner coordinates.\n  if (bbox.extent[0] === bbox.extent[2] && bbox.extent[1] === bbox.extent[3]) {\n    // Assign the style to the lookup object for the feature field property value.\n    theme.lookup[val] = theme.categories[theme.index];\n    theme.categories[theme.index].values ??= [];\n    theme.categories[theme.index].values.push(val);\n\n    feature.style = theme.lookup[val].style;\n    return;\n  }\n\n  // Find intersecting bounding boxes with their assigned cat index.\n  const intersects = theme.boxes.filter(\n    (b) =>\n      !(\n        bbox.extent[0] > b.extent[2] ||\n        bbox.extent[2] < b.extent[0] ||\n        bbox.extent[1] > b.extent[3] ||\n        bbox.extent[3] < b.extent[1]\n      ),\n  );\n\n  // Push the current bbox into the array.\n  theme.boxes.push(bbox);\n\n  const set = new Set(intersects.map((item) => item.themeIdx));\n\n  // Current index is already in set of intersecting boxes.\n  if (set.has(theme.index)) {\n    // Find index which is not in set if possible.\n    for (let free = 0; free < theme.categories.length; free++) {\n      if (set.has(free)) continue;\n      // Assign free index and break loop.\n      bbox.themeIdx = free;\n      break;\n    }\n  }\n\n  bbox.themeIdx ??= theme.index;\n\n  // Assign the style to the lookup object for the feature field property value.\n  theme.lookup[val] = theme.categories[bbox.themeIdx];\n  theme.categories[theme.index].values ??= [];\n  theme.categories[theme.index].values.push(val);\n\n  feature.style = theme.lookup[val].style;\n}\n", "/**\n## /layer/themes/graduated\n\nThe layer theme module exports a method for graduated themes.\n\n@module /layer/themes/graduated\n*/\n\n/**\n@function graduated\n@description\nThe graduated theme method iterates through the ordered categories array and compares a numeric feature field value with the category.\nThe iteration will break if the field value exceeds the category value.\n\n@param {Object} theme The theme configuration object.\n@param {Object} feature The feature object.\n@property {string} theme.field The field name used for determining the category.\n@property {Array} theme.categories An array of category objects.\n@property {string} theme.graduated_breaks The comparison operator (\"less\" or \"more\").\n@property {Object} feature.properties The properties of the feature.\n@property {Array} [properties.features] An array of sub-features.\n*/\nconst graduated_breaks = {\n  greater_than: (val) => (cat) => val >= cat.value,\n  less_than: (val) => (cat) => val <= cat.value,\n};\nexport default function graduated(theme, feature) {\n  // The graduated theme requires feature.properties.\n  if (!feature.properties) return;\n\n  const catValue = Array.isArray(feature.properties.features)\n    ? // Reduce array of features to sum catValue\n      feature.properties.features.reduce(\n        (total, F) => total + Number(F.getProperties()[theme.field]),\n        0,\n      )\n    : // Get catValue from cat or field property.\n      parseFloat(feature.properties[theme.field]);\n\n  if (!isNaN(catValue) && catValue !== null) {\n    const index = theme.categories.findIndex(\n      graduated_breaks[theme.graduated_breaks](catValue),\n    );\n\n    const cat = theme.categories.at(index);\n\n    if (cat.style === null) {\n      feature.style = null;\n      return;\n    }\n\n    // Spread cat style to retain scale property\n    feature.style = {\n      ...feature.style,\n      ...cat.style,\n    };\n  }\n}\n", "/**\n## /layer\n\nThe layer module imports the Mapp layer decorator method and utility methods to render Mapp layer in an Openlayers mapview.Map object.\n\n@requires /layer/decorate\n@requires /layer/fade\n@requires /layer/featureFields\n@requires /layer/featureFormats\n@requires /layer/featureHover\n@requires /layer/featureStyle\n@requires /layer/styleParser\n\n@module /layer\n*/\n\n/**\n@global\n@typedef {Object} layer\nA mapp-layer object is a decorated JSON layer object which has been added to a mapview.\n@property {string} layer.srid='3857' Feature layer require a spatial reference identifier (SRID).\n@property {Object} L Openlayers [layer class]{@link https://openlayers.org/en/latest/apidoc/module-ol_layer_Layer-Layer.html} object.\n@property {boolean} layer.display Whether the layer should be displayed.\n@property {layer-style} layer.style The mapp-layer style configuration.\n@property {string} layer.format The format of the layer data.\n@property {layer-cluster} [layer.cluster] Point layer cluster configuration.\n@property {string} [layer.table] Table name for layer features.\n@property {Array} [layer.tables] An array of tables for different zoom level.\n@property {number} [layer.zIndex] The zIndex for the layer canvas element.\n@property {Object} layer.mapview mapview typedef object.\n*/\n\nimport decorate from './decorate.mjs';\nimport fade from './fade.mjs';\nimport * as featureFields from './featureFields.mjs';\nimport * as featureFormats from './featureFormats.mjs';\nimport featureHover from './featureHover.mjs';\nimport featureStyle from './featureStyle.mjs';\nimport formats from './format/_format.mjs';\nimport styleParser from './styleParser.mjs';\nimport basic from './themes/basic.mjs';\nimport categorized from './themes/categorized.mjs';\nimport distributed from './themes/distributed.mjs';\nimport graduated from './themes/graduated.mjs';\n\nexport default {\n  decorate,\n  fade,\n  featureFields,\n  featureFormats,\n  featureHover,\n  featureStyle,\n  formats,\n  // The featureStyle method supersedes the deprecated Style method.\n  Style: featureStyle,\n  styleParser,\n  themes: {\n    basic,\n    categorized,\n    distributed,\n    graduated,\n  },\n};\n", "/**\n### /location/create\n\n@module /location/create\n*/\n\n/**\n@function createLocation\n\n@description\nThe createLocation method creates a location from a JSON feature and stores the new Location in the layer data at rest.\n\nThe layer will be reloaded to show the new location in the mapview.\n\nDynamic tile generation for MVT layer may lag and not represent recently inserted rows. The feature will be checked for inclusion and the tile generation will be attempted at a 1 second interval until the feature is included in the generated tiles.\n\nThe method will attempt to get the location from the layer data at rest.\n\n@param {Object} feature JSON feature. \n@param {Object} interaction Mapview drawing interaction.\n@param {layer} layer Decorated Mapp Layer.\n\n@property {Object} feature.geometry GeoJSON geometry for new location.\n@property {Object} [interaction.defaults] defaults{} object properties are stored as field columns in the location record.\n@property {Object} [interaction.default_fields] default_fields{} object keys are assigned as interaction.defaults properties with the values used to lookup interaction object properties values.\n*/\nexport default async function createLocation(feature, interaction, layer) {\n  // If the feature is null, return.\n  if (!feature) return;\n\n  // Get the current table and set new to true.\n  const location = {\n    layer,\n    new: true,\n    table: layer.tableCurrent(),\n  };\n\n  // Assign defaults from interaction[default_fields]\n  if (interaction.default_fields) {\n    interaction.defaults ??= {};\n\n    Object.entries(interaction.default_fields).forEach((entry) => {\n      interaction.defaults[entry[0]] = interaction[entry[1]];\n    });\n  }\n\n  // Store location in database.\n  // The id must be returned from a serial ID field.\n  try {\n    location.id = await mapp.utils.xhr({\n      body: JSON.stringify({\n        [layer.geom]: feature.geometry,\n        ...interaction?.defaults,\n        ...layer.draw?.defaults,\n      }),\n      method: 'POST',\n      url:\n        `${layer.mapview.host}/api/query?` +\n        mapp.utils.paramString({\n          layer: layer.key,\n          locale: layer.mapview.locale.key,\n          table: location.table,\n          template: 'location_new',\n        }),\n    });\n  } catch (err) {\n    console.error('Error saving location:', err);\n    mapp.ui.elements.alert({ text: mapp.dictionary.location_new_failed });\n    return;\n  }\n\n  // Check whether feature is loaded on MVT update.\n  if (layer.format === 'mvt') {\n    layer.features = [];\n    layer.source.on('tileloadend', concatFeatures);\n\n    function concatFeatures(e) {\n      layer.features = layer.features.concat(e.tile.getFeatures());\n    }\n\n    setTimeout(checkFeature, 1000);\n\n    function checkFeature() {\n      const found = layer.features?.find(\n        (F) => F.properties?.id === location.id,\n      );\n      if (found) {\n        layer.source.un('tileloadend', concatFeatures);\n      } else {\n        layer.reload();\n      }\n    }\n  }\n\n  // Layer must be reloaded to reflect geometry changes.\n  layer.reload();\n\n  // The changeEnd event is required for dataview updates.\n  layer.mapview.Map.getTargetElement().dispatchEvent(\n    new CustomEvent('changeEnd'),\n  );\n\n  // Get the newly created location.\n  mapp.location.get(location);\n}\n", "/**\n### /location/decorate\n\nThe location decorator module provides methods to decorate an object as location typedef.\n\nDictionary entries:\n- confirm_delete\n- location_save_changes\n\n@requires /dictionary\n@requires /utils/xhr\n@requires /utils/paramString\n@requires /ui/elements/confirm\n\n@module /location/decorate\n*/\n\n/**\n@global\n@typedef {Object} location\nA decorated mapp location.\n\n@property {layer} layer The layer from which the location data was queried.\n@property {string} [getTemplate=\"location_get\"] Query from which to retrieve location data.\n@property {string} [table] Layer table from which to get the location data.\n@property {Array} Layers Array of Openlayer Layers (with Source) to store geometries associated with the location.\n@property {Array} updateCallbacks An array of methods called in the execution of the location.update() method.\n@property {Array} removeCallbacks An array of methods called in the execution of the location.remove() method.\n@property {Array} infoj Array of infoj-entry objects with their values populated by the location get() method.\n@property {function} confirmUpdate {@link module:/location/decorate~confirmUpdate}\n@property {function} getExtent {@link module:/location/decorate~getExtent}\n@property {function} flyTo {@link module:/location/decorate~flyTo}\n@property {function} removeEdits {@link module:/location/decorate~removeEdits}\n@property {function} restoreEdits {@link module:/location/decorate~restoreEdits}\n@property {function} removeLayer {@link module:/location/decorate~removeLayer}\n@property {function} remove {@link module:/location/decorate~remove}\n@property {function} syncFields {@link module:/location/decorate~syncFields}\n@property {function} update {@link module:/location/decorate~update}\n@property {HTMLElement} [view] The location view displayed in the location listview in the default Mapp application view.\n*/\n\n/**\n@function decorate\n\n@description\nThe location decorator method creates mapp-location typedef object from a JSON location.\n\n@param {object} location JSON location.\n\n@returns {location} Decorated Mapp Location.\n*/\nexport default function decorate(location) {\n  Object.assign(location, {\n    confirmUpdate,\n    getExtent,\n    flyTo,\n    Layers: [],\n    removeLayer,\n    remove,\n    removeCallbacks: [],\n    removeEdits,\n    restoreEdits,\n    syncFields,\n    trash,\n    update,\n    updateCallbacks: [],\n  });\n\n  return location;\n}\n\n/**\n@function remove\n@this location\n\n@description\nThe remove method is bound to a location in the location.decorate method.\n\nthis being the location, the method will first remove itself to prevent the method being called twice.\n\nThe remove method will free the location record by deleting the location.hook.\n\nA location.view HTMLElement will be removed from the DOM.\n\nAny Openlayers layer in the location.Layers[] array will be removed from the mapview.\n\nThe highlight interaction will be assigned to the location mapview.\n\nThe location layer will be reload [and restyled in the process].\n\nAny methods in the location.removeCallbacks[] array will be executed.\n*/\nfunction remove() {\n  // Checks may be performed after async oprations\n  // whether a location has already been removed.\n  delete this.remove;\n\n  this.layer.mapview.hooks && mapp.hooks.filter('locations', this.hook);\n\n  delete this.layer.mapview.locations[this.hook];\n\n  this.view instanceof HTMLElement && this.view.remove();\n\n  this.Layers?.forEach((entry) => this.removeLayer(entry));\n\n  // Restore highlight interaction.\n  // A different interaction may have been set from a location method.\n  this.layer.mapview.interaction?.type !== 'highlight' &&\n    this.layer.mapview.interactions.highlight();\n\n  // Reload the layer if possible.\n  this.layer?.reload?.();\n\n  this.removeCallbacks?.forEach((fn) => typeof fn === 'function' && fn(this));\n}\n\n/**\n@function confirmUpdate\n@async\n@this location\n\n@description\nThe method checks for unsaved changes in the location infoj entries.\n\nA confirm dialog is presented if unsaved changes are detected.\n\nConfirming the dialog will call the location update method with the provided callback param. The method will return true in this case.\n\nnull will be returned if the user cancels the confirm dialog.\n\n@param {function} [callback] The callback function overrides the default location updateCallbacks.\n\n@return {Promise<true|null>} Returns true after the location update has been executed. Returns null if the update is cancelled.\n*/\nasync function confirmUpdate(callback) {\n  // Check other infoj entries for unsaved changed.\n  const unsavedChanges = this.infoj.some(\n    (entry) => typeof entry.newValue !== 'undefined',\n  );\n\n  if (unsavedChanges) {\n    const confirmUpdate = await mapp.ui.elements.confirm({\n      text: mapp.dictionary.location_save_changes,\n    });\n\n    if (confirmUpdate) {\n      await this.update(callback);\n      return true;\n    } else {\n      return null;\n    }\n  }\n}\n\n/**\n@function update\n@async\n@this location\n\n@description\nThe update method will abort if some of the location.infoj entries is invalid.\n\nJSON newValues are created for any json or jsonb type entries in the location.infoj array.\n\nAn xhr POST request with all newValues is passed to location_update query template.\n\ninfoj entry values are set to the newValues after a successful update.\n\nDependent fields for updated entries is an array of fields that is passed to the syncFields method, to retrieve the updated values from the location.\n\nThese dependents fields are reloaded with the updated values from the location.\n\nDependent layers is an array of layer keys that will be reloaded after the update.\n\nA callback function can be provided to override the execution of methods in the location updateCallbacks array. This allows to provide a function to render the location view without changing the editing state and execute a modify or draw interaction from a geometry entry.\n\n@param {function} [callback] The callback function overrides the default location updateCallbacks.\n*/\nasync function update(callback) {\n  if (this.infoj.some((entry) => entry.invalid)) {\n    mapp.ui.elements.alert({ text: mapp.dictionary.invalid_entry_value });\n    return new Error('Unable to update.');\n  }\n\n  // Create newValue for jsonb entries.\n  this.infoj\n    .filter((entry) => entry.jsonb_key)\n    .filter((entry) => entry.jsonb_field)\n    .filter((entry) => typeof entry.newValue !== 'undefined')\n    .forEach((entry) => {\n      entry.newValue = {\n        jsonb: {\n          [entry.jsonb_field]: {\n            [entry.jsonb_key]: entry.newValue,\n          },\n        },\n      };\n    });\n\n  // Create newValue on json_field entries.\n  this.infoj\n    .filter((entry) => entry.json_field)\n    .filter((entry) => entry.json_key)\n    .filter((entry) => typeof entry.newValue !== 'undefined')\n    .forEach((entry) => {\n      const fieldEntry = this.infoj.find(\n        (_entry) => _entry.field === entry.json_field,\n      );\n\n      fieldEntry.newValue ??= fieldEntry.value || {};\n\n      fieldEntry.newValue[entry.json_key] = entry.newValue;\n\n      delete entry.newValue;\n    });\n\n  // Map newValues from infoj entry objects.\n  const newValues = Object.fromEntries(\n    this.infoj\n      .filter((entry) => typeof entry.newValue !== 'undefined')\n      .map((entry) => [entry.field, entry.newValue]),\n  );\n\n  // Shortcircuit if no update is required.\n  if (!Object.keys(newValues).length) return;\n\n  const location_update = await mapp.utils.xhr({\n    body: JSON.stringify(newValues),\n    method: 'POST',\n    url:\n      `${this.layer.mapview.host}/api/query?` +\n      mapp.utils.paramString({\n        id: this.id,\n        layer: this.layer.key,\n        locale: this.layer.mapview.locale.key,\n        table: this.table,\n        template: 'location_update',\n      }),\n  });\n\n  if (location_update instanceof Error) {\n    mapp.ui.elements.alert({ text: mapp.dictionary.location_update_failed });\n    this.view?.classList.remove('disabled');\n    return;\n  }\n\n  // Find newValue entries for update.\n  const dependents = this.infoj\n    .filter((entry) => typeof entry.newValue !== 'undefined')\n    .map((entry) => {\n      // Update entry.values with newValues.\n      entry.value = entry.newValue;\n\n      // Remove newValue\n      delete entry.newValue;\n\n      // Iterate through the dependents_layers array\n      if (Array.isArray(entry.dependents_layers)) {\n        entry.dependents_layers.forEach((layer) => {\n          // Find the layer in mapview.\n          const mapview_layer = entry.location.layer.mapview.layers[layer];\n\n          // If the layer exists, reload it.\n          if (mapview_layer) mapview_layer.reload();\n        });\n      }\n\n      return entry.dependents;\n    })\n    // Flatten dependents array and filter out undefined values.\n    .flat()\n    .filter((dependents) => dependents !== undefined);\n\n  // sync dependent fields\n  if (dependents.length) await this.syncFields([...new Set(dependents)]);\n\n  // Reload layer.\n  this.layer.reload();\n\n  // Ensure that modify/draw interactions are finished.\n  this.layer.mapview.interactions.highlight();\n\n  if (callback instanceof Function) {\n    callback(this);\n    return;\n  }\n\n  // Execute update callbacks.\n  this.updateCallbacks?.forEach((fn) => typeof fn === 'function' && fn(this));\n}\n\n/**\n@function syncFields\n@async\n@this location\n\n@description\nThe syncFields method sends a parameterised query to the location_get query template. The fields parameter will be populated from the fields params argument.\n\nValues of the location [this] infoj entry matching the fields will be updated with values from the query response.\n\n@param {array} fields\n*/\nasync function syncFields(fields) {\n  // fields must be an array\n  if (!Array.isArray(fields)) {\n    fields = [fields];\n  }\n\n  const response = await mapp.utils.xhr(\n    `${this.layer.mapview.host}/api/query?` +\n      mapp.utils.paramString({\n        fields: fields.join(),\n        id: this.id,\n        layer: this.layer.key,\n        locale: this.layer.mapview.locale.key,\n        table: this.table,\n        template: 'location_get',\n      }),\n  );\n\n  // Return if response is falsy or error.\n  if (!response || response instanceof Error) {\n    console.warn(\n      'No data returned from location_get request using ID:',\n      this.id,\n    );\n    return;\n  } else if (Array.isArray(response)) {\n    console.warn(\n      `Location response returned more than one record for Layer: ${this.layer.key}.`,\n    );\n    console.log('Location Get Response:', response);\n    return;\n  }\n\n  this.infoj\n    .filter((entry) => typeof response[entry.field] !== 'undefined')\n    .forEach((entry) => {\n      entry.value = response[entry.field];\n    });\n}\n\n/**\n@function flyTo\n@async\n@this location\n\n@description\nCenters the mapview arround the outermost extent of a location, this will also adhere to the maximum\nzoom level specified on the layer.\n\nThe greatest extent of these is used in {@link module:/mapview/fitView}.\n\n@param {integer} [maxZoom] The maximum zoom level of the layer.\n*/\nasync function flyTo(maxZoom) {\n  const flyToExtent = await this.getExtent();\n\n  flyToExtent &&\n    this.layer.mapview.fitView(flyToExtent, {\n      maxZoom,\n    });\n}\n\n/**\n@function removeLayer\n@this location\n\n@description\nThe location method removes an OL layer from the locations mapview and Layers array.\n*/\nfunction removeLayer(entry) {\n  if (!entry.L) return;\n\n  this.Layers = this.Layers.filter(\n    (layer) => layer.L.ol_uid !== entry.L.ol_uid,\n  );\n\n  this.layer.mapview.Map.removeLayer(entry.L);\n  delete entry.L;\n}\n\nasync function trash() {\n  const confirm = await mapp.ui.elements.confirm({\n    text: mapp.dictionary.confirm_delete,\n  });\n\n  if (!confirm) return;\n\n  await mapp.utils.xhr(\n    `${this.layer.mapview.host}/api/query?` +\n      mapp.utils.paramString({\n        id: this.id,\n        layer: this.layer.key,\n        locale: this.layer.mapview.locale.key,\n        table: this.table,\n        template: 'location_delete',\n      }),\n  );\n\n  this.remove();\n}\n\n/**\n@function removeEdits\n@this location\n\n@description\nThe method parses the location infoj entries deletes newValue properties of each entry and assigns the edit property as _edit which makes edits unvailable for this location.\n*/\nfunction removeEdits() {\n  // Iterate through the location.infoj entries.\n  this.infoj.forEach((entry) => {\n    if (!entry.edit) return;\n\n    // Remove newValue\n    // Unsaved edits will be lost.\n    delete entry.newValue;\n\n    // Change edit key to _edit\n    entry._edit = entry.edit;\n    delete entry.edit;\n  });\n}\n\n/**\n@function removeEdits\n@this location\n\n@description\nThe method parses the location infoj entries and assigns the _edit property of each entry as edit property to enable location edits.\n*/\nfunction restoreEdits() {\n  // Restore edit in infoj entries\n  this.infoj.forEach((entry) => {\n    if (!entry._edit) return;\n\n    entry.edit = entry._edit;\n    delete entry._edit;\n  });\n}\n\n/**\n@function getExtent\n@async\n@this location\n\n@description\nThe method iterates over the location Layers and calculates the overall extent returned from the individual extent methods.\n\n@returns {Promise<Array>} The overall extent returned from the Extents methods.\n*/\nasync function getExtent() {\n  const overall_extent = ol.extent.createEmpty();\n\n  for (const entry of this.Layers) {\n    if (!entry.display) continue;\n\n    //await extent function if it is one\n    const extent = await entry.getExtent();\n\n    //extend the extent to create the greates one\n    Array.isArray(extent) && ol.extent.extend(overall_extent, extent);\n  }\n\n  return !overall_extent.every((val) => isFinite(val)) ? null : overall_extent;\n}\n", "/**\n## /location/get\n\nThe module exports the location get and getInfoj methods to request location data from the XYZ host.\n\n@requires /location/decorate\n@requires /hooks\n@requires /utils/xhr\n\n@module /location/get\n*/\n\n/**\n@function get\n\n@description\nThe method will shortcircuit if a default getLocation method has been assigned to the [highlight] interaction.\n\nThe get method assigns a unique location.hook composed from the location.layer.key and the location.id.\n\nThe layer.key being unique to the locale, and the id being unique to the layer makes the location.hook unique to the mapview.\n\nA location will be removed from the list object param if the location already exists in the list. Otherwise the location will be assigned as a property to the list object.\n\nThe getInfoj() method is awaited before the location is decorated.\n\n@param {object} location\n@param {object} list Object in which locations are stored as properties.\n@property {layer} [location.layer] The layer to which the location belongs.\n@property {string} location.id The ID must be unique for the layer dataset.\n@property {Array} [layer.infoj] The infoj array from the layer, this is required to decorate the location.\n@property {mapview} [layer.mapview] \n@property {object} [mapview.interaction] The current [highlight] interaction.\n@property {boolean} [mapview.hooks] Hooks are enabled for the location.layer.mapview.\n@returns {Promise<object>} Decorated location\n*/\nconst locations = new Set();\nexport async function get(location, list = location.layer.mapview.locations) {\n  const mapview = location.layer.mapview;\n\n  // A getLocation function has been assigned to the current mapview.interaction.\n  if (mapview.interaction?.getLocation instanceof Function) {\n    mapview.interaction?.getLocation(location);\n    return;\n  }\n\n  // Location has no layer or id, return.\n  if (!location.layer || !location.id) return;\n\n  // Location has no infoj to decorate, return.\n  if (!location.layer.infoj) return;\n\n  // The location get requested originated from a layer_template.\n  if (location.layer.params?.layer_template) {\n    location.layer.key = location.layer.params.layer_template;\n  }\n\n  // Build location hook from layer key and location id.\n  location.hook ??= `${location.layer.key}!${location.id}`;\n\n  if (list[location.hook]) {\n    // Remove location if already in list.\n    list[location.hook].remove();\n    delete list[location.hook];\n    return;\n  }\n\n  // Prevent location from being requested again while not yet decorated.\n  if (locations.has(location.hook)) return;\n  locations.add(location.hook);\n\n  // Assign locale key to location\n  location.locale ??= mapview.locale.key;\n\n  if (!(await getInfoj(location))) {\n    locations.delete(location.hook);\n    delete list[location.hook];\n    return;\n  }\n\n  mapp.location.decorate(location);\n\n  // Location will be removed if requested again as decorated.\n  locations.delete(location.hook);\n\n  // Assign location to mapview.\n  list[location.hook] = location;\n\n  // Hooks are enabled for the mapview\n  if (mapview.hooks) {\n    mapp.hooks.push('locations', location.hook);\n  }\n\n  return location;\n}\n\n/**\n@function getInfoj\n\n@description\nThe method sends a parameterised query to the location.getTemplate query template.\n\nThe response is expected to be an object, not an array.\n\nThe response properties are mapped into clones of the layer.infoj which will be assigned to the location.\n\n@param {object} location\n@property {layer} location.layer The layer to which the location belongs.\n@property {layer} [location.getTemplate='location_get'] The query template for the location data.\n\n@returns {Promise<object>} The populated location.infoj entries array.\n*/\nexport async function getInfoj(location) {\n  if (!location.layer) {\n    console.warn('No layer provided for getLocationInfoj()');\n    return;\n  }\n\n  // Location layer is provided as key.\n  if (typeof location.layer === 'string') {\n    location.layer = await mapp.utils.xhr(\n      `${mapp.host}/api/workspace/layer?locale=${location.locale}&layer=${location.layer}`,\n    );\n  }\n\n  location.getTemplate ??= 'location_get';\n\n  // Get table from layer if not provided.\n  location.table ??=\n    location.layer.table ||\n    (location.layer.tables &&\n      Object.values(location.layer.tables).find((table) => !!table));\n\n  // Request the location fields from layer json & id.\n  const response = await getFeatureResponse(location);\n\n  // Check if the response is empty.\n  if (!response || response instanceof Error) {\n    const text = `Get location query for ID:${location.id} on layer: \"${location.layer.name}\" has failed.`;\n    console.warn(text, response);\n    mapp.ui.elements.alert({ text });\n    return;\n  }\n\n  // Check if the response is an array.\n  else if (Array.isArray(response)) {\n    const text = `Get location query for ID:${location.id} on layer: \"${location.layer.name}\" returned ${response.length} records.`;\n    console.warn(text, response);\n    mapp.ui.elements.alert({ text });\n    return;\n  }\n\n  // Assign qID as default field if layer has no infoj.\n  location.layer.infoj ??= [{ field: location.layer.qID }];\n\n  // Parse and clone the infoj and response data.\n  location.infoj = location.layer.infoj?.map((_entry) => ({\n    ...structuredClone(_entry),\n    location,\n    title: _entry.title || response[_entry.field + '_label'],\n    value: response[_entry.field],\n  }));\n\n  return location.infoj;\n}\n\n/**\n@function getFeatureResponse\n@async\n@description\nRetrieves a feature either from local cache or remote API based on location parameters\n\n```js\nconst location = {\n  layer: {\n    featureLocation: true,\n    features: [{properties: {id: '123'}, geometry: {...}}]\n  },\n  id: '123',\n  getTemplate: 'default',\n  locale: 'en',\n  table: 'locations'\n};\nconst feature = await getFeatureResponse(location);\n```\n\n@param {Object} location The location object containing feature lookup parameters\n@property {layer} location.layer Layer information containing features and metadata\n@property {boolean} [layer.featureLocation] Flag indicating if features are cached locally\n@property {Array} [layer.features] Array of cached feature objects if available locally; Required for layer.featureLocation\n@property {string} location.id ID of the feature to retrieve\n@property {string} location.getTemplate Template name for API query\n@property {string} location.locale Locale setting for API query\n@property {string} location.table Table name for API query\n@property {string} layer.key Fallback layer key identifier\n\n@returns {Promise<Object|null>} A promise that resolves to either:\n- An object containing the feature geometry and properties if found\n- null if no matching feature is found locally\n- API response if fetched remotely\n*/\nasync function getFeatureResponse(location) {\n  // Check if features are already available locally\n  if (location.layer.featureLocation) {\n    const feature = location.layer.features.find(\n      (feature) => feature.properties[location.layer.qID] === location.id,\n    );\n\n    return feature\n      ? {\n          geometry: feature.geometry,\n          ...feature.properties,\n        }\n      : null;\n  }\n\n  // If not available locally, fetch from API\n  const queryParams = {\n    id: location.id,\n    layer: location.layer.key,\n    layer_template: location.layer.params?.layer_template,\n    locale: location.locale,\n    table: location.table,\n    template: location.getTemplate,\n  };\n\n  const apiUrl = `${mapp.host}/api/query?${mapp.utils.paramString(queryParams)}`;\n\n  let response;\n\n  try {\n    response = await mapp.utils.xhr(apiUrl);\n  } catch (err) {\n    return err;\n  }\n  return response;\n}\n", "/**\n## /location/nnearest\n\nThe module exports a utility method for the nnearest query template.\n\n@requires /utils/xhr\n@module /location/nnearest\n*/\n\n/**\n@function nnearest\n\n@description\nThe nnearest method gets coordinates from a feature geometry passed in the params argument.\n\nA parameterised query to the get_nnearest template will be sent. The n for the nearest records query param is implied by the count property value of a cluster feature.\n\nThe records returned from the query are presented in a list popup positioned on the feature geometry.\n\nClicking on a list element allows to get the location associated with the query response record.\n\n@param {object} params Parameter for the nnearest location query.\n@property {mapview} params.mapview The mapview for locations layer.\n@property {layer} params.later The locations layer.\n@property {object} params.feature Query records nnearest to the feature.geometry.\n@property {string} params.table The database table for the query.\n*/\nexport default async function nnearest(params) {\n  const featureProperties = params.feature.getProperties();\n\n  const fGeom = params.feature.getGeometry();\n  const fCoord = fGeom.getCoordinates();\n  const coords = ol.proj.transform(\n    fCoord,\n    `EPSG:${params.mapview.srid}`,\n    `EPSG:${params.layer.srid}`,\n  );\n\n  const response = await mapp.utils.xhr(\n    `${params.mapview.host}/api/query/get_nnearest?` +\n      mapp.utils.paramString({\n        coords: coords,\n        filter: params.layer.filter?.current,\n        geom: params.layer.geom,\n        label: params.layer.cluster?.label || params.layer.qID,\n        layer: params.layer.key,\n        locale: params.mapview.locale.key,\n        n:\n          featureProperties.count > (params.max || 99)\n            ? params.max || 99\n            : featureProperties.count,\n        qID: params.layer.qID,\n        table: params.table,\n        x: coords[0],\n        y: coords[1],\n      }),\n  );\n\n  const list = response.map(\n    (li) => mapp.utils.html.node`<li \n    onclick=${(e) => {\n      params.mapview.popup(null);\n      mapp.location.get({\n        id: li.id,\n        layer: params.layer,\n        marker: ol.proj.transform(\n          li.coords,\n          'EPSG:' + params.layer.srid,\n          'EPSG:' + params.mapview.srid,\n        ),\n        table: params.table,\n      });\n    }}>${li.label || '\"' + params.layer.cluster?.label + '\"'}`,\n  );\n\n  const content = mapp.utils.html.node`<ul class=\"list\">${list}`;\n\n  params.mapview.popup({\n    autoPan: true,\n    content,\n    coords: ol.proj.transform(\n      coords,\n      'EPSG:' + params.layer.srid,\n      'EPSG:' + params.mapview.srid,\n    ),\n  });\n}\n", "/**\n## /location\n\n@module /location\n*/\n\nimport create from './create.mjs';\n\nimport decorate from './decorate.mjs';\n\nimport { get, getInfoj } from './get.mjs';\n\nimport nnearest from './nnearest.mjs';\n\nexport default {\n  create,\n  decorate,\n  get,\n  getInfoj,\n  nnearest,\n};\n", "/**\n## /mapview/addLayer\n\nThe module exports the addLayer method which is bound to the mapview.\n\n@module /mapview/addLayer\n*/\n\n/**\n@function addLayer\n\n@description\nA single or an array of JSON layer can be added to the mapview with the addLayer method.\n\nA default zIndex is assigned to layer without an implicit zIndex.\n\nThe mapview [this] to which the addLayer method is bound will be assigned to the layer object.\n\nA layer with a valid format property will be decorated and added to the mapview.layers{} object.\n\nLayer with a display flag will shown in the mapview.\n\nA renderComplete event will be assigned to the Openlayers mapview.Map{}. This promise will resolve once after all layer to be shown in the addLayer method have completed their render.\n\n@param {object} layers A single JSON layer or an array of JSON layer to be added to the mapview.\n\n@returns {array} The array of decorated layers is returned.\n*/\nexport default async function addLayer(layers) {\n  // A single JSON layer is provided.\n  if (layers instanceof Object && !Array.isArray(layers)) {\n    // Create array of layers with single JSON layer.\n    layers = [layers];\n  }\n\n  // A set of the layers is required in order to control the display based on URL params [hooks]\n  const currentLayers = this.hooks && new Set(mapp.hooks.current.layers);\n\n  // Create clone layers NOT to modify the original JSON layer.\n  layers = structuredClone(layers);\n\n  this.zIndex ??= 1;\n\n  for (const layer of layers) {\n    // The layer.err is an array of errors from failing to retrieve templates asscoiated with a layer.\n    layer.err && console.error(layer.err);\n\n    // An increasing zIndex is assigned to layer without implicit zIndex to ensure that layers added later are drawn on top.\n    layer.zIndex ??= this.zIndex++;\n\n    layer.mapview = this;\n\n    // currentLayers as defined through the layers array URL parameter will be displayed.\n    if (currentLayers?.size) {\n      layer.display = currentLayers.has(layer.key);\n    }\n\n    await mapp.layer.decorate(layer);\n\n    if (!layer.L) continue;\n\n    this.layers[layer.key] = layer;\n\n    layer.display && layer.show();\n  }\n\n  // Will resolve once the map has completed render.\n  this.renderComplete = new Promise((resolve) => {\n    this.Map.once('rendercomplete', resolve);\n  });\n\n  return layers;\n}\n", "/**\n## /mapview/allFeatures\n\nThe allFeatures method exported from the module is assigned to a mapview in the [mapview decorator]{@link module:/mapview~decorate}\n\n@module /mapview/allFeatures\n*/\n\n/**\n@function allFeatures\n\n@description\nThe allFeatures method checks for all features at a pixel location with the [highlight] interaction.layerFilter and interaction.hitTolerance as options.\n\nA list element is created for each feature with the element click event passing the feature as argument to the interaction getFeature method.\n\n@param {object} e The click event.\n@param {mapview} mapview The mapview from which the click [Map] event originates.\n@property {Object} e.pixel The pixel object for the click event pointer location.\n*/\nexport default function allFeatures(e, mapview) {\n  // Remove popup from mapview.\n  mapview.popup(null);\n\n  const features = [];\n\n  const callback = (F, L) => {\n    const feature = {\n      F,\n      id: F.get('id') || F.getId(),\n      L,\n      layer: mapview.layers[L.get('key')],\n    };\n\n    features.push(feature);\n  };\n\n  const options = {\n    hitTolerance: mapview.interaction.hitTolerance,\n    layerFilter: mapview.interaction.layerFilter,\n  };\n\n  // Find features at pixel.\n  mapview.Map.forEachFeatureAtPixel(e.pixel, callback, options);\n\n  // No features at pixel.\n  if (!features.length) return;\n\n  const list = features.map(\n    (feature) => mapp.utils.html`\n    <li onclick=${(e) => {\n      mapview.interaction.getFeature(feature);\n      mapview.popup(null);\n    }}>${feature.L.get('key')} [${feature.id}]`,\n  );\n\n  const content = mapp.utils.html.node`<ul class=\"list\">${list}`;\n\n  mapview.popup({\n    autoPan: true,\n    content,\n  });\n}\n", "/**\n@module /mapview/attribution\n*/\n\nexport default function attribution(mapview) {\n  if (typeof mapview.attribution !== 'object') return;\n\n  mapview.attribution.target ??= mapview.target;\n\n  mapview.attribution.node = mapp.utils.html.node`\n    <div class=\"map-attribution\">${mapview.attribution.logo}`;\n\n  mapview.attribution.target.append(mapview.attribution.node);\n\n  mapview.attribution.linksTarget = mapp.utils.html\n    .node`<div class=\"attribution-links\">`;\n\n  mapview.attribution.node.append(mapview.attribution.linksTarget);\n\n  mapview.attribution.links ??= {};\n\n  mapview.attribution.check = () => {\n    // Create clone of mapview.attribution.links which are always displayed.\n    const links = structuredClone(mapview.attribution.links);\n\n    // Assign layer.attribution for visible to layers to links.\n    Object.values(mapview.layers)\n      .filter((layer) => !!layer.display)\n      .filter((layer) => !!layer.attribution)\n      .forEach((layer) => Object.assign(links, layer.attribution));\n\n    const elements = Object.entries(links).map(\n      (entry) => mapp.utils.html`\n      <a target=\"_blank\" href=\"${entry[1]}\">${entry[0]}`,\n    );\n\n    // Render all links into mapview.attribution.target.\n    mapp.utils.render(\n      mapview.attribution.linksTarget,\n      mapp.utils.html.node`${elements}`,\n    );\n  };\n}\n", "/**\n## Mapview.fitView()\nFits the view to a given extent\n\n@module /mapview/fitView\n@param {Array} extent - geo extent, array of 4 numbers, must be [minX, minY, maxX, maxY]\n@param {Object} options - Defaults to empty object \n*/\n\nexport default function (extent, options = {}) {\n  // Extent must be an array of finite values.\n  if (!Array.isArray(extent) || !extent.every((val) => isFinite(val))) {\n    console.warn('Attempted to call fitView method with invalid extent');\n    return;\n  }\n\n  this.Map.getView().fit(extent, {\n    duration: 1000,\n    padding: [50, 50, 50, 50],\n    ...options,\n  });\n}\n", "/**\n## Mapview.geoJSON()\nThe mapview.geojson method creates and adds a geoJSON layer/source to the mapview.Map.\n\n@module /mapview/geoJSON\n\n@param {Object} params\nThe params object argument.\n*/\n\nexport default function (params) {\n  params.format = 'GeoJSON';\n\n  return this.geometry(params);\n}\n", "/**\n## Mapview.geoJSON()\nThe mapview.geojson method creates and adds a geoJSON layer/source to the mapview.Map.\n\n@module /mapview/geometry\n\n@param {Object} params\nThe params object argument.\n*/\n\nlet format;\n\nexport default function (params) {\n  if (\n    typeof params.format === 'string' &&\n    Object.hasOwn(ol.format, params.format)\n  ) {\n    format = new ol.format[params.format]();\n  }\n\n  let feature;\n\n  // Parse geometry from string value if not provided.\n  const geometry =\n    params.geometry ||\n    (typeof params.value === 'string'\n      ? JSON.parse(params.value)\n      : params.value);\n\n  // Create OL style object from params.style if not provided.\n  params.Style ??= mapp.utils.style(params.style);\n  if (!geometry) return;\n\n  try {\n    feature = format.readFeature(\n      {\n        geometry,\n        type: 'Feature',\n      },\n      {\n        dataProjection: `EPSG:${params.dataProjection || params.srid || this.srid}`,\n        featureProjection: `EPSG:${this.srid}`,\n      },\n    );\n  } catch (err) {\n    console.error(err);\n    return;\n  }\n\n  if (!feature) return;\n\n  const layerVector = new ol.layer.Vector({\n    source: new ol.source.Vector({\n      features: [feature],\n    }),\n    style: params.Style,\n    zIndex: params.zIndex,\n  });\n\n  this.Map.addLayer(layerVector);\n\n  return layerVector;\n}\n", "/**\n## /mapview/getBounds\nExports a utility method which must be assigned to a mapview object.\n\n@module /mapview/getBounds\n\n@param {string} srid\nOptional spatial reference identifier as string.\n\n@returns {{south: number, west: number, north: number, east: number}}\nBounds object\n*/\n\n/**\n@function getBounds\n\n@description\nThe getBounds method is assigned to the mapview object [_this].\n\nThe extent of the mapview view[port] will be calculated and returned as an object with east, north, south, west float properties.\n\n@param {string} [srid] The returned bounding box will be transformed to the coordinate system SRID.\n\n@returns {object} Bounding box extent {east, north, south, west}\n*/\nexport default function getBounds(srid) {\n  const extent = this.Map.getView().calculateExtent();\n\n  if (!srid)\n    return {\n      east: extent[2],\n      north: extent[3],\n      south: extent[1],\n      west: extent[0],\n    };\n\n  // transforms extent from source projection to destination projection\n  const extentTransformed = ol.proj.transformExtent(\n    extent,\n    `EPSG:${this.srid}`,\n    `EPSG:${srid}`,\n  );\n\n  return {\n    east: extentTransformed[2],\n    north: extentTransformed[3],\n    south: extentTransformed[1],\n    west: extentTransformed[0],\n  };\n}\n", "/**\n## Mapview.infotip()\n\n@module /mapview/infotip\n\n@param {Object} content\n*/\n\nconst infotip = {};\n\nexport default function (content) {\n  const mapview = this;\n\n  // Remove infotip node element\n  infotip.node?.remove();\n\n  // The mapview must have a position to place the infotip.\n  if (!mapview.position) return;\n\n  // Remove infotip positioning event from mapview Map.\n  mapview.Map.un('pointermove', position);\n\n  // Just clears the infotip.\n  if (!content) return;\n\n  if (content instanceof HTMLElement) {\n    infotip.node = content;\n\n    // Content type object but not HTMLElement cannot be rendered.\n  } else if (typeof content === 'object') {\n    console.warn(\n      `Content type object cannot be rendered in infotip: ${JSON.stringify(content)}`,\n    );\n    return;\n  } else {\n    // Check for braces in content string.\n    if (mapview.locale.xss_check && /[()]/.test(content)) {\n      console.warn(`Potential XSS detected in infotip content ${content}`);\n    }\n\n    // Creates the infotip node.\n    infotip.node = mapp.utils.html.node`<div class=\"infotip box-shadow\">`;\n\n    // Assigns the infotip content.\n    infotip.node.innerHTML = content;\n  }\n\n  // Appends the infotip to the mapview.Map.\n  mapview.Map.getTargetElement().append(infotip.node);\n\n  // Assign infotip positioning event to mapview.Map.\n  mapview.Map.on('pointermove', position);\n\n  // Set the position of the infotip.\n  position();\n\n  function position() {\n    // The infotip class has a default opacity of 0, with transition effect.\n    infotip.node.style.opacity = 1;\n\n    // Set the infotip position from mapview pointerLocation.\n    infotip.node.style.left =\n      mapview.pointerLocation.x - infotip.node.offsetWidth / 2 + 'px';\n    infotip.node.style.top =\n      mapview.pointerLocation.y - infotip.node.offsetHeight - 15 + 'px';\n  }\n}\n", "/**\n## Mapview.interactions.draw()\n\n@module /mapview/interactions/draw\n\n@param {Object} params\nThe params object argument.\n*/\n\nexport default function (params) {\n  const mapview = this;\n\n  // Finish the current interaction.\n  mapview.interaction?.finish();\n\n  // Assign params onto the defaults as mapview.interaction.\n  mapview.interaction = {\n    condition: (e) => {\n      if (mapview.interaction.wait) return false;\n\n      // Right click\n      if (e.originalEvent.buttons === 2) {\n        // Remove last vertex.\n        mapview.interaction.interaction.removeLastPoint();\n        mapview.interaction.vertices.pop();\n\n        const moveEvent = new ol.MapBrowserEvent(\n          'pointermove',\n          mapview.Map,\n          e.originalEvent,\n        );\n        mapview.interaction.interaction.handleEvent(moveEvent);\n\n        mapview.interaction.conditions?.forEach(\n          (fn) => typeof fn === 'function' && fn(e),\n        );\n        return false;\n      }\n\n      // Left click.\n      if (e.originalEvent.buttons === 1) {\n        mapview.interaction.vertices.push(e.coordinate);\n        mapview.popup(null);\n\n        mapview.interaction.conditions?.forEach(\n          (fn) => typeof fn === 'function' && fn(e),\n        );\n        return true;\n      }\n    },\n\n    drawend: mapp.ui?.elements.contextMenu.draw.bind(this),\n\n    finish,\n\n    format: new ol.format.GeoJSON(),\n\n    getFeature,\n\n    // The Layer is required for generated features such as isolines.\n    Layer: new ol.layer.Vector({\n      zIndex: params.layer?.zIndex || 99,\n    }),\n\n    // Bind context menu from mapp ui elements.\n    source: new ol.source.Vector(),\n\n    style: [\n      new ol.style.Style({\n        stroke: new ol.style.Stroke({\n          color: '#3399CC',\n          width: 1.25,\n        }),\n      }),\n      new ol.style.Style({\n        geometry: mapp.utils.verticeGeoms,\n        image: new ol.style.Circle({\n          fill: new ol.style.Fill({\n            color: '#eee',\n          }),\n          radius: 5,\n          stroke: new ol.style.Stroke({\n            color: '#3399CC',\n            width: 1.25,\n          }),\n        }),\n      }),\n    ],\n\n    // Whether the draw interaction event should be handled.\n    type: 'draw',\n\n    // OL Style for sketch feature.\n    vertices: [],\n\n    // Spread params argument.\n    ...params,\n  };\n\n  // Change cursor style over mapview element.\n  mapview.Map.getTargetElement().style.cursor = 'crosshair';\n\n  // Set mapview.interaction.Layer source.\n  mapview.interaction.Layer.setSource(mapview.interaction.source);\n\n  // Add mapview.interaction.Layer to mapview.\n  mapview.Map.addLayer(mapview.interaction.Layer);\n\n  document.addEventListener('keyup', escape);\n\n  function escape(e) {\n    e.key === 'Escape' && mapview.interaction.finish();\n  }\n\n  // Create OL draw interaction.\n  mapview.interaction.interaction = new ol.interaction.Draw(\n    mapview.interaction,\n  );\n\n  // Set drawstart event method.\n  mapview.interaction.interaction.on('drawstart', (e) => {\n    // Get the draw feature geometry.\n    const geometry = e.feature.getGeometry();\n\n    async function onChange() {\n      mapview.popup({\n        content: mapp.utils.html.node`\n          <div style=\"padding: 5px\">\n          ${await mapp.utils.convert(\n            // Get the geometry metric figure.\n            mapview.metrics[mapview.interaction.tooltip.metric](geometry),\n\n            // Options argument for conversion.\n            mapview.interaction.tooltip,\n          )}`,\n      });\n    }\n\n    // Assign an onchange method to the geometry for the tooltip.\n    mapview.interaction.tooltip &&\n      geometry.on('change', mapview.interaction.tooltip.onChange || onChange);\n\n    // Clear the source\n    mapview.interaction.source.clear();\n\n    // Remove the popup.\n    mapview.popup(null);\n  });\n\n  if (typeof mapview.interaction.drawend === 'function') {\n    mapview.interaction.interaction.on('drawend', mapview.interaction.drawend);\n  }\n\n  // Add OL interaction to mapview.Map\n  mapview.Map.addInteraction(mapview.interaction.interaction);\n\n  // Assign snap interaction.\n  mapview.interactions.snap(mapview);\n\n  // Get first feature from mapview.interaction.source as GeoJSON.\n  function getFeature() {\n    // Return feature as geojson.\n    return JSON.parse(\n      mapview.interaction.format.writeFeature(\n        // Get first OL feature from source.\n        mapview.interaction.source.getFeatures()[0],\n        {\n          // Use mapview.interaction.srid as dataProjection if defined in params.\n          dataProjection:\n            'EPSG:' + mapview.interaction.layer?.srid ||\n            mapview.interaction.srid ||\n            mapview.srid,\n          featureProjection: 'EPSG:' + mapview.srid,\n        },\n      ),\n    );\n  }\n\n  function finish(feature) {\n    document.removeEventListener('keyup', escape);\n\n    // Remove snap interaction.\n    mapview.interaction.snap?.remove?.();\n\n    // Reset the cursor style.\n    mapview.Map.getTargetElement().style.cursor = 'default';\n\n    // Remove popup from mapview.\n    mapview.popup(null);\n\n    // Remove interaction from mapview.Map.\n    mapview.Map.removeInteraction(mapview.interaction.interaction);\n\n    // Remove draw Layer from mapview.Map.\n    mapview.Map.removeLayer(mapview.interaction.Layer);\n\n    mapview.interaction.callback?.(feature);\n  }\n}\n", "/**\n## /mapview/interactions/highlight\n\nThe module exports the highlight interaction method which is bound to a mapview in the [decorator]{@link module:/mapview~decorate} method.\n\n@requires /location/get\n@requires /location/nnearest\n@requires /mapview/allFeatures\n\n@module /mapview/interactions/highlight\n*/\n\n/**\n@typedef {Object} interaction The highlight interaction object.\n@property {Function} getFeature Method to return a feature from the highlight or click event methods.\n@property {Function} longClickMethod Defaults to [mapview.allFeatures()]{@link module:/mapview/allFeatures}\n@property {Number} longClickTimeout Timeout for the execution of the longClickMethod.\n@property {Integer} longClickMS Milliseconds for longClickTimeout. Defaults to 500ms.\n@property {Boolean} longClick Execute longClick method.\n@property {Number} hitTolerance Pixel distance for detection of features on pixel. Defaults to 5pixel.\n@property {Set} candidateKeys A set of candidate features under the cursor.\n@property {Object} current The current highlighted feature.\n@property {Function} Click The click method for the interaction. This will shortcircuit the getFeature method.\n@property {Function} noLocationClick The noLocationClick method for the interaction, this is only ran if there is no current highlight interaction, and Click method is not available. This will shortcircuit the getFeature method.\n@property {Boolean} clicked The click method was recently called.\n*/\n\n/**\n@function highlight\n\n@description\nThe highlight interaction method is bound to a mapview object [this].\n\nThe highlight interaction method will call the finish() method of the mapview.interaction before assigning a highlight interaction object as mapview.interaction.\n\nThe configuration params are spread into the interaction configuration overriding any of the defaults.\n\nThe highlight interaction works by assigning mousedown, touchstart, mouseup, and mouseleave events to the mapview.Map object.\n\nThe optional getLocation function property will be executed the [mapp.location.get()]{@link module:/location/get~get} method.\n\n@param {object} params The params object is spread into the interaction defaults.\n@property {Function} [getLocation] Will be executed after the getFeature method.\n*/\nexport default function highlight(params) {\n  const mapview = this;\n\n  // Finish the current interaction.\n  mapview.interaction?.finish();\n\n  mapview.interaction = {\n    candidateKeys: new Set(),\n\n    candidates: {},\n\n    finish,\n\n    getFeature,\n\n    hitTolerance: 5,\n\n    layerFilter,\n\n    longClickMethod: mapview.allFeatures,\n\n    longClickMS: 500,\n\n    // Filter for layers which have a highlight style.\n    type: 'highlight',\n\n    // Spread params argument.\n    ...params,\n  };\n\n  // pointerMove will highlight features.\n  mapview.Map.on('pointermove', pointerMove);\n\n  // click will select the highlighted feature.\n  mapview.Map.on('click', click);\n\n  mapview.Map.getTargetElement().addEventListener('mousedown', mouseDown);\n\n  mapview.Map.getTargetElement().addEventListener('touchstart', touchStart);\n\n  mapview.Map.getTargetElement().addEventListener('mouseup', mouseUp);\n\n  mapview.Map.getTargetElement().addEventListener('mouseleave', mouseleave);\n\n  /**\n  @function layerFilter\n\n  @description\n  The layerFilter method filters mapview layers with a qID.\n  \n  @param {Object} L Openlayers layer.\n  */\n  function layerFilter(L) {\n    return Object.values(mapview.layers).some(\n      (layer) => layer.qID && layer.L === L,\n    );\n  }\n\n  /**\n  @function mouseleave\n\n  @description\n  The mouseleave event method will be triggered when the cursor leaves the mapview.Map element.\n\n  The method will empty the interaction.candidateKeys set and call the clear method.\n  */\n  function mouseleave() {\n    // Reset candidateKeys Set\n    mapview.interaction.candidateKeys = new Set();\n    clear();\n  }\n\n  /**\n  @function touchStart\n\n  @description\n  The touchStart event prevents the mouseDown event on touch input.\n  */\n  function touchStart(e) {\n    e.preventDefault();\n  }\n\n  /**\n  @function mouseDown\n\n  @description\n  The mouseDown event method enables the longClickMethod.\n\n  The cursor is set to wait after the longClickTimeout event.\n\n  The longClickTimeout is cleared in the pointerMove and click event methods.\n  */\n  function mouseDown() {\n    // Short circuit the mouseDown event method if the longClickMethod is falsy.\n    if (!mapview.interaction.longClickMethod) return;\n\n    delete mapview.interaction.longClick;\n\n    mapview.interaction.longClickTimeout &&\n      clearTimeout(mapview.interaction.longClickTimeout);\n\n    mapview.interaction.longClickTimeout = setTimeout(() => {\n      mapview.interaction.longClick = true;\n      mapview.Map.getTargetElement().style.cursor = 'wait';\n    }, mapview.interaction.longClickMS);\n  }\n\n  /**\n  @function mouseUp\n\n  @description\n  The mouseUp event method reset the cursor to auto.\n  */\n  function mouseUp() {\n    mapview.Map.getTargetElement().style.cursor = 'auto';\n  }\n\n  /**\n  @function pointerMove\n\n  @description\n  The pointerMove event method will clear the interaction.longClickTimeout number before assigning each feature intersecting with the event [pixel] location.\n\n  Each feature is stored in the candidates object in the forEachFeatureAtPixel callback method.\n\n  The interaction.layerFilter method is assigned as an option to filter feature from relevant feature layer.\n\n  A candidate object consists of a key, the Openlayers layer object L, and the feature object F itself.\n\n  The method checks whether a Set candidates objects keys is different from the interaction.candidateKeys set to determine whether the highlight feature has changed.\n\n  The interaction.candidateKeys set will be cleared and the clear method is called if there are no candidate features.\n\n  The method will shortcircuit if the are no candidates or the highlight stays the same.\n\n  Otherwise a feature is chosen which is not in the interaction.candidateKeys set.\n\n  The method will shortcircuit if the chosen feature key is the same as the interaction.current [feature] key.\n\n  Otherwise the clear method is called and the feature is assigned as the interaction.current thereafter.\n\n  The pointerMove method will be called from a touch click event in order to select features on a touch screen. However there is no cursor and the highlight style should not be applied nor should the hover method be called. The pointerMove method will shortcircuit if called with a touch event.\n\n  Otherwise the cursor will check to a pointer if selection is possible.\n\n  The feature will be passed as argument to a feature.layer.hover method.\n\n  Finally the layer.L change event will be called to trigger the featureStyle render.\n\n  @param {Object} e The pointerMove event.\n  @property {Object} e.pixel The pixel object for the current pointer location.\n  */\n  function pointerMove(e) {\n    // Clear longClick timeout.\n    mapview.interaction.longClickTimeout &&\n      clearTimeout(mapview.interaction.longClickTimeout);\n\n    const candidates = {};\n\n    const callback = (F, L) => {\n      // get layerKey from key property or ol object L Uid.\n      const layerKey = L.get('key') || ol.util.getUid(L);\n\n      // get featureID from id property, getId method or ol object F Uid.\n      const featureID = F.get('id') || F.getId() || ol.util.getUid(F);\n\n      // Compose candidate key from layerKey and featureID.\n      const key = `${layerKey}!${featureID}`;\n\n      candidates[key] = { F, key, L };\n    };\n\n    const options = {\n      hitTolerance: mapview.interaction.hitTolerance,\n      layerFilter: mapview.interaction.layerFilter,\n    };\n\n    mapview.Map.forEachFeatureAtPixel(e.pixel, callback, options);\n\n    if (!Object.keys(candidates).length) {\n      // There is no candidate to highlight.\n      mapview.interaction.candidateKeys.clear();\n      clear();\n      return;\n    }\n\n    if (\n      mapp.utils.areSetsEqual(\n        mapview.interaction.candidateKeys,\n        new Set(Object.keys(candidates)),\n      )\n    ) {\n      // The highlight hasn't changed.\n      return;\n    }\n\n    // Find feature from key which is not in candidates set.\n    const feature =\n      candidates[\n        Object.keys(candidates).find(\n          (key) => !mapview.interaction.candidateKeys.has(key),\n        )\n      ] ||\n      // Or assign candidate from first key\n      (mapview.interaction.current?.key &&\n        candidates[mapview.interaction.current?.key]) ||\n      candidates[Object.keys(candidates)[0]];\n\n    // Assign new Set of candidate keys to mapview.interaction.\n    mapview.interaction.candidateKeys = new Set(Object.keys(candidates));\n\n    // Return if feature is current.\n    if (mapview.interaction.current?.key === feature.key) return;\n\n    // Clear highlight before assigning feature.\n    clear();\n\n    // Assign feature.layer from mapview.layer\n    feature.layer = mapview.layers[feature.L.get('key')];\n\n    // Assign feature.id from id property or getId method.\n    feature.id = feature.F.get('id') || feature.F.getId();\n\n    // Required for featureStyle() styling of highlight feature.\n    feature.layer.highlight = feature.id;\n\n    // Assign feature as current.\n    mapview.interaction.current = feature;\n\n    if (e.originalEvent.pointerType !== 'mouse') {\n      // The pointMove() method maybe called from touch/click event.\n      e.type !== 'pointermove' && mapview.interaction.getFeature(feature);\n\n      // Touch events should not highlight style features or call hover method since there is no cursor.\n      clear();\n      return;\n    }\n\n    if (feature.layer.infoj) {\n      // Change cursor if the highlight is selectable.\n      mapview.Map.getTargetElement().style.cursor = 'pointer';\n    }\n\n    if (typeof feature.layer.style?.hover?.method === 'function') {\n      // Execute hover method assigned to the current feature layer.\n      feature.layer.style.hover.method(feature.F, feature.layer);\n    }\n\n    mapview.interaction.current.layer.L.changed();\n  }\n\n  /**\n  @function click\n\n  @description\n  The click() method is assigned to the mapview.Map element click event listener.\n  The method will reset the cursor and check for execution of the interaction.longClickMethod.\n\n  The method is debounced to 600ms with interaction.clicked flag.\n\n  The pointerMove method will be called with the click event [location] to get a feature without a cursor.\n\n  The interaction.Click method will be called if it exists. This will shortcircuit the getFeature method.\n\n  The interaction.noLocationClick method will be called if no current location is available.\n\n  Otherwise the interaction.current feature is passed to the interaction.getFeature method.\n\n  @param {Object} e The calling event.\n  */\n  function click(e) {\n    // Reset cursor.\n    mapview.Map.getTargetElement().style.cursor = 'auto';\n\n    clearTimeout(mapview.interaction.longClickTimeout);\n\n    if (mapview.interaction.longClick) {\n      mapview.interaction.longClickMethod(e, mapview);\n      return;\n    }\n\n    // Limit click event to 600ms\n    if (mapview.interaction.clicked) return;\n\n    mapview.interaction.clicked = setTimeout(() => {\n      mapview.interaction.clicked = null;\n    }, 600);\n\n    // There is no current highlighted feature without pointerMove.\n    // Simulate pointermove on the touch click coordinates.\n    if (e.originalEvent.pointerType === 'touch') {\n      mapview.interaction.candidateKeys = new Set();\n      e.type = 'touchClick';\n      pointerMove(e);\n      return;\n    }\n\n    // Remove any existing popup. e.g. Cluster select dialogue.\n    mapview.popup(null);\n\n    // if there's a mapview.interaction.Click method, execute it.\n    if (typeof mapview.interaction.Click === 'function') {\n      // Execute the Click method\n      mapview.interaction.Click(e);\n      return;\n    }\n\n    // if there's a mapview.interaction.noLocationClick method\n    if (\n      !mapview.interaction.current &&\n      typeof mapview.interaction.noLocationClick === 'function'\n    ) {\n      // Execute the noLocationClick method\n      mapview.interaction.noLocationClick(e);\n      return;\n    }\n\n    // Get the feature from the current highlight.\n    if (mapview.interaction.current) {\n      mapview.interaction.getFeature(mapview.interaction.current);\n    }\n  }\n\n  /**\n  @function clear\n\n  @description\n  The clear method will clear the current feature and shortcircuit if there is no current feature.\n\n  The infotip object [eg. hover] will be removed.\n\n  The cursor will be reset.\n\n  The layer.L change event will be called to trigger the featureStyle render.\n  */\n  function clear() {\n    // Highlight has already been cleared.\n    if (!mapview.interaction.current) return;\n\n    mapview.infotip(null);\n\n    mapview.Map.getTargetElement().style.cursor = 'auto';\n\n    // Prevent highlight render.\n    delete mapview.interaction.current.layer.highlight;\n\n    mapview.interaction.current.layer.L.changed();\n\n    // Delete the current highlight feature after render.\n    // The [feature] current.layer object is required for the featureStyle render.\n    delete mapview.interaction.current;\n  }\n\n  /**\n  @function getFeature\n\n  @description\n  The getFeature method deals with cluster features.\n\n  A dialog to select a cluster feature will be presented.\n\n  The interaction.getFeature method can be overwritten in the params passed to the highlight interaction.\n\n  The nnearest method is called for cluster features which are not created from a vector source.\n\n  @param {Object} feature The feature to get.\n  */\n  function getFeature(feature) {\n    // Get the properties of the current highlight feature.\n    const featureProperties = feature.F.getProperties();\n\n    // The feature is a cluster feature.\n    if (featureProperties.count > 1) {\n      const features = feature.F.get('features');\n\n      // Features are clustered in source.\n      if (Array.isArray(features)) {\n        // Get list of cluster feature label and id.\n        const featuresList = features.map((F) => {\n          const featureProperties = F.getProperties();\n          return {\n            id: featureProperties.id,\n            label: featureProperties[feature.layer.cluster?.label],\n          };\n        });\n\n        // Create list for cluster features.\n        const list = featuresList.map(\n          (li) => mapp.utils.html.node`<li\n          onpointerup=${(e) => {\n            mapview.popup(null);\n            mapp.location.get({\n              id: li.id,\n              layer: feature.layer,\n              table: feature.layer.table || feature.layer.tableCurrent(),\n            });\n          }}>${li.label || li.id}`,\n        );\n\n        const content = mapp.utils.html.node`<ul class=\"list\">${list}`;\n\n        // Display the popup to select cluster feature.\n        mapview.popup({\n          autoPan: true,\n          content,\n          coords: feature.F.getGeometry().getCoordinates(),\n        });\n\n        return;\n      }\n\n      // Features are not clustered in source.\n      mapp.location.nnearest({\n        feature: feature.F,\n        layer: feature.layer,\n        mapview,\n        table: feature.layer.table || feature.layer.tableCurrent(),\n      });\n      return;\n    }\n\n    // Get feature location.\n    mapp.location.get({\n      id: feature.id,\n      layer: feature.layer,\n      table: feature.layer.table || feature.layer.tableCurrent(),\n    });\n  }\n\n  /**\n  @function finish\n\n  @description\n  The [highlight] interaction will be cleared.\n  \n  Any popup will be removed from mapview.\n\n  Event listener will be removed the mapview.Map element.\n  */\n  function finish() {\n    // Clear must be called before interaction is nulled.\n    clear();\n\n    // Remove popup from mapview.\n    mapview.popup(null);\n\n    // Remove event listener from mapview.\n    mapview.Map.un('pointermove', pointerMove);\n    mapview.Map.un('click', click);\n    mapview.Map.getTargetElement().removeEventListener('mousedown', mouseDown);\n    mapview.Map.getTargetElement().removeEventListener(\n      'touchstart',\n      touchStart,\n    );\n    mapview.Map.getTargetElement().removeEventListener('mouseup', mouseUp);\n    mapview.Map.getTargetElement().removeEventListener(\n      'mouseleave',\n      mouseleave,\n    );\n\n    mapview.interaction.callback?.();\n  }\n}\n", "/**\n## Mapview.interactions.modify()\n\nThe modify module exports the modify function. The modify function defines the behaviour of a modification performed on the map.\n\nDictionary entries:\n- delete_vertex\n\n@requires /dictionary\n\n@module /mapview/interactions/modify\n*/\n\n/**\n@function modify\nDefines the behaviour for a modification interaction performed on the map.\n\n@param {Object} params Extra parameters for the mapview.interaction.\n*/\n\nexport default function modify(params) {\n  const mapview = this;\n\n  // Finish the current interaction.\n  mapview.interaction?.finish();\n\n  mapview.interaction = {\n    deleteCondition: (e) => {\n      if (e.type === 'singleclick') {\n        const geom = mapview.interaction.Feature.getGeometry();\n\n        const geomType = geom.getType();\n\n        if (geomType === 'Point') return;\n\n        const coords = geom.getCoordinates();\n\n        // Return on point or line with 2 vertices.\n        if (geomType === 'LineString' && coords.length < 3) return;\n\n        // Return on polygon with less than 3 vertices.\n        if (geomType === 'Polygon' && coords[0].length <= 4) return;\n\n        // Set popup to remove vertex.\n        mapview.popup({\n          content: mapp.utils.html.node`<ul>\n            <li\n              onclick=${() => {\n                mapview.interaction.interaction.removePoint();\n                mapview.interaction.vertices.push(\n                  mapview.interaction.Feature.getGeometry().getClosestPoint(\n                    e.coordinate,\n                  ),\n                );\n              }}>${mapp.dictionary.delete_vertex}`,\n          coords: geom.getClosestPoint(e.coordinate),\n        });\n      }\n    },\n\n    finish,\n\n    format: new ol.format.GeoJSON(),\n\n    getFeature,\n\n    Layer: new ol.layer.Vector({\n      zIndex: Infinity,\n    }),\n\n    modifyend: mapp.ui?.elements.contextMenu.modify.bind(this),\n\n    Style: [\n      new ol.style.Style({\n        image: new ol.style.Circle({\n          radius: 5,\n          stroke: new ol.style.Stroke({\n            color: '#3399CC',\n            width: 1.25,\n          }),\n        }),\n        stroke: new ol.style.Stroke({\n          color: '#3399CC',\n          width: 1.25,\n        }),\n      }),\n      new ol.style.Style({\n        geometry: mapp.utils.verticeGeoms,\n        image: new ol.style.Circle({\n          fill: new ol.style.Fill({\n            color: '#eee',\n          }),\n          radius: 5,\n          stroke: new ol.style.Stroke({\n            color: '#3399CC',\n            width: 1.25,\n          }),\n        }),\n      }),\n    ],\n\n    source: new ol.source.Vector(),\n\n    type: 'modify',\n\n    vertices: [],\n\n    // Spread params argument.\n    ...params,\n  };\n\n  mapview.Map.getTargetElement().style.cursor = 'crosshair';\n\n  mapview.interaction.source.addFeature(mapview.interaction.Feature);\n\n  // Set mapview.interaction.Layer source.\n  mapview.interaction.Layer.setSource(mapview.interaction.source);\n\n  // Set mapview.interaction.Layer style\n  mapview.interaction.Layer.setStyle(mapview.interaction.Style);\n\n  // Add mapview.interaction.Layer to mapview.\n  mapview.Map.addLayer(mapview.interaction.Layer);\n\n  //End the modification on escape key.\n  document.addEventListener('keyup', escape);\n\n  function escape(e) {\n    e.key === 'Escape' && mapview.interaction.finish();\n  }\n\n  mapview.interaction.interaction = new ol.interaction.Modify(\n    mapview.interaction,\n  );\n\n  // Will clear remove vertex popup.\n  mapview.interaction.interaction.on('modifystart', (e) => {\n    mapview.popup(null);\n  });\n\n  if (typeof mapview.interaction.modifyend === 'function') {\n    mapview.interaction.interaction.on(\n      'modifyend',\n      mapview.interaction.modifyend,\n    );\n  }\n\n  // Add OL interaction to mapview.Map\n  mapview.Map.addInteraction(mapview.interaction.interaction);\n\n  // Assign snap interaction.\n  mapview.interactions.snap(mapview);\n\n  function getFeature() {\n    return JSON.parse(\n      mapview.interaction.format.writeFeature(mapview.interaction.Feature, {\n        dataProjection: 'EPSG:' + mapview.interaction.srid || mapview.srid,\n        featureProjection: 'EPSG:' + mapview.srid,\n      }),\n    );\n  }\n\n  function finish(feature) {\n    //Remove the escape key event listener\n    document.removeEventListener('keyup', escape);\n\n    // Remove snap interaction.\n    mapview.interaction.snap?.remove?.();\n\n    // Reset the cursor style.\n    mapview.Map.getTargetElement().style.cursor = 'default';\n\n    // Remove popup from mapview.\n    mapview.popup(null);\n\n    // Remove interaction from mapview.Map.\n    mapview.Map.removeInteraction(mapview.interaction.interaction);\n\n    // Clear the modify source.\n    mapview.interaction.source.clear();\n\n    // Remove draw Layer from mapview.Map.\n    mapview.Map.removeLayer(mapview.interaction.Layer);\n\n    mapview.interaction.callback?.(feature);\n  }\n}\n", "/**\n * ### mapview.interactions.snap()\n * This module sets up the snap interaction for the mapview.\n * @module /mapview/interactions/snap\n */\n\n/**\n * Sets up the snap interaction for the mapview.\n * @function snap\n * @param {Object} mapview - The mapview object.\n * @param {ol.Map} mapview.Map - The OpenLayers map object.\n * @param {Object} mapview.interaction - The interaction object.\n * @param {boolean|Object} mapview.interaction.snap - The snap interaction configuration.\n * @param {string} [mapview.interaction.snap.layer] - The key of the layer to snap to.\n * @param {ol.layer.Layer} mapview.interaction.layer - The interaction layer.\n * @param {Object} mapview.layers - The map layers object.\n */\nexport default function (mapview) {\n  // The current draw/modify interaction doesn't snap.\n  if (!mapview.interaction.snap) return;\n\n  if (mapview.interaction.snap === true) {\n    // Assign the interaction layer as snap layer if snap is true.\n    mapview.interaction.snap = {\n      layer: mapview.interaction.layer.key,\n    };\n  }\n\n  if (typeof mapview.interaction.snap === 'string') {\n    // Assign the interaction layer as snap layer if snap is a string.\n    mapview.interaction.snap = {\n      layer: mapview.interaction.snap,\n    };\n  }\n  // Assign mapview and interaction to be _this.\n  mapview.interaction.snap = {\n    /**\n     * Removes the snap interaction and related resources.\n     */\n    remove: () => {\n      if (mapview.interaction.layer.featureSource) {\n        // Detach tile load event,\n        mapview.interaction.layer.featureSource.un('tileloadend', tileloadend);\n\n        // Remove featureSource layer from mapview.Map,\n        mapview.Map.removeLayer(mapview.interaction.snap.vectorTileLayer);\n\n        // And clear featureSource.\n        mapview.interaction.layer.featureSource.clear();\n      }\n\n      mapview.Map.removeInteraction(mapview.interaction.snap.interaction);\n    },\n\n    ...mapview.interaction.snap,\n  };\n\n  // Check if snap layer exists in mapview.layers.\n  if (!mapview.layers[mapview.interaction.snap.layer]) {\n    console.warn(\n      `Unable to snap to layer:${mapview.interaction.snap.layer} as it is not found in mapview.layers.`,\n    );\n    return;\n  }\n\n  // Assign snap layer from key if defined.\n  mapview.interaction.snap.layer &&=\n    mapview.layers[mapview.interaction.snap.layer] || mapview.interaction.layer;\n\n  // Assign interaction as snap layer if undefined.\n  mapview.interaction.snap.layer ??= mapview.interaction.layer;\n\n  mapview.interaction.snap.layer.show();\n\n  /**\n   * Callback function for the `tileloadend event of the feature source.\n   * Adds features from the loaded tile to the snap source.\n   * @param {ol.TileLoadEvent} e - The tile load event.\n   */\n  function tileloadend(e) {\n    const features = e.tile.getFeatures();\n\n    // Try adding features to prevent a crash adding the same feature twice.\n    try {\n      mapview.interaction.snap.source.addFeatures(features);\n    } catch {}\n  }\n\n  if (mapview.interaction.snap.layer.featureSource) {\n    // Create new Vector source for snap features.\n    mapview.interaction.snap.source = new ol.source.Vector();\n\n    // Assign loadend event to MVT layer featureSource.\n    mapview.interaction.snap.layer.featureSource.on('tileloadend', tileloadend);\n\n    mapview.interaction.snap.vectorTileLayer = new ol.layer.VectorTile({\n      opacity: 0,\n      source: mapview.interaction.snap.layer.featureSource,\n    });\n\n    // Add invisible tile layer for the featureSource to trigger tile loads.\n    mapview.Map.addLayer(mapview.interaction.snap.vectorTileLayer);\n  } else {\n    // Assign vector source as snap source for vector layer.\n    mapview.interaction.snap.source =\n      mapview.interaction.snap.layer.L.getSource();\n  }\n\n  // Create snap interaction with snap.source.\n  mapview.interaction.snap.interaction = new ol.interaction.Snap({\n    source: mapview.interaction.snap.source,\n  });\n\n  // Add snap.interaction to mapview.Map\n  mapview.Map.addInteraction(mapview.interaction.snap.interaction);\n}\n", "/**\n## Mapview.interactions.zoom()\n\n@module /mapview/interactions/zoom\n\n@param {Object} params\nThe params object argument.\n*/\n\nexport default function (params) {\n  const mapview = this;\n\n  // Finish the current interaction.\n  mapview.interaction?.finish();\n\n  mapview.interaction = {\n    finish: finish,\n\n    Layer: new ol.layer.Vector({\n      source: new ol.source.Vector(),\n    }),\n\n    // Spread params argument.\n    ...params,\n  };\n\n  mapview.interaction.Layer.getSource().clear();\n\n  mapview.Map.addLayer(mapview.interaction.Layer);\n\n  mapview.Map.getTargetElement().style.cursor = 'zoom-in';\n\n  mapview.interaction.interaction = new ol.interaction.Draw({\n    geometryFunction: ol.interaction.Draw.createBox(),\n    source: mapview.interaction.Layer.getSource(),\n    style: {\n      'fill-color': '#fff9',\n      'stroke-color': '#ddd',\n    },\n    type: 'Circle',\n  });\n\n  mapview.interaction.interaction.on('drawend', (e) => {\n    mapview.fitView(e.feature.getGeometry().getExtent());\n\n    finish();\n  });\n\n  mapview.Map.addInteraction(mapview.interaction.interaction);\n\n  function finish() {\n    mapview.Map.getTargetElement().style.cursor = 'auto';\n\n    mapview.Map.removeInteraction(mapview.interaction.interaction);\n\n    mapview.Map.removeLayer(mapview.interaction.Layer);\n\n    mapview.interaction.Layer.getSource().clear();\n\n    mapview.interaction.callback?.();\n  }\n}\n", "/**\n## Mapview.locate()\n\n@module /mapview/locate\n\n@param {Object} params\nThe params object argument.\n*/\n\n/**\n@function locate\n\n@description\nThe locate method bound to the mapview [this] renders the current location from the Navigator Web API unto the mapview map. \n\n@param {Object} params Params for the locate method.\n*/\nexport default function locate(params) {\n  this._locate ??= {\n    feature: new ol.Feature({\n      geometry: new ol.geom.Point([0, 0]),\n    }),\n    icon: {\n      scale: 0.05,\n      svg: `${this.host}/icons/locator.svg`,\n    },\n    ...params,\n  };\n\n  this._locate.active = !this._locate.active;\n\n  // Create the geolocation marker if it doesn't exist yet.\n  if (!this._locate.L) {\n    this._locate.L = new ol.layer.Vector({\n      source: new ol.source.Vector({\n        features: [this._locate.feature],\n      }),\n      style: mapp.utils.style({\n        icon: this._locate.icon,\n      }),\n      zIndex: 999,\n    });\n  }\n\n  // Remove the geolocation marker if locate is not active.\n  if (!this._locate.active) {\n    this.Map.removeLayer(this._locate.L);\n    return;\n  }\n\n  this.Map.addLayer(this._locate.L);\n\n  mapp.utils.getCurrentPosition((pos) => {\n    const coords = ol.proj.fromLonLat([\n      parseFloat(pos.coords.longitude),\n      parseFloat(pos.coords.latitude),\n    ]);\n\n    this._locate.feature.getGeometry().setCoordinates(coords);\n\n    // Fly to pos_ll and set flyTo to false to prevent map tracking.\n    this.Map.getView().animate({\n      center: coords,\n      zoom: this.locale.maxZoom,\n    });\n  });\n}\n", "/**\n## Mapview.popup()\n\n@module /mapview/popup\n\n@param {Object} params\nThe params object argument.\n*/\n\nconst popup = {};\n\nexport default function (params) {\n  if (typeof params === 'undefined') {\n    // Returns undefined / falsy if popup.node has been removed.\n    return popup.node?.parentNode;\n  }\n\n  const mapview = this;\n\n  // Remove a current tooltip.\n  mapview.infotip(null);\n\n  // Remove infotip node element\n  popup.node?.remove();\n\n  // Just clears the infotip.\n  if (!params) return;\n\n  popup.node = mapp.utils.html.node`<div class=\"popup box-shadow\">`;\n\n  popup.node.appendChild(params.content);\n\n  popup.overlay && mapview.Map.removeOverlay(popup.overlay);\n\n  popup.overlay = new ol.Overlay({\n    autoPan: params.autoPan,\n    autoPanAnimation: {\n      duration: 250,\n    },\n    element: popup.node,\n    insertFirst: true,\n    position: params.coords || mapview.position,\n    positioning: 'bottom-center',\n  });\n\n  mapview.Map.addOverlay(popup.overlay);\n}\n", "/**\n## /mapview/removeLayer\nThe module exports the removeLayer method which is bound to the mapview.\n\n@module /mapview/removeLayer\n*/\n\n/**\n@function removeLayer\n@description\nThe method will iterate of an array of layer or layer keys and will call the remove method of the referenced layer.\n\n@param {(string|object|array)} layers A single layer key/object or an array of layer keys/objects to be removed from the mapview.\n*/\nexport default function removeLayer(layers) {\n  // Handle single layer input\n  if (!Array.isArray(layers)) {\n    layers = [layers];\n  }\n\n  for (const _layer of layers) {\n    const layer = typeof _layer === 'string' ? this.layers[_layer] : _layer;\n\n    layer.remove();\n  }\n\n  // Will resolve once the map has completed render\n  this.renderComplete = new Promise((resolve) => {\n    this.Map.once('rendercomplete', resolve);\n  });\n}\n", "/**\n### /mapview\n\n@module /mapview\n*/\n\n/**\n@global\n@typedef {Object} mapview\nA mapview object has an Openlayers Map element limited to the locale configuration.\n@property {string} host The host domain/path for queries.\n@property {object} Map Openlayers Map element.\n@property {object} locale The locale defintion for the mapview.\n@property {function} changend The changeend method is triggered by the mapview.Map moveend event.\n*/\n\nimport addLayer from './addLayer.mjs';\nimport allFeatures from './allFeatures.mjs';\nimport attribution from './attribution.mjs';\n\nimport fitView from './fitView.mjs';\nimport geoJSON from './geoJSON.mjs';\n\nimport geometry from './geometry.mjs';\nimport getBounds from './getBounds.mjs';\n\nimport infotip from './infotip.mjs';\nimport _draw from './interactions/draw.mjs';\nimport _highlight from './interactions/highlight.mjs';\nimport _modify from './interactions/modify.mjs';\nimport snap from './interactions/snap.mjs';\nimport _zoom from './interactions/zoom.mjs';\nimport locate from './locate.mjs';\nimport popup from './popup.mjs';\nimport removeLayer from './removeLayer.mjs';\n\n/**\n@function decorate\n\n@description\nThe mapview decorator method decorates the mapview object param as a typedef mapview object.\n\nThe mapview decorator may return the async mapviewPromise method which must be awaited if svgTemplates must be loaded or syncPlugins must be executed.\n\n@param {object} mapview JSON params for a new mapview.\n@property {string} [mapview.host=mapp.host] The host domain/path for queries.\n@property {object} mapview.locale The locale defintion for the mapview.\n@property {Object} [locale.svgTemplates] Object of template key and src values to be loaded as svg strings. locale.svg_templates is the legacy property.\n@property {array} [locale.syncPlugins] An array plugins to be loaded in order.\n\n@returns {mapview} Decorated Mapview.\n*/\nexport default function decorate(mapview) {\n  if (!mapview.locale) {\n    console.warn(`A locale property is required to decorare a mapview object.`);\n    return;\n  }\n  if (!mapview.target) {\n    console.warn(`A target is required for the mapview Map creation.`);\n    return;\n  }\n\n  // Replace keyvalue_dictionary entries if required.\n  mapp.utils.keyvalue_dictionary(mapview.locale);\n\n  // Assign host from mapp if not implicit.\n  mapview.host ??= mapp.host;\n\n  Object.assign(mapview, {\n    addLayer,\n    allFeatures,\n    changeEnd,\n    changeEndCallbacks: [updateView],\n    fitView,\n    geoJSON,\n    geometry,\n    getBounds,\n    infotip,\n    interactions: {\n      draw: _draw.bind(mapview),\n      highlight: _highlight.bind(mapview),\n      modify: _modify.bind(mapview),\n      snap,\n      zoom: _zoom.bind(mapview),\n    },\n    layers: {},\n    locate,\n    locations: {},\n    metrics: {\n      area: (geometry) => ol.sphere.getArea(geometry),\n      distance: (geometry) =>\n        ol.sphere.getLength(\n          new ol.geom.LineString([\n            geometry.getInteriorPoint().getCoordinates(),\n            mapview.position,\n          ]),\n        ),\n      length: (geometry) => ol.sphere.getLength(geometry),\n    },\n    popup,\n    removeLayer,\n    srid: mapview.locale.srid || '3857',\n  });\n\n  viewConfig(mapview);\n\n  mapviewControls(mapview);\n\n  // Map\n  mapview.Map = new ol.Map({\n    controls: mapview.controls,\n    interactions: ol.interaction.defaults.defaults({\n      mouseWheelZoom:\n        (mapview.scrollWheelZoom && {\n          duration: 250, // default\n          timeout: 80, // default\n        }) ||\n        false,\n      pinchRotate:\n        (mapview.pinchRotate && {\n          threshold: 3,\n        }) ||\n        false,\n    }),\n    moveTolerance: 5,\n    target: mapview.target, //[new ol.control.Zoom()]\n    view: new ol.View(mapview.view),\n  });\n\n  mapview.target = mapview.Map.getTargetElement();\n\n  updateView(mapview);\n\n  // Observe whether the mapview.Map target element changes size.\n  // Method should debounce to account for manual resizing, ie. with a slider element.\n  let resizeObserverTimeout;\n  new ResizeObserver(() => {\n    resizeObserverTimeout && clearTimeout(resizeObserverTimeout);\n\n    resizeObserverTimeout = setTimeout(() => {\n      mapview.target.dispatchEvent(new Event('resize'));\n    }, 400);\n  }).observe(mapview.target);\n\n  viewMask(mapview);\n\n  // Create mapview attribution.\n  attribution(mapview);\n\n  // Events\n\n  // pointermove\n  mapview.Map.on('pointermove', (e) => {\n    // The geographic coordinate.\n    mapview.position = e.coordinate;\n\n    // The pixel coordinate.\n    mapview.pointerLocation = {\n      x: e.originalEvent.clientX,\n      y: e.originalEvent.clientY,\n    };\n  });\n\n  // mouseout\n  mapview.target.addEventListener('mouseout', () => {\n    mapview.infotip(null);\n\n    // Set position on and pointerLocation to null.\n    mapview.position = null;\n    mapview.pointerLocation = {\n      x: null,\n      y: null,\n    };\n  });\n\n  mapview.target.addEventListener('changeEnd', () => mapview.changeEnd());\n\n  mapview.Map.on('moveend', () =>\n    mapview.target.dispatchEvent(new Event('changeEnd')),\n  );\n\n  // svgTemplates replaces the legacy svg_templates configuration\n  mapview.locale.svgTemplates ??= mapview.locale.svg_templates;\n\n  if (mapview.locale.syncPlugins?.length || mapview.locale.svgTemplates) {\n    return mapviewPromise(mapview);\n  }\n\n  return mapview;\n}\n\n/**\n@function viewConfig\n\n@description\nThe method sets the view config for the mapview.\n\n@param {object} mapview JSON params for a new mapview.\n@property {object} [mapview.view] The view config.\n@property {float} [view.lng = 0] Longitude\n@property {float} [view.lat = 0] Latitude\n*/\nfunction viewConfig(mapview) {\n  mapview.view ??= mapview.locale.view || {};\n\n  mapview.view.projection = `EPSG:${mapview.srid}`;\n\n  mapview.view.minZoom ??= mapview.locale.minZoom || 0;\n\n  mapview.view.maxZoom ??= mapview.locale.maxZoom;\n\n  mapview.view.z =\n    mapp.hooks?.current?.z || mapview.view.z || mapview.view.minZoom;\n\n  // Assign z as zoom for the OL view constructor.\n  mapview.view.zoom = mapview.view.z;\n\n  mapview.view.center = ol.proj.fromLonLat([\n    Number.parseFloat(mapp.hooks?.current?.lng || mapview.view?.lng || 0),\n    Number.parseFloat(mapp.hooks?.current?.lat || mapview.view?.lat || 0),\n  ]);\n\n  viewExtent(mapview);\n}\n\n/**\n@function viewExtent\n\n@description\nThe methods checks the locale extent configuration and sets the view extent.\n\n@param {object} mapview JSON params for a new mapview.\n@property {locale} mapview.locale The mapview locale.\n@property {object} [mapview.view] The view config.\n@property {object} [locale.extent] The locale/view extent.\n*/\nfunction viewExtent(mapview) {\n  if (mapview.locale.bounds) {\n    console.warn('locale.bounds have been renamed to locale.extent');\n    mapview.locale.extent = mapview.locale.bounds;\n  }\n\n  const north = Number.parseFloat(mapview.locale.extent?.north || 90);\n  const south = Number.parseFloat(mapview.locale.extent?.south || -90);\n  const east = Number.parseFloat(mapview.locale.extent?.east || 180);\n  const west = Number.parseFloat(mapview.locale.extent?.west || -180);\n\n  if (north - south >= 0 && east - west >= 0) {\n    mapview.view.extent = ol.proj.transformExtent(\n      [west, south, east, north],\n      'EPSG:4326',\n      `EPSG:${mapview.srid}`,\n    );\n  } else {\n    console.warn(\n      'Invalid extent. Ensure north >= south and east >= west. Global extent is assumed.',\n    );\n    mapview.view.extent = ol.proj.transformExtent(\n      [-180, -90, 180, 90],\n      'EPSG:4326',\n      `EPSG:${mapview.srid}`,\n    );\n  }\n\n  // Assign extent for gazetteer check.\n  mapview.extent = mapview.view.extent;\n}\n\n/**\n@function mapviewControls\n\n@description\nThe method parses mapview control configs in the locale and creates the mapview.controls array of openlayer map control elements.\n\nAn array of mapviewControls, eg. `mapviewControls = ['Zoom']` can be defined to add the control to the mapview.Map on creation.\n\n@param {object} mapview JSON params for the new mapview.Map.\n@property {locale} mapview.locale The mapview locale.\n@property {array} [locale.mapviewControls] Array of openlayers map controls eg. 'Zoom'.\n@property {boolean} [locale.showScaleBar] Legacy config to show metric ScaleLine.\n@property {string} [locale.scalebar] Legacy config to define ScaleLine units.\n@property {string} [locale.ScaleLine] String configuration for openlayers ScaleLine units ['metric' or 'imperial'].\n*/\nfunction mapviewControls(mapview) {\n  // Assign ol controls for mapview from locale.\n  mapview.controls =\n    mapview.locale.mapviewControls\n      ?.filter((control) => Object.hasOwn(ol.control, control))\n      .map((control) => new ol.control[control]()) || [];\n\n  if (mapview.locale.showScaleBar) {\n    // The legacy boolean showScaleBar config will set the ScaleLine to metric.\n    mapview.locale.ScaleLine ??= 'metric';\n  }\n\n  if (mapview.locale.scalebar) {\n    // The legacy scalebar config will set as ScaleLine.\n    mapview.locale.ScaleLine ??= mapview.locale.scalebar;\n  }\n\n  if (mapview.locale.ScaleLine) {\n    // The ScaleLine property must be imperial or metric\n    mapview.locale.ScaleLine =\n      mapview.locale.ScaleLine === 'imperial' ? 'imperial' : 'metric';\n\n    mapview.controls.push(\n      new ol.control.ScaleLine({\n        units: mapview.locale.ScaleLine,\n      }),\n    );\n  }\n}\n\n/**\n@function viewMask\n\n@description\nA mask layer will be added to the mapview map if the mask flag is set in the locale.extent.\n\n@param {object} mapview JSON params for a new mapview.\n@property {locale} mapview.locale The mapview locale.\n@property {object} [locale.extent] The locale/view extent.\n@property {boolean} [extent.mask] Apply mask layer to the view extent.\n*/\nfunction viewMask(mapview) {\n  if (mapview.locale.maskBounds) {\n    console.warn('locale.maskBounds is set as mask:true in locale.extent');\n  }\n\n  // Extent mask\n  if (!mapview.locale.extent?.mask) return;\n\n  // Set world extent\n  const world = [\n    [180, 90],\n    [180, -90],\n    [-180, -90],\n    [-180, 90],\n    [180, 90],\n  ];\n\n  // Set locale extent\n  const extent = [\n    [mapview.locale.extent.east, mapview.locale.extent.north],\n    [mapview.locale.extent.east, mapview.locale.extent.south],\n    [mapview.locale.extent.west, mapview.locale.extent.south],\n    [mapview.locale.extent.west, mapview.locale.extent.north],\n    [mapview.locale.extent.east, mapview.locale.extent.north],\n  ];\n\n  // Create a maskFeature from the word and locale extent.\n  const maskFeature = new ol.Feature({\n    geometry: new // Use world and locale extent as polygon rings.\n    // The second ring will be subtracted.\n    ol.geom.Polygon([world, extent]).transform(\n      `EPSG:4326`,\n      `EPSG:${mapview.srid}`,\n    ),\n  });\n\n  // Add masklayer with the maskFeature\n  // and infinite zIndex to mapview.Map\n  mapview.Map.addLayer(\n    new ol.layer.Vector({\n      source: new ol.source.Vector({\n        features: [maskFeature],\n      }),\n      style: {\n        'fill-color': '#0004',\n      },\n      zIndex: Infinity,\n    }),\n  );\n}\n\n/**\n@function changeEnd\n@this mapview\n\n@description\nThe changeEnd method is debounced by 400ms and will iterate over the changeEndCallbacks array methods. Each method will be called with the mapview [this] as argument.\n*/\nfunction changeEnd() {\n  clearTimeout(this.changeEndTimer);\n\n  this.changeEndTimer = setTimeout(() => {\n    for (const fn of this.changeEndCallbacks) {\n      if (typeof fn === 'function') {\n        fn(this);\n      }\n    }\n    for (const layer of Object.values(this.layers)) {\n      if (typeof layer.changeEnd === 'function') {\n        layer.changeEnd();\n      }\n    }\n  }, 400);\n}\n\n/**\n@function updateView\n\n@description\nThe method updates the mapview.view object with the current lat, lng, and z from the OL Map object.\n\nThe view parameters will also be set as url params with the hooks option provided to the mapview decorator.\n@param {mapview} mapview\n@property {object} mapview.view The current Map view.\n@property {float} view.z The current Map view zoom level.\n@property {float} view.lat The current Map view latitude.\n@property {float} view.lng The current Map view longitude.\n*/\nfunction updateView(mapview) {\n  // Assign the Map.view z to the mapview object.\n  mapview.view.z =\n    Math.round((mapview.Map.getView().getZoom() + Number.EPSILON) * 100) / 100;\n\n  // Get center from Map.View\n  mapview.view.center = ol.proj.transform(\n    mapview.Map.getView().getCenter(),\n    `EPSG:${mapview.srid}`,\n    `EPSG:4326`,\n  );\n\n  mapview.view.lat =\n    Math.round((mapview.view.center[1] + Number.EPSILON) * 100000) / 100000;\n  mapview.view.lng =\n    Math.round((mapview.view.center[0] + Number.EPSILON) * 100000) / 100000;\n\n  // Update URL params if enabled on mapview\n  if (mapview.hooks) {\n    // Set lat, lng, z URL params.\n    mapp.hooks.set({\n      lat: mapview.view.lat,\n      lng: mapview.view.lng,\n      z: mapview.view.z,\n    });\n  }\n}\n\n/**\n@function mapviewPromise\n@async\n\n@description\nmapviewPromise is an async method which resolves to the mapview object. The method is returned from the mapview decorator if the creation of the mapview must be awaited in order to import and execute synchronous plugin methods or load svg_templates required for synchronous feature style render methods.\n\nThe method will iterate of the locale.layers array and merge layer.plugins into the locale.plugins array.\n\n@param {object} mapview \n@property {locale} mapview.locale The locale defintion for the mapview.\n@property {array} locale.plugins Array of plugins to dynamically import.\n@property {array} [locale.layers] Array of locale layers which may have additional plugins to load.\n@property {array} [locale.syncPlugins] Array of plugins [key] to be executed in sync.\n@property {array} [locale.svgTemplates] Array of svg_templates [objects] to be loaded.\n\n@returns {Promise<mapview>} The async method resolves to the decorated mapview object.\n*/\nasync function mapviewPromise(mapview) {\n  await mapp.utils.svgTemplates(mapview.locale.svgTemplates);\n\n  // Load dictionary if language other than English.\n  if (\n    mapp.language !== 'en' &&\n    !Object.hasOwn(mapp.dictionaries, mapp.language)\n  ) {\n    await mapp.utils.loadDictionary(mapp.language);\n  }\n\n  // Locale must have an empty plugins array in order to concatenate with layer.plugins[]\n  mapview.locale.plugins ??= [];\n\n  // Concat layer.plugins into locale.plugins array.\n  if (Array.isArray(mapview.locale.layers)) {\n    for (const layer of mapview.locale.layers) {\n      if (Array.isArray(layer.plugins)) {\n        mapview.locale.plugins = layer.plugins.concat(mapview.locale.plugins);\n      }\n    }\n  }\n\n  // Remove potential duplicates.\n  mapview.locale.plugins = [...new Set(mapview.locale.plugins)];\n\n  if (mapview.loadPlugins) {\n    await mapp.utils.loadPlugins(\n      mapview.locale.plugins,\n      Array.isArray(mapview.loadPlugins) ? mapview.loadPlugins : undefined,\n    );\n  }\n\n  mapview.locale.syncPlugins ??= [];\n\n  const syncPlugins = new Set(mapview.locale.syncPlugins);\n\n  // Execute synchronous plugins in order of array.\n  for (const key of mapview.locale.syncPlugins) {\n    if (typeof mapp.plugins[key] !== 'function') continue;\n\n    await mapp.plugins[key](mapview.locale[key], mapview);\n  }\n\n  // Execute all other plugin methods async.\n  const asyncPlugins = Object.keys(mapview.locale)\n    .filter((key) => !syncPlugins.has(key))\n    .filter((key) => typeof mapp.plugins[key] === 'function')\n    .map((key) => mapp.plugins[key](mapview.locale[key], mapview));\n\n  await Promise.all(asyncPlugins);\n\n  return mapview;\n}\n", "/**\n### Admin Plugin\n\nDictionary entries:\n- toolbar_admin\n\n@requires /dictionary\n\n@module /plugins/admin\n*/\n\n/**\nAdds an admin button to the map view if the user has admin privileges.\n@function admin\n@param {Object} plugin - The plugin configuration object.\n@param {Object} mapview - The mapview object.\n@returns {void}\n*/\nexport function admin(plugin, mapview) {\n  const btnColumn = mapview.mapButton;\n\n  // the btnColumn element only exist in the default mapp view.\n  if (!btnColumn) return;\n\n  // Append user admin link.\n  if (!mapp.user?.admin) return;\n\n  btnColumn.appendChild(mapp.utils.html.node`\n    <a\n      title=${mapp.dictionary.toolbar_admin}\n      href=\"${mapp.host + '/api/user/admin'}\">\n      <span class=\"notranslate material-symbols-outlined\">supervisor_account`);\n}\n", "/**\n# /plugins/dark_mode\n\nThe module defines a darkTheme object to be applied with the cssColour.setTheme utility.\n\n@requires /ui/utils/cssColour\n\n@module /plugins/dark_mode\n*/\n\n/**\n@function dark_mode\n@description\nThe dark_mode plugin method adds a button to the mapview controls which allows to toggle the application of a darkTheme defined in this module.\n\nWhether the darkTheme should be applied by default is stored as darkMode flag in the localStorage.\n*/\nexport function dark_mode(plugin, mapview) {\n  // If mapbutton doesn't exist, return (for custom views).\n  if (!mapview.mapButton) return;\n\n  // localStorage stores boolean with their respective string values.\n  let darkMode = mapp.user?.dark_mode;\n\n  // toggle dark_mode if true.\n  darkMode &&\n    mapp.ui.utils.cssColour.setTheme(mapp.ui.utils.cssColour.themes.dark);\n\n  const button = mapp.utils.html.node`<button\n    title=${mapp.dictionary.dark_mode}\n    data-id=\"dark_mode\"\n    class=\"btn-color-mode\"\n    onclick=${() => {\n      // toggle darkMode property\n      darkMode = !darkMode;\n\n      if (mapp.user) {\n        mapp.user.dark_mode = darkMode;\n        updateUser();\n      }\n\n      // Update the dark mode theme depending on the user setting\n      const ThemeChosen = darkMode ? mapp.ui.utils.cssColour.themes.dark : {};\n\n      // Set the dark mode theme\n      mapp.ui.utils.cssColour.setTheme(ThemeChosen);\n\n      // change mode icon\n      const modeIcon = button.querySelector('span');\n      modeIcon.textContent = darkMode ? 'light_mode' : 'dark_mode';\n    }}>\n    <span class=\"notranslate material-symbols-outlined\">${darkMode ? 'light_mode' : 'dark_mode'}`;\n\n  // If the button container exists, append the dark mode button.\n  mapview.mapButton.append(button);\n}\n\n/**\n@function updateUser\n@description\nThis function updates the user object in the IndexedDB.\nRemoves roles, admin and, blocked flag from the user to prevent these properties being overwritten.\n*/\nasync function updateUser() {\n  // Remove roles, admin and, blocked from mapp.user.\n  // Prevents overwriting values from the user table\n  const sanitizedUser = { ...mapp.user };\n  delete sanitizedUser.roles;\n  delete sanitizedUser.admin;\n  delete sanitizedUser.blocked;\n\n  // Store the user object in the IndexedDB\n  await mapp.utils.userIndexedDB.put({\n    store: 'user',\n    name: mapp.user.email,\n    obj: sanitizedUser,\n  });\n}\n\n/**\n@function custom_theme\n@description\nThe custom_theme object from the locale will be applied through the cssColourTheme utility.\n@param {Object} theme The colourTheme to be applied.\n@example\n\"custom_theme\": {\n      \"primary\": \"#311250\",\n      \"base\": \"#f2f2f2\",\n      \"base-secondary\": \"#f7f7f7\",\n      \"base-tertiary\": \"#fafafa\",\n      \"font\": \"#3f3f3f\",\n      \"font-mid\": \"#858585\",\n      \"font-contrast\": \"#dddddd\",\n      \"border\": \"#dddddd\",\n      \"active\": \"#c864dc\",\n      \"hover\": \"#939faa\",\n      \"changed\": \"#ffffa7\",\n      \"info\": \"#00695c\",\n      \"danger\": \"#A21309\"\n    }\n*/\nexport function custom_theme(theme) {\n  mapp.ui.utils.cssColour.setTheme(theme);\n}\n", "/**\n## /plugins/feature_info\n\nThe feature_info plugin module exports the feature_info plugin method.\n\nDictionary entries:\n- toolbar_current_location\n\n@requires /dictionary\n@requires /mapview/interactions/highlight\n@requires /mapview/popup\n\n@module /plugins/feature_info\n*/\n\n/**\n@function feature_info\n@description\nThe feature_info plugin method adds a button to the #mapButton element to call the toggleFeatureInfoHighlight method.\n\nThe plugin param will turned into an object if configured as true in the locale.\n\n@param {Object} plugin The plugin config object from the locale.\n@param {mapview} mapview The mapview for the highlight feature info interaction.\n*/\nexport function feature_info(plugin, mapview) {\n  const btnColumn = mapview.mapButton;\n\n  if (!btnColumn) return;\n\n  if (plugin === true) {\n    plugin = {};\n  }\n\n  plugin.btn = mapp.utils.html.node`<button\n    title=${mapp.dictionary.feature_info}\n    data-id=\"feature_info\"\n    onclick=${() => toggleFeatureInfoHighlight(plugin, mapview)}>\n    <span class=\"notranslate material-symbols-outlined\">left_click`;\n\n  btnColumn.append(plugin.btn);\n}\n\n/**\n@function toggleFeatureInfoHighlight\n@description\nThe meathod will toggle a highlight interaction with a custom getFeature callback method.\n\nThe getFeature method will log the feature properties to the dev console and create a mapview popup with the stringified feature properties object in a pre-code block.\n\n@param {Object} plugin The plugin config object from the locale.\n@param {mapview} mapview The mapview for the highlight feature info interaction.\n@property {boolean} [plugin.features] Include the cluster features[] label in the output.\n@property {string} [plugin.css] The css for the content element passed to the mapview popup.\n*/\nfunction toggleFeatureInfoHighlight(plugin, mapview) {\n  // Toggle will return true if class is added.\n  if (plugin.btn.firstElementChild.classList.toggle('active')) {\n    mapview.interactions.highlight({\n      callback: () => {\n        plugin.btn.firstElementChild.classList.remove('active');\n      },\n      getFeature: (feature) => {\n        const featureProperties = feature.F.getProperties();\n\n        // The OL Styles array is meaningless for the feature_info popup.\n        delete featureProperties.Styles;\n\n        delete featureProperties.geometry;\n\n        // Check for cluster feature.\n        if (Array.isArray(featureProperties.features)) {\n          // Reduce features to length or properties dependent on the flag.\n          featureProperties.features = plugin.features\n            ? featureProperties.features.map(\n                (F) => F.getProperties()[feature.layer.cluster.label],\n              )\n            : featureProperties.features.length;\n        }\n\n        console.log(feature.F);\n\n        const feature_info = {\n          id: feature.id,\n          layer: feature.layer.key,\n          properties: featureProperties,\n        };\n\n        plugin.css ??= 'padding: 1em; max-width: 250px; overflow: auto;';\n\n        const content = mapp.utils.html.node`<pre\n          style=${plugin.css}\n          >${JSON.stringify(feature_info, undefined, 2)}`;\n\n        mapview.popup({\n          content,\n        });\n      },\n    });\n  } else {\n    // Will finish the feature_info highlight method.\n    mapview.interactions.highlight();\n  }\n}\n", "/**\n### Fullscreen Plugin\n\nDictionary entries:\n- toolbar_fullscreen\n\n@requires /dictionary\n\n@module /plugins/fullscreen\n */\n\n/**\nAdds a fullscreen toggle button to the map view.\n@function fullscreen\n@param {Object} plugin - The plugin configuration object.\n@param {Object} mapview - The mapview object.\n@param {ol.Map} mapview.Map - The OpenLayers map object.\n@param {Object} mapview.layers - The layers object containing map layers.\n@returns {void}\n*/\nexport function fullscreen(plugin, mapview) {\n  const btnColumn = mapview.mapButton;\n\n  // The btnColumn element only exists in the default mapp view.\n  if (!btnColumn) return;\n\n  function toggleFullscreen(e) {\n    e.target.classList.toggle('active');\n    document.body.classList.toggle('fullscreen');\n    mapview.Map.updateSize();\n    Object.values(mapview.layers).forEach((layer) => layer.mbMap?.resize());\n  }\n\n  const btn = mapp.utils.html.node`\n    <button\n      data-id=\"fullscreen\"\n      class=\"mobile-display-none\"\n      title=${mapp.dictionary.toolbar_fullscreen}\n      onclick=${toggleFullscreen}>\n      <span class=\"notranslate material-symbols-outlined\">left_panel_close`;\n\n  btnColumn.append(btn);\n}\n", "/**\n### /plugins/layer_order\n\nThe plugin sorts the mapview.locale.layers[] array according to the order of layer object keys in the layer_order locale property.\n\nLayer with keys not referenced in the layer order will be on top.\n\n```js\n\"layer_order\": [\n  \"urban_areas\",\n  \"admin\",\n  \"retail_places\"\n]\n```\n@module plugins/layer_order\n*/\n\n/**\n@function layer_order\n\n@description\nThe function sorts mapview.locale.layers based on the order specified in layer_order array.\nIt accesses each layer key and checks its index in the layer_order array.\n@param {Array} plugin An array listing layers to be reordered.\n@param {Object} mapview The mapview object\n*/\nexport function layer_order(plugin, mapview) {\n  if (!Array.isArray(plugin)) return;\n  mapview?.locale?.layers.sort(\n    (a, b) => plugin.indexOf(a.key) - plugin.indexOf(b.key),\n  );\n}\n", "/**\n## /plugins/link_button\nThe module exports the link_button plugin method to mapp.plugins{}\n\nDictionary entries:\n- link\n\n@requires /dictionary\n\n@module /plugins/link_button\n*/\n\n/**\n@function link_button\n\n@description\nThe link_button locale property is provided as the link_button function argument. This can be either a single object or an array of objects.\nicon_name is the name of the symbol in Material Icons resources.\n```json\n\"link_button\": [\n  {\n    \"href\": \"/url/url\",\n    \"title\": \"TITLE HERE\",\n    \"css_style\": \"color: blue;\",\n    \"icon_name\": \"grid_view\"\n  },\n  {\n    \"href\": \"/foo\",\n    \"title\": \"Foo\",\n    \"locale\": true\n  }\n]\n```\nThe link_button method will call the addButton method for each link_button object.\n\n@param {Object} link_button The link_button config, can be an array of objects.\n@param {mapview} mapview The mapview object.\n*/\nlet mapButton;\nexport function link_button(link_button, mapview) {\n  mapButton = mapview.mapButton;\n  const localeKey = mapview.locale.key;\n\n  if (!mapButton) return;\n\n  if (!link_button) return;\n\n  if (Array.isArray(link_button)) {\n    link_button.forEach((link) => addButton(link, localeKey));\n  } else {\n    addButton(link_button, localeKey);\n  }\n}\n\n/**\n@function addButton\n@description\nThe addButton method creates a link element and appends the element to the mapButton.\n\n@param {Object} link The link object.\n@param {string} localeKey The key of the current mapview locale.\n@property {string} link.href The link URL.\n@property {string} link.title The link title, defaults to \"Link\".\n@property {string} link.target The link target, defaults to \"_blank\".\n@property {string} link.css_class Optional class for the symbol container.\n@property {string} link.css_style The style for the symbol container.\n@property {string} link.icon_name The name for Material Icons symbol. Read more: https://fonts.google.com/icons\n@property {boolean} [link.locale] Whether to append the locale to the href.\n*/\nfunction addButton(link, localeKey) {\n  if (!link?.href) {\n    console.warn(`You must provide a href for the link_button plugin.`);\n    return;\n  }\n\n  if (link.locale) {\n    link.href = `${link.href}?locale=${localeKey}`;\n  }\n\n  link.css_class ??= '';\n\n  const css_class = `notranslate material-symbols-outlined ${link.css_class}`;\n\n  // If no icon name is provided, warn\n  if (!link.icon_name) {\n    console.warn(\n      `You must provide an icon_name for the link_button plugin. If applicable, remove the mask-icon from the css_class property and/or the svg links from the css_style property.`,\n    );\n    return;\n  }\n\n  link.icon_name ??= 'open_in_new';\n\n  link.title ??= mapp.dictionary.link;\n\n  const node = mapp.utils.html.node`\n    <a\n      title=${link.title}\n      href=${link.href}\n      target=${link.target}>\n      <span\n      class=${css_class}\n      style=${link.css_style}>${link.icon_name}`;\n\n  mapButton.append(node);\n}\n", "/**\n### Locator Plugin\n\nDictionary entries:\n- toolbar_current_location\n\n@requires /dictionary\n\n@module /plugins/locator\n */\n\n/**\nAdds a locator button to the map view for triggering geolocation.\n@function locator\n@param {Object} plugin - The plugin configuration object.\n@param {Object} mapview - The mapview object.\n@param {Function} mapview.locate - The locate function of the mapview.\n@returns {void}\n*/\nexport function locator(plugin, mapview) {\n  const btnColumn = mapview.mapButton;\n\n  // The btnColumn element only exists in the default mapp view.\n  if (!btnColumn) return;\n\n  const btn = mapp.utils.html.node`\n    <button\n      data-id=\"locator\"\n      title=${mapp.dictionary.toolbar_current_location}\n      onclick=${(e) => {\n        e.target.classList.toggle('active');\n        mapview.locate();\n      }}><span class=\"notranslate material-symbols-outlined\">my_location`;\n\n  btnColumn.append(btn);\n}\n", "/**\n### Login Plugin\n\nDictionary entries:\n- toolbar_login\n- toolbar_logout\n\n@requires /dictionary\n\n@module /plugins/login\n */\n\n/**\nAdds a login/logout button to the map view.\n@function login\n@param {Object} plugin - The plugin configuration object.\n@param {Object} mapview - The mapview object.\n@returns {void}\n*/\nexport function login(plugin, mapview) {\n  const btnColumn = mapview.mapButton;\n\n  // the btnColumn element only exist in the default mapp view.\n  if (!btnColumn) return;\n\n  // Append login/logout link.\n  if (!document.head.dataset.login) return;\n\n  const iconName = `${mapp.user ? 'logout' : 'lock_open'}`;\n\n  const iconClass =\n    'notranslate material-symbols-outlined' +\n    (mapp.user ? ' color-danger' : '');\n\n  let userURL;\n\n  if (mapp.user?.sessionIndex) {\n    userURL = `${mapp.host}/saml/logout`;\n  } else if (mapp.user) {\n    userURL = '?logout=true';\n  } else {\n    userURL = '?login=true';\n  }\n\n  btnColumn.appendChild(mapp.utils.html.node`\n    <a\n      title=${mapp.user ? mapp.dictionary.toolbar_logout : mapp.dictionary.toolbar_login}\n      href=${userURL}>\n      <span class=${iconClass}>${iconName}`);\n}\n", "/**\nThe svg_templates plugin module has been deprectated in favour of {@link module:/utils/svgTemplates}.\n\n@module /plugins/svg_templates\n@deprecated\n*/\n\n/**\n@function svg_templates\n@deprecated\n*/\nexport async function svg_templates(plugin) {\n  return mapp.utils.svgTemplates(plugin);\n}\n", "/**\n### Test plugin\n\nThis plugin is used to run different kinds of tests on any instance.\n- Core\n- Integrity\n\nTo provide test params to the plugin you can provide a test object to a locale.\n\n```json\n\"test\": {\n  \"quiet\": true, <-- will only show errors (Defaults to false)\n  \"showSummary\": true, <-- will show a summary (Default to false)\n},\n```\nTo run the different tests you can provide the `test` param as part of the url params.\n\neg.\n\n`/?test=core` - run the core front end tests\n`/?test=integrity` - run the integrity tests\n\nTODO: The current core & integrity tests are going to be restructured and reinvisioned in the next iteration.\n\n@module /plugins/test\n*/\n\n/**\nAdds the core & integrity tests to the mapp.plugins object to be run on a workspace.\n@function test\n@param {Object} plugin - The plugin configuration object.\n@param {Object} mapview - The mapview object.\n@returns {void}\n*/\nexport async function test(plugin, mapview) {\n  if (!mapp.hooks.current.test) return;\n\n  plugin = Object.assign({}, plugin, {\n    quiet: plugin?.quiet ?? false,\n    showSummary: plugin?.showSummary ?? true,\n  });\n\n  if (plugin.options) {\n    plugin = plugin.options;\n    console.warn(\n      'please move the options properties into the test plugin object',\n    );\n  }\n\n  try {\n    await mapp.utils.esmImport('codi-test-framework@1.0.37');\n\n    if (!globalThis._mappTest) {\n      await import(`${mapp.host}/public/js/tests/_mapp.test.js`);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n\n  if (!codi) return;\n\n  if (mapp.hooks.current.test === 'integrity') {\n    mapview.Map.once('loadend', async () => {\n      await codi.runWebTestFunction(\n        () => _mappTest.integrityTests(mapview),\n        plugin,\n      );\n    });\n  }\n\n  if (mapp.hooks.current.test === 'core') {\n    await codi.runWebTestFunction(() => _mappTest.coreTest(mapview), plugin);\n  }\n}\n", "/** \n### /plugins/userIDB\n\nThe plugin provides a JSON editor interface for the userIndexedDB 'user' store.\n\n@requires /utils/userIndexedDB\n@module /plugins/userIDB\n*/\n\n/**\n@function userIDB\n\nThe userIDB plugin method adds a button to toggle the user dialog.\n\n@param {Object} plugin The userIDB config.\n@param {Object} mapview The mapview object.\n*/\nexport function userIDB(plugin, mapview) {\n  plugin.user = mapp.user || {\n    email: 'anonymous',\n  };\n\n  // Find the btnColumn element.\n  const btnColumn = mapview.mapButton;\n\n  if (!btnColumn) return;\n\n  plugin.title ??= 'userIDB';\n\n  plugin.button = mapp.utils.html.node`\n  <button\n    title=${plugin.title}\n    onclick=${() => {\n      if (plugin.button.classList.toggle('active')) {\n        userDialog(plugin);\n      } else {\n        plugin.dialog?.close();\n      }\n    }}>\n    <span class=\"notranslate material-symbols-outlined\">rule_settings`;\n\n  // Append the plugin btn to the btnColumn.\n  btnColumn.append(plugin.button);\n}\n\n/**\n@function userDialog\n\nThe userDialog method show a dialog with a jsonEditor element containing the user object.\n\nCustom button elements added to the jsonEditor toolbar allow to store/update the user object in the userIndexedDB or to remove the stored user.\n\n@param {Object} plugin The userIDB config.\n*/\nasync function userDialog(plugin) {\n  const content = mapp.utils.html.node`<div>`;\n\n  const jsoneditor = await mapp.ui.elements.jsoneditor({\n    props: {\n      content: {\n        text: JSON.stringify(plugin.user),\n      },\n      mode: 'text',\n      onRenderMenu: renderUpdateMenu,\n    },\n    target: content,\n  });\n\n  plugin.dialog = {\n    closeBtn: true,\n    content,\n    header: plugin.title,\n    onClose: (e) => {\n      plugin.button.classList.remove('active');\n    },\n    target: document.getElementById('Map'),\n  };\n\n  mapp.ui.elements.dialog(plugin.dialog);\n\n  // Create a custom menu for the userLayer jsoneditor control.\n  function renderUpdateMenu(items) {\n    // Push button to add layer to mapview layers.\n    items.push(\n      {\n        className: 'notranslate material-symbols-outlined-important',\n        onClick: updateUser,\n        text: 'person_edit',\n        title: 'Update User',\n        type: 'button',\n      },\n      {\n        className: 'notranslate material-symbols-outlined-important',\n        onClick: removeUser,\n        text: 'person_remove',\n        title: 'Remove User',\n        type: 'button',\n      },\n    );\n\n    return items\n      .filter((item) => item.text !== 'table')\n      .filter((item) => item.text !== 'tree')\n      .filter((item) => item.type !== 'separator')\n      .filter((item) => item.className !== 'jse-undo')\n      .filter((item) => item.className !== 'jse-redo')\n      .filter((item) => item.className !== 'jse-search')\n      .filter((item) => item.className !== 'jse-contextmenu')\n      .filter((item) => item.className !== 'jse-sort')\n      .filter((item) => item.className !== 'jse-transform');\n  }\n\n  async function updateUser() {\n    const content = jsoneditor.get();\n\n    const jsonUser = JSON.parse(content.text);\n\n    await mapp.utils.userIndexedDB.put({\n      store: 'user',\n      name: jsonUser.email,\n      obj: jsonUser,\n    });\n  }\n\n  async function removeUser() {\n    const content = jsoneditor.get();\n\n    const jsonUser = JSON.parse(content.text);\n\n    if (!jsonUser.email) return;\n\n    await mapp.utils.userIndexedDB.remove({\n      store: 'user',\n      name: jsonUser.email,\n    });\n\n    content.text = JSON.stringify({\n      email: jsonUser.email,\n    });\n\n    jsoneditor.set(content);\n  }\n}\n", "/**\n## /plugins/userLayer\n\nThe plugin module provides developers a jsoneditor interface to add new layers in the default view.\n\n@requires /ui/utils/layerJSE\n\n@module /plugins/userLayer\n*/\n\n/**\n@function userLayer\n@async\n\n@description\nThe userLayer plugin method adds a button to the layer control to open a jsoneditor dialog.\n\nThe jsoneditor dialog allows to validate a layer json configuration to add as user layer to the mapview.\n\n@param {Object} plugin The object holds the plugin configuration.\n@param {mapview} mapview The mapview to which a user layer should be added.\n*/\nexport async function userLayer(plugin, mapview) {\n  // The mapp.ui lib must be loaded.\n  if (!mapp.ui?.utils.layerJSE) return;\n\n  plugin.layersNode = document.getElementById('layers');\n\n  if (!plugin.layersNode) return;\n\n  // Create a content div for the dialog.\n  const content = mapp.utils.html.node`<div>`;\n\n  const addBtn = {\n    className: 'text-button',\n    onClick: () => addLayer(plugin, mapview),\n    text: 'Add Layer',\n    title: 'Add Layer to mapview',\n    type: 'button',\n  };\n\n  // Use the content as target for the jsoneditor control.\n  plugin.jsoneditor = await mapp.ui.utils.layerJSE(\n    content,\n    { json: {} },\n    addBtn,\n  );\n\n  plugin.btn = mapp.utils.html.node`<button\n    class=\"raised\"\n    onclick=${() => {\n      plugin.btn.classList.toggle('active');\n\n      plugin.dialog = mapp.ui.elements.dialog({\n        header: mapp.utils.html.node`<div>`,\n        css_style: 'width: 500px; height 300px',\n        containedCentre: true,\n        contained: true,\n        closeBtn: true,\n        onClose: () => {\n          plugin.btn.classList.toggle('active');\n        },\n        content,\n      });\n    }}>Add Layer`;\n\n  plugin.layersNode.append(plugin.btn);\n}\n\n/**\n@function addLayer\n@async\n\n@description\nThe method will attempt to decorate the json content of the jsoneditor element as a mapp layer.\n\nThe decorate mapp layer will be added to the mapview and the layer view will be appended to the layers list.\n\n@param {Object} plugin The object holds the plugin configuration.\n@param {mapview} mapview The mapview to which a user layer should be added.\n*/\nasync function addLayer(plugin, mapview) {\n  const content = plugin.jsoneditor.get();\n\n  const jsonLayer = JSON.parse(content.text);\n\n  jsonLayer.mapview = mapview;\n\n  jsonLayer.zIndex ??= mapview.zIndex++;\n\n  jsonLayer.key ??= jsonLayer.zIndex;\n\n  const newLayer = await mapp.layer.decorate(jsonLayer);\n\n  if (!newLayer.L) {\n    console.warn('JSON layer could not be decorated');\n    return;\n  }\n\n  mapp.ui.layers.view(newLayer);\n\n  plugin.layersNode.append(newLayer.view);\n\n  newLayer.mapview.layers[newLayer.key] = newLayer;\n\n  newLayer.display && newLayer.show();\n\n  plugin.dialog.close();\n}\n", "/**\n### /plugins/userLocale\n\nThe userLocale plugin appends the userLocale utility interface to the layer panel.\n\n@module /plugins/userLocale\n*/\n\n/**\n@function userLocale\nAn input allows to define the userlocale name with buttons to either put (create or overwrite) a stored userlocale or delete a stored userlocale.\nThe panel will be disabled during the transaction to save or remove a user locale.\n\n@param {Object} plugin The userLocale config from the locale.\n@param {Object} mapview The mapview object.\n*/\nexport function userLocale(plugin, mapview) {\n  const layersNode = document.getElementById('layers');\n\n  if (!layersNode) return;\n\n  // Call the utility method to create the userLocale interface.\n  plugin.content = mapp.ui.elements.userLocale(plugin, mapview);\n\n  // Append the content to the layersNode.\n  layersNode.append(plugin.content);\n}\n", "/**\n### Zoom Btn Plugin\n\nDictionary entries:\n- toolbar_zoom_in\n- toolbar_zoom_out\n\n@requires /dictionary\n\n@module /plugins/zoomBtn\n*/\n\n/**\n@function zoomBtn\n\n@description\nAdds zoom in and zoom out buttons to the mapview.\n\n@param {Object} plugin The plugin configuration object.\n@param {Object} mapview The mapview object.\n@property {ol.Map} mapview.Map The OpenLayers map object.\n@property {Object} mapview.locale The locale object of the mapview.\n@property {number} locale.maxZoom The maximum zoom level allowed.\n@property {number} locale.minZoom The minimum zoom level allowed.\n*/\nexport function zoomBtn(plugin, mapview) {\n  // Plugin will err if called from layer.\n  if (!mapview) return;\n\n  const btnColumn = mapview.mapButton;\n\n  // the btnColumn element only exist in the default mapp view.\n  if (!btnColumn) return;\n\n  // Add zoomIn button.\n  const btnZoomIn = btnColumn.appendChild(mapp.utils.html.node`\n    <button\n      data-id=\"btnZoomIn\"\n      .disabled=${mapview.Map.getView().getZoom() >= mapview.view.maxZoom}\n      title=${mapp.dictionary.toolbar_zoom_in}\n      onclick=${(e) => {\n        const z = parseInt(mapview.Map.getView().getZoom() + 1);\n        mapview.Map.getView().setZoom(z);\n        e.target.disabled = z >= mapview.view.maxZoom;\n      }}><span class=\"notranslate material-symbols-outlined\">zoom_in`);\n\n  // Add zoomOut button.\n  const btnZoomOut = btnColumn.appendChild(mapp.utils.html.node`\n    <button\n      data-id=\"btnZoomOut\"\n      .disabled=${mapview.Map.getView().getZoom() <= mapview.view.minZoom}\n      title=${mapp.dictionary.toolbar_zoom_out}\n      onclick=${(e) => {\n        const z = parseInt(mapview.Map.getView().getZoom() - 1);\n        mapview.Map.getView().setZoom(z);\n        e.target.disabled = z <= mapview.view.minZoom;\n      }}><span class=\"notranslate material-symbols-outlined\">zoom_out`);\n\n  mapview.changeEndCallbacks.push(checkZoom);\n\n  function checkZoom(mapview) {\n    const z = mapview.Map.getView().getZoom();\n    btnZoomIn.disabled = z >= mapview.view.maxZoom;\n    btnZoomOut.disabled = z <= mapview.view.minZoom;\n  }\n}\n", "/**\n### Zoom To Area Plugin\n\nDictionary entries:\n- toolbar_zoom_to_area\n\n@requires /dictionary\n\n@module /plugins/zoomtoArea\n*/\n\n/**\nAdds a \"Zoom to Area\" button to the map view for zooming to a specific area.\n@function zoomToArea\n@param {Object} plugin - The plugin configuration object.\n@param {Object} mapview - The mapview object.\n@param {Object} mapview.interactions - The interactions object of the mapview.\n@param {Function} mapview.interactions.highlight - The highlight interaction function.\n@param {Function} mapview.interactions.zoom - The zoom interaction function.\n@returns {void}\n*/\nexport function zoomToArea(plugin, mapview) {\n  const btnColumn = mapview.mapButton;\n\n  // the btnColumn element only exist in the default mapp view.\n  if (!btnColumn) return;\n\n  function toggleZoomInteraction(e) {\n    // If active cancel zoom and enable highlight interaction.\n    if (e.target.classList.contains('active')) {\n      // Will remove the 'active' class in callback of zoom interaction.\n      mapview.interactions.highlight();\n      return;\n    }\n\n    // Add active class\n    e.target.classList.add('active');\n\n    // Make zoom interaction current.\n    mapview.interactions.zoom({\n      // The interaction callback is executed on cancel or finish.\n      callback: () => {\n        e.target.classList.remove('active');\n        delete mapview.interaction;\n\n        // Set highlight interaction if no other interaction is current after 400ms.\n        setTimeout(() => {\n          !mapview.interaction && mapview.interactions.highlight();\n        }, 400);\n      },\n    });\n  }\n\n  const btn = mapp.utils.html.node`\n    <button\n      class=\"mobile-display-none\"\n      data-id=\"zoomtoarea\"\n      title=${mapp.dictionary.toolbar_zoom_to_area}\n      onclick=${toggleZoomInteraction}>\n      <span class=\"notranslate material-symbols-outlined\">pageview`;\n\n  btnColumn.append(btn);\n}\n", "/**\n## /plugins\n\nThe module exports a collection of core mapp plugins.\n\n@module /plugins\n\n@requires module:/plugins/admin\n@requires module:/plugins/feature_info\n@requires module:/plugins/fullscreen\n@requires module:/plugins/layer_order\n@requires module:/plugins/link_button\n@requires module:/plugins/locator\n@requires module:/plugins/login\n@requires module:/plugins/svg_templates\n@requires module:/plugins/userIDB\n@requires module:/plugins/userLayer\n@requires module:/plugins/userLocale\n@requires module:/plugins/zoomBtn\n@requires module:/plugins/zoomToArea\n*/\n\nimport { admin } from './admin.mjs';\nimport { custom_theme, dark_mode } from './dark_mode.mjs';\nimport { feature_info } from './feature_info.mjs';\nimport { fullscreen } from './fullscreen.mjs';\nimport { layer_order } from './layer_order.mjs';\nimport { link_button } from './link_button.mjs';\nimport { locator } from './locator.mjs';\nimport { login } from './login.mjs';\nimport { svg_templates } from './svg_templates.mjs';\nimport { test } from './test.mjs';\nimport { userIDB } from './userIDB.mjs';\nimport { userLayer } from './userLayer.mjs';\nimport { userLocale } from './userLocale.mjs';\nimport { zoomBtn } from './zoomBtn.mjs';\nimport { zoomToArea } from './zoomToArea.mjs';\n\n/**\n@typedef {Object} plugins\n@property {function} admin The admin plugin module.\n@property {function} feature_info Show feature properties in popup.\n@property {function} fullscreen The fullscreen plugin module.\n@property {function} layer_order The layer_order plugin module.\n@property {function} keyvalue_dictionary The keyvalue_dictionary plugin module.\n@property {function} locator The locator plugin module.\n@property {function} login The login plugin module.\n@property {function} svg_templates The svg_templates plugin module.\n@property {function} zoomBtn The zoomBtn plugin module.\n@property {function} zoomToArea The zoomToArea plugin module.\n@property {function} link_button The link_button plugin module.\n*/\n\nconst plugins = {\n  admin,\n  custom_theme,\n  dark_mode,\n  feature_info,\n  fullscreen,\n  layer_order,\n  link_button,\n  locator,\n  login,\n  svg_templates,\n  test,\n  userIDB,\n  userLayer,\n  userLocale,\n  zoomBtn,\n  zoomToArea,\n};\n\nexport default plugins;\n", "/**\n### /utils/esmImport\n\nThe module exports a default method to import modules from esm.sh cdn.\n\n@module /utils/esmImport\n*/\n\nconst promises = {};\n\n/**\n@function esmImport\n@async\n\n@description\nThe esmImport method add a promise to the promises object for the module to be imported.\n\nAn existing promise will be awaited.\n\nThe promise resolves to the module to be imported.\n\n@param {string} module The module to import.\n@returns {Promise<Module>} The promise resolves to the imported module.\n*/\nexport default async function esmImport(module) {\n  promises[module] ??= new Promise((resolve) => {\n    import(`https://esm.sh/${module}`).then((esm) => {\n      resolve(esm);\n    });\n  });\n\n  return await promises[module];\n}\n", "class e extends Map{set(e,t){return super.set(e,t),t}}class t extends WeakMap{set(e,t){return super.set(e,t),t}}\n/*! (c) Andrea Giammarchi - ISC */const n=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,r=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\\/?)>/g,s=/([^\\s\\\\>\"'=]+)\\s*=\\s*(['\"]?)\\x01/g,l=/[\\x01\\x02]/g;const o=(e,t)=>111===e.nodeType?1/t<0?t?(({firstChild:e,lastChild:t})=>{const n=document.createRange();return n.setStartAfter(e),n.setEndAfter(t),n.deleteContents(),e})(e):e.lastChild:t?e.valueOf():e.firstChild:e,{isArray:a}=Array,i=e=>null==e?e:e.valueOf(),c=(e,t)=>{let n,r,s=t.slice(2);return!(t in e)&&(r=t.toLowerCase())in e&&(s=r.slice(2)),t=>{const r=a(t)?t:[t,!1];n!==r[0]&&(n&&e.removeEventListener(s,n,r[1]),(n=r[0])&&e.addEventListener(s,n,r[1]))}};const{isArray:u,prototype:d}=Array,{indexOf:p}=d,{createDocumentFragment:f,createElement:h,createElementNS:m,createTextNode:g,createTreeWalker:y,importNode:b}=new Proxy({},{get:(e,t)=>document[t].bind(document)});let w;const x=(e,t)=>t?(e=>{w||(w=m(\"http://www.w3.org/2000/svg\",\"svg\")),w.innerHTML=e;const t=f();return t.append(...w.childNodes),t})(e):(e=>{const t=h(\"template\");return t.innerHTML=e,t.content})(e),v=({childNodes:e},t)=>e[t],N=(e,t,n)=>((e,t,n,r,s)=>{const l=n.length;let o=t.length,a=l,i=0,c=0,u=null;for(;i<o||c<a;)if(o===i){const t=a<l?c?r(n[c-1],-0).nextSibling:r(n[a-c],0):s;for(;c<a;)e.insertBefore(r(n[c++],1),t)}else if(a===c)for(;i<o;)u&&u.has(t[i])||e.removeChild(r(t[i],-1)),i++;else if(t[i]===n[c])i++,c++;else if(t[o-1]===n[a-1])o--,a--;else if(t[i]===n[a-1]&&n[c]===t[o-1]){const s=r(t[--o],-1).nextSibling;e.insertBefore(r(n[c++],1),r(t[i++],-1).nextSibling),e.insertBefore(r(n[--a],1),s),t[o]=n[a]}else{if(!u){u=new Map;let e=c;for(;e<a;)u.set(n[e],e++)}if(u.has(t[i])){const s=u.get(t[i]);if(c<s&&s<a){let l=i,d=1;for(;++l<o&&l<a&&u.get(t[l])===s+d;)d++;if(d>s-c){const l=r(t[i],0);for(;c<s;)e.insertBefore(r(n[c++],1),l)}else e.replaceChild(r(n[c++],1),r(t[i++],-1))}else i++}else e.removeChild(r(t[i++],-1))}return n})(e.parentNode,t,n,o,e),C=(e,t)=>{switch(t[0]){case\"?\":return((e,t,n)=>r=>{const s=!!i(r);n!==s&&((n=s)?e.setAttribute(t,\"\"):e.removeAttribute(t))})(e,t.slice(1),!1);case\".\":return((e,t)=>\"dataset\"===t?(({dataset:e})=>t=>{for(const n in t){const r=t[n];null==r?delete e[n]:e[n]=r}})(e):n=>{e[t]=n})(e,t.slice(1));case\"@\":return c(e,\"on\"+t.slice(1));case\"o\":if(\"n\"===t[1])return c(e,t)}switch(t){case\"ref\":return(e=>{let t;return n=>{t!==n&&(t=n,\"function\"==typeof n?n(e):n.current=e)}})(e);case\"aria\":return(e=>t=>{for(const n in t){const r=\"role\"===n?n:`aria-${n}`,s=t[n];null==s?e.removeAttribute(r):e.setAttribute(r,s)}})(e)}return((e,t)=>{let n,r=!0;const s=document.createAttributeNS(null,t);return t=>{const l=i(t);n!==l&&(null==(n=l)?r||(e.removeAttributeNode(s),r=!0):(s.value=l,r&&(e.setAttributeNodeNS(s),r=!1)))}})(e,t)};function A(e){const{type:t,path:n}=e,r=n.reduceRight(v,this);return\"node\"===t?(e=>{let t,n,r=[];const s=l=>{switch(typeof l){case\"string\":case\"number\":case\"boolean\":t!==l&&(t=l,n||(n=g(\"\")),n.data=l,r=N(e,r,[n]));break;case\"object\":case\"undefined\":if(null==l){t!=l&&(t=l,r=N(e,r,[]));break}if(u(l)){t=l,0===l.length?r=N(e,r,[]):\"object\"==typeof l[0]?r=N(e,r,l):s(String(l));break}if(t!==l)if(\"ELEMENT_NODE\"in l)t=l,r=N(e,r,11===l.nodeType?[...l.childNodes]:[l]);else{const e=l.valueOf();e!==l&&s(e)}break;case\"function\":s(l(e))}};return s})(r):\"attr\"===t?C(r,e.name):(e=>{let t;return n=>{const r=i(n);t!=r&&(t=r,e.textContent=null==r?\"\":r)}})(r)}const k=e=>{const t=[];let{parentNode:n}=e;for(;n;)t.push(p.call(n.childNodes,e)),e=n,({parentNode:n}=e);return t},$=\"is\u00B5\",E=new t,O=/^(?:textarea|script|style|title|plaintext|xmp)$/,T=(e,t)=>{const o=\"svg\"===e,a=((e,t,o)=>{let a=0;return e.join(\"\u0001\").trim().replace(r,((e,t,r,l)=>{let a=t+r.replace(s,\"\u0002=$2$1\").trimEnd();return l.length&&(a+=o||n.test(t)?\" /\":\"></\"+t),\"<\"+a+\">\"})).replace(l,(e=>\"\u0001\"===e?\"\\x3c!--\"+t+a+++\"--\\x3e\":t+a++))})(t,$,o),i=x(a,o),c=y(i,129),u=[],d=t.length-1;let p=0,f=`${$}${p}`;for(;p<d;){const e=c.nextNode();if(!e)throw`bad template: ${a}`;if(8===e.nodeType)e.data===f&&(u.push({type:\"node\",path:k(e)}),f=`${$}${++p}`);else{for(;e.hasAttribute(f);)u.push({type:\"attr\",path:k(e),name:e.getAttribute(f)}),e.removeAttribute(f),f=`${$}${++p}`;O.test(e.localName)&&e.textContent.trim()===`\\x3c!--${f}--\\x3e`&&(e.textContent=\"\",u.push({type:\"text\",path:k(e)}),f=`${$}${++p}`)}}return{content:i,nodes:u}},S=(e,t)=>{const{content:n,nodes:r}=E.get(t)||E.set(t,T(e,t)),s=b(n,!0);return{content:s,updates:r.map(A,s)}},L=(e,{type:t,template:n,values:r})=>{const s=M(e,r);let{entry:l}=e;l&&l.template===n&&l.type===t||(e.entry=l=((e,t)=>{const{content:n,updates:r}=S(e,t);return{type:e,template:t,content:n,updates:r,wire:null}})(t,n));const{content:o,updates:a,wire:i}=l;for(let e=0;e<s;e++)a[e](r[e]);return i||(l.wire=(e=>{const{firstChild:t,lastChild:n}=e;if(t===n)return n||e;const{childNodes:r}=e,s=[...r];return{ELEMENT_NODE:1,nodeType:111,firstChild:t,lastChild:n,valueOf:()=>(r.length!==s.length&&e.append(...s),e)}})(o))},M=({stack:e},t)=>{const{length:n}=t;for(let r=0;r<n;r++){const n=t[r];n instanceof j?t[r]=L(e[r]||(e[r]={stack:[],entry:null,wire:null}),n):u(n)?M(e[r]||(e[r]={stack:[],entry:null,wire:null}),n):e[r]=null}return n<e.length&&e.splice(n),n};class j{constructor(e,t,n){this.type=e,this.template=t,this.values=n}}const B=n=>{const r=new t;return Object.assign(((e,...t)=>new j(n,e,t)),{for(t,s){const l=r.get(t)||r.set(t,new e);return l.get(s)||l.set(s,(e=>(t,...r)=>L(e,{type:n,template:t,values:r}))({stack:[],entry:null,wire:null}))},node:(e,...t)=>L({stack:[],entry:null,wire:null},new j(n,e,t)).valueOf()})},D=new t,_=(e,t)=>{const n=\"function\"==typeof t?t():t,r=D.get(e)||D.set(e,{stack:[],entry:null,wire:null}),s=n instanceof j?L(r,n):n;return s!==r.wire&&(r.wire=s,e.replaceChildren(s.valueOf())),e},z=B(\"html\"),H=B(\"svg\");export{j as Hole,z as html,_ as render,H as svg};\n", "/**\n## /utils/compose\n\nThe compose module exports a utility method allowing to compose functions.\n\nFunction composition allows to expand function logic by inheriting the product of an existing function in a composition.\n\nA function can be composed into itself by binding the original method.\n\nEach function in the composition must accept and return 1 argument which is passed left to right through the composition.\n\nFor example the [mapp.layer.decorate(layer)]{@link module:/layer/decorate~decorate} method accepts a JSON layer and returns a promise which resolves into a decorated layer object. We can compose this method with a second method which awaits layer decorator and logs the decorated layer to the console.\n\n```js\nasync function logLayer(layer) {\n  await layer\n  console.log(layer)\n}\n\nmapp.layer.decorate = mapp.utils.compose(\n  mapp.layer.decorate.bind(),\n  logLayer)\n```\n\n@module /utils/compose\n*/\n\n/**\n@function compose\n\n@description\nThe compose method reduces an array of n Function arguments which are spread into the fns array.\n\nAn arrow method which provides the argument provided to the first method in the function composition is provided as initial value to the Array.reduce of functions. Each function is executed in the order of the fns array. The return of any function in the composition is provided as argument to the next function [fn].\n\n@returns {*} The single argument passed through all functions in composition.\n*/\nexport default function compose(...fns) {\n  // reduce the spread functions to execute in succession.\n  return (arg) =>\n    fns.reduce((acc, fn) => {\n      // Execute function with reduce accumulator as only argument.\n      return fn(acc);\n\n      // Provide argument as initial value to the reduce function\n    }, arg);\n}\n", "/**\n## mapp.utils.convert()\n\n@module /utils/convert\n*/\n\nlet promise, convert;\n\nasync function moduleImport() {\n  if (!promise)\n    promise = new Promise((resolve) => {\n      import('https://cdn.skypack.dev/convert@4').then((mod) => {\n        convert = mod.convert;\n        resolve();\n      });\n    });\n\n  await promise;\n}\n\nexport default async (value, params) => {\n  await moduleImport();\n\n  value = parseFloat(value);\n\n  if (params.units && params.convertTo) {\n    value = convert(value, params.units).to(params.convertTo);\n  }\n\n  value = value.toFixed(params.decimals || 0);\n\n  value = value.toLocaleString(params.locale || 'en-GB');\n\n  return `${params.prefix || ''}${value}${params.suffix || ''}`;\n};\n", "/**\n## /utils/copyToClipboard\n\nThe utils module expose the clipboard api.\n\n@module /utils/copyToClipboard\n*/\n\n/**\n@function copyToClipboard\n@description\nThe method writes the string param to the clipboard.\n\n@param {string} text_to_copy string which will be written to clipboard.\n*/\nexport default function copyToClipboard(text_to_copy) {\n  navigator.clipboard.writeText(text_to_copy);\n}\n", "/**\n## /utils/csvDownload\n\nThe csvDownload module exports a default method to turn an array into a comma separated text file.\n\n@module /utils/csvDownload\n*/\n\n/**\n@function csvDownload\n\n@description\nThe function turns an array of records into a text blob. The blob is transfomed to an ObjectURL which can be referenced in an anchor [link] tag. The hidden tag element is appended to the document.body and programmatically clicked to download the ObjectURL as a text file.\n\n@param {array} data An array of records for the csv text file.\n@param {Object} [params] The parameters object.\n@property {String} [params.separator=','] The seperator used in the csv text file.\n@property {String} [params.type='text/csv;charset=utf-8;'] The type for the csv text file includes the charset required for character support.\n@property {String} [params.join='\\r\\n'] The characters used to join the row strings. The default being [carriage] return \\r and [new] line feed \\n.\n@property {String} [params.file='file'] The file name for the download generated from clicking the ObjectURL link.\n@property {Boolean} [params.header] Whether a header should be added to the CSV file.\n@property {Array} [params.fields] An array of field objects for the fieldsFunction and header row.\n*/\nexport default function csvDownload(data, params = {}) {\n  if (!Array.isArray(data)) {\n    console.warn('Array argument for csvDownload must be an array');\n    return;\n  }\n\n  // Set comma as default separator.\n  params.separator ??= ',';\n\n  const rows = data.map((record) => {\n    const row = Array.isArray(params.fields)\n      ? fieldsFunction(record, params.fields)\n      : Object.values(record);\n\n    return row.join(params.separator);\n  });\n\n  // Set default type for the blob.\n  params.type ??= 'text/csv;charset=utf-8;';\n\n  params.join ??= '\\r\\n';\n\n  params.title ??= 'file';\n\n  if (params.header && Array.isArray(params.fields)) {\n    // Unshift the header row with either the title or field names.\n    rows.unshift(params.fields.map((field) => field.title || field.field));\n  }\n\n  const blob = new Blob([rows.join(params.join)], { type: params.type });\n\n  const link = document.createElement('a');\n\n  link.download = `${params.title}.csv`;\n  link.href = URL.createObjectURL(blob);\n  link.dataset.downloadurl = ['csv', link.download, link.href].join(':');\n  link.style.display = 'none';\n  document.body.append(link);\n  link.click();\n  URL.revokeObjectURL(link.href);\n}\n\n/**\n@function fieldsFunction\n\n@description\nThe fieldsFunction method receives a record obect and the fields array param. The method iterated through the fields array and formats the record [field] property according the fields params object.\n\n@param {Object} record A record object represents the data for a CSV row.\n@param {Array} fields An array of field params objects.\n\n@returns {Array} Returns an array of field string values to be merged joined as a CSV row.\n*/\nfunction fieldsFunction(record, fields) {\n  return fields.map((field) => {\n    if (!field.field) return;\n\n    // Escape quotes in string value.\n    if (typeof record[field.field] === 'string' && field.string) {\n      return `\"${record[field.field].replaceAll('\"', '\"\"')}\"`;\n    }\n\n    // Format number toLocaleString\n    if (field.formatter === 'toLocaleString') {\n      const val = parseFloat(record[field.field]);\n\n      if (isNaN(val)) return;\n\n      return `\"${val.toLocaleString(field.locale || navigator.language, field.options)}\"`;\n    }\n\n    return record[field.field];\n  });\n}\n", "/**\n## /utils/csvUpload\n\nThis module exports the default csvUpload method for mapp utils module.\n\nThis utility supplies a way to insert data into a table from a csv file.\n\nThe function takes a File object and reads the contents.\n\nThe data is sanatised (see `splitRowIntoFields`) and then passed to the supplied `query` param.\n\n```json\n{\n  query: \"sql_table_insert\"\n  queryparams: {\n      table: \"scratch\"\n  }\n  layer: {}\n  fields: {\n    \"numeric_field\": \"numeric\",\n    \"char_field\": \"text\"\n  }\n}\n\n - layer: the layer on which the csv upload is being done.\n - queryparams.table: the table being inserted on.\n - fields: this describes the fields being inserted, the name of the field is used as the key and the type is the value of the key\n\nThe function transforms the read data into an object as below:\n```json\n  {\n    \"numeric_field::numeric\":[\n      1,2,3\n    ],\n    \"char_field::text\":[\n      'a','b','c'\n    ]\n  }\n\n```\n\nThis data is passed to the relevant insert query (defaults to `sql_table_insert`).\n\nAdditionally files exceeding the lambda upload limit (6mb) will be chunked into parts and inserted separately.\n\n@module /utils/csvUpload\n*/\n\n/**\n@typedef {Object} schemaMethods\nschemaMethods are used to convert the field values to the correct type for the database.\nThe methods are used in the chunkRows method to convert the field values to the correct type for the database.\n\n@property {function} int Parse value as integer.\n@property {function} numeric Parse value as float.\n@property {function} text Replace quotes in string values.\n@property {function} varchar Replace quotes in string values.\n*/\nconst schemaMethods = {\n  int: (val) => parseInt(val.replace(/[^\\d.-]/g, '')) || null,\n  numeric: (val) => parseFloat(val.replace(/[^\\d.-]/g, '')) || null,\n  text: (val) => `${val.replace(/'/g, \"''\")}`,\n  varchar: (val) => `${val.replace(/'/g, \"''\")}`,\n};\n\n/**\n@function csvUpload\n@async\n\n@description\nThis function uploads a CSV file to a database store.\n\n@param {File} file The CSV file to upload.\n@param {Object} params The parameters object.\n@property {String} params.query The query to upload the data.\n@property {Object} params.fields The definition of the columns being inserted e.g. {field: field_type}.\n@property {String} params.layer The layer on which the csv upload is being done. This is only required if using the sql_table_insert query.\n@property {String} params.queryparams.table The table being inserted into. Only required if using the sql_table_insert query.\n@property {Boolean} [params.async] If set to true, the data is uploaded asynchronously. Default is false.\n@property {Boolean} [params.header] If set to true, the first row is treated as a header row and not uploaded.\n\n@returns {Promise<Object|Error>} The outcome object and any messages returned by the database.\n*/\nexport default async function csvUpload(file, params = {}) {\n  if (!params.query) {\n    return new Error(`A query must be supplied for the csv upload.`);\n  }\n\n  if (!params.fields) {\n    return new Error(\n      `Fields are required to define the columns being inserted. Please supply a fields object in the format \"fields\": {\"field_name\": \"field_type\"}\".`,\n    );\n  }\n\n  if (params.query === 'sql_table_insert') {\n    if (!params.queryparams.layer) {\n      return new Error(`A layer must be supplied for the insert query.`);\n    }\n\n    if (!params.queryparams.table) {\n      return new Error(\n        `A table must be supplied for the insert query. Please supply a table in the queryparams object.`,\n      );\n    }\n  }\n\n  return new Promise((resolve) => {\n    const reader = new FileReader();\n\n    reader.readAsText(file);\n\n    reader.onload = async (e) => {\n      // Split text file into rows on carriage return / new line.\n      const rows = e.target.result.trim().split(/\\r?\\n/);\n\n      // Check the number of columns in the csv across all rows and return the highest count.\n      const columnCounts = rows.map((row) => splitRowIntoFields(row).length);\n      const columnCount = Math.max(...columnCounts);\n\n      if (columnCount !== Object.keys(params.fields).length) {\n        // Return an error if the number of columns in the CSV file does not match the number of fields supplied.\n        resolve([\n          new Error(\n            `The number of columns in the CSV file (${columnCount}) does not match the number of fields supplied (${\n              Object.keys(params.fields).length\n            }). Please check your CSV file and try again.`,\n          ),\n        ]);\n        return;\n      }\n\n      // The file has a header row.\n      if (params.header) rows.shift();\n\n      const chunks = chunkRows(rows, params);\n\n      let responses = [];\n\n      // If async = true, then we need to wait for all promises to resolve before returning the outcome object.\n      if (params.async) {\n        responses = await Promise.all(\n          chunks.map((chunk) => postRequestData(chunk, params)),\n        );\n      }\n\n      // If async = false, run them synchhronously.\n      else {\n        for (const chunk of chunks) {\n          const response = await postRequestData(chunk, params);\n          responses.push(response);\n        }\n      }\n\n      resolve(responses);\n    };\n  });\n}\n\n/**\n@function chunkRows\n@description\nThe method iterates over each row in the rows param. And returns an array of chunks according to max payload size for the POST request.\n\n@param {array} rows An array of rows extracted from the CSV file.\n@param {object} params Parameter for chunking the rows array.\n@property {Object} params.fields The definition of the columns being inserted e.g. {field: field_type}.\n@property {Number} [params.chunkSize] The chunk size in bytes to upload the data in. Defaults to 4MB.\n@property {Array} [params.schema] The schema array of column types.\n@returns {Array} An array of field arrays chunked to size.\n*/\nfunction chunkRows(rows, params) {\n  const chunks = [];\n\n  // Set default chunksize in bytes.\n  params.chunkSize ??= 4000000;\n  let chunkSize = 0;\n  let chunk = {};\n\n  rows.forEach((row) => {\n    // Split row into fields array.\n    const fields = splitRowIntoFields(row);\n\n    for (const indx in fields) {\n      const field = Object.keys(params.fields)[indx];\n      const type = params.fields[field];\n\n      //assign field definition to its type with a `::` separator e.g. field::field_type\n      chunk[`${field}::${type}`] ??= [];\n      chunk[`${field}::${type}`].push(schemaMethods[type](fields[indx]));\n\n      // Determine blob size in bytes for the chunk.\n      const rowSize = new Blob([chunk]).size;\n\n      // Check whether the chunk would exceed lambda payload limit.\n      if (chunkSize + rowSize >= params.chunkSize) {\n        chunks.push(structuredClone(chunk));\n\n        // Create a new current chunk.\n        chunk = {};\n        chunkSize = 0;\n      }\n\n      // Add row to current chunk and sum size.\n      chunkSize += rowSize;\n    }\n  });\n\n  // Push the last chunk if it exists.\n  if (Object.keys(chunk).length) chunks.push(chunk);\n\n  return chunks;\n}\n\n/**\n@function splitRowIntoFields\n@description\nThe method splits a CSV row string into fields.\n\n@param {String} row The row to split.\n@returns {Array} The fields array.\n*/\nfunction splitRowIntoFields(row) {\n  // Create an array to store the fields.\n  const fields = [];\n\n  // Create a variable to store the current field.\n  let currentField = '';\n\n  let insideQuotes = false;\n\n  // Loop through each character in the row.\n  for (const character of row) {\n    // This if statement checks if the character is a double quote.\n    if (character === '\"') {\n      // If the character is a double quote, we toggle the insideQuotes variable, which will be used to determine if we are inside a quote.\n      insideQuotes = !insideQuotes;\n    }\n    // If the character is a comma and we are not inside quotes, we push the current field to the fields array.\n    else if (character === ',' && !insideQuotes) {\n      // Push current field to fields array\n      fields.push(currentField.trim());\n\n      // Reset for the next field\n      currentField = '';\n    } else {\n      // Add character to current field\n      currentField += character;\n    }\n  }\n\n  // Push the last field (if any) after the loop to the fields array.\n  if (currentField) {\n    fields.push(currentField.trim());\n  }\n\n  return fields;\n}\n\n/**\n@function postRequestData\n@description\nThe method returns a parameterised query object from the XHR utility method.\n\n@param {Array} data Data for the post request body.\n@param {Object} params Parameters for the post query.\n@returns {Promise<Object|Error>} Returns promise from XHR query utility.\n*/\nfunction postRequestData(data, params) {\n  params.queryparams ??= {};\n\n  const queryParams = mapp.utils.queryParams(params);\n\n  const paramString = mapp.utils.paramString(queryParams);\n\n  const url = `${mapp.host}/api/query?${paramString}`;\n\n  return mapp.utils.xhr({\n    body: JSON.stringify(data),\n    method: 'POST',\n    url,\n  });\n}\n", "/**\n## mapp.utils.dataURLtoBlob()\n\n@module /utils/dataURLtoBlob\n*/\n\nexport function dataURLtoBlob(dataURL) {\n  if (dataURL.indexOf(';base64,') == -1) {\n    const parts = dataURL.split(','),\n      contentType = parts[0].split(':')[1],\n      raw = parts[1];\n\n    return new Blob([raw], { type: contentType });\n  }\n\n  const parts = dataURL.split(';base64,'),\n    contentType = parts[0].split(':')[1],\n    raw = window.atob(parts[1]),\n    uInt8Array = new Uint8Array(raw.length);\n\n  for (let i = 0; i < raw.length; ++i) {\n    uInt8Array[i] = raw.charCodeAt(i);\n  }\n\n  return new Blob([uInt8Array], { type: contentType });\n}\n", "/**\n## mapp.utils.gazetteer{}\n\nThe gazetteer is used to search for locations via a provider or by searching for matching terms in a database.\n\nA provider can be supplied to search e.g. Google\n```\n{\n  \"provider\": \"GOOGLE\",\n  \"maxZoom\": 10,\n  \"streetview\": {\n    \"key\": \"xxxxxxxxxxxxxxxxxxxx\"\n  },\n  \"options\": {\n    \"componentRestrictions\": {\n      \"country\": \"country code\"\n    }\n  }\n}\n```\n\nThis search will use google services and not interact with the database, if `datasets` are provided the search\nwill also look through the database:\n```\n\"datasets\": [\n  {\n    \"qterm\": \"postcode\",\n    \"title\": \"Postcode\",\n    \"layer\": \"retailpoints\"\n  }\n]\n```\n\nTo search only the database only a smaller config can be provided:\n```\n\"gazetteer\": {\n  \"layer\": \"scratch\",\n  \"qterm\": \"store_name\",\n  \"table\": \"scratch\"\n},\n```\n\nDictionary entries:\n- no_results\n- invalid_lat_lon\n@requires /dictionary\n\n@module /utils/gazetteer\n*/\n\n/**\n@function datasets\n\n@description\nCalls the search function in cases where the gazetteer was not provided with datasets.\n\n@param {string} term The search term from the input\n@param {Object} gazetteer gazetteer configuration object.\n@property {String} [gazetteer.provider] Provider for the search e.g. Google.\n@property {String} [gazetteer.qterm] A database field to search for the term.\n*/\nexport function datasets(term, gazetteer) {\n  if (!gazetteer.provider) {\n    gazetteer.qterm && search(term, gazetteer);\n  }\n\n  // Search additional datasets.\n  gazetteer.datasets?.forEach((dataset) => {\n    Object.assign(dataset, {\n      // Merge the gazetteer and dataset objects\n      // Ensuring that the dataset takes precedence over the gazetteer\n      ...gazetteer,\n      ...dataset,\n    });\n\n    search(term, dataset);\n  });\n}\n\n/**\n@function search\n\n@description\nPerforms the search using the provided dataset and term.\n\nProvides a custom onLoad function for xhr utils which adds the found rows to the result set shown in the view.\n\n@param {string} term The search term from the input\n@param {Object} dataset The parameters for the search.\n*/\nfunction search(term, dataset) {\n  const layer = dataset.mapview.layers[dataset.layer];\n\n  // Skip if layer defined in datasets is not added to the mapview\n  if (!layer) {\n    console.warn('No layer definition for gazetteer search.');\n    return;\n  }\n\n  // Skip if layer table is not defined and no table is defined in dataset or gazetteer.\n  if (!layer.table && !dataset.table) {\n    console.warn('No table definition for gazetteer search.');\n    return;\n  }\n\n  const paramString = mapp.utils.paramString({\n    filter: layer.filter?.current,\n    label: dataset.label || dataset.qterm,\n    layer: layer.key,\n    limit: dataset.limit || 10,\n    locale: dataset.mapview.locale.key,\n    qID: layer.qID,\n    qterm: dataset.qterm,\n    table: dataset.table || layer.table,\n    template: dataset.query || 'gaz_query',\n    term: `${dataset.leading_wildcard ? '*' : ''}${term}*`,\n    wildcard: '*',\n  });\n\n  dataset.cache = true;\n  dataset.debounce = layer.key;\n  dataset.url = `${dataset.mapview.host}/api/query?${paramString}`;\n\n  mapp.utils\n    .xhr(dataset)\n    .then((response) => {\n      // The gazetteer input may have been cleared prior to the onload event.\n      if (!dataset.input.value.length) return;\n\n      // No results\n      if (!response) {\n        if (dataset.no_result === null) return;\n        dataset.list.append(mapp.utils.html.node`\n        <li>\n          <span class=\"label\">${dataset.title || layer.name}</span>\n          <span>${dataset.no_result || mapp.dictionary.no_results}</span>`);\n        return;\n      }\n\n      // Ensure that response is a flat array.\n      [response].flat().forEach((row) => addRow(dataset, layer, row));\n    })\n    .catch((err) => {\n      // Do not log debounce message.\n      if (err instanceof Error) console.error(err);\n    });\n}\n\n/**\n@function addRow\n\n@description\nAdds any search results to a list to be displayed in the view.\n\nUses {@link module:/location/get} to add a location to search results so they can be\nshown on click.\n\n@param {Object} dataset The configuraion object from which the search is being conducted.\n@param {Object} layer The layer on which the result is found.\n@param {Object} row the returned data.\n*/\nfunction addRow(dataset, layer, row) {\n  const listRow = mapp.utils.html.node`<li\n    onclick=${(e) => {\n      if (dataset.callback) return dataset.callback(row, dataset);\n\n      mapp.location\n        .get({\n          id: row.id,\n          layer,\n        })\n        .then((loc) => loc?.flyTo?.(dataset.maxZoom));\n    }}>\n    <span class=\"label\">${dataset.title || layer.name}</span>\n    <span>${row.label}</span>`;\n\n  dataset.list.append(listRow);\n}\n\n/**\n@function getLocation\n\n@description\nTurns latitude and longitude parameters into a location.\n\nWill display a warning if the returned location is outside the extent.\n\n@param {Object} location The configuraion object from which the search is being conducted.\n@property {Number} location.lng The longitude of the location.\n@property {Number} location.lat The latitude of the location.\n@property {Function} location.flyTo {@link module:/location/flyTo} is used to go to a location.\n@param {Object} gazetteer The layer on which the result is found.\n\n*/\nexport function getLocation(location, gazetteer) {\n  if (typeof gazetteer.callback === 'function') {\n    gazetteer.callback(location);\n    return;\n  }\n\n  const coord = ol.proj.transform(\n    [location.lng, location.lat],\n    `EPSG:4326`,\n    `EPSG:${gazetteer.mapview.srid}`,\n  );\n\n  if (!ol.extent.containsCoordinate(gazetteer.mapview.extent, coord)) {\n    mapp.ui.elements.alert({ text: mapp.dictionary.invalid_lat_lon });\n    return;\n  }\n\n  Object.assign(location, {\n    hook: location.label,\n    Layers: [],\n    Extents: {},\n    layer: {\n      mapview: gazetteer.mapview,\n    },\n  });\n\n  const infoj = [\n    {\n      inline: true,\n      title: location.label,\n      value: location.source,\n    },\n    {\n      class: 'display-none',\n      location,\n      srid: '4326',\n      type: 'pin',\n      value: [location.lng, location.lat],\n      buffer: gazetteer.buffer,\n    },\n  ];\n\n  mapp.location.decorate(Object.assign(location, { infoj }));\n\n  gazetteer.mapview.locations[location.hook] = location;\n\n  location.flyTo(gazetteer.maxZoom);\n}\n", "/**\n## mapp.utils.getCurrentPosition()\n\n@module /utils/getCurrentPosition\n*/\n\nexport default function (\n  callback,\n  options = {\n    //enableHighAccuracy: false,\n    //timeout: 3000,\n    //maximumAge: 0\n  },\n) {\n  navigator.geolocation.getCurrentPosition(\n    callback,\n    (err) => console.error(err),\n    options,\n  );\n}\n", "/**\n## mapp.utils.hexa()\n\n@module /utils/hexa\n*/\n\nexport default (hex, transparency) => {\n  if (isNaN(transparency)) return hex;\n\n  if (hex.length === 7)\n    return (\n      hex +\n      ((transparency && parseInt(transparency * 255).toString(16)) || '00')\n    );\n\n  if (hex.length === 4) return hex + parseInt(transparency * 15).toString(16);\n\n  return hex;\n};\n", "/**\n### /utils/jsonParser\n\nThe jsonParser utility is used to parse a locale to be stored as a userLocale.\n\n@module /utils/jsonParser\n*/\n\nexport default jsonParser;\n\nlet sourceObjArray, targetObjArray;\n\n/**\n@function jsonParser\n\n@description\nThe jsonParser returns an object which can be stored in an object store.\n\nThe jsonParser method resets the arrays to hold parsed objects and removes the parser flags from all object in these arrays before returning the jsonObject with parsed properties from the obj param.\n\n@param {Object} obj A decorated object.\n@returns {Object} Returns a JSON object which can be stored in an object store.\n*/\nfunction jsonParser(obj) {\n  if (typeof obj !== 'object') return;\n\n  const jsonObject = {};\n\n  sourceObjArray = [];\n  targetObjArray = [];\n\n  propertyParser(jsonObject, obj);\n\n  // Remove parser flags.\n  sourceObjArray.forEach((obj) => delete obj.__parsed);\n  targetObjArray.forEach((obj) => delete obj.__parsed);\n\n  return jsonObject;\n}\n\n/**\n@function propertyParser\n\n@description\nThe propertyParser parses a source object and assigns properties which can be stored in an object store to the target object.\n\n@param {Object} target\n@param {Object} source\n*/\nfunction propertyParser(target, source) {\n  if (!isObject(source)) return source;\n\n  // The source object must only be parsed once.\n  source.__parsed = true;\n\n  sourceObjArray.push(source);\n\n  targetObjArray.push(target);\n\n  // Iterate through the source own enumerable string-keyed property key-value pairs.\n  for (const [key, value] of Object.entries(source)) {\n    // The ignoreKeys contain checks against prototype pollution.\n    if (new Set(['__proto__', 'constructor', 'mapview']).has(key)) {\n      continue;\n    }\n\n    if (excludeProperty(value)) continue;\n\n    if (assignValue(target, key, value)) continue;\n\n    if (Array.isArray(value)) {\n      target[key] = value.map((entry) =>\n        isObject(entry) ? propertyParser({}, entry) : entry,\n      );\n      continue;\n    }\n\n    if (value.hasOwnProperty('__parsed')) {\n      if (value.key) {\n        target[key] = value.key;\n      }\n      continue;\n    }\n\n    // Value must be an object at this point.\n    target[key] ??= {};\n\n    // Call recursive merge for target key object.\n    propertyParser(target[key], value);\n  }\n\n  return target;\n}\n\n/**\n@function excludeProperty\n@description\nThe excludeProperty method returns true if a property should be exluded from the target in the propertyParser iteration.\n\n@param {*} value\n@returns {Boolean} True if the property should be excluded in regards to the property value.\n*/\nfunction excludeProperty(value) {\n  if (value instanceof Object) {\n    const constructor = Object.getPrototypeOf(value).constructor;\n\n    if (!(constructor === Object || constructor === Array)) {\n      // Constructor may be from a class, function, html element\n      return true;\n    }\n  }\n\n  if (Array.isArray(value)) {\n    const firstItem = value[0];\n\n    if (firstItem instanceof Object) {\n      const constructor = Object.getPrototypeOf(firstItem).constructor;\n\n      if (!(constructor === Object || constructor === Array)) {\n        // Constructor may be from a class, function, html element\n        return true;\n      }\n\n      if (firstItem.__parsed) {\n        return true;\n      }\n    }\n  }\n}\n\n/**\n@function assignValue\n@description\nReturns true if a true, false, null, string, or num value can be assigned to the target object.\n\nReturns true if undefined value is skipped.\n\n@param {Object} target\n@param {string} key\n@param {*} value\n@returns {Boolean} True if the value has been assigned.\n*/\nfunction assignValue(target, key, value) {\n  // Prevent prototype polluting assignment.\n  if (key === '__proto__' || key === 'constructor') return true;\n\n  if (value === undefined) {\n    return true;\n  }\n\n  if (value === true) {\n    target[key] = true;\n    return true;\n  }\n\n  if (value === false) {\n    target[key] = false;\n    return true;\n  }\n\n  if (value === null) {\n    target[key] = null;\n    return true;\n  }\n\n  if (typeof value !== 'object') {\n    target[key] = value;\n    return true;\n  }\n}\n\n/**\n@function isObject\nChecks whether the item argument is an object but not true, false, null, or an array.\n\n@param {*} item\n@returns {Boolean} True if the item is an object but not true, false, null, or an array.\n*/\nfunction isObject(item) {\n  if (item === true) return false;\n\n  if (item === false) return false;\n\n  if (item === null) return false;\n\n  if (Array.isArray(item)) return false;\n\n  if (typeof item === 'object') return true;\n}\n", "/**\n### /utils/keyvalue_dictionary\n\nThe keyvalue_dictionary utility method will parse a JSON object for properties with key/value pairs matching entries a provided dictionary.\n\nThe property value will be replaced with a language lookup in the dictionary or the default value.\n\n```js\n\"keyvalue_dictionary\": [\n  {\n    \"key\": \"name\",\n    \"value\": \"OSM\",\n    \"default\": \"OpenStreetMap\",\n    \"uk\": \"S\u0142awa OpenStreetMap \uD83C\uDDFA\uD83C\uDDE6\"\n  }\n]\n```\n@module /utils/keyvalue_dictionary\n*/\n\n/**\n@function keyvalue_dictionary\n\n@description\nReplaces key-value pairs in an object with dictionary entries.\n\n@param {Object} obj The object to be mapped to keyvalue_dictionary.\n*/\nexport function keyvalue_dictionary(obj) {\n  if (!obj.keyvalue_dictionary) return;\n\n  // Create a Map from dictionary object.\n  const keyvalue_dictionaryMap = new Map();\n\n  obj.keyvalue_dictionary.forEach((entry) => {\n    const compositeKey = `${entry.key}:${entry.value}`;\n    keyvalue_dictionaryMap.set(compositeKey, entry);\n  });\n\n  parseObject(obj, keyvalue_dictionaryMap);\n}\n\n/**\n@function parseObject\n\n@description\nParses an object and replaces its string values with dictionary entries.\n\n@param {Object} obj The object to parse.\n@param {Array} dictionary An array of dictionary entries.\n*/\nfunction parseObject(obj, dictionary) {\n  for (const [key, value] of Object.entries(obj)) {\n    if (key === 'mapview') continue;\n    if (isArrayObject(value, dictionary)) continue;\n    if (typeof value === 'string') replaceKeyValue(obj, key, value, dictionary);\n  }\n}\n\n/**\n@function isArrayObject\n\n@description\nChecks if an item is an array or an object and recursively applies the parsing logic.\n\n@param {*} item The item to check.\n@param {Array} dictionary An array of dictionary entries.\n@returns {boolean} Returns true if the item is an array or an object, false otherwise.\n */\nfunction isArrayObject(item, dictionary) {\n  if (Array.isArray(item)) {\n    item.forEach((val) => isArrayObject(val, dictionary));\n    return true;\n  }\n  if (item instanceof Object) {\n    parseObject(item, dictionary);\n    return true;\n  }\n}\n\n/**\n@function replaceKeyValue\n\n@description\nReplaces a key-value pair in an object with a dictionary entry.\n\n@param {Object} obj The object containing the key-value pair.\n@param {string} key The key of the value to replace.\n@param {string} value The value to replace.\n@param {Array} dictionary An array of dictionary entries.\n*/\nfunction replaceKeyValue(obj, key, value, dictionary) {\n  const compositeKey = `${key}:${value}`;\n\n  if (!dictionary.has(compositeKey)) return;\n\n  const entry = dictionary.get(compositeKey);\n\n  obj[key] =\n    entry[mapp?.user?.language || mapp.language] || entry.default || value;\n}\n", "/**\n## /utils/loadDictionary\n\nThe loadDictionary module exports a default method to load a language dictionary.\n\n@module /utils/loadDictionary\n*/\n\n/**\n@function loadDictionary\n\n@description\nThe method will fetch a json language dictionary from the public directory and merge the language object into the mapp.dictionaries.\n\n@param {string} languageCode The language code for the dictionary to be loaded.\n*/\nexport default async function loadDictionary(languageCode) {\n  try {\n    // Dynamically import the JSON language file\n    const response = await fetch(\n      `${mapp.host}/public/dictionaries/${languageCode}.json`,\n    );\n\n    const languageData = await response.json();\n\n    // Merge the imported data into mapp.dictionaries\n    mapp.dictionaries[languageCode] = {\n      ...mapp.dictionaries[languageCode],\n      ...languageData,\n    };\n  } catch (error) {\n    console.error(`Failed to fetch language \"${languageCode}\":`, error);\n  }\n}\n", "/**\nExports the default loadPlugins utility method as mapp.utils.loadPlugins().\n\n@module /utils/loadPlugins\n*/\n\n/**\n@function loadPlugins\n\n@description\nThe loadPlugins utility method receives an array argument of src string locations.\n\nThe method creates an array of promises to load each plugin from the provided source.\n\nAll import promises must be resolved for the loadPlugins method to resolve.\n\nThe endsWith argument can be used to provide an array of string conditions on which the plugin src string must end to be loaded.\n\n@param {Array} plugins Array of plugin src location strings.\n@param  {Array} endsWith Array of strings to limit which plugins should be loaded. Defaults to ['.js','.mjs']\n\n@returns {Promise} The promise returned from the method will resolve once all [plugin] import promises are settled.\n*/\n\nexport default function loadPlugins(plugins, endsWith = ['.js', '.mjs']) {\n  if (!Array.isArray(plugins)) return;\n\n  return new Promise((resolveAll) => {\n    const promises = plugins\n      .filter((plugin) => endsWith.some((_this) => plugin.endsWith(_this)))\n      .map((plugin) => {\n        if (!plugin.startsWith('http')) {\n          plugin = `${new URL(document.URL).origin}${plugin}`\n        }\n        return loadPlugin(plugin)\n      });\n\n    Promise.allSettled(promises)\n      .then(() => {\n        resolveAll();\n      })\n      .catch((err) => {\n        console.error(err);\n        resolveAll();\n      });\n  });\n}\n\nfunction loadPlugin(plugin) {\n  return new Promise((resolve, reject) =>\n    import(plugin)\n      .then((mod) => {\n        resolve(mod);\n      })\n      .catch((err) => {\n        console.warn(`Failed to load plugin: ${plugin}`);\n        console.error(err);\n        reject(err);\n      }),\n  );\n}\n", "/**\n## /utils/merge\n\nExport the default mergeDeep method to mapp.utils{}.\n\n@module /utils/merge\n*/\n\n/**\n@function mergeDeep\n\n@description\nThe mergeDeep utility method will set the source object's own enumerable string-keyed property values on a target object.\n\nmergeDeep will call itself recursively allowing to merge nested objects.\n\nAn empty target object can be provided to effectively clone a source object.\n\nInstances of HTMLElement objects will be ignored by the merge method.\n\nArrays will not be merged. The source array will overwrite a target array.\n\n@param {Object} target \n@param  {Spread} sources The sources param is spread into an array.\n*/\nexport default function mergeDeep(target, ...sources) {\n  // No sources to merge.\n  if (!sources.length) {\n    return target;\n  }\n\n  // Shift first source out of sources array.\n  const source = sources.shift();\n\n  // target & source are both objects.\n  if (!isObject(target) || !isObject(source)) {\n    return mergeDeep(target, ...sources);\n  }\n\n  // Iterate over object keys in source.\n  for (const key in source) {\n    if (Object.getPrototypeOf(source) !== Object.getPrototypeOf({})) continue;\n\n    if (key === '__proto__' || key === 'constructor') continue;\n\n    if (source[key] instanceof HTMLElement) {\n      console.warn(source[key]);\n\n      // source[key] is object with potential nesting.\n    } else if (isObject(source[key])) {\n      // Target key must be an object.\n      target[key] ??= {};\n\n      // Call recursive merge for target key object.\n      mergeDeep(target[key], source[key]);\n    } else {\n      // source[key] could be null, true, false, or Array object\n      target[key] = source[key];\n    }\n  }\n\n  return mergeDeep(target, ...sources);\n}\n\n/**\n@function isObject\n\n@description\nThe method checks whether item param is an object, excluding true, false, null, Array objects.\n\n@param {Any} item \n\n@return {Boolean} Return boolean whether item param is an object.\n*/\nfunction isObject(item) {\n  if (item === true) return false;\n\n  if (item === false) return false;\n\n  if (item === null) return false;\n\n  if (Array.isArray(item)) return false;\n\n  if (typeof item === 'object') return true;\n}\n", "/**\n## /utils/mobile\n\nExport the mobile utility method.\n\n@module /utils/mobile\n*/\n\n/**\n@function mobile\n\n@description\nThe mobile utility method can be used to set the widthInPx module variable or check whether the window.innerWidth is less or equal the widthInPx variable.\n\n@param {integer} setWidthInPx Set widthInPx\n\n@returns {Boolean} Returns true if window.innerWidth is less than widthInPx\n*/\n\nlet widthInPx = 0;\n\nexport default function mobile(setWidthInPx) {\n  if (!setWidthInPx) return window.innerWidth <= widthInPx;\n\n  widthInPx = setWidthInPx;\n}\n", "/**\n@module /utils/numericFormatter\n*/\n\n/**\n@function formatNumericValue\n\n@description\nThe formatNumericValue method will attempt to format params.newValue or params.value as localeString by passing the formatterParams to the localeString() method.\n\n0 must be 0.\n\nNULL is a number and must be parsed as float to be not a number [!isNaN].\n\nThe prefix and suffix are concatenated with the localString as params.stringValue.\n\nUnless the formatterParams are NULL the mapp.language property will be assigned as locale for the localeString.\n\nThe maximumFractionDigits will be set to 0 for integer type params.\n\nThe maximumFractionDigits can be configured as params.round property.\n\n@param {Object} params The config object argument.\n@property {String} params.suffix Suffix appended to stringValue.\n@property {String} params.prefix Prefix prepended to stringValue.\n@property {Object} params.formatterParams Configuration for the localeString creation.\n@property {String} [params.type] \"integer\" type params must be formatted with maximumFractionDigits=0.\n@property {Integer} [params.round] The round value will be assigned as maximumFractionDigits for the localeString options argument.\n\n@returns {string} The concatenated stringValue.\n*/\nexport function formatNumericValue(params) {\n  // suffix and prefix should be empty string if undefined.\n  params.prefix ??= '';\n  params.suffix ??= '';\n\n  // numericValue must not be a number if either value is null.\n  const numericValue =\n    params.newValue !== undefined\n      ? parseFloat(params.newValue)\n      : parseFloat(params.value);\n\n  params.localeString = '';\n\n  if (params.formatterParams === undefined) {\n    // Assign default formatterParams.\n    params.formatterParams = {\n      locale: mapp.language,\n    };\n  }\n\n  if (params.formatterParams === null && !isNaN(numericValue)) {\n    // Assign numericValue as string if formatterParams are null.\n    params.localeString = numericValue.toString();\n  } else if (!isNaN(numericValue)) {\n    // Assign the browser language as locale if not provided in formatterParams, otherwise use mapp.language.\n    params.formatterParams.locale ??= navigator.language || mapp.language;\n\n    params.formatterParams.options ??= {};\n\n    // \"integer\" type values must not have fraction digits.\n    params.formatterParams.options.maximumFractionDigits ??=\n      params.round || (params.type === 'integer' ? 0 : 2);\n\n    // Format a numeric value into a localized string representation\n    params.localeString = new Intl.NumberFormat(\n      params.formatterParams.locale,\n      params.formatterParams.options,\n    ).format(numericValue);\n  }\n\n  // The trailing fraction character will be store by the unformatStringvalue method if present.\n  params.lastCharacter ||= '';\n\n  params.stringValue = `${params.prefix}${params.localeString}${params.lastCharacter}${params.suffix}`;\n\n  return params.stringValue;\n}\n\n/**\n * Unformats a string value by removing prefix, suffix, and locale-specific formatting.\n *\n * @function unformatStringValue\n * @description\n * This function removes the specified prefix and suffix from the input string,\n * then unformats the remaining value based on the provided locale settings.\n * It handles locale-specific decimal separators and removes non-numeric characters.\n * The resulting numeric value is returned as a parsed float.\n *\n * @param {Object} params - The configuration object.\n * @param {string} params.stringValue - The input string to be unformatted.\n * @param {string} [params.prefix] - Prefix to be removed from stringValue.\n * @param {string} [params.suffix] - Suffix to be removed from stringValue.\n * @param {Object} [params.formatterParams] - Configuration for locale-specific formatting.\n * @param {string} [params.formatterParams.locale] - The locale to use for unformatting (e.g., 'en-US', 'de-DE').\n *\n * @returns {number|null} The numeric value extracted from the stringValue, or null if the input is empty or invalid.\n */\nexport function unformatStringValue(params) {\n  if (!params.stringValue) return null;\n\n  let stringValue = params.stringValue;\n\n  if (params.prefix) {\n    // Remove prefix string.\n    stringValue = stringValue.replace(params.prefix, '');\n  }\n\n  if (params.suffix) {\n    // Remove suffix string.\n    stringValue = stringValue.replace(params.suffix, '');\n  }\n\n  if (stringValue.length && params.formatterParams?.locale) {\n    // Create a number formatter using the specified locale\n    const numberFormatter = new Intl.NumberFormat(\n      params.formatterParams.locale,\n    );\n\n    // Get the parts of a formatted number (1.1 is used as an example)\n    const parts = numberFormatter.formatToParts(10000.1);\n\n    // Find the decimal separator used in this locale\n    const decimalSeperator = parts.find(\n      (part) => part.type === 'decimal',\n    )?.value;\n\n    //Find the thousand seperator used in the locale\n    const thousandSeperator = parts.find(\n      (part) => part.type === 'group',\n    )?.value;\n\n    // Replace the locale-specific decimal separator with a standard period\n    let normalisedValue = stringValue.replaceAll(thousandSeperator, '');\n\n    // Replace the locale-specific decimal separator with a standard period\n    normalisedValue = normalisedValue.replace(decimalSeperator, '.');\n\n    // Remove any non-numeric characters, except for period and minus sign\n    const cleanedValue = normalisedValue.replace(/[^\\d.-]/g, '');\n\n    //Delete the lastCharacter param\n    delete params.lastCharacter;\n\n    // Preserve fraction character at end of stringValue\n    if (stringValue.endsWith(decimalSeperator)) {\n      params.lastCharacter = decimalSeperator;\n    }\n\n    // Preserve 0 fraction at end of stringValue\n    if (stringValue.endsWith(decimalSeperator + 0)) {\n      params.lastCharacter = decimalSeperator + 0;\n    }\n\n    // Parse the cleaned string into a float (decimal) number\n    stringValue = parseFloat(cleanedValue);\n\n    return stringValue;\n  }\n\n  if (stringValue === '') return null;\n\n  return parseFloat(stringValue);\n}\n", "/**\n### /utils/olStyle\n\nThe olStyle utility module exports the default olStyle method.\n\n@module /utils/olStyle\n*/\n\n/**\n@global\n@typedef {Object} feature-style\nA JSON mapp-style object.\n@property {string} [svg] The SVG source for the icon.\n@property {string} [type] The type of the icon.\n@property {Array|Object} [icon] The icon configuration or an array of icon configurations.\n@property {number} [width] The width of the icon or symbol.\n@property {number} [height] The height of the icon or symbol.\n@property {string} [strokeColor] The stroke color of the line symbol.\n@property {number} [strokeWidth] The stroke width of the line symbol.\n@property {string} [fillColor] The fill color of the polygon symbol.\n@property {number} [fillOpacity] The fill opacity of the polygon symbol.\n@property {Array} [lineDash] An Array of numbers that specify distances to alternately draw a line and a gap, eg: [5, 4].\n\n*/\n\n/**\n@function olStyle\n\n@description\nThe olStyle method takes a mapp-style JSON representation to create an Openlayers style object for rendering Openlayers features in the Openlayers mapview.Map.\n\n@param {feature-style} style A JSON mapp-style object.\n\n@returns {Object} An Openlayers feature style object.\n*/\nexport default function olStyle(style, feature) {\n  if (!style) return null;\n\n  // Array for OL Style objects.\n  const Styles = [];\n\n  // The style object must always be processed as an array.\n  style = Array.isArray(style) ? style : [style];\n\n  // Iterate through style array.\n  style.forEach((style) => {\n    // Only process icon for features if they are point geometries.\n    if (style.icon) {\n      // Iterate through icon style array.\n      if (Array.isArray(style.icon)) {\n        style.icon.forEach((icon) => iconStyle(Styles, style, icon, feature));\n      } else {\n        iconStyle(Styles, style, style.icon, feature);\n      }\n    }\n\n    if (style.fillColor || style.strokeColor) {\n      // Create OL fill.\n      const fill =\n        style.fillColor &&\n        new ol.style.Fill({\n          color: mapp.utils.hexa(style.fillColor, style.fillOpacity),\n        });\n\n      // Create OL stroke.\n      const stroke =\n        style.strokeColor &&\n        new ol.style.Stroke({\n          color: mapp.utils.hexa(style.strokeColor, style.strokeOpacity),\n          width: parseFloat(style.strokeWidth || 1),\n          lineDash: style.lineDash,\n        });\n\n      // Push OL vector Style into Styles array.\n      Styles.push(new ol.style.Style({ fill, stroke, zIndex: style.zIndex }));\n    }\n\n    // Create label style if label text is not undefined.\n    if (typeof style.label?.text !== 'undefined') {\n      const text = new ol.style.Text({\n        fill: new ol.style.Fill({\n          color: style.label.fillColor || '#000',\n        }),\n        font: style.label.font || '12px sans-serif',\n        offsetX: style.label.offsetX,\n        offsetY: style.label.offsetY,\n        overflow: style.label.overflow,\n        stroke:\n          style.label.strokeColor &&\n          new ol.style.Stroke({\n            color: style.label.strokeColor,\n            width: style.label.strokeWidth || 1,\n          }),\n        text: String(style.label.text),\n      });\n\n      // Push OL text Style into Styles array.\n      Styles.push(new ol.style.Style({ text, zIndex: style.zIndex }));\n    }\n  });\n\n  // Set Styles object to cache style.\n  feature?.set?.('Styles', Styles, true);\n\n  return Styles;\n}\n\n/**\n@function iconStyle\n\n@description\nThe iconStyle method calculates the scale for the Openlayers Style Icon.\n\nOn Openlayers Style Icon requires an URL. A `data:image` URL will be created from the svgSymbols module methods if not explicit.\n\n@param {array} Styles An array of Openlayers style objects.\n@param {feature-style} style A JSON mapp-style object.\n@param {object} icon An array of Openlayers style objects.\n@param {object} feature The Openlayers feature to style with an icon.\n*/\nfunction iconStyle(Styles, style, icon, feature) {\n  // Calculate scale for icon render.\n  let scale = icon.scale || 1;\n  scale *= style.scale || 1;\n  scale *= style.clusterScale || 1;\n  scale *= style.fieldScale || 1;\n  scale *= style.zoomInScale || 1;\n  scale *= style.zoomOutScale || 1;\n  scale *= style.highlightScale || 1;\n\n  // Create icon url from svgSymbols method if not defined as url or svg source.\n  icon.url ??=\n    icon.svg || mapp.utils.svgSymbols[icon.type || 'dot'](icon, feature);\n\n  if (!icon.url) return;\n\n  // Push OL icon Style into Styles array.\n  Styles.push(\n    new ol.style.Style({\n      image: new ol.style.Icon({\n        anchor: icon.anchor || [0.5, 0.5],\n        crossOrigin: 'anonymous',\n        scale: scale,\n        src: icon.url,\n      }),\n      zIndex: style.zIndex,\n    }),\n  );\n}\n", "/**\n## /utils/paramString\nThis module creates a parameter string for an XHR request.\n\n@module /utils/paramString\n*/\n\n/**\n@function paramString\n\n@description\nCreates a parameter string for an XHR request based on the provided parameters object.\n\nThe function takes a params object and returns a URL parameter string for for requests.\n\nFollowing properties are filtered out:\n\n- Value is falsy and not 0\n- Value is '{}' string.\n- Value is not typeof 'object', empty array, or object with some property value that is an object with keys.\n\nThe URL parameter value of objects which are not arrays will be stringified and URI component encoded.\n\nOther property values will be URI encoded.\n\nThe URL parameter array is joined with an ampersand (&) to be returned as URL parameter string.\n\n@param {Object} params The object containing the parameters.\n\n@returns {string} The parameter string.\n*/\nexport default paramString;\n\nfunction paramString(params) {\n  if (!params) return '';\n\n  const paramsString = Object.entries(params)\n\n    // Value should be 0 or truthy\n    .filter((entry) => entry[1] === 0 || !!entry[1])\n\n    // Value must not be empty functional brackets.\n    .filter((entry) => entry[1] !== '{}')\n\n    // Filter out zero length array and objects with empty object values.\n    .filter(\n      (entry) =>\n        typeof entry[1] !== 'object' ||\n        entry[1].length ||\n        Object.values(entry[1]).some(\n          (val) => typeof val === 'object' && Object.keys(val).length,\n        ),\n    )\n\n    .map((entry) => {\n      // Stringify non array objects.\n      if (typeof entry[1] === 'object' && !Array.isArray(entry[1])) {\n        return `${entry[0]}=${encodeURIComponent(JSON.stringify(entry[1]))}`;\n      }\n\n      return `${entry[0]}=${encodeURIComponent(entry[1])}`;\n    })\n    .join('&');\n\n  return paramsString;\n}\n", "/**\n## /utils/ping\n\nThe ping utility module exports a method to repeat a ping query until a condition is met.\n\n@module /utils/ping\n*/\n\n/**\n@function ping \n  \n@description\nThe ping utility method executes the pingQuery method which will repeat at a given interval until a condition is met.\n\nThe ping method will create a request url for the ping query from the provided queryparams object.\n\n``` js\nmapp.utils.ping({\n  query: 'location_field_value',\n  responseType: 'text',\n  successCondition: 'ok',\n  failCondition: 'failed',\n  queryparams: {\n    id: true,\n    field: 'model_status',\n    table: 'location_table',\n  },\n  interval: 4000,\n  callback: (response) => {\n    console.log(response);\n  },\n});\n```\n\n@param {Object} params The parameters object.\n@property {string} params.query The query template for the ping query.\n@property {Object} params.queryparams Parameters for the ping query.\n*/\nexport default function ping(params) {\n  if (!params.query) {\n    console.warn(`A query parameter must be defined for the ping utility.`);\n    return;\n  }\n\n  // Default interval to 4 seconds\n  params.interval ??= 4000;\n\n  params.host ??= mapp.host;\n\n  const queryParams = mapp.utils.queryParams(params);\n\n  const paramString = mapp.utils.paramString(queryParams);\n\n  params.url = `${mapp.host}/api/query?${paramString}`;\n\n  return pingQuery(params);\n}\n\n/** \n@function pingQuery \n  \n@description\nThe pingQuery method will call itself with a timeout until a condition is met.\n\nThe method will reject if the response is an error.\n\nThe method will resolve if the response matches either the failCondition or the successCondition.\n\nThe method will resolve if the callback property is set to false.\n\nIf the callback property is a function it will be called with the response and the params object itself as arguments.\n\n@param {Object} params The parameters object.\n@property {string} params.responseType The expected responseType form the ping query.\n@property {string} params.url The request url for the ping query.\n@property {function} params.callback Method to be executed with the response and params object as arguments.\n@property {string} params.successCondition The expected response for a successful ping query.\n@property {string} params.failCondition The expected response for a failed ping query.\n@property {number} params.interval The interval in milliseconds between ping queries.\n@returns {Promise} A promise that resolves with the response or rejects with an error.\n*/\nfunction pingQuery(params) {\n  return new Promise((resolve, reject) => {\n    const pingPromise = async () => {\n      const response = await mapp.utils.xhr(params);\n\n      if (response instanceof Error) {\n        return reject(response);\n      }\n\n      if (params.callback instanceof Function) {\n        params.callback(response, params);\n      }\n\n      if (params.callback === false) {\n        return resolve(response);\n      }\n\n      if (params.failCondition === response) {\n        return resolve(response);\n      }\n\n      if (params.successCondition === response) {\n        return resolve(response);\n      }\n\n      setTimeout(pingPromise, params.interval);\n    };\n\n    pingPromise();\n  });\n}\n", "/**\n## mapp.utils.polygonIntersectFeatures()\n\n@module /utils/polygonIntersectFeatures\n*/\n\n/**\n * Checks if features intersect with a drawn polygon on a map view.\n * @function polygonIntersectFeatures\n * @param {Object} params - The parameters for the function.\n * @param {Object} params.mapview - The map view instance.\n * @param {Function} [params.drawendCallback] - Callback function to be called with intersecting features.\n * @param {Object} [params.interaction] - Additional interaction options to be merged with the default config.\n */\nexport function polygonIntersectFeatures(params) {\n  if (!params.mapview) return;\n\n  function getArrayDepth(arr) {\n    return Array.isArray(arr) ? 1 + Math.max(0, ...arr.map(getArrayDepth)) : 0;\n  }\n\n  // Config for mapview draw interaction.\n  const interaction = {\n    // Draw polygon.\n    drawend: (e) => {\n      const poly = e.feature;\n\n      const polyGeom = poly.getGeometry();\n\n      let features = params.mapview.interaction.snap.source.getFeatures();\n\n      features = features.filter((feature) => {\n        let coordinates = feature.getGeometry().getCoordinates(); //.flat(2)\n\n        coordinates = coordinates.flat(getArrayDepth(coordinates) - 2);\n\n        return coordinates.some((coord) =>\n          polyGeom.intersectsCoordinate(coord),\n        );\n      });\n\n      if (params.drawendCallback) {\n        params.drawendCallback(features);\n      }\n    },\n\n    type: 'Polygon',\n    ...params,\n  };\n\n  // Initiate drawing on mapview with config as interaction argument.\n  params.mapview.interactions.draw(interaction);\n}\n", "/**\n## /utils/proj4\n\nThe proj4 utility module exports methods to manage Openlayers projections.\n\nThe proj4 library will be imported through mapp.utils.esmImport('proj4@2.9.0')\n\n@module /utils/proj4\n*/\n\nexport const proj4 = {\n  addProjection,\n};\n\n/**\n@function addProjection\n@async\n@description\n\nThe proj4 utility method adds a new projection to the ol library.\n\n``` js\nmapp.utils.proj4.addProjection({\n  name: 'EPSG:27700',\n  defs: '+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs',\n  extent: [0, 0, 700000, 1300000]\n});\n```\n\n@param {object} params\n@property {string} params.name\n@property {string} params.defs\n@property {array} params.extent\n*/\nasync function addProjection(params) {\n  const mod = await mapp.utils.esmImport('proj4@2.9.0');\n\n  mod.default.defs(params.name, params.defs);\n\n  // Create and add the projection to OpenLayers\n  const projection = new ol.proj.Projection({\n    code: params.name,\n    extent: params.extent,\n  });\n\n  // Add the projection to the OpenLayers registry\n  ol.proj.addProjection(projection);\n\n  // Register transformation functions\n  ol.proj.addCoordinateTransforms(\n    'EPSG:3857',\n    params.name,\n    (coord) => mod.default('EPSG:3857', params.name, coord),\n    (coord) => mod.default(params.name, 'EPSG:3857', coord),\n  );\n}\n", "/**\n## mapp.utils.promiseAll{}\n\n@module /utils/promiseAll\n*/\n\nexport default (promises) =>\n  new Promise((resolveAll, rejectAll) => {\n    Promise.all(promises)\n      .then(resolveAll)\n      .catch((error) => {\n        console.error(error);\n        rejectAll(error);\n      });\n  });\n", "/**\n## /utils/queryParams\n\nThe queryParams module exports the queryParams utility method for layer and dataview requests.\n\n@module /utils/queryParams\n*/\n\nexport default queryParams;\n\n/**\n@function queryParams\n\n@description\nThe queryParams method returns a params object for the creation of a query URL params string.\n\nThe utility facilitates the creation of params argument for the [mapp.utils.paramString()]{@link module:/utils/paramString~paramString} method.\n\nfrom the [dataview.update()]{@link module:/ui/Dataview~updateDataview} method.\n```js\n// Compile params object from dataview this.\nconst params = mapp.utils.queryParams(this);\n\n// Stringify paramString from object.\nconst paramString = mapp.utils.paramString(params);\n\nthis.host ??= this.layer?.mapview?.host\n\n// Query data as response from query.\nconst response = await mapp.utils.xhr(`${this.host || mapp.host}/api/query?${paramString}`);\n```\nThe queryParams method is particularly useful for calculating the current [viewport] bounds for a data query and to determine the current table for the mapviews current zoom level.\n\n@param {Object} _this Object from which the query originates, eg. layer, dataview entry.\n@property {Object} _this.queryparams Parameter object for the query.\n@property {Boolean} [queryparams.layer] The layer associated with the requesting object _this should be provided as request param.\n@property {layer} [_this.layer] The layer associated with _this object. The layer is required to calculate a viewport, center, zoom [z], or table [if not explicit].\n@property {Boolean} [_this.viewport] Calculate the bounds for the current viewport of the mapview for _this.layer.\n@returns {object} A params object to create a params string.\n*/\nfunction queryParams(_this) {\n  // Must be an empty object if undefined.\n  _this.queryparams ??= {};\n\n  // If queryparams is not an object, return.\n  if (typeof _this.queryparams !== 'object') {\n    console.warn('queryparams must be an object');\n    return;\n  }\n\n  let layer = _this.layer || _this.location?.layer;\n\n  // Merge layer queryparams with request queryparams.\n  // _this.queryparams takes precedence.\n  if (layer?.queryparams) {\n    _this.queryparams = {\n      ...layer.queryparams,\n      ..._this.queryparams,\n    };\n  }\n\n  // Assign table from layer JSON or layer.tableCurrent() method.\n  _this.queryparams.table &&=\n    typeof _this.queryparams.table === 'string'\n      ? _this.queryparams.table\n      : getTable(_this);\n\n  // Get bounds from mapview.\n  const bounds = _this.viewport && _this.layer.mapview.getBounds();\n\n  const geom =\n    typeof _this.queryparams.geom === 'string'\n      ? _this.queryparams.geom\n      : getGeom(_this);\n\n  // Get center from mapview.\n  const center =\n    _this.queryparams.center &&\n    ol.proj.transform(\n      _this.layer.mapview.Map.getView().getCenter(),\n      `EPSG:${_this.layer.mapview.srid}`,\n      `EPSG:4326`,\n    );\n\n  // Queries will fail if the template can not be accessed in workspace.\n  const template =\n    _this.queryparams.template || encodeURIComponent(_this.query);\n\n  // Layer filter can only be applied if the layer is provided as reference to a layer object in the layers list.\n  const filter = _this.queryparams.filter ? layer?.filter?.current : undefined;\n\n  // Locale param is only required for layer lookups.\n  const locale =\n    layer?.mapview?.locale.key || _this.location?.locale || undefined;\n\n  // ID will be taken if a location object is provided with the params.\n  const id = _this.queryparams.id ? _this.location?.id : undefined;\n\n  // qID will be taken if a location object is provided with the params.\n  const qID = _this.queryparams.qID ? _this.location?.layer?.qID : undefined;\n\n  // queryparams.email is a boolean property.\n  const email = _this.queryparams.email ? mapp.user.email : undefined;\n\n  // lat lng must be explicit or the center flag param must be set.\n  const lat = center?.[1];\n  const lng = center?.[0];\n\n  // z will be generated if the z flag is set in the params.\n  const z = _this.queryparams?.z && layer.mapview.Map.getView().getZoom();\n\n  // Viewport will only be generated if the viewport flag is set on the params.\n  const viewport = bounds && [\n    bounds.west,\n    bounds.south,\n    bounds.east,\n    bounds.north,\n    layer.mapview.srid,\n  ];\n\n  // The layer maybe defined as string in the queryparams.\n  layer = layer?.key || _this.queryparams.layer || undefined;\n\n  const params = {\n    ..._this.queryparams,\n    email,\n    fieldValues: undefined,\n    filter,\n    geom,\n    id,\n    lat,\n    layer,\n    lng,\n    locale,\n    qID,\n    template,\n    viewport,\n    z, // The fieldValues array entries should not be part of the url params.\n  };\n\n  return params;\n}\n\n/**\n@function getTable\n\n@description\nReturns the current table associated with a layer or location.layer which maybe dependent on the mapview zoom level.\n\n@param {Object} _this Object from which the query originates, eg. layer, dataview entry.\n@property {location} [_this.location] A mapp location associated with _this object.\n@property {layer} [location.layer] A mapp layer associated with _this.location.\n@property {layer} [_this.layer] A mapp layer associated with _this object.\n\n@returns {string} Table name\n*/\nfunction getTable(_this) {\n  return (\n    _this.location?.layer?.table ||\n    _this.layer?.table ||\n    _this.location?.layer?.tableCurrent?.() ||\n    _this.layer?.tableCurrent?.() ||\n    _this.location?.layer?.tableCurrent?.() ||\n    (_this.layer?.tables &&\n      Object.values(_this.layer.tables).find((table) => !!table)) ||\n    (_this.location?.layer?.tables &&\n      Object.values(_this.location?.layer.tables).find((table) => !!table))\n  );\n}\n\n/**\n@function getGeom\n\n@description\nReturns the current geometry associated with a layer or location.layer which maybe dependent on the mapview zoom level.\n\n@param {Object} _this Object from which the query originates, eg. layer, dataview entry.\n@property {location} [_this.viewport] The viewport flag is set on the params.\n@property {layer} [_this.layer] A mapp layer associated with _this object.\n\n@returns {string} Table name\n*/\nfunction getGeom(_this) {\n  return _this.viewport ? _this.layer.geomCurrent() : undefined;\n}\n", "/**\n### /utils/scriptElement\n\nThe module exports a default method to load scripts from tags.\n\n@module /utils/scriptElement\n*/\n\nconst promises = {};\n\n/**\n@function scriptElement\n@async\n\n@description\nThe scriptElement method adds a promise to the promises object for a script src to be loaded.\n\nAn existing promise will be awaited.\n\nThe promise resolves with the load event.\n\n@param {string} src The script element src.\n@param {string} [type='module'] The script type.\n@returns {Promise<Event>} The promise resolves to the load event for the script element.\n*/\nexport default async function scriptElement(src, type = 'module') {\n  promises[src] ??= new Promise((resolve, reject) => {\n    const scriptEl = document.createElement('script');\n    scriptEl.type = type;\n    scriptEl.src = src;\n\n    scriptEl.addEventListener('load', () => {\n      console.log(`${scriptEl.src} script loaded.`);\n      resolve();\n    });\n    scriptEl.addEventListener('error', reject);\n\n    document.head.append(scriptEl);\n  });\n\n  return await promises[src];\n}\n", "/**\n## mapp.utils.svgSymbols{}\n\n@module /utils/svgSymbols\n*/\n\nimport { svg } from './uhtml.mjs';\n\nconst xmlSerializer = new XMLSerializer();\n\nconst memoizedIcons = {\n  dot: new Map(),\n};\n\nexport function dot(style) {\n  const lookup = Object.values({\n    fillColor: style.fillColor,\n  }).reduce((a, b) => a + b);\n\n  if (memoizedIcons.dot.has(lookup)) return memoizedIcons.dot.get(lookup);\n\n  let icon = svg.node`\n    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\n      <circle cx=13 cy=13 r=10 fill='#333'></circle>\n      <circle cx=12 cy=12 r=10 fill=${style.fillColor || '#fff'}></circle>`;\n\n  icon = `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n\n  memoizedIcons.dot.set(lookup, icon);\n\n  return icon;\n}\n\nexport function target(style) {\n  const icon = svg.node`\n    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\n      <circle cx=13 cy=13 fill='#333' r=10 opacity=0.4></circle>\n      <circle cx=12 cy=12 r=10 fill=${style.fillColor || '#FFF'}>`;\n\n  style.layers &&\n    Object.entries(style.layers).forEach((layer) => {\n      icon.appendChild(\n        svg.node`<circle cx=12 cy=12 r=${parseFloat(layer[0]) * 10} fill=${layer[1]}>`,\n      );\n    });\n\n  return `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n}\n\nexport function triangle(style) {\n  const icon = svg.node`\n    <svg width=24 height=24 viewBox='${`0 0 24 24`}' xmlns='http://www.w3.org/2000/svg'>\n      <polygon\n        points=\"12,4.68 2,22 22,22\"\n        fill=\"#333\" stroke=\"#333\" opacity=0.4 stroke-opacity=0.4 stroke-width=3\n        stroke-linejoin=\"round\"/>`;\n\n  icon.appendChild(svg.node`\n    <polygon\n      fill=${style.fillColor || '#FFF'} stroke=${style.fillColor || '#FFF'} stroke-width=2\n      points=\"12,4.68 2,22 22,22\"  stroke-linejoin=\"round\"/>`);\n\n  style.layers &&\n    Object.entries(style.layers).forEach((layer) => {\n      function x(val, scale) {\n        return 12 + (val - 12) * scale;\n      }\n\n      function y(val, scale) {\n        return 16 + (val - 16) * scale;\n      }\n\n      const points = `${x(12, layer[0])},${y(4.68, layer[0])} ${x(2, layer[0])}, ${y(22, layer[0])} ${x(22, layer[0])}, ${y(22, layer[0])}`;\n\n      icon.appendChild(svg.node`\n      <polygon\n        points=\"${points}\"\n        fill=${layer[1]}\n        stroke=${layer[1] || '#FFF'}\n        stroke-width=1\n        stroke-linejoin=\"round\"/>`);\n    });\n\n  return `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n}\n\nexport function square(style) {\n  const icon = svg.node`\n    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\n      <rect fill='#333' opacity=0.3 width=20 height=20 x=2 y=2 rx=1></rect>\n      <rect fill=${style.fillColor || '#FFF'} width=20 height=20 x=0 y=0 rx=1></rect>`;\n\n  style.layers &&\n    Object.entries(style.layers).forEach((layer) => {\n      icon.appendChild(svg.node`\n      <rect fill=${layer[1]}\n        width=${parseFloat(layer[0]) * 20}\n        height=${parseFloat(layer[0]) * 20}\n        x=${10 * (1 - parseFloat(layer[0]))}\n        y=${10 * (1 - parseFloat(layer[0]))} rx=${parseFloat(layer[0])}></rect>`);\n    });\n\n  return `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n}\n\nexport function diamond(style) {\n  const icon = svg.node`\n    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\n      <polygon\n        fill='#333'\n        opacity=0.3\n        points=\"12 0, 24 12, 12 24, 0 12\"></polygon>\n      <polygon\n        fill=${style.fillColor || '#FFF'}\n        points=\"12 0, 24 12, 12 24, 0 12\"></polygon>`;\n\n  function s(val, scale) {\n    return 12 + (val - 12) * scale;\n  }\n\n  style.layers &&\n    Object.entries(style.layers).forEach((layer) => {\n      const points = `${s(12, layer[0])} ${s(0, layer[0])},${s(24, layer[0])} ${s(12, layer[0])},${s(12, layer[0])} ${s(24, layer[0])}, ${s(0, layer[0])} ${s(12, layer[0])}`;\n\n      icon.appendChild(svg.node`\n      <polygon\n        fill=${layer[1] || '#FFF'}\n        points=\"${points}\"></polygon>`);\n    });\n\n  return `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n}\n\nexport function semiCircle(style) {\n  const icon = svg.node`\n    <svg width=30 height=30 viewBox='0 0 20 24' xmlns='http://www.w3.org/2000/svg'>\n      <defs>\n        <clipPath id=\"cut-off-shade\">\n          <rect x=\"0\" y=\"0\" width=\"24\" height=\"11\"/>\n        </clipPath>\n        <clipPath id=\"cut-off\">\n          <rect x=\"0\" y=\"0\" width=\"24\" height=\"10\"/>\n        </clipPath>\n      </defs>\n      <circle cx=\"11\" cy=\"10\" r=\"10\" clip-path=\"url(#cut-off-shade)\" fill=\"#333\" opacity=0.4></circle>\n      <circle cx=10 cy=10 r=10 fill=${style.fillColor || '#FFF'} clip-path=\"url(#cut-off-shade)\">`;\n\n  style.layers &&\n    Object.entries(style.layers).forEach((layer) => {\n      icon.appendChild(svg.node`\n      <circle cx=10 cy=10 r=${parseFloat(layer[0]) * 10} fill=${layer[1]} clip-path=\"url(#cut-off-shade)\">`);\n    });\n\n  return `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n}\n\nexport function markerLetter(style) {\n  const icon = svg.node`\n    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path fill=\"${style.color}\"\n        d=\"M 12 1.969 C 7.878 1.969 4.813 5.239 4.813 9.328 C 4.813 10.554 5.222 12.189 6.244 14.028 C 8.289 17.504 12 22 12 22 C 12 22 16.055 17.504 18.099 14.028 C 19.122 12.189 19.341 10.963 19.341 9.328 C 19.341 5.239 16.054 1.969 12 1.969 Z\"/>\n      <circle cx=\"12.17192400568182\" cy=\"8.918683238636365\" r=\"5.109789772727275\" fill=\"rgb(255, 255, 255)\"/>\n      <text x=\"12\" y=\"12\" style=\"text-anchor: middle; font-weight: 600; font-size: 9px; font-family: sans-serif; fill: rgb(85, 85, 85);\">\n      ${style.letter}`;\n\n  return `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n}\n\nexport function markerColor(style) {\n  const icon = svg.node`\n    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path style=\"opacity: 0.5;\" fill=\"${style.colorMarker}\"\n        d=\"M 10.797 1.238 C 6.308 1.238 2.716 4.83 2.716 9.32 C 2.716 11.116 3.165 12.463 4.287 14.483 C 6.532 18.3 9.952 23.234 9.952 23.234 C 9.952 23.234 15.063 18.3 17.308 14.483 C 18.43 12.463 18.879 11.116 18.879 9.32 C 18.879 4.83 15.287 1.238 10.797 1.238 Z\"/>\n      <path fill=\"${style.colorMarker}\"\n        d=\"M 10 1.238 C 5.51 1.238 2.144 4.83 2.144 9.32 C 2.144 10.667 2.593 12.463 3.716 14.483 C 5.961 18.3 10 23.238 10 23.238 C 10 23.238 14.491 18.3 16.736 14.483 C 17.859 12.463 18.1 11.116 18.1 9.32 C 18.1 4.83 14.49 1.238 10 1.238 Z\"/>\n      <circle cx=\"10.226\" cy=\"8.871\" r=\"5.612\" opacity=\"0.8\" fill=\"rgb(255, 255, 255)\"/>\n      <circle cx=\"10.226\" cy=\"8.871\" r=\"2.806\" opacity=\"0.8\" fill=\"${style.colorDot}\"/>`;\n\n  return `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n}\n\nexport function circle(style) {\n  const icon = svg.node`\n    <svg width=24 height=24 viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'>\n      <circle cx=16 cy=16 r=10\n        stroke=\"${style.strokeColor || '#333'}\"\n        stroke-width=\"${style.strokeWidth || 1}\"\n        fill=\"#ffffff33\">`;\n\n  return `data:image/svg+xml,${encodeURIComponent(xmlSerializer.serializeToString(icon))}`;\n}\n\n// Assign template method to svgSymbols.\nexport function template(icon) {\n  // Get svgString from svgSymbol.templates.\n  let svgString = mapp.utils.svgSymbols.templates?.[icon.template];\n\n  // Return undefined if svgString not found in templates.\n  if (!svgString) return;\n\n  // Iterate through the icon.substitute entries.\n  if (typeof icon.substitute === 'object') {\n    Object.entries(icon.substitute).forEach((entry) => {\n      // Replace substitute key with values.\n      svgString = svgString.replaceAll(entry[0], entry[1]);\n    });\n  }\n\n  // Return encoded string.\n  return `data:image/svg+xml,${encodeURIComponent(svgString)}`;\n}\n", "/**\n@module /utils/svgTemplates\n*/\n\n/**\n@function svg_templates\n@async\n\n@description\nThe method parses the templates object param. Templates which are not yet available as mapp.utils.svgSymbols.templates{} will fetched and stored for use in feature style methods.\n\nThe svgTemplates method will resolve once all templates have been parsed and loaded.\n\n@param {object} templates An object with svg_template properties to load.\n\n@returns {Promise<void>}\n*/\nexport default async function svgTemplates(templates) {\n  if (!templates || !Object.keys(templates).length) return;\n\n  mapp.utils.svgSymbols.templates ??= {};\n\n  // Iterate through svg_templates entries.\n  const promises = Object.keys(templates)\n\n    // The template key is not yet loaded into the templates\n    .filter((key) => !Object.hasOwn(mapp.utils.svgSymbols.templates, key))\n    .map((key) => {\n      // Fetch entry value.\n      return fetch(templates[key])\n        .then((response) => response.text())\n        .then((svgString) => {\n          // Assign parsed svgString as entry key to templates object.\n          mapp.utils.svgSymbols.templates[key] = svgString;\n        });\n    });\n\n  await Promise.all(promises);\n}\n", "/**\nUtility module for transforming between Unix timestamp integers and formatted date strings.\nSupports various date/time formats and localization options.\n@module /utils/temporal\n*/\nconst DEFAULT_LOCALE = 'en-GB';\nconst MILLISECONDS_IN_SECOND = 1000;\n\n/**\nSafely converts Unix timestamp to JavaScript Date object\n@private\n@param {number} unixTimestamp Unix timestamp in seconds\n@returns {Date} JavaScript Date object\n@throws {Error} If timestamp is invalid\n*/\nfunction toJSDate(unixTimestamp) {\n  if (!Number.isInteger(unixTimestamp)) {\n    console.error('unixTimestamp must be integer for Date conversion');\n    return;\n  }\n\n  return new Date(unixTimestamp * MILLISECONDS_IN_SECOND);\n}\n\n/**\nFormats a Unix timestamp into a localized date string. If not explicit in the param the language for the locale will be taken from the mapp.user object or fallback to the default format.\n@param {Object} params Input parameters\n@property {number} params.value Unix timestamp in seconds\n@property {number} [params.newValue] Updated timestamp value (takes precedence over value)\n@property {string} [params.locale=en-GB] Locale identifier\n@property {Intl.DateTimeFormatOptions} [params.options] Formatting options\n@returns {string} Formatted date string\n@see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat|Intl.DateTimeFormat}\n*/\nfunction dateString(params) {\n  // Set the locale to the browser language if not provided, or fallback to the default of 'en-GB'.\n  params.locale ??= navigator.language || DEFAULT_LOCALE;\n\n  // The timestamp must be parsed as Integer.\n  const timestamp = parseInt(params.newValue || params.value);\n\n  const date = toJSDate(timestamp);\n\n  return new Intl.DateTimeFormat(params.locale, params.options).format(date);\n}\n\n/**\nConverts a date string to Unix timestamp. The current data will be used if no dateStr is provided.\n@param {string} [dateStr] Date string parseable by JavaScript Date\n@returns {number} Unix timestamp in seconds\n@throws {Error} If date string is invalid\n*/\nfunction dateToUnixEpoch(dateStr) {\n  const date = dateStr ? new Date(dateStr) : new Date();\n\n  if (isNaN(date.getTime())) {\n    console.error('Invalid date string provided');\n    return;\n  }\n\n  return Math.floor(date.getTime() / MILLISECONDS_IN_SECOND);\n}\n\n/**\nFormats Unix timestamp to ISO datetime string (YYYY-MM-DDThh:mm:ss)\n@param {integer} timestamp Unix timestamp in seconds\n@returns {string} ISO datetime string without timezone\n*/\nfunction datetime(timestamp) {\n  if (!timestamp) return;\n  const date = toJSDate(timestamp);\n  return date.toISOString().split('.')[0];\n}\n\n/**\nFormats Unix timestamp to ISO date string (YYYY-MM-DD)\n@param {integer} timestamp Unix timestamp in seconds\n@returns {string} ISO date string\n*/\nfunction date(timestamp) {\n  if (!timestamp) return;\n  const date = toJSDate(timestamp);\n  return date.toISOString().split('T')[0];\n}\n\nexport const temporal = {\n  date,\n  dateString,\n  dateToUnixEpoch,\n  datetime,\n};\n", "/**\n## /utils/textFile\n\n@module /utils/textFile\n*/\n\n/**\n@function textFile\n\n@description TextFile Utils\n\n@param {Object} params \n@property  {string} params.text\n*/\nexport default function textFile(params) {\n  if (typeof params.text !== 'string') return;\n\n  params.filename ??= 'file.txt';\n\n  params.type ??= 'text';\n\n  const blob = new Blob([params.text], {\n    type: params.type,\n  });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `${params.filename}`;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n", "/** \n### mapp.utils.userIndexedDB\n\nThe module exports method to store and retrieve objects from a userIndexedDB.\n\n@module /utils/userIndexedDB\n*/\n\n/**\n@function openDB\n@description\nThe method is called from any transaction method to interact with the userIndexedDB.\n\nA new database will be created when attempting to open a DB which does not exist.\n\nA new store will be created when a new DB is upgraded [on creation].\n\n@param {object} params \n@property {string} params.store\n@property {string} params.user\n@property {string} params.workspace\n@returns {Promise} OpenDBPromise\n*/\nexport async function openDB(params) {\n  const OpenDBPromise = new Promise((resolve, reject) => {\n    params.indexedDB ??= 'MAPP';\n    // will create a new database if db/version doesn't exist.\n    const IDBRequest = indexedDB.open(params.indexedDB, 3);\n\n    IDBRequest.onerror = (event) => {\n      console.error(IDBRequest.error);\n      resolve(IDBRequest);\n    };\n\n    IDBRequest.onsuccess = (event) => {\n      if (!event.target.result.objectStoreNames.contains(params.store)) {\n        console.warn(\n          `UserIDB '${params.indexedDB}' doesn't contain \"${params.store}\" objectStore.`,\n        );\n\n        resolve(null);\n      }\n\n      resolve(event.target.result);\n    };\n\n    // will be called on database versioning.\n    IDBRequest.onupgradeneeded = (event) => {\n      // onsuccess method will be called after the object store is created.\n      event.target.result.createObjectStore(params.store);\n    };\n  });\n\n  const IDB = await OpenDBPromise;\n\n  return IDB;\n}\n\n/**\n@function add\n@param {Object} params \n@property {string} params.user \n@property {string} params.db \n@property {string} params.store \n@property {object} params.key \n@returns {Promise} addPromise\n*/\nexport async function add(params) {\n  const IDB = await openDB(params);\n\n  const addPromise = new Promise((resolve, reject) => {\n    const IDBTransaction = IDB.transaction([params.store], 'readwrite');\n\n    const objectStore = IDBTransaction.objectStore(params.store);\n\n    const IDBRequest = objectStore.add(params.obj);\n\n    IDBRequest.onerror = (event) => {\n      console.error(IDBRequest.error);\n      reject(IDBRequest.error);\n    };\n\n    IDBRequest.onsuccess = (event) => {\n      resolve(event.target.result);\n    };\n  });\n\n  await addPromise;\n\n  return addPromise;\n}\n\n/**\n@function get\n@param {Object} params \n@property {string} params.user \n@property {string} params.workspace \n@property {string} params.store \n@property {object} params.name \n@returns {Promise} getPromise\n*/\nexport async function get(params) {\n  const IDB = await openDB(params);\n\n  const getPromise = new Promise((resolve, reject) => {\n    const IDBTransaction = IDB.transaction([params.store], 'readwrite');\n\n    const objectStore = IDBTransaction.objectStore(params.store);\n\n    const IDBRequest = objectStore.get(params.name);\n\n    IDBRequest.onerror = (event) => {\n      console.error(IDBRequest.error);\n      reject(IDBRequest.error);\n    };\n\n    IDBRequest.onsuccess = (event) => {\n      resolve(IDBRequest.result);\n    };\n  });\n\n  await getPromise;\n\n  return getPromise;\n}\n\nexport async function list(params) {\n  const IDB = await openDB(params);\n\n  const getPromise = new Promise((resolve, reject) => {\n    const IDBTransaction = IDB.transaction([params.store], 'readwrite');\n\n    const objectStore = IDBTransaction.objectStore(params.store);\n\n    const IDBRequest = objectStore.getAll();\n\n    IDBRequest.onerror = (event) => {\n      console.error(IDBRequest.error);\n      reject(IDBRequest);\n    };\n\n    IDBRequest.onsuccess = (event) => {\n      const locales = IDBRequest.result.map((locale) => ({\n        key: locale.key,\n        name: locale.name,\n      }));\n      resolve(locales);\n    };\n  });\n\n  await getPromise;\n\n  return getPromise;\n}\n\n/**\n@function put\n@param {Object} params \n@property {string} params.user \n@property {string} params.db \n@property {string} params.store \n@property {object} params.obj \n@returns {Promise} updatePromise\n*/\nexport async function put(params) {\n  const IDB = await openDB(params);\n\n  const updatePromise = new Promise((resolve, reject) => {\n    const IDBTransaction = IDB.transaction([params.store], 'readwrite');\n\n    const objectStore = IDBTransaction.objectStore(params.store);\n\n    const IDBRequest = objectStore.put(params.obj, params.name);\n\n    IDBRequest.onerror = (event) => {\n      console.error(IDBRequest.error);\n      reject(IDBRequest);\n    };\n\n    IDBRequest.onsuccess = (event) => {\n      resolve(IDBRequest.result);\n    };\n  });\n\n  await updatePromise;\n\n  return updatePromise;\n}\n\nexport async function remove(params) {\n  const IDB = await openDB(params);\n\n  const removePromise = new Promise((resolve, reject) => {\n    const IDBTransaction = IDB.transaction([params.store], 'readwrite');\n\n    const objectStore = IDBTransaction.objectStore(params.store);\n\n    const IDBRequest = objectStore.delete(params.name);\n\n    IDBRequest.onerror = (event) => {\n      console.error(IDBRequest.error);\n      reject(IDBRequest);\n    };\n\n    IDBRequest.onsuccess = (event) => {\n      resolve();\n    };\n  });\n\n  await removePromise;\n\n  return removePromise;\n}\n", "/**\n### /utils/userLocale\n\nThe userLocale utility module exports methods to get, put (create or overwrite), or delete a userLocale object in a userIndexedDB.\n\nAt current the module requires the userIndexedDB utility module to store the userLocale in an indexedDB.\n\nLocales can be stored in the locales store.\n\nThe locales store is part of an [indexed] DB identified by the user and the workspace.\n\nA workspace is unique to an XYZ instance.\n\nA decorated locale object must be parsed with the jsonParser utility method in order to be stored as a JSON object in a store.\n\n@requires /utils/jsonParser\n@requires /utils/userIndexedDB\n\n@module /utils/userLocale\n*/\n\n/**\n@function get\n@async\n\n@description\nThe get method requests a locale stored in a userIndexedDB.\n\n@param {Object} locale\n@property {Object} locale.workspace Identifies the XYZ instance.\n@property {Object} locale.name The custom name under which a locale is stored.\n@returns {Promise<Object>} Returns a locale object stored as a userLocale.\n*/\nexport async function get(locale) {\n  const storedLocale = await mapp.utils.userIndexedDB.get({\n    indexedDB: locale.workspace,\n    store: 'locales',\n    user: mapp.user.email || 'anonymous',\n    name: locale.name,\n  });\n\n  return storedLocale;\n}\n\n/**\n@function putLocale\n@async\n\n@description\nThe putLocale method calls the put method to store a locale object in the userIndexedDB.\n\n@param {Object} mapview The mapview object.\n@property {string} params The params object.\n@returns {Promise<Object>} Returns the response object from the put method.\n*/\nexport async function putLocale(mapview, params) {\n  const locale = mapp.utils.jsonParser(mapview.locale);\n\n  locale.layers = Object.values(mapview.layers).map(mapp.utils.jsonParser);\n\n  const response = await mapp.utils.userIndexedDB.put({\n    indexedDB: locale.workspace,\n    store: 'locales',\n    user: mapp.user.email || 'anonymous',\n    name: locale.name,\n    obj: locale,\n  });\n\n  return response;\n}\n\n/**\n@function list\n@async\n\n@description\nRequests an array of locales [key, name] from the 'locales' database store.\n\n@param {string} workspace The workspace identifier.\n*/\nexport async function list(workspace) {\n  const locales = await mapp.utils.userIndexedDB.list({\n    indexedDB: workspace,\n    store: 'locales',\n    user: mapp.user.email || 'anonymous',\n  });\n\n  return locales;\n}\n\n/**\n@function remove\n@async\n\n@description\nThe method removes a locale from the database 'locales' store.\n\n@param {Object} locale\n@property {Object} locale.workspace The workspace identifier.\n@property {Object} locale.name The custom name under which a locale is stored.\n*/\nexport async function remove(locale) {\n  const response = await mapp.utils.userIndexedDB.remove({\n    indexedDB: locale.workspace,\n    store: 'locales',\n    user: mapp.user.email || 'anonymous',\n    name: locale.name,\n  });\n\n  return response;\n}\n", "/**\n## /utils/versionCheck\n\n@module /utils/versionCheck\n*/\n\n/**\n@function versionCheck\n\n@description\nCompare the mapp.version string property against as string value provided as argument.\n\nThe versionCheck returns true if the provided value argument equals or exceeds the mapp.version.\n\n```js\nversionCheck('4.12') //returns true with mapp.version = '4.12.0' or smaller.\n```\n\n@param {String} value The value to compare with the current version.\n@return {boolean} Return true if the current version is more than or equal to the given value.\n*/\nexport function versionCheck(value) {\n  const majorVersion = parseInt(mapp.version.split('.')[0]);\n\n  const minorVersion = parseInt(mapp.version.split('.')[1]);\n\n  const patchVersion = parseInt(mapp.version.split('.')[2]);\n\n  const majorValue = parseInt(value.toString().split('.')[0]);\n\n  const minorValue = parseInt(value.toString().split('.')[1]);\n\n  const patchValue = parseInt(value.toString().split('.')[2]) || 0;\n\n  // The major version exceeds the value.\n  if (majorVersion > majorValue) {\n    return true;\n  }\n\n  // The major versions are equal.\n  if (majorVersion === majorValue) {\n    // The minor version exceeds the mapp.version minor.\n    if (minorVersion > minorValue) return true;\n\n    return minorVersion === minorValue && patchVersion >= patchValue;\n  }\n\n  // The value exceeds the mapp.version\n  return false;\n}\n", "/**\n## mapp.utils.verticeGeoms()\n\n@module /utils/verticeGeoms\n*/\n\nexport default (feature) => {\n  const geometry = feature.getGeometry();\n\n  if (geometry.getType() === 'Point')\n    return new ol.geom.Point(geometry.getCoordinates());\n\n  let coords = geometry.getCoordinates();\n\n  const depth = getDepth(coords);\n\n  // Line string will have a depth of 2.\n  if (depth === 2) {\n    return new ol.geom.MultiPoint(coords);\n  }\n\n  // Coords with a depth of more than 3 indicate multi geoms.\n  coords = depth > 3 ? coords.flat(2) : coords[0];\n\n  return new ol.geom.MultiPoint(coords);\n};\n\nfunction getDepth(arr) {\n  return Array.isArray(arr) ? 1 + Math.max(0, ...arr.map(getDepth)) : 0;\n}\n", "/**\n## /utils/xhr\n\nExport the xhr method to mapp.utils{}.\n\n@module /utils/xhr\n*/\n\n/**\n@function xhr\n\n@description\nThe params object/string for the xhr utility method is required.\n\nThe params are assumed to the request URL if provided as a string argument.\n\nThe request params and response are stored in a Map() if the cache flag is set in the params object argument.\n\nIf the debounce flag is set, requests will be delayed until after the specified time has elapsed since the last call in the same group.\nUnlike throttle which aborts previous requests, debounce delays execution of the latest request.\nThe method is assumed to be 'POST' if a params.body is provided.\n\n@param {Object} params The object containing the parameters.\n@property {string} params.url The request URL.\n@property {string} [params.method=GET] The request method.\n@property {string} [params.responseType=json] The XHR responseType.\n@property {Object} [params.requestHeader={'Content-Type': 'application/json'}] The XHR requestHeader.\n@property {string} [params.body] A stringified request body for a 'POST' request.\n@property {boolean} [params.resolveTarget] Whether the target instead of target.response should be resolved.\n@property {boolean} [params.cache] Whether the response should be cached in a Map().\n@property {boolean|number|object} [params.debounce] Whether the request should be debounced. Can be true (300ms default), a number (milliseconds), or an object (group name with 300ms default). Format: \"{key: \"name\", delay: 300}.\n\n@returns {Promise} A promise that resolves with the XHR.\n*/\nconst requestMap = new Map();\nexport function xhr(params) {\n  return new Promise((resolve, reject) => {\n    if (!params) {\n      console.error('xhr params are falsy.');\n      return reject(new Error('xhr params are required'));\n    }\n\n    params = typeof params === 'string' ? { url: params } : { ...params };\n\n    if (!params.url) {\n      console.error('no xhr request url has been provided.');\n      return reject(new Error('no xhr request url has been provided.'));\n    }\n\n    params.method ??= params.body ? 'POST' : 'GET';\n    params.responseType ??= 'json';\n\n    const xhr = new XMLHttpRequest();\n    xhr.open(params.method, params.url, true);\n\n    if (params.requestHeader !== null) {\n      const headers = {\n        'Content-Type': 'application/json',\n        ...params.requestHeader,\n      };\n      Object.entries(headers).forEach(([k, v]) => xhr.setRequestHeader(k, v));\n    }\n\n    xhr.responseType = params.responseType;\n\n    if (params.cache && requestMap.has(params.url)) {\n      const cached = requestMap.get(params.url);\n      return resolve(params.resolveTarget ? cached : cached.response);\n    }\n\n    xhr.onload = () => {\n      if (xhr.status >= 400) {\n        return reject(new Error(`HTTP ${xhr.status}`));\n      }\n\n      const result = params.resolveTarget ? xhr : xhr.response;\n\n      if (params.cache) {\n        requestMap.set(\n          params.url,\n          params.resolveTarget ? xhr : { response: result },\n        );\n      }\n\n      resolve(result);\n    };\n\n    if (debounce(xhr, params, reject)) return;\n\n    // Send request if not debounced.\n    try {\n      xhr.send(params.body);\n    } catch (err) {\n      return err;\n    }\n  });\n}\n\n/**\n@function debounce\n\n@description\nA request will not be debounced if the params.debounce property is falsy [undefined].\n\nThe debounce property will be assigned as delay [ms] value if numeric.\n\nThe debounce property will be assigned as key for the debounce.\n\nThe delay will be provided to timeout sending the xhr request.\n\nThe timeout will be stored in the debounceMap with the associated params.key property. The timeout will be cleared should a request with the same key property be debounced before the timeout function is executed.\n\n@param {object} xhr XMLHttpRequest.\n@param {object} params Request parameters.\n@property {boolean} [params.debounce] Request should be debounced.\n@property {string} [params.key='global'] Key for request in debounceMap.\n@property {boolean} [params.delay=300] Delay in ms for debounce timeout.\n@param {function} reject The request promise will be rejected if debounced.\n\n@returns {boolean} true if request will be debounced.\n*/\nconst debounceMap = new Map();\nfunction debounce(xhr, params, reject) {\n  if (!params.debounce) return;\n\n  if (typeof params.debounce === 'number') {\n    params.delay = params.debounce;\n  }\n\n  params.delay ??= 300;\n\n  if (typeof params.debounce === 'string') {\n    params.key ??= params.debounce;\n  }\n\n  params.key ??= 'global';\n\n  const existing = debounceMap.get(params.key);\n\n  if (existing) {\n    clearTimeout(existing.timeoutId);\n    // Debounced requests should not be rejected with an Error.\n    existing.reject('Request Debounced');\n  }\n\n  const timeoutId = setTimeout(() => {\n    debounceMap.delete(params.key);\n\n    xhr.send(params.body);\n  }, params.delay);\n\n  debounceMap.set(params.key, { timeoutId, reject });\n\n  // This request will be debounced.\n  return true;\n}\n", "/**\n## mapp.utils{}\n\n@module /utils\n*/\n\nimport esmImport from './esmImport.mjs';\nimport { html, render, svg } from './uhtml.mjs';\n\n/**\n@function simpleStatistics\n@async\n\n@description\nThe method import the [simple-statistics]{@link https://www.npmjs.com/package/simple-statistics} module through the esmImport utility.\n\n@returns {Promise<Module>} The promise resolves to the simple-statistics module.\n*/\nasync function simpleStatistics() {\n  return await esmImport('simple-statistics@7.8.8');\n}\n\n/**\n@function olScript\n@async\n@memberof module:/utils\n\n@description\nThe olScript uses the scriptElement utility method to load the Openlayers Application script.\n*/\nasync function olScript() {\n  await mapp.utils.scriptElement(\n    'https://cdn.jsdelivr.net/npm/ol@v10.7.0/dist/ol.js',\n    'application/javascript',\n  );\n}\n\n/**\n@function areSetsEqual\n@memberof module:/utils\n*/\nconst areSetsEqual = (a, b) =>\n  a.size === b.size && [...a].every((value) => b.has(value));\n\nimport compose from './compose.mjs';\nimport convert from './convert.mjs';\nimport copyToClipboard from './copyToClipboard.mjs';\nimport csvDownload from './csvDownload.mjs';\nimport csvUpload from './csvUpload.mjs';\nimport { dataURLtoBlob } from './dataURLtoBlob.mjs';\nimport * as gazetteer from './gazetteer.mjs';\nimport getCurrentPosition from './getCurrentPosition.mjs';\nimport { default as hexa } from './hexa.mjs';\nimport jsonParser from './jsonParser.mjs';\nimport { keyvalue_dictionary } from './keyvalue_dictionary.mjs';\nimport loadDictionary from './loadDictionary.mjs';\nimport loadPlugins from './loadPlugins.mjs';\nimport merge from './merge.mjs';\nimport mobile from './mobile.mjs';\nimport {\n  formatNumericValue,\n  unformatStringValue,\n} from './numericFormatter.mjs';\nimport style from './olStyle.mjs';\nimport paramString from './paramString.mjs';\nimport ping from './ping.mjs';\nimport { polygonIntersectFeatures } from './polygonIntersectFeatures.mjs';\nimport { proj4 } from './proj4.mjs';\nimport promiseAll from './promiseAll.mjs';\nimport queryParams from './queryParams.mjs';\nimport scriptElement from './scriptElement.mjs';\nimport * as svgSymbols from './svgSymbols.mjs';\nimport svgTemplates from './svgTemplates.mjs';\nimport { temporal } from './temporal.mjs';\nimport textFile from './textFile.mjs';\nimport * as userIndexedDB from './userIndexedDB.mjs';\nimport * as userLocale from './userLocale.mjs';\nimport { versionCheck } from './versionCheck.mjs';\nimport { default as verticeGeoms } from './verticeGeoms.mjs';\nimport { xhr } from './xhr.mjs';\n\nexport default {\n  areSetsEqual,\n  compose,\n  convert,\n  copyToClipboard,\n  csvDownload,\n  csvUpload,\n  dataURLtoBlob,\n  esmImport,\n  formatNumericValue,\n  gazetteer,\n  getCurrentPosition,\n  hexa,\n  html,\n  jsonParser,\n  keyvalue_dictionary,\n  loadDictionary,\n  loadPlugins,\n  merge,\n  mobile,\n  olScript,\n  paramString,\n  ping,\n  polygonIntersectFeatures,\n  proj4,\n  promiseAll,\n  queryParams,\n  render,\n  scriptElement,\n  simpleStatistics,\n  style,\n  svg,\n  svgSymbols,\n  svgTemplates,\n  temporal,\n  textFile,\n  unformatStringValue,\n  userIndexedDB,\n  userLocale,\n  versionCheck,\n  verticeGeoms,\n  xhr,\n};\n", "/**\n## MAPP\n\nThe primary module for the MAPP API will import other MAPP modules and assign itself as the `window.mapp{}` object.\n\nThe `mapp.mjs` module is used as entry point for the esbuild process to bundle the MAPP API.\n\nThe MAPP library requires Openlayers. The mapp module will check whether the Openlayers script has been loaded and will log the version. A warning will be issued if the loaded Openlayers version is outdated.\n\n@requires /mapview\n@requires /layer\n@requires /location\n@requires /utils\n@requires /dictionary\n@requires /dictionaries\n\n@module mapp\n*/\n\nimport { dictionaries, dictionary } from './dictionary.mjs';\nimport hooks from './hooks.mjs';\nimport layer from './layer/_layer.mjs';\nimport location from './location/_location.mjs';\nimport Mapview from './mapview/_mapview.mjs';\nimport plugins from './plugins/_plugins.mjs';\nimport utils from './utils/_utils.mjs';\n\nhooks.parse();\n\nconst ol_current = 10.7; //03/02/2025\n\nglobalThis.ol ??= {};\n\n// Check whether Openlayers has been loaded.\nif (!ol.util?.VERSION) {\n  console.warn(`Openlayers has not been loaded.`);\n} else if (Number.parseFloat(ol.util?.VERSION) < ol_current) {\n  console.warn(`Openlayers v${ol.util?.VERSION} below current v${ol_current}.`);\n} else {\n  console.log(`Openlayers v${ol.util?.VERSION}`);\n}\n\nglobalThis.mapp = {\n  dictionaries,\n  dictionary,\n  hash: 'c3aa678427f05755ce358258c632b66e540c09a0',\n  hooks,\n  host: document.head?.dataset?.dir || '',\n  language: hooks.current.language || 'en',\n  layer,\n  location,\n  Mapview,\n  plugins,\n  utils,\n  version: '4.21.0',\n};\n"],
  "mappings": "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",
  "names": ["en_default", "dictionary", "get", "target", "key", "receiver", "dictionaries", "en_default", "hooks", "filter", "parse", "push", "remove", "removeAll", "set", "hooks_default", "url", "key", "value", "_hooks", "pushState", "val", "el", "me", "decorate", "layer", "changeEnd", "geomCurrent", "getExtent", "hide", "remove", "show", "tableCurrent", "update", "zoomToExtent", "entry", "val", "key", "ids", "feature", "body", "fn", "table", "zoom", "zoomKeys", "minZoomKey", "maxZoomKey", "geom", "params", "response", "jsonLayer", "newLayer", "layersnode", "fade", "layer", "out", "currentOpacity", "targetOpacity", "duration", "startTime", "updateOpacity", "elapsedTime", "progress", "interpolatedOpacity", "featureFields_exports", "__export", "distribution", "fieldsArray", "process", "reset", "layer", "field", "numbers", "n", "count", "jenks", "theme", "val", "simpleStatistics", "value", "cat", "i", "fieldsSet", "featureFormats_exports", "__export", "cluster", "geojson", "wkt", "wkt_properties", "wkth3", "layer", "features", "vals", "i", "geometry", "count", "id", "properties", "field", "formatGeojson", "feature", "formatWKT", "olFeatures", "cellGeomMap", "h3js", "wkt_fields", "longLat", "lL", "featureHover", "feature", "layer", "featureKey", "table", "paramString", "response", "content", "_error", "featureStyle", "layer", "feature", "Styles", "featureProperties", "clusterStyle", "highlightStyle", "labelStyle", "selectedStyle", "iconScalingStyle", "lookupFeature", "f", "clusterScale", "fieldValue", "factor", "googleMapTiles", "layer", "mapboxStyle", "layer", "MaplibreGL", "maplibre", "layer", "className", "testUrl", "normalizeStyleURL", "maplibreMap", "url", "resourceType", "transformMapboxUrl", "frameState", "accessToken", "normalizeSpriteURL", "normalizeGlyphsURL", "normalizeSourceURL", "parseUrl", "parts", "formatUrl", "urlObject", "apiUrlObject", "params", "path", "MVT", "layer", "reload", "wktPropertiesLoad", "tileUrlFunction", "wktTileUrlFunction", "tileCoord", "table", "geom", "bounds", "viewport", "z", "paramString", "url", "response", "tiles_default", "layer", "evt", "vector", "layer", "clusterConfig", "features", "e", "clusterSourceChange", "reload", "feature_counts", "F", "featureProperties", "entry", "table", "geom", "bounds", "format_default", "vector", "googleMapTiles", "mapboxStyle", "maplibre", "MVT", "tiles_default", "iconKeys", "styleKeys", "styleParser", "layer", "warnings", "clusterChecks", "parseTheme", "key", "handleHovers", "iconObject", "iconUrlSVG", "icon", "theme", "cat", "graduatedTheme", "catStyle", "a", "b", "defaultStyle", "mergeStyle", "style", "basic", "theme", "feature", "categorized", "theme", "feature", "flat", "field", "catValue", "cat", "icon", "distributed", "theme", "feature", "val", "bbox", "intersects", "b", "set", "item", "free", "graduated_breaks", "val", "cat", "graduated", "theme", "feature", "catValue", "total", "F", "index", "layer_default", "decorate", "fade", "featureFields_exports", "featureFormats_exports", "featureHover", "featureStyle", "format_default", "styleParser", "basic", "categorized", "distributed", "graduated", "createLocation", "feature", "interaction", "layer", "location", "entry", "err", "concatFeatures", "e", "checkFeature", "F", "decorate", "location", "confirmUpdate", "getExtent", "flyTo", "removeLayer", "remove", "removeEdits", "restoreEdits", "syncFields", "trash", "update", "entry", "fn", "callback", "fieldEntry", "_entry", "newValues", "dependents", "layer", "mapview_layer", "fields", "response", "maxZoom", "flyToExtent", "overall_extent", "extent", "val", "locations", "get", "location", "list", "mapview", "getInfoj", "table", "response", "getFeatureResponse", "text", "_entry", "feature", "queryParams", "apiUrl", "err", "nnearest", "params", "featureProperties", "fCoord", "coords", "list", "li", "e", "content", "location_default", "createLocation", "decorate", "get", "getInfoj", "nnearest", "addLayer", "layers", "currentLayers", "layer", "resolve", "allFeatures", "mapview", "features", "callback", "F", "L", "feature", "options", "list", "e", "content", "attribution", "mapview", "links", "layer", "elements", "entry", "fitView_default", "extent", "options", "val", "geoJSON_default", "params", "format", "geometry_default", "params", "feature", "geometry", "err", "layerVector", "getBounds", "srid", "extent", "extentTransformed", "infotip", "infotip_default", "content", "mapview", "position", "draw_default", "params", "mapview", "e", "moveEvent", "fn", "finish", "getFeature", "escape", "geometry", "onChange", "feature", "highlight", "params", "mapview", "finish", "getFeature", "layerFilter", "pointerMove", "click", "mouseDown", "touchStart", "mouseUp", "mouseleave", "L", "layer", "clear", "e", "candidates", "callback", "F", "layerKey", "featureID", "key", "options", "feature", "features", "list", "featureProperties", "li", "content", "modify", "params", "mapview", "e", "geom", "geomType", "coords", "finish", "getFeature", "escape", "feature", "snap_default", "mapview", "tileloadend", "e", "features", "zoom_default", "params", "mapview", "finish", "e", "locate", "params", "pos", "coords", "popup", "popup_default", "params", "mapview", "removeLayer", "layers", "_layer", "resolve", "decorate", "mapview", "addLayer", "allFeatures", "changeEnd", "updateView", "fitView_default", "geoJSON_default", "geometry_default", "getBounds", "infotip_default", "draw_default", "highlight", "modify", "snap_default", "zoom_default", "locate", "geometry", "popup_default", "removeLayer", "viewConfig", "mapviewControls", "resizeObserverTimeout", "viewMask", "attribution", "e", "mapviewPromise", "viewExtent", "north", "south", "east", "west", "control", "world", "extent", "maskFeature", "fn", "layer", "syncPlugins", "key", "asyncPlugins", "admin", "plugin", "mapview", "btnColumn", "dark_mode", "plugin", "mapview", "darkMode", "button", "updateUser", "ThemeChosen", "modeIcon", "sanitizedUser", "custom_theme", "theme", "feature_info", "plugin", "mapview", "btnColumn", "toggleFeatureInfoHighlight", "feature", "featureProperties", "F", "content", "fullscreen", "plugin", "mapview", "btnColumn", "toggleFullscreen", "e", "layer", "btn", "layer_order", "plugin", "mapview", "a", "b", "mapButton", "link_button", "mapview", "localeKey", "link", "addButton", "css_class", "node", "locator", "plugin", "mapview", "btnColumn", "btn", "e", "login", "plugin", "mapview", "btnColumn", "iconName", "iconClass", "userURL", "svg_templates", "plugin", "test", "plugin", "mapview", "error", "userIDB", "plugin", "mapview", "btnColumn", "userDialog", "content", "jsoneditor", "renderUpdateMenu", "e", "items", "updateUser", "removeUser", "item", "jsonUser", "userLayer", "plugin", "mapview", "content", "addBtn", "addLayer", "jsonLayer", "newLayer", "userLocale", "plugin", "mapview", "layersNode", "zoomBtn", "plugin", "mapview", "btnColumn", "btnZoomIn", "e", "z", "btnZoomOut", "checkZoom", "zoomToArea", "plugin", "mapview", "btnColumn", "toggleZoomInteraction", "e", "btn", "plugins", "admin", "custom_theme", "dark_mode", "feature_info", "fullscreen", "layer_order", "link_button", "locator", "login", "svg_templates", "test", "userIDB", "userLayer", "userLocale", "zoomBtn", "zoomToArea", "plugins_default", "promises", "esmImport", "module", "resolve", "esm", "e", "t", "n", "r", "s", "l", "o", "a", "i", "c", "u", "d", "p", "f", "h", "m", "g", "y", "b", "w", "x", "v", "N", "C", "A", "k", "$", "E", "O", "T", "S", "L", "M", "j", "B", "D", "_", "z", "H", "compose", "fns", "arg", "acc", "fn", "promise", "convert", "moduleImport", "resolve", "mod", "convert_default", "value", "params", "copyToClipboard", "text_to_copy", "csvDownload", "data", "params", "rows", "record", "fieldsFunction", "field", "blob", "link", "fields", "val", "schemaMethods", "val", "csvUpload", "file", "params", "resolve", "reader", "e", "rows", "columnCounts", "row", "splitRowIntoFields", "columnCount", "chunks", "chunkRows", "responses", "chunk", "postRequestData", "response", "chunkSize", "fields", "indx", "field", "type", "rowSize", "currentField", "insideQuotes", "character", "data", "queryParams", "paramString", "url", "dataURLtoBlob", "dataURL", "parts", "contentType", "raw", "uInt8Array", "gazetteer_exports", "__export", "datasets", "getLocation", "term", "gazetteer", "search", "dataset", "layer", "paramString", "response", "row", "addRow", "err", "listRow", "e", "loc", "location", "coord", "infoj", "getCurrentPosition_default", "callback", "options", "err", "hexa_default", "hex", "transparency", "jsonParser_default", "jsonParser", "sourceObjArray", "targetObjArray", "obj", "jsonObject", "propertyParser", "target", "source", "isObject", "key", "value", "excludeProperty", "assignValue", "entry", "constructor", "firstItem", "item", "keyvalue_dictionary", "obj", "keyvalue_dictionaryMap", "entry", "compositeKey", "parseObject", "dictionary", "key", "value", "isArrayObject", "replaceKeyValue", "item", "val", "loadDictionary", "languageCode", "languageData", "error", "loadPlugins", "plugins", "endsWith", "resolveAll", "promises", "plugin", "_this", "loadPlugin", "err", "resolve", "reject", "mod", "mergeDeep", "target", "sources", "source", "isObject", "key", "item", "widthInPx", "mobile", "setWidthInPx", "formatNumericValue", "params", "numericValue", "unformatStringValue", "stringValue", "parts", "decimalSeperator", "part", "thousandSeperator", "normalisedValue", "cleanedValue", "olStyle", "style", "feature", "Styles", "icon", "iconStyle", "fill", "stroke", "text", "scale", "paramString_default", "paramString", "params", "entry", "val", "ping", "params", "queryParams", "paramString", "pingQuery", "resolve", "reject", "pingPromise", "response", "polygonIntersectFeatures", "params", "getArrayDepth", "arr", "interaction", "e", "polyGeom", "features", "feature", "coordinates", "coord", "proj4", "addProjection", "params", "mod", "projection", "coord", "promiseAll_default", "promises", "resolveAll", "rejectAll", "error", "queryParams_default", "queryParams", "_this", "layer", "getTable", "bounds", "geom", "getGeom", "center", "template", "filter", "locale", "id", "qID", "email", "lat", "lng", "z", "viewport", "table", "promises", "scriptElement", "src", "type", "resolve", "reject", "scriptEl", "svgSymbols_exports", "__export", "circle", "diamond", "dot", "markerColor", "markerLetter", "semiCircle", "square", "target", "template", "triangle", "xmlSerializer", "memoizedIcons", "dot", "style", "lookup", "a", "b", "icon", "H", "target", "layer", "triangle", "x", "val", "scale", "y", "points", "square", "diamond", "s", "semiCircle", "markerLetter", "markerColor", "circle", "template", "svgString", "entry", "svgTemplates", "templates", "promises", "key", "response", "svgString", "DEFAULT_LOCALE", "toJSDate", "unixTimestamp", "dateString", "params", "DEFAULT_LOCALE", "timestamp", "date", "dateToUnixEpoch", "dateStr", "datetime", "temporal", "textFile", "params", "blob", "url", "a", "userIndexedDB_exports", "__export", "add", "get", "list", "openDB", "put", "remove", "params", "resolve", "reject", "IDBRequest", "event", "IDB", "addPromise", "getPromise", "locales", "locale", "updatePromise", "removePromise", "userLocale_exports", "__export", "get", "list", "putLocale", "remove", "locale", "mapview", "params", "workspace", "versionCheck", "value", "majorVersion", "minorVersion", "patchVersion", "majorValue", "minorValue", "patchValue", "verticeGeoms_default", "feature", "geometry", "coords", "depth", "getDepth", "arr", "requestMap", "xhr", "params", "resolve", "reject", "headers", "k", "v", "cached", "result", "debounce", "err", "debounceMap", "existing", "timeoutId", "simpleStatistics", "esmImport", "olScript", "areSetsEqual", "a", "b", "value", "utils_default", "compose", "convert_default", "copyToClipboard", "csvDownload", "csvUpload", "dataURLtoBlob", "formatNumericValue", "gazetteer_exports", "getCurrentPosition_default", "hexa_default", "z", "jsonParser_default", "keyvalue_dictionary", "loadDictionary", "loadPlugins", "mergeDeep", "mobile", "paramString_default", "ping", "polygonIntersectFeatures", "proj4", "promiseAll_default", "queryParams_default", "_", "scriptElement", "olStyle", "H", "svgSymbols_exports", "svgTemplates", "temporal", "textFile", "unformatStringValue", "userIndexedDB_exports", "userLocale_exports", "versionCheck", "verticeGeoms_default", "xhr", "hooks_default", "ol_current", "dictionaries", "dictionary", "layer_default", "location_default", "decorate", "plugins_default", "utils_default"]
}

(()=>{var Gt=Object.create;var D=Object.defineProperty;var qt=Object.getOwnPropertyDescriptor;var _t=Object.getOwnPropertyNames;var Nt=Object.getPrototypeOf,Rt=Object.prototype.hasOwnProperty;var H=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(t,o)=>(typeof require!="undefined"?require:t)[o]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var A=(e,t)=>{for(var o in t)D(e,o,{get:t[o],enumerable:!0})},Ut=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of _t(t))!Rt.call(e,r)&&r!==o&&D(e,r,{get:()=>t[r],enumerable:!(n=qt(t,r))||n.enumerable});return e};var W=(e,t,o)=>(o=e!=null?Gt(Nt(e)):{},Ut(t||!e||!e.__esModule?D(o,"default",{value:e,enumerable:!0}):o,e));var G=class extends Map{set(t,o){return super.set(t,o),o}},k=class extends WeakMap{set(t,o){return super.set(t,o),o}};var Zt=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Vt=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,Bt=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,Dt=/[\x01\x02]/g,ge=(e,t,o)=>{let n=0;return e.join("").trim().replace(Vt,(r,i,s,l)=>{let a=i+s.replace(Bt,"=$2$1").trimEnd();return l.length&&(a+=o||Zt.test(i)?" /":"></"+i),"<"+a+">"}).replace(Dt,r=>r===""?"<!--"+t+n+++"-->":t+n++)};var rn=1,sn=111,Ht=({firstChild:e,lastChild:t})=>{let o=document.createRange();return o.setStartAfter(e),o.setEndAfter(t),o.deleteContents(),e},ye=(e,t)=>e.nodeType===111?1/t<0?t?Ht(e):e.lastChild:t?e.valueOf():e.firstChild:e,be=e=>{let{firstChild:t,lastChild:o}=e;if(t===o)return o||e;let{childNodes:n}=e,r=[...n];return{ELEMENT_NODE:1,nodeType:111,firstChild:t,lastChild:o,valueOf(){return n.length!==r.length&&e.append(...r),e}}};var{isArray:K}=Array,{indexOf:Wt,slice:Kt}=[];var we=!1,q=class{constructor(t,o){we=!0,this._=(...n)=>t(...n,o)}},pn=(e,t)=>new q(e,t),xe=e=>t=>{for(let o in t){let n=o==="role"?o:`aria-${o}`,r=t[o];r==null?e.removeAttribute(n):e.setAttribute(n,r)}},J=e=>e==null?e:e.valueOf(),ve=(e,t)=>{let o,n=!0,r=document.createAttributeNS(null,t);return i=>{let s=we&&i instanceof q?i._(e,t):J(i);o!==s&&((o=s)==null?n||(e.removeAttributeNode(r),n=!0):(r.value=s,n&&(e.setAttributeNodeNS(r),n=!1)))}},ke=(e,t,o)=>n=>{let r=!!J(n);o!==r&&((o=r)?e.setAttribute(t,""):e.removeAttribute(t))},Jt=({dataset:e})=>t=>{for(let o in t){let n=t[o];n==null?delete e[o]:e[o]=n}},X=(e,t)=>{let o,n,r=t.slice(2);return!(t in e)&&(n=t.toLowerCase())in e&&(r=n.slice(2)),i=>{let s=K(i)?i:[i,!1];o!==s[0]&&(o&&e.removeEventListener(r,o,s[1]),(o=s[0])&&e.addEventListener(r,o,s[1]))}},Se=e=>{let t;return o=>{t!==o&&(t=o,typeof o=="function"?o(e):o.current=e)}},Ce=(e,t)=>t==="dataset"?Jt(e):o=>{e[t]=o},Ee=e=>{let t;return o=>{let n=J(o);t!=n&&(t=n,e.textContent=n??"")}};var Le=(e,t,o,n,r)=>{let i=o.length,s=t.length,l=i,a=0,p=0,u=null;for(;a<s||p<l;)if(s===a){let h=l<i?p?n(o[p-1],-0).nextSibling:n(o[l-p],0):r;for(;p<l;)e.insertBefore(n(o[p++],1),h)}else if(l===p)for(;a<s;)(!u||!u.has(t[a]))&&e.removeChild(n(t[a],-1)),a++;else if(t[a]===o[p])a++,p++;else if(t[s-1]===o[l-1])s--,l--;else if(t[a]===o[l-1]&&o[p]===t[s-1]){let h=n(t[--s],-1).nextSibling;e.insertBefore(n(o[p++],1),n(t[a++],-1).nextSibling),e.insertBefore(n(o[--l],1),h),t[s]=o[l]}else{if(!u){u=new Map;let h=p;for(;h<l;)u.set(o[h],h++)}if(u.has(t[a])){let h=u.get(t[a]);if(p<h&&h<l){let L=a,c=1;for(;++L<s&&L<l&&u.get(t[L])===h+c;)c++;if(c>h-p){let m=n(t[a],0);for(;p<h;)e.insertBefore(n(o[p++],1),m)}else e.replaceChild(n(o[p++],1),n(t[a++],-1))}else a++}else e.removeChild(n(t[a++],-1))}return o};var{isArray:M,prototype:Xt}=Array,{indexOf:Y}=Xt,{createDocumentFragment:Yt,createElement:Qt,createElementNS:eo,createTextNode:Q,createTreeWalker:ee,importNode:te}=new Proxy({},{get:(e,t)=>document[t].bind(document)}),to=e=>{let t=Qt("template");return t.innerHTML=e,t.content},_,oo=e=>{_||(_=eo("http://www.w3.org/2000/svg","svg")),_.innerHTML=e;let t=Yt();return t.append(..._.childNodes),t},$e=(e,t)=>t?oo(e):to(e);var no=({childNodes:e},t)=>e[t],T=(e,t,o)=>Le(e.parentNode,t,o,ye,e),ro=e=>{let t,o,n=[],r=i=>{switch(typeof i){case"string":case"number":case"boolean":t!==i&&(t=i,o||(o=Q("")),o.data=i,n=T(e,n,[o]));break;case"object":case"undefined":if(i==null){t!=i&&(t=i,n=T(e,n,[]));break}if(M(i)){t=i,i.length===0?n=T(e,n,[]):typeof i[0]=="object"?n=T(e,n,i):r(String(i));break}if(t!==i)if("ELEMENT_NODE"in i)t=i,n=T(e,n,i.nodeType===11?[...i.childNodes]:[i]);else{let s=i.valueOf();s!==i&&r(s)}break;case"function":r(i(e));break}};return r},io=(e,t)=>{switch(t[0]){case"?":return ke(e,t.slice(1),!1);case".":return Ce(e,t.slice(1));case"@":return X(e,"on"+t.slice(1));case"o":if(t[1]==="n")return X(e,t)}switch(t){case"ref":return Se(e);case"aria":return xe(e)}return ve(e,t)};function Me(e){let{type:t,path:o}=e,n=o.reduceRight(no,this);return t==="node"?ro(n):t==="attr"?io(n,e.name):Ee(n)}var oe=e=>{let t=[],{parentNode:o}=e;for(;o;)t.push(Y.call(o.childNodes,e)),e=o,{parentNode:o}=e;return t},j="is\xB5",Te=new k,so=/^(?:textarea|script|style|title|plaintext|xmp)$/,E=()=>({stack:[],entry:null,wire:null}),lo=(e,t)=>{let{content:o,updates:n}=co(e,t);return{type:e,template:t,content:o,updates:n,wire:null}},ao=(e,t)=>{let o=e==="svg",n=ge(t,j,o),r=$e(n,o),i=ee(r,129),s=[],l=t.length-1,a=0,p=`${j}${a}`;for(;a<l;){let u=i.nextNode();if(!u)throw`bad template: ${n}`;if(u.nodeType===8)u.data===p&&(s.push({type:"node",path:oe(u)}),p=`${j}${++a}`);else{for(;u.hasAttribute(p);)s.push({type:"attr",path:oe(u),name:u.getAttribute(p)}),u.removeAttribute(p),p=`${j}${++a}`;so.test(u.localName)&&u.textContent.trim()===`<!--${p}-->`&&(u.textContent="",s.push({type:"text",path:oe(u)}),p=`${j}${++a}`)}}return{content:r,nodes:s}},co=(e,t)=>{let{content:o,nodes:n}=Te.get(t)||Te.set(t,ao(e,t)),r=te(o,!0),i=n.map(Me,r);return{content:r,updates:i}},O=(e,{type:t,template:o,values:n})=>{let r=je(e,n),{entry:i}=e;(!i||i.template!==o||i.type!==t)&&(e.entry=i=lo(t,o));let{content:s,updates:l,wire:a}=i;for(let p=0;p<r;p++)l[p](n[p]);return a||(i.wire=be(s))},je=({stack:e},t)=>{let{length:o}=t;for(let n=0;n<o;n++){let r=t[n];r instanceof v?t[n]=O(e[n]||(e[n]=E()),r):M(r)?je(e[n]||(e[n]=E()),r):e[n]=null}return o<e.length&&e.splice(o),o},v=class{constructor(t,o,n){this.type=t,this.template=o,this.values=n}};var Oe=e=>{let t=new k,o=n=>(r,...i)=>O(n,{type:e,template:r,values:i});return Object.assign((n,...r)=>new v(e,n,r),{for(n,r){let i=t.get(n)||t.set(n,new G);return i.get(r)||i.set(r,o(E()))},node:(n,...r)=>O(E(),new v(e,n,r)).valueOf()})},Pe=new k,ne=(e,t)=>{let o=typeof t=="function"?t():t,n=Pe.get(e)||Pe.set(e,E()),r=o instanceof v?O(n,o):o;return r!==n.wire&&(n.wire=r,e.replaceChildren(r.valueOf())),e},re=Oe("html"),f=Oe("svg");function N(e,t=new WeakMap){if(e===null||typeof e!="object"||typeof e=="function"||e instanceof HTMLElement)return e;let o=Array.isArray(e)?[]:{};if(t.get(e))return t.get(e);t.set(e,o);for(let n in e)o[n]=N(e[n],t);return o}function ie(e,t={}){if(!Array.isArray(e)){console.warn("Array argument for csvDownload must be an array");return}let o=e.map(i=>Object.values(i).join(",")),n=new Blob([o.join(`\r
`)],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.download=`${t.title||"file"}.csv`,r.href=URL.createObjectURL(n),r.dataset.downloadurl=["csv",r.download,r.href].join(":"),r.style.display="none",document.body.append(r),r.click(),r.remove()}var se,Fe;async function po(){se||(se=new Promise(async e=>{import("https://cdn.skypack.dev/convert@4").then(t=>e(Fe=t.convert))})),await se}var Ie=async(e,t)=>(await po(),e=parseFloat(e),t.units&&t.convertTo&&(e=Fe(e,t.units).to(t.convertTo)),e=e.toFixed(t.decimals||0),e=e.toLocaleString(t.locale||"en-GB"),`${t.prefix||""}${e}${t.suffix||""}`);function ze(e){let t=document.body.appendChild(mapp.utils.html.node`
    <textarea style="visibility=none;">`);t.value=e,t.select(),document.execCommand("copy"),t.remove()}function Ae(e){if(e.indexOf(";base64,")==-1){let i=e.split(","),s=i[0].split(":")[1],l=i[1];return new Blob([l],{type:s})}let t=e.split(";base64,"),o=t[0].split(":")[1],n=window.atob(t[1]),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return new Blob([r],{type:o})}var Ge=(e,t)=>isNaN(t)?e:e.length===7?e+(t&&parseInt(t*255).toString(16)||"00"):e.length===4?e+parseInt(t*15).toString(16):e;var le={};A(le,{cluster:()=>mo,geojson:()=>uo,wkt:()=>fo});function qe(e){e.style?.theme?.field_stats&&(e.style.theme.updated=!0,e.style.theme.field_stats[e.style.theme.field]={values:[]})}function uo(e,t){let o=new ol.format.GeoJSON;return qe(e),t.map(n=>{let r=n.properties;return e.style?.theme?.field_stats&&e.style.theme.field_stats[e.style.theme.field].values.push(parseFloat(r[e.style.theme.field])),new ol.Feature({id:n.id,geometry:o.readGeometry(n.geometry,{dataProjection:"EPSG:"+e.srid,featureProjection:"EPSG:"+e.mapview.srid}),properties:r})})}function fo(e,t){let o=new ol.format.WKT;return qe(e),t.map(n=>{let r={};return e.params.fields?.forEach((i,s)=>{e.style?.theme?.field_stats?.[i]&&e.style?.theme?.field_stats?.[i].values.push(parseFloat(n[s+2])),r[i]=n[s+2]}),new ol.Feature({id:n.shift(),geometry:o.readGeometry(n.shift(),{dataProjection:"EPSG:"+e.srid,featureProjection:"EPSG:"+e.mapview.srid}),properties:r})})}function mo(e,t){return e.max_size=1,t.map((o,n)=>{let r=new ol.geom.Point(o.shift()),i=o.shift();e.max_size=e.max_size>i?e.max_size:i;let s=o.shift(),l={count:i};return e.params.fields.forEach((a,p)=>{l[a]=o[p]}),new ol.Feature({id:s,geometry:r,...l})})}var _e=e=>{if(!!Array.isArray(e))return new Promise(t=>{let o=e.map(n=>new Promise((r,i)=>import(n).then(s=>{r(s)}).catch(()=>{i()})));Promise.allSettled(o).then(()=>{t()}).catch(n=>{console.error(n),t()})})};function Ne(e,t={}){navigator.geolocation.getCurrentPosition(e,o=>console.error(o),t)}function P(e,...t){if(!t.length)return e;let o=t.shift();if(ae(e)&&ae(o)){let n=Object.getPrototypeOf(e);for(let r in o){if(n[r]){console.warn(`Prototype polution detected for key: ${r}`);continue}o[r]===null?e[r]=null:ae(o[r])?(e[r]??={},P(e[r],o[r])):e[r]=o[r]}}return P(e,...t)}function ae(e){if(e instanceof HTMLElement)return console.warn(e),!1;if(Array.isArray(e))return!1;if(typeof e=="object")return!0}var Re=e=>Object.entries(e).filter(t=>t[1]===0||!!t[1]).filter(t=>t[1]!=="{}").filter(t=>typeof t[1]!="object"||t[1].length||Object.values(t[1]).some(o=>typeof o=="object"&&Object.keys(o).length)).map(t=>(typeof t[1]=="object"&&!Array.isArray(t[1])&&(t[1]=JSON.stringify(t[1])),encodeURI(`${t[0]}=${t[1]}`))).join("&");var Ue=e=>new Promise((t,o)=>{Promise.all(e).then(t).catch(n=>{console.error(n),o(n)})});var Ze=e=>{if(typeof e.queryparams!="object"){console.warn("queryparams must be an object");return}e.queryparams.layer=e.queryparams.layer||e.viewport;let t=e.location?.layer?.tableCurrent()||e.layer?.tableCurrent(),o=e.queryparams.table===!0?t:e.queryparams.table;e.queryparams.table&&=o;let n=e.viewport&&e.layer.mapview.getBounds(),r=e.queryparams.center&&ol.proj.transform(e.layer.mapview.Map.getView().getCenter(),`EPSG:${e.layer.mapview.srid}`,"EPSG:4326");return{...e.queryparams,template:encodeURIComponent(e.query),filter:e.queryparams.filter?e.layer.filter?.current:void 0,locale:e.queryparams.layer?e.layer.mapview.locale.key:void 0,layer:e.queryparams.layer?e.layer.key:void 0,id:e.queryparams.id?e.location?.id:void 0,lat:r&&r[1],lng:r&&r[0],z:e.queryparams?.z&&e.layer.mapview.Map.getView().getZoom(),viewport:n&&[n.west,n.south,n.east,n.north,e.layer.mapview.srid],fieldValues:void 0}};var Ve=(e,t)=>{if(!e)return;let o=[];return e=Array.isArray(e)?e:[e],e.forEach(n=>{if(n.icon&&(n.icon=Array.isArray(n.icon)?n.icon:[n.icon],n.icon.forEach(r=>{let i=r.scale||n.scale||1;i*=n.clusterScale||1,i*=n.zoomInScale||1,i*=n.zoomOutScale||1,i*=n.highlightScale||1,r.url=r.url||r.svg||mapp.utils.svgSymbols[r.type||"dot"](r,t),r.url&&o.push(new ol.style.Style({image:new ol.style.Icon({src:r.url,crossOrigin:"anonymous",scale:i,anchor:r.anchor||[.5,.5]}),zIndex:n.zIndex}))})),n.fillColor||n.strokeColor){let r=n.fillColor&&new ol.style.Fill({color:mapp.utils.hexa(n.fillColor,n.fillOpacity)}),i=n.strokeColor&&new ol.style.Stroke({color:mapp.utils.hexa(n.strokeColor,n.strokeOpacity),width:parseFloat(n.strokeWidth||1)});o.push(new ol.style.Style({fill:r,stroke:i}))}if(typeof n.label?.text<"u"){let r=new ol.style.Text({font:n.label.font||"12px sans-serif",text:String(n.label.text),overflow:n.label.overflow,offsetY:n.label.offsetY,offsetX:n.label.offsetX,stroke:n.label.strokeColor&&new ol.style.Stroke({color:n.label.strokeColor,width:n.label.strokeWidth||1}),fill:new ol.style.Fill({color:n.label.fillColor||"#000"})});o.push(new ol.style.Style({text:r,zIndex:n.zIndex}))}}),t?.set?.("Styles",o,!0),o};var pe={};A(pe,{circle:()=>So,diamond:()=>wo,dot:()=>ho,markerColor:()=>ko,markerLetter:()=>vo,semiCircle:()=>xo,square:()=>bo,target:()=>go,template:()=>Co,triangle:()=>yo});var y=new XMLSerializer,ce={dot:new Map};function ho(e){let t=Object.values({fillColor:e.fillColor}).reduce((n,r)=>n+r);if(ce.dot.has(t))return ce.dot.get(t);let o=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 r=10 fill='#333'></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#fff"}></circle>`;return o=`data:image/svg+xml,${encodeURIComponent(y.serializeToString(o))}`,ce.dot.set(t,o),o}function go(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 fill='#333' r=10 opacity=0.4></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#FFF"}>`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(f.node`<circle cx=12 cy=12 r=${parseFloat(o[0])*10} fill=${o[1]}>`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(t))}`}function yo(e){let t=f.node`
    <svg width=24 height=24 viewBox='${"0 0 24 24"}' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        points="12,4.68 2,22 22,22" 
        fill="#333" stroke="#333" opacity=0.4 stroke-opacity=0.4 stroke-width=3
        stroke-linejoin="round"/>`;return t.appendChild(f.node`
    <polygon
      fill=${e.fillColor||"#FFF"} stroke=${e.fillColor||"#FFF"} stroke-width=2
      points="12,4.68 2,22 22,22"  stroke-linejoin="round"/>`),e.layers&&Object.entries(e.layers).forEach(o=>{function n(s,l){return 12+(s-12)*l}function r(s,l){return 16+(s-16)*l}let i=`${n(12,o[0])},${r(4.68,o[0])} ${n(2,o[0])}, ${r(22,o[0])} ${n(22,o[0])}, ${r(22,o[0])}`;t.appendChild(f.node`
      <polygon
        points="${i}"
        fill=${o[1]}
        stroke=${o[1]||"#FFF"}
        stroke-width=1
        stroke-linejoin="round"/>`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(t))}`}function bo(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <rect fill='#333' opacity=0.3 width=20 height=20 x=2 y=2 rx=1></rect>
      <rect fill=${e.fillColor||"#FFF"} width=20 height=20 x=0 y=0 rx=1></rect>`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(f.node`
      <rect fill=${o[1]}
        width=${parseFloat(o[0])*20}
        height=${parseFloat(o[0])*20}
        x=${10*(1-parseFloat(o[0]))}
        y=${10*(1-parseFloat(o[0]))} rx=${parseFloat(o[0])}></rect>`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(t))}`}function wo(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        fill='#333'
        opacity=0.3
        points="12 0, 24 12, 12 24, 0 12"></polygon>
      <polygon
        fill=${e.fillColor||"#FFF"}
        points="12 0, 24 12, 12 24, 0 12"></polygon>`;function o(n,r){return 12+(n-12)*r}return e.layers&&Object.entries(e.layers).forEach(n=>{let r=`${o(12,n[0])} ${o(0,n[0])},${o(24,n[0])} ${o(12,n[0])},${o(12,n[0])} ${o(24,n[0])}, ${o(0,n[0])} ${o(12,n[0])}`;t.appendChild(f.node`
      <polygon
        fill=${n[1]||"#FFF"}
        points="${r}"></polygon>`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(t))}`}function xo(e){let t=f.node`
    <svg width=30 height=30 viewBox='0 0 20 24' xmlns='http://www.w3.org/2000/svg'>
      <defs>
        <clipPath id="cut-off-shade">
          <rect x="0" y="0" width="24" height="11"/>
        </clipPath>
        <clipPath id="cut-off">
          <rect x="0" y="0" width="24" height="10"/>
        </clipPath>
      </defs>
      <circle cx="11" cy="10" r="10" clip-path="url(#cut-off-shade)" fill="#333" opacity=0.4></circle>
      <circle cx=10 cy=10 r=10 fill=${e.fillColor||"#FFF"} clip-path="url(#cut-off-shade)">`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(f.node`
      <circle cx=10 cy=10 r=${parseFloat(o[0])*10} fill=${o[1]} clip-path="url(#cut-off-shade)">`)}),`data:image/svg+xml,${encodeURIComponent(y.serializeToString(t))}`}function vo(e){let t=f.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path fill="${e.color}"
        d="M 12 1.969 C 7.878 1.969 4.813 5.239 4.813 9.328 C 4.813 10.554 5.222 12.189 6.244 14.028 C 8.289 17.504 12 22 12 22 C 12 22 16.055 17.504 18.099 14.028 C 19.122 12.189 19.341 10.963 19.341 9.328 C 19.341 5.239 16.054 1.969 12 1.969 Z"/>
      <circle cx="12.17192400568182" cy="8.918683238636365" r="5.109789772727275" fill="rgb(255, 255, 255)"/>
      <text x="12" y="12" style="text-anchor: middle; font-weight: 600; font-size: 9px; font-family: sans-serif; fill: rgb(85, 85, 85);">
      ${e.letter}`;return`data:image/svg+xml,${encodeURIComponent(y.serializeToString(t))}`}function ko(e){let t=f.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path style="opacity: 0.5;" fill="${e.colorMarker}"
        d="M 10.797 1.238 C 6.308 1.238 2.716 4.83 2.716 9.32 C 2.716 11.116 3.165 12.463 4.287 14.483 C 6.532 18.3 9.952 23.234 9.952 23.234 C 9.952 23.234 15.063 18.3 17.308 14.483 C 18.43 12.463 18.879 11.116 18.879 9.32 C 18.879 4.83 15.287 1.238 10.797 1.238 Z"/>
      <path fill="${e.colorMarker}"
        d="M 10 1.238 C 5.51 1.238 2.144 4.83 2.144 9.32 C 2.144 10.667 2.593 12.463 3.716 14.483 C 5.961 18.3 10 23.238 10 23.238 C 10 23.238 14.491 18.3 16.736 14.483 C 17.859 12.463 18.1 11.116 18.1 9.32 C 18.1 4.83 14.49 1.238 10 1.238 Z"/>
      <circle cx="10.226" cy="8.871" r="5.612" opacity="0.8" fill="rgb(255, 255, 255)"/>
      <circle cx="10.226" cy="8.871" r="2.806" opacity="0.8" fill="${e.colorDot}"/>`;return`data:image/svg+xml,${encodeURIComponent(y.serializeToString(t))}`}function So(e){let t=f.node`
    <svg width=24 height=24 viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=16 cy=16 r=10
        stroke="${e.strokeColor||"#333"}"
        stroke-width="${e.strokeWidth||1}"
        fill="#ffffff33">`;return`data:image/svg+xml,${encodeURIComponent(y.serializeToString(t))}`}function Co(e){let t=mapp.utils.svgSymbols.templates?.[e.template];if(!!t)return typeof e.substitute=="object"&&Object.entries(e.substitute).forEach(o=>{t=t.replaceAll(o[0],o[1])}),`data:image/svg+xml,${encodeURIComponent(t)}`}var ue={};A(ue,{datasets:()=>Eo,getLocation:()=>Lo});function Eo(e,t){t.provider||t.qterm&&o(t),t.datasets?.forEach(o);function o(n){let r=t.mapview.layers[t.layer||n.layer];if(!r){console.warn("No layer definition for gazetteer search.");return}if(!r.table&&!n.table&&!t.table){console.warn("No table definition for gazetteer search.");return}n.xhr?.abort(),n.xhr=new XMLHttpRequest,n.xhr.open("GET",t.mapview.host+"/api/query/gaz_query?"+mapp.utils.paramString({label:n.qterm,qterm:n.qterm,qID:r.qID,locale:t.mapview.locale.key,layer:r.key,filter:r.filter?.current,table:n.table||t.table||r.table,wildcard:"*",term:`${n.leading_wildcard?"*":""}${e}*`,limit:n.limit||t.limit||10})),n.xhr.setRequestHeader("Content-Type","application/json"),n.xhr.responseType="json",n.xhr.onload=i=>{if(!!t.input.value.length&&!(i.target.status>=300)){if(!i.target.response){t.list.append(mapp.utils.html.node`
                    <li>
                        <span class="label">${n.title||r.name}</span>
                        <span>${mapp.dictionary.no_results}</span>`);return}[i.target.response].flat().forEach(s=>{t.list.append(mapp.utils.html.node`
                    <li
                        onclick=${l=>{if(t.callback)return t.callback(s,t);mapp.location.get({layer:r,id:s.id}).then(a=>a&&a.flyTo(t.maxZoom||n.maxZoom))}}>
                        <span class="label">${n.title||r.name}</span>
                        <span>${s.label}</span>`)})}},n.xhr.send()}}function Lo(e,t){if(typeof t.callback=="function"){t.callback(e);return}Object.assign(e,{layer:{mapview:t.mapview},Layers:[],hook:e.label});let o=[{title:e.label,value:e.source,inline:!0},{type:"pin",value:[e.lng,e.lat],srid:"4326",class:"display-none",location:e}];t.streetview&&t.streetview.key&&o.push({type:"streetview",key:t.streetview.key,location:e}),mapp.location.decorate(Object.assign(e,{infoj:o})),t.mapview.locations[e.hook]=e,e.flyTo(t.maxZoom)}var De=e=>{let t=e.getGeometry();if(t.getType()==="Point")return new ol.geom.Point(t.getCoordinates());let o=t.getCoordinates(),n=Be(o);return n===2?new ol.geom.MultiPoint(o):(o=n>3?o.flat(2):o[0],new ol.geom.MultiPoint(o))};function Be(e){return Array.isArray(e)?1+Math.max(0,...e.map(Be)):0}var fe=new Map,He=e=>new Promise((t,o)=>{if(!e)return o();if(e=typeof e=="string"?{url:e}:e,e.cache&&fe.has(e))return t(fe.get(e));let n=new XMLHttpRequest;if(n.open(e.method||"GET",e.url),e.requestHeader!==null){let r={"Content-Type":"application/json"};Object.assign(r,e.requestHeader||{}),Object.entries(r).forEach(i=>n.setRequestHeader(...i))}n.responseType=e.responseType||"json",n.onload=r=>{if(r.target.status>=400){o(new Error(r.target.status));return}e.cache&&fe.set(e,r.target.response),t(e.resolveTarget?r.target:r.target.response)},n.send(e.body)});var $o=(e,t)=>e.size===t.size&&[...e].every(o=>t.has(o)),Mo=(...e)=>t=>e.reduce((o,n)=>n(o),t),To=async()=>await new Promise(async e=>{let t=document.createElement("script");t.type="application/javascript",t.src="https://cdn.jsdelivr.net/npm/ol@v8.1.0/dist/ol.js",t.onload=e,document.head.append(t),console.warn("Openlayers library loaded from script tag.")}),We={render:ne,html:re,svg:f,convert:Ie,areSetsEqual:$o,clone:N,compose:Mo,copyToClipboard:ze,csvDownload:ie,dataURLtoBlob:Ae,featureFormats:le,gazetteer:ue,getCurrentPosition:Ne,hexa:Ge,loadPlugins:_e,merge:P,olScript:To,paramString:Re,promiseAll:Ue,queryParams:Ze,style:Ve,svgSymbols:pe,verticeGeoms:De,xhr:He};var d={current:{layers:[],locations:[]},set:Oo,parse:jo,remove:Ke,removeAll:Po,push:Fo,filter:Io},R=d;function jo(){let e=new URL(window.location.href);for(let[t,o]of e.searchParams.entries()){if(o==="false"){d.current[t]=!1;continue}if(o==="true"){d.current[t]=!0;continue}if(t==="locations"||t==="layers"){d.current[t]=decodeURIComponent(o).split(",");continue}d.current[t]=o.includes(",")?decodeURIComponent(o).split(","):o}d.current.token&&(e.searchParams.delete("token"),window.history.replaceState({},document.title,e.toString()),delete d.current.token)}function Oo(e){Object.assign(d.current,e),F()}function Ke(e){Array.isArray(d.current[e])?d.current[e].length=0:delete d.current[e],F()}function Po(){Object.keys(d.current).forEach(e=>Ke(e)),F()}function Fo(e,t){d.current[e]?d.current[e].indexOf(t)<0&&d.current[e].push(t):d.current[e]=[t],F()}function Io(e,t){d.current[e]=d.current[e].filter(o=>o!==t),F()}function F(){try{window.history.pushState({},document.title,`?${mapp.utils.paramString(d.current)}`)}catch(e){console.log(e)}}var Je={save:"Save",cancel:"Cancel",confirm_delete:"Are you sure you want to delete this feature? This cannot be undone.",invalid_geometry:"Invalid geometry",no_results:"No results for this search"};var Xe={save:"Speichern",cancel:"Abbrechen",invalid_geometry:"Ung\xFCltige Geometrie",confirm_delete:"Best\xE4tigung des L\xF6schvorgang"};var Ye={save:"Enregister",cancel:"Annuler",no_results:"Aucun resultat pour cette recherche"};var Qe={save:"Zapisz",cancel:"Anuluj",no_results:"Nic nie znaleziono"};var et={save:"\u4FDD\u5B58",cancel:"\u30AD\u30E3\u30F3\u30BB\u30EB",no_results:"\u7D50\u679C\u306A\u3057"};var tt={save:"\uC800\uC7A5",cancel:"\uCDE8\uC18C",no_results:"\uAC80\uC0C9\uACB0\uACFC \uC5C6\uC74C"};var ot={save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",no_results:"\u672A\u627E\u5230\u76F8\u5173\u5730\u70B9"};var nt={en:Je,de:Xe,fr:Ye,pl:Qe,ja:et,ko:tt,zh:ot};var rt=async e=>{if(await mapp.layer.formats[e.format](e),Object.assign(e,{show:zo,showCallbacks:[],hide:Ao,hideCallbacks:[],tableCurrent:Go,tableMax:qo,tableMin:_o,zoomToExtent:No}),e.edit&&(console.warn(`Layer: ${e.key}, please update edit:{} to use draw:{} as layer.edit has been superseeded with layer.draw to be in line with the OL drawing interaction.`),e.draw=Object.assign(e.draw||{},e.edit)),e.draw??={},e.draw?.delete&&console.warn(`Layer: ${e.key}, please move draw.delete to use layer.deleteLocation:true.`),e.draw.callback=async(t,o)=>{if(!t)return;let n={layer:e,table:e.tableCurrent(),new:!0};n.id=await mapp.utils.xhr({method:"POST",url:`${e.mapview.host}/api/location/new?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:n.table}),body:JSON.stringify(Object.assign({[e.geom]:t.geometry},o?.defaults||{},e.draw?.defaults||{}))}),mapp.location.get(n)},e.filter=Object.assign({current:{}},e.filter),e.L.setOpacity(e.style?.opacity||1),e.style?.hovers&&e.style?.hover&&(console.warn(`Layer: ${e.key}, cannot use both layer.style.hover and layer.style.hovers. Layer.style.hover has been deleted.`),delete e.style.hover),e.style?.labels&&e.style?.label&&(console.warn(`Layer: ${e.key}, cannot use both layer.style.label and layer.style.labels. Layer.style.label has been deleted.`),delete e.style.label),e.style?.themes&&(e.style.theme=typeof e.style.theme=="object"?e.style.theme:e.style.themes[e.style.theme||Object.keys(e.style.themes)[0]]),e.style?.theme?.setLabel&&e.style?.labels&&(e.style.label=e.style.labels[e.style.theme.setLabel]),e.hover&&(console.warn(`Layer: ${e.key}, layer.hover{} should be defined within layer.style{}.`),e.style.hover=e.hover,delete e.hover),e.style?.theme?.setHover&&e.style?.hovers&&(e.style.hover=e.style.hovers[e.style.theme.setHover]),e.style?.hovers&&(e.style.hover=typeof e.style.hover=="object"?e.style.hover:e.style.hovers[e.style.hover||Object.keys(e.style.hovers)[0]]),e.style?.hover&&(e.style.hover.method??=mapp.layer.featureHover),e.style?.labels&&(e.style.label=typeof e.style.label=="object"?e.style.label:e.style.labels[e.style.label||Object.keys(e.style.labels)[0]]),Array.isArray(mapp.user?.roles)){for(let t in e.roles||{})if(e.roles[t]!==null&&typeof e.roles[t]=="object"){let o=t.match(/(?<=^!)(.*)/g)?.[0];(mapp.user.roles.includes(t)||o&&!mapp.user.roles.includes(o))&&mapp.utils.merge(e,e.roles[t])}e.infoj?.filter(t=>typeof t.roles=="object").forEach(t=>{for(let o in t.roles)if(typeof t.roles[o]=="object"){let n=o.match(/(?<=^!)(.*)/g)?.[0];(mapp.user.roles.includes(o)||n&&!mapp.user.roles.includes(n))&&mapp.utils.merge(t,t.roles[o])}})}return Object.keys(e).forEach(t=>{mapp.layer[t]?.(e),mapp.plugins[t]?.(e)}),e};function zo(){this.display=!0;try{this.mapview.Map.addLayer(this.L)}catch{}this.reload instanceof Function&&this.reload(),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.push("layers",this.key),this.showCallbacks?.forEach(e=>e instanceof Function&&e(this))}function Ao(){this.display=!1,this.mapview.Map.removeLayer(this.L),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.filter("layers",this.key),this.hideCallbacks?.forEach(e=>e instanceof Function&&e(this))}function Go(){if(!this.tables)return this.table;let e,t=parseInt(this.mapview.Map.getView().getZoom()),o=Object.keys(this.tables),n=parseInt(o[0]),r=parseInt(o[o.length-1]);return e=this.tables[t],e=t<n?this.tables[n]:e,e=t>r?this.tables[r]:e,e}function qo(){return this.tables?Object.values(this.tables).reverse().find(e=>!!e):this.table}function _o(){return this.tables?Object.values(this.tables).find(e=>!!e):this.table}async function No(e){let t=await mapp.utils.xhr(`${this.mapview.host}/api/query/layer_extent?`+mapp.utils.paramString({dbs:this.dbs,locale:this.mapview.locale.key,layer:this.key,table:this.table||Object.values(this.tables)[0]||Object.values(this.tables)[1],geom:this.geom,proj:this.srid,srid:this.mapview.srid,filter:this.filter.current}));if(!t)return!1;let o=/\((.*?)\)/.exec(t.box2d)[1].replace(/ /g,",");return this.mapview.fitView(o.split(",").map(n=>parseFloat(n)),e),!0}var de,U=null;async function Ro(){return U?new U.Map(...arguments):(de||(de=new Promise(async e=>{console.warn("The mbtiles layer format uses an outdated version of the maplibre-gl library. Please change the format to maplibre"),Promise.all([import("https://cdn.skypack.dev/pin/maplibre-gl@v1.15.3-OFxGDsJNZ70P0Qa7CzNE/mode=imports,min/optimized/maplibre-gl.js")]).then(t=>{U=t[0],e()}).catch(t=>{console.error(t.message),alert("Failed to load MaplibreGL library. Please reload the browser.")})})),await de,new U.Map(...arguments))}var it=async e=>{e.container=mapp.utils.html.node`<div 
    class="mbtiles" 
    style="visibility: hidden; position: absolute; width: 100%; height: 100%;">`,e.mapview.Map.getTargetElement().prepend(e.container),e.Map=await Ro({container:e.container,style:e.mbStyle,accessToken:e.accessToken,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1,preserveDrawingBuffer:e.preserveDrawingBuffer}),e.L=new ol.layer.Layer({zIndex:e.zIndex||0,render:t=>{if(!!e.display)return e.container.style.visibility="visible",e.Map.jumpTo({center:ol.proj.toLonLat(t.viewState.center),zoom:t.viewState.zoom-1,bearing:-t.viewState.rotation*180/Math.PI,animate:!1}),e.container}}),e.mapview.Map.getTargetElement().addEventListener("resize",()=>e.Map.resize())};var me,S=null;async function Uo(){return S?new S.Map(...arguments):(me||(me=new Promise(async e=>{if(window.maplibregl){S=window.maplibregl,e();return}Promise.all([import("https://cdn.skypack.dev/pin/maplibre-gl@v3.3.1-tpQnCWSKVKnsrj9mKNGz/mode=imports,min/optimized/maplibre-gl.js")]).then(t=>{S=t[0],["deferred","loaded"].includes(S.getRTLTextPluginStatus())||S.setRTLTextPlugin("https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js",null,!0),e()}).catch(t=>{console.error(t.message),alert("Failed to load MaplibreGL library. Please reload the browser.")})})),await me,new S.Map(...arguments))}var lt=async e=>{e.container=mapp.utils.html.node`<div 
    class="maplibre" 
    style="visibility: hidden; position: absolute; width: 100%; height: 100%;">`,e.mapview.Map.getTargetElement().prepend(e.container),e.Map=await Uo({container:e.container,pixelRatio:1,style:e.style.URL,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1,preserveDrawingBuffer:e.preserveDrawingBuffer,transformRequest:(t,o)=>t.indexOf("mapbox:")===0?Zo(t,o,e.accessToken):{url:t}}),e.mapview.Map.getTargetElement().addEventListener("resize",()=>e.Map.resize()),e.L=new ol.layer.Layer({zIndex:e.zIndex||0,render:t=>{if(!!e.display)return e.container.style.visibility="visible",e.Map.jumpTo({center:ol.proj.toLonLat(t.viewState.center),zoom:t.viewState.zoom-1,bearing:-t.viewState.rotation*180/Math.PI,animate:!1}),e.container}})};function Zo(e,t,o){if(e.indexOf("/styles/")>-1&&e.indexOf("/sprite")===-1)return{url:Vo(e,o)};if(e.indexOf("/sprites/")>-1)return{url:Do(e,o)};if(e.indexOf("/fonts/")>-1)return{url:Bo(e,o)};if(e.indexOf("/v4/")>-1)return{url:st(e,o)};if(t==="Source")return{url:st(e,o)}}function I(e){let t=e.match(/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Z(e,t){let o=I("https://api.mapbox.com");e.protocol=o.protocol,e.authority=o.authority,e.params.push(`access_token=${t}`);let n=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${n}`}function Vo(e,t){let o=I(e);return o.path=`/styles/v1${o.path}`,Z(o,t)}function Bo(e,t){let o=I(e);return o.path=`/fonts/v1${o.path}`,Z(o,t)}function st(e,t){let o=I(e);return o.path=`/v4/${o.authority}.json`,o.params.push("secure"),Z(o,t)}function Do(e,t){let o=I(e),n=o.path.split(".");return o.path=`/styles/v1${n[0]}/sprite.${n[1]}`,Z(o,t)}var at=e=>{e.L=new ol.layer.Tile({source:new ol.source.OSM({url:decodeURIComponent(e.URI),opaque:!1,transition:0}),layer:e,zIndex:e.style?.zIndex||0})};var ct=e=>{e.srid??="3857",e.style??={},e.reload=()=>{e.source.refresh(),e.tilesLoaded=[],e.featureSource.refresh()},e.clones=new Set,e.featureSource=new ol.source.VectorTile({format:new ol.format.MVT({featureClass:ol.Feature}),transition:0,cacheSize:0,tileUrlFunction:t}),e.source=new ol.source.VectorTile({format:new ol.format.MVT,transition:0,cacheSize:0,tileUrlFunction:t});function t(o){let n=e.tableCurrent();return(!n||!e.display)&&!e.clones?.size?e.source.clear():`${e.mapview.host}/api/layer/mvt/${o[0]}/${o[1]}/${o[2]}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,srid:e.mapview.srid,table:n,filter:e.filter?.current})}e.L=new ol.layer.VectorTile({key:e.key,source:e.source,renderBuffer:200,zIndex:e.style?.zIndex||1,style:mapp.layer.Style(e)})};var z=e=>{e.srid??="3857",e.properties&&console.warn(`Layer: ${e.key}, layer.properties{} are no longer required for wkt & geojson datasets.`),e.params??={},Ho(e),e.style??={},e.setSource=t=>{if(t===null){e.L.setSource(null);return}if(!!t){if(e.source=new ol.source.Vector({features:mapp.utils.featureFormats[e.format](e,[t].flat())}),delete e.xhr,e.fade&&mapp.layer.fade(e),e.cluster?.distance){e.cluster.source=new ol.source.Cluster({distance:e.cluster.distance,source:e.source}),e.L.setSource(e.cluster.source);return}e.L.setSource(e.source)}},e.reload=()=>{if(e.features)return;let t=e.tableCurrent();if(!t)return;e.fade&&mapp.layer.fade(e,!0),e.params.fields=[...new Set([e.style.theme?.field,e.style.label?.field,e.cluster?.label].flat().filter(n=>!!n))];let o=e.mapview.getBounds();e.params.viewport&&=[o.west,o.south,o.east,o.north,e.mapview.srid],e.params.z&&=e.mapview.Map.getView().getZoom(),clearTimeout(e.timeout),e.timeout=setTimeout(()=>{e.xhr=mapp.utils.xhr(`${e.mapview.host}/api/query?${mapp.utils.paramString({template:e.params.template||e.format,locale:e.mapview.locale.key,layer:e.key,table:t,srid:e.srid,filter:e.filter?.current,...e.params})}`).then(e.setSource)},100)},e.L=new ol.layer[e.vectorImage&&"VectorImage"||"Vector"]({key:e.key,zIndex:e.zIndex||1,style:e.styleFunction||mapp.layer.Style(e)}),e.setSource(e.features),(e.tables||e.params.viewport)&&e.mapview.Map.getTargetElement().addEventListener("changeEnd",()=>{if(!e.tableCurrent()){e.L.setSource(null);return}!e.display||(clearTimeout(e.timeout),e.timeout=setTimeout(e.reload,100))}),e.cluster?.distance&&e.L.on("change",t=>{if(!e.cluster.source)return;delete e.max_size;let o=e.cluster.source.getFeatures().map(n=>{let r=n.get("features");if(n.set("id",r[0].get("id"),!0),r.length>1)n.set("count",r.length,!0);else{let i=r[0].getProperties();Object.entries(i.properties||{}).forEach(s=>{n.set(s[0],s[1],!0)})}return r.length});!o.length||(e.max_size=Math.max(...o))})};function Ho(e){if(typeof e.cluster=="object"){if(e.cluster.distance&&e.cluster.resolution){console.warn(`Layer: ${e.key}, cluster.distance and cluster.resolution are mutually exclusive. You cannot use them both on the same layer. Please remove one of them. `);return}if(!e.cluster.distance&&!e.cluster.resolution){console.warn(`Layer: ${e.key}, cluster.distance or cluster.resolution must be set.`);return}if(e.cluster.resolution){if(typeof e.cluster.resolution=="number")e.params.resolution=parseFloat(e.cluster.resolution);else{console.warn(`Layer: ${e.key}, cluster.resolution must be a number.`);return}if(e.srid==="4326"){console.warn(`Layer: ${e.key}, srid 4326 is not allowed for cluster.resolution layers.`);return}e.params.viewport=!0,e.params.z=!0,e.format="cluster",e.params.template??=e.cluster.hexgrid?"cluster_hex":"cluster"}}}var pt={mbtiles:it,maplibre:lt,tiles:at,mvt:ct,cluster:z,geojson:z,wkt:z,vector:z};function V(e,t){if(!e?.fade)return;clearTimeout(e.fade);let o=e.L.getOpacity(),n;if(t){if(o<=0)return;n=Math.max(o-.2,0)}else{if(o>=1)return;n=Math.min(o+.2,1)}let r=100,i=Date.now(),s=()=>{let a=Date.now()-i;if(a<r){let p=a/r,u=o+(n-o)*p;e.L.setOpacity(u),requestAnimationFrame(s)}else e.L.setOpacity(n)};s(),e.fade=setTimeout(()=>V(e,t),r)}function ut(e,t){if(!t.style.hover.display)return;let o=t.mapview.interaction?.current?.key?.toString();if(!o)return;let n=mapp.utils.paramString({dbs:t.dbs,locale:t.mapview.locale.key,layer:t.key,filter:e.properties.count>1&&t.filter?.current,template:t.style.hover.query||"infotip",qID:t.qID,id:e.properties.id,table:t.tableCurrent(),geom:t.geom,field:t.style.hover.field,coords:e.properties.count>1&&ol.proj.transform(e.getGeometry().getCoordinates(),`EPSG:${t.mapview.srid}`,`EPSG:${t.srid}`)});mapp.utils.xhr(`${t.mapview.host}/api/query?${n}`).then(r=>{if(!!r){if(typeof t.style.hover.render=="function"){let i=t.style.hover.render(r);t.mapview.infotip(i);return}r.label!=""&&t.mapview.interaction?.current?.key===o&&t.mapview.infotip(r.label)}})}var ft={ni:Wo};function dt(e,t){return Object.keys(e).some(o=>{let n=Object.keys(e[o])[0];return ft[n]&&ft[n](o,e[o][n],t)})}function Wo(e,t,o){return new Set(t).has(o.properties[e])}var mt=e=>{return e.style.default??={strokeColor:"#333",fillColor:"#fff1",icon:{type:"dot"}},function(i){let s=i.get("Styles");if(s)return s;if(i.properties=i.getProperties(),i.properties.properties&&(Object.assign(i.properties,i.properties.properties),delete i.properties.properties),(e.style.filter||e.style.theme?.filter)&&e.filter.current&&Object.keys(e.filter.current).length&&mapp.layer.featureFilter(e.filter.current,i))return null;if(i.style={...mapp.utils.clone(e.style.default),...e.style.theme?.style},Array.isArray(e.featureLookup)){let l=e.featureLookup.find(a=>a[e.featureLookupId||"id"]===i.properties.id);if(!l)return;Object.assign(i.properties,l)}if(i.geometryType??=i.getGeometry().getType(),i.geometryType==="Point"&&(i.style.icon??=mapp.utils.clone(i.style),i.properties.count>1&&e.style.cluster&&Object.assign(i.style,e.style.cluster)),mapp.layer.themes[e.style.theme?.type]?.(e.style.theme,i),t(i),o(i),n(i),e.mapview?.locations[`${e.key}!${i.properties.id}`]){if(e.style.selected===null)return;e.style.selected&&mapp.utils.merge(i.style,e.style.selected,{zIndex:1/0})}return mapp.utils.style(i.style,i)};function t(r){r.geometryType==="Point"&&(r.style.clusterScale&&(r.style.clusterScale=e.style.logScale?Math.log(r.style.clusterScale)/Math.log(e.max_size)*Math.log(r.properties.size||r.properties.count):1+r.style.clusterScale/e.max_size*(r.properties.size||r.properties.count)),r.style.zoomInScale&&(r.style.zoomInScale*=e.mapview.Map.getView().getZoom()),r.style.zoomOutScale&&(r.style.zoomOutScale/=e.mapview.Map.getView().getZoom()))}function o(r){if(!!e.style.highlight&&!!e.highlight&&e.highlight===(r.get("id")||r.getId())){if(r.geometryType!=="Point"){mapp.utils.merge(r.style,e.style.highlight);return}r.style.zIndex=1/0,e.style.highlight.icon&&(r.style.icon=Array.isArray(e.style.highlight.icon)?e.highlight.icon:Object.assign(r.style.icon,e.style.highlight.icon)),r.style.highlightScale=e.style.highlight.scale}}function n(r){!e.style.label?.display||(mapp.utils.merge(r.style,{label:e.style.label}),r.style.label.text=r.style.label.count&&r.properties.count>1&&r.properties.count||void 0,typeof r.style.label.text>"u"&&(r.style.label.text=r.properties[r.style.label.field]),typeof r.style.label.text>"u"&&(r.style.label.text=r.properties.label),r.style.label?.minZoom>e.mapview.Map.getView().getZoom()&&delete r.style.label,r.style.label?.maxZoom<e.mapview.Map.getView().getZoom()&&delete r.style.label)}};function ht(e,t){if(t.style?.icon?.clusterScale)return;let o=t.properties.cat||t.properties[e.field],n=e.cat[encodeURIComponent(o)]?.style||e.cat[o]?.style||e.cat[encodeURIComponent(o)]||e.cat[o];if(!(typeof n>"u")){if(t.geometryType==="Point"){t.style.icon=n.icon||Object.assign(t.style.icon,n),delete t.style.icon.url;return}mapp.utils.merge(t.style,n)}}function gt(e,t){if(e.lookup||(e.lookup={},e.boxes=[],e.index=0),e.lookup[t.properties[e.field]]){var s=e.lookup[t.properties[e.field]];mapp.utils.merge(t.style,s);return}let o={extent:t.getGeometry().getExtent()},n=e.boxes.filter(l=>!(o.extent[0]>l.extent[2]||o.extent[2]<l.extent[0]||o.extent[1]>l.extent[3]||o.extent[3]<l.extent[1]));e.boxes.push(o);let r=new Set(n.map(l=>l.themeIdx));e.index++,e.index===e.cat_arr.length&&(e.index=0);let i=!r.has(e.index)&&parseInt(e.index);if(i===!1){for(let l=0;l<e.cat_arr.length;l++)if(!r.has(l)){i=l;break}}i===!1&&(i=parseInt(e.index)),o.themeIdx=i;var s=e.cat_arr[i];e.lookup[t.properties[e.field]]=s,mapp.utils.merge(t.style,s)}function yt(e,t){if(!t.style?.icon?.clusterScale){var o=Array.isArray(t.properties.features)?t.properties.features.reduce((r,i)=>r+Number(i.getProperties().properties[e.field]),0):parseFloat(t.properties.cat||t.properties[e.field]);if(!isNaN(o)){for(let r=0;r<e.cat_arr.length&&!(o<parseFloat(e.cat_arr[r].value));r++){var n=mapp.utils.clone(e.cat_arr[r].style||e.cat_arr[r]);delete n.label}if(typeof n>"u")return;if(t.geometryType==="Point"){t.style.icon=n.icon||Object.assign(t.style.icon,n),delete t.style.icon.url;return}mapp.utils.merge(t.style,n)}}}var bt={decorate:rt,formats:pt,featureHover:ut,featureFilter:dt,fade:V,Style:mt,themes:{categorized:ht,distributed:gt,graduated:yt}};var wt=e=>(Object.assign(e,{flyTo:Xo,Layers:[],remove:Ko,removeCallbacks:[],trash:Qo,update:Jo,mvt_cache:Yo,updateCallbacks:[]}),e);function Ko(){delete this.remove,this.layer.mapview.hooks&&mapp.hooks.filter("locations",this.hook),delete this.layer.mapview.locations[this.hook],this.view instanceof HTMLElement&&this.view.remove(),this.Layers?.forEach(e=>this.layer.mapview.Map.removeLayer(e)),this.layer.mapview.interaction.type!=="highlight"&&this.layer.mapview.interactions.highlight(),this.layer.reload&&this.layer.reload(),this.removeCallbacks?.forEach(e=>typeof e=="function"&&e(this))}async function Jo(){let e=Object.fromEntries(this.infoj.filter(o=>typeof o.newValue<"u").map(o=>[o.field,o.newValue]));if(!Object.keys(e).length)return;await this.mvt_cache(),await mapp.utils.xhr({method:"POST",url:`${this.layer.mapview.host}/api/location/update?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id}),body:JSON.stringify(e)}),await this.mvt_cache();let t=this.infoj.filter(o=>typeof o.newValue<"u").filter(o=>o.dependents&&o.dependents.length).map(o=>o.dependents).flat();if(this.infoj.filter(o=>typeof o.newValue<"u").forEach(o=>{o.value=o.newValue,delete o.newValue}),t.length){let o=await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id,fields:[...new Set(t)].join()}));this.infoj.filter(n=>typeof o[n.field]<"u").forEach(n=>{n.value=o[n.field]})}this.layer.reload(),this.updateCallbacks?.forEach(o=>typeof o=="function"&&o(this))}function Xo(e){let t=new ol.source.Vector;this.Layers.forEach(o=>{let n=o.getSource();typeof n.getFeatures=="function"&&t.addFeatures(n.getFeatures())}),this.layer.mapview.fitView(t.getExtent(),{maxZoom:e})}async function Yo(){!this.layer?.mvt_cache||await mapp.utils.xhr(`${this.layer.mapview.host}/api/query?`+mapp.utils.paramString({template:"mvt_cache_delete_intersects",locale:this.layer.mapview.locale.key,layer:this.layer.key,mvt_cache:this.layer.mvt_cache,table:this.table,qID:this.layer.qID,id:this.id,geom:this.layer.geom}))}async function Qo(){!confirm(mapp.dictionary.confirm_delete)||(await this.mvt_cache(),await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/delete?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id})),this.remove())}async function xt(e,t=e.layer.mapview.locations){if(e.layer.mapview.interaction?.getLocation instanceof Function){e.layer.mapview.interaction?.getLocation(e);return}if(!e.layer||!e.id||(e.hook=`${e.layer.key}!${e.id}`,e.layer.mapview.interaction?.locations?.has(e.hook)))return;if(e.layer.mapview.interaction?.locations?.add(e.hook),t[e.hook]){t[e.hook].remove(),delete t[e.hook],e.layer.mapview.interaction?.locations?.delete(e.hook);return}e.table??=e.layer.table||Object.values(e.layer.tables).find(r=>typeof r=="string");let o=await mapp.utils.xhr(`${e.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:e.layer.mapview.locale.key,layer:e.layer.key,table:e.table,id:e.id}));if(!o){console.log("No data returned from location get request"),mapp.hooks.filter("locations",e.hook);return}let n=e.layer.infoj.map(r=>{let i=mapp.utils.clone(r);return Object.assign(i,{title:o[i.field+"_label"]||i.title,value:o[i.field],location:e}),i});return mapp.location.decorate(Object.assign(e,{infoj:n})),e.new&&await e.mvt_cache(),t[e.hook]=e,e.layer.mapview.interaction?.locations?.delete(e.hook),e.record&&e.layer.mapview.hooks&&mapp.hooks.push("locations",e.hook),e}async function vt(e){let t=e.feature.getProperties(),o=e.feature.getGeometry(),n=o.getCoordinates(),r=ol.proj.transform(n,"EPSG:"+e.mapview.srid,"EPSG:"+e.layer.srid),i=await mapp.utils.xhr(`${e.mapview.host}/api/query/get_nnearest?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.layer.key,geom:e.layer.geom,qID:e.layer.qID,label:e.layer.cluster?.label||e.layer.qID,table:e.table,filter:e.layer.filter?.current,n:t.count>(e.max||99)?e.max||99:t.count,x:r[0],y:r[1],coords:r})),s=mapp.utils.html.node`
    <div style="max-width: 66vw; max-height: 300px; overflow-x: hidden;">
      <ul>
      ${i.map(l=>mapp.utils.html.node`
        <li
          onclick=${a=>{e.mapview.popup(null),mapp.location.get({layer:e.layer,table:e.table,id:l.id,marker:ol.proj.transform(l.coords,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid)})}}>${l.label||'"'+e.layer.cluster?.label+'"'}`)}`;e.mapview.popup({coords:ol.proj.transform(r,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid),content:s,autoPan:!0})}var kt={decorate:wt,get:xt,nnearest:vt};async function St(e){if(!Array.isArray(e))return;let t=this.hooks&&new Set(mapp.hooks.current.layers);for(let o of e){let n=mapp.utils.merge({},this.locale.layer||{},o);if(n.mapview=this,t?.size&&(n.display=t.has(n.key)),!mapp.layer.formats[n.format]){console.warn(`Layer: ${n.key}, format is unknown or undefined. This is likely due to an incorrect file path.`);continue}await mapp.layer.decorate(n),this.layers[n.key]=n,n.display&&n.show()}return e}function Ct(e,t={}){if(!Array.isArray(e)||!e.every(o=>isFinite(o))){console.warn("Attempted to call fitView method with invalid extent");return}this.Map.getView().fit(e,Object.assign({padding:[50,50,50,50],duration:1e3},t))}function Et(e){let t=this.Map.getView().calculateExtent();if(!e)return{south:t[1],west:t[0],north:t[3],east:t[2]};let o=ol.proj.transformExtent(t,`EPSG:${this.srid}`,`EPSG:${e}`);return{south:o[1],west:o[0],north:o[3],east:o[2]}}function Lt(e){let t=new ol.format.GeoJSON,o;try{o=e.geometry&&t.readFeature({type:"Feature",geometry:e.geometry},{dataProjection:`EPSG:${e.dataProjection||this.srid}`,featureProjection:`EPSG:${this.srid}`})}catch(r){console.error(r);return}if(!o)return;let n=new ol.layer.Vector({source:new ol.source.Vector({features:[o]}),zIndex:e.zIndex,style:e.Style});return this.Map.addLayer(n),n}var g={};function $t(e){let t=this;if(g.node?.remove(),!t.position||(t.Map.un("pointermove",o),!e))return;if(e instanceof HTMLElement)g.node=e;else if(typeof e=="object"){console.log(e);return}else/[()]/.test(e)&&console.warn(`Potential XSS detected in infotip content ${e}`),g.node=mapp.utils.html.node`<div class="infotip box-shadow">`,g.node.innerHTML=e;t.Map.getTargetElement().append(g.node),t.Map.on("pointermove",o),o();function o(){g.node.style.opacity=1,g.node.style.left=t.pointerLocation.x-g.node.offsetWidth/2+"px",g.node.style.top=t.pointerLocation.y-g.node.offsetHeight-15+"px"}}function Mt(e){if(this._locate=this._locate||Object.assign({icon:{svg:`${this.host}/icons/locator.svg`,scale:.05},feature:new ol.Feature({geometry:new ol.geom.Point([0,0])})},e||{}),this._locate.active=!this._locate.active,this._locate.L||(this._locate.L=new ol.layer.Vector({source:new ol.source.Vector({features:[this._locate.feature]}),zIndex:999,style:mapp.utils.style({icon:this._locate.icon})})),!this._locate.active){this.Map.removeLayer(this._locate.L);return}this.Map.addLayer(this._locate.L),mapp.utils.getCurrentPosition(t=>{let o=ol.proj.fromLonLat([parseFloat(t.coords.longitude),parseFloat(t.coords.latitude)]);this._locate.feature.getGeometry().setCoordinates(o),this.Map.getView().animate({center:o,zoom:this.locale.maxZoom})})}var b={};function Tt(e){if(typeof e>"u")return b.node?.parentNode;let t=this;t.infotip(null),b.node?.remove(),e&&(b.node=mapp.utils.html.node`<div class="popup box-shadow">`,b.node.appendChild(e.content),b.overlay&&t.Map.removeOverlay(b.overlay),b.overlay=new ol.Overlay({element:b.node,position:e.coords||t.position,positioning:"bottom-center",autoPan:e.autoPan,insertFirst:!0,autoPanAnimation:{duration:250}}),t.Map.addOverlay(b.overlay))}function jt(e,t){t.popup(null);let o=[];if(t.Map.forEachFeatureAtPixel(e.pixel,(r,i)=>{let s={F:r,L:i,layer:t.layers[i.get("key")],id:r.get("id")||r.getId()};o.push(s)},{layerFilter:t.interaction.layerFilter,hitTolerance:t.interaction.hitTolerance}),!o.length)return;let n=mapp.utils.html.node`
      <div style="max-width: 66vw; max-height: 300px; overflow-x: hidden;">
        <ul>
        ${o.map(r=>mapp.utils.html.node`
          <li onclick=${i=>{t.interaction.getFeature(r),t.popup(null)}}
        }}>${r.L.get("key")} [${r.id}]`)}`;t.popup({content:n,autoPan:!0})}function Ot(e){let t=this;t.interaction?.finish(),t.interaction={type:"highlight",finish:L,clear:u,highlight:l,getFeature:h,hitTolerance:5,candidates:{},candidateKeys:new Set,locations:new Set,longClickMethod:t.allFeatures,longClickMS:500,layerFilter:c=>Object.values(this.layers).some(m=>m.qID&&m.L===c),...e},t.Map.on("pointermove",s),t.Map.on("click",p),t.Map.getTargetElement().addEventListener("mousedown",n),t.Map.getTargetElement().addEventListener("touchstart",o),t.Map.getTargetElement().addEventListener("mouseup",r);function o(c){c.preventDefault()}function n(){!t.interaction.longClickMethod||(delete t.interaction.longClick,t.interaction.longClickTimeout&&clearTimeout(t.interaction.longClickTimeout),t.interaction.longClickTimeout=setTimeout(()=>{t.interaction.longClick=!0,t.Map.getTargetElement().style.cursor="wait"},t.interaction.longClickMS))}function r(){t.Map.getTargetElement().style.cursor="auto"}let i;function s(c){if(t.popup()||(t.interaction.longClickTimeout&&clearTimeout(t.interaction.longClickTimeout),i))return;i=!0;let m={};if(t.Map.forEachFeatureAtPixel(c.pixel,(w,$)=>{let x={key:`${$.get("key")||ol.util.getUid($)}!${w.get("id")||w.getId()||ol.util.getUid(w)}`,F:w,L:$};m[x.key]=x},{layerFilter:t.interaction.layerFilter,hitTolerance:t.interaction.hitTolerance}),!Object.keys(m).length){t.interaction.candidateKeys=new Set,i=!1,u();return}if(mapp.utils.areSetsEqual(t.interaction.candidateKeys,new Set(Object.keys(m)))){i=!1;return}let C=m[Object.keys(m).find(w=>!t.interaction.candidateKeys.has(w))];C=C||t.interaction.current?.key&&m[t.interaction.current?.key]||m[Object.keys(m)[0]],t.interaction.candidateKeys=new Set(Object.keys(m)),i=!1,t.interaction.highlight(C,c)}function l(c,m){if(u(),t.interaction.current=Object.assign(c,{layer:t.layers[c.L.get("key")],id:c.F.get("id")||c.F.getId()}),t.interaction.current.layer.highlight=c.id,m.originalEvent.pointerType!=="mouse"){m.type!=="pointermove"&&t.interaction.getFeature(t.interaction.current),u();return}t.interaction.current.layer.infoj&&(t.Map.getTargetElement().style.cursor="pointer"),typeof t.interaction.current.layer.style?.hover?.method=="function"&&t.interaction.current.layer.style.hover.method(c.F,t.interaction.current.layer),t.interaction.current.layer.format!=="mvt"&&t.interaction.current.layer.style.highlight&&typeof t.interaction.current.F.setStyle=="function"?(c.F.set("Styles",null,!0),c.F.set("highlight",!0,!0),t.interaction.current.F.setStyle()):t.interaction.current.layer.style.highlight&&t.interaction.current.layer.L.changed()}let a;function p(c){if(t.Map.getTargetElement().style.cursor="auto",t.interaction.longClickTimeout&&clearTimeout(t.interaction.longClickTimeout),t.interaction.longClick&&typeof t.interaction.longClickMethod=="function"){t.interaction.longClickMethod(c,t);return}if(t.popup()){t.popup(null);return}if(!a){if(a=setTimeout(()=>{a=null},600),c.originalEvent.pointerType==="touch"){t.interaction.candidateKeys=new Set,c.type="touchClick",s(c);return}if(t.popup(null),t.interaction.current){t.interaction.getFeature(t.interaction.current);return}typeof t.interaction.noLocationClick=="function"&&t.interaction.noLocationClick(c)}}function u(){!t.interaction.current||(t.infotip(null),t.Map.getTargetElement().style.cursor="auto",delete t.interaction.current.layer.highlight,t.interaction.current.layer.format!=="mvt"&&typeof t.interaction.current.F.setStyle=="function"?(t.interaction.current.F.set("Styles",null,!0),t.interaction.current.F.set("highlight",!1,!0),t.interaction.current.F.setStyle()):t.interaction.current.layer.style.highlight&&t.interaction.current.layer.L.changed(),delete t.interaction.current)}function h(c){if(!c.layer.infoj)return;if(c.F.getProperties().count>1){let C=c.F.get("features");if(Array.isArray(C)){let w=C.map(x=>{let B=x.getProperties();return{id:B.id,label:B.properties[c.layer.cluster?.label]}}),$=mapp.utils.html.node`
        <div style="max-width: 66vw; max-height: 300px; overflow-x: hidden;">
          <ul>
          ${w.map(x=>mapp.utils.html.node`
            <li
              onclick=${B=>{t.popup(null),mapp.location.get({layer:c.layer,table:c.layer.table||c.layer.tableCurrent(),id:x.id})}}>${x.label||x.id}`)}`;t.popup({coords:c.F.getGeometry().getCoordinates(),content:$,autoPan:!0});return}mapp.location.nnearest({mapview:t,layer:c.layer,table:c.layer.table||c.layer.tableCurrent(),feature:c.F});return}mapp.location.get({layer:c.layer,table:c.layer.table||c.layer.tableCurrent(),id:c.id})}function L(){u(),t.popup(null),t.Map.un("pointermove",s),t.Map.un("click",p),t.Map.getTargetElement().removeEventListener("mousedown",n),t.Map.getTargetElement().removeEventListener("touchstart",o),t.Map.getTargetElement().removeEventListener("mouseup",r),t.interaction.callback?.()}}function Pt(e){let t=this;t.interaction?.finish(),t.interaction={type:"draw",finish:n,getFeature:o,format:new ol.format.GeoJSON,source:new ol.source.Vector,Layer:new ol.layer.Vector,drawend:mapp.ui?.elements.contextMenu.draw.bind(this),vertices:[],condition:r=>{if(r.originalEvent.buttons===2){t.interaction.interaction.removeLastPoint(),t.interaction.vertices.pop();let i=new ol.MapBrowserEvent("pointermove",t.Map,r.originalEvent);return t.interaction.interaction.handleEvent(i),t.interaction.interaction.handleEvent(i),!1}if(r.originalEvent.buttons===1)return t.interaction.vertices.push(r.coordinate),t.popup(null),t.interaction.conditions?.forEach(i=>typeof i=="function"&&i(r)),!0},style:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})],...e},t.Map.getTargetElement().style.cursor="crosshair",t.interaction.Layer.setSource(t.interaction.source),t.Map.addLayer(t.interaction.Layer),t.interaction.interaction=new ol.interaction.Draw(t.interaction),t.interaction.interaction.on("drawstart",r=>{let i=r.feature.getGeometry();async function s(){t.popup({content:mapp.utils.html.node`
          <div style="padding: 5px">
          ${await mapp.utils.convert(t.metrics[t.interaction.tooltip.metric](i),t.interaction.tooltip)}`})}t.interaction.tooltip&&i.on("change",t.interaction.tooltip.onChange||s),t.interaction.source.clear(),t.popup(null)}),typeof t.interaction.drawend=="function"&&t.interaction.interaction.on("drawend",t.interaction.drawend),t.Map.addInteraction(t.interaction.interaction),t.interactions.snap(t);function o(){return JSON.parse(t.interaction.format.writeFeature(t.interaction.source.getFeatures()[0],{dataProjection:"EPSG:"+t.interaction.layer?.srid||t.interaction.srid||t.srid,featureProjection:"EPSG:"+t.srid}))}function n(r){t.interaction.snap?.remove?.(),t.Map.getTargetElement().style.cursor="default",t.popup(null),t.Map.removeInteraction(t.interaction.interaction),t.Map.removeLayer(t.interaction.Layer),t.interaction.callback?.(r)}}function Ft(e){let t=this;t.interaction?.finish(),t.interaction={type:"modify",finish:n,format:new ol.format.GeoJSON,source:new ol.source.Vector,Layer:new ol.layer.Vector({zIndex:1/0}),vertices:[],modifyend:mapp.ui?.elements.contextMenu.modify.bind(this),getFeature:o,Style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})],deleteCondition:r=>{if(r.type==="singleclick"){let i=t.interaction.Feature.getGeometry(),s=i.getType();if(s==="Point")return;let l=i.getCoordinates();if(s==="LineString"&&l.length<3||s==="Polygon"&&l[0].length<=4)return;t.popup({coords:i.getClosestPoint(r.coordinate),content:mapp.utils.html.node`<ul>
            <li
              onclick=${()=>{t.interaction.interaction.removePoint(),t.interaction.vertices.push(t.interaction.Feature.getGeometry().getClosestPoint(r.coordinate))}}>${mapp.dictionary.delete_vertex}`})}},...e},t.Map.getTargetElement().style.cursor="crosshair",t.interaction.source.addFeature(t.interaction.Feature),t.interaction.Layer.setSource(t.interaction.source),t.interaction.Layer.setStyle(t.interaction.Style),t.Map.addLayer(t.interaction.Layer),t.interaction.interaction=new ol.interaction.Modify(t.interaction),t.interaction.interaction.on("modifystart",r=>{t.popup(null)}),typeof t.interaction.modifyend=="function"&&t.interaction.interaction.on("modifyend",t.interaction.modifyend),t.Map.addInteraction(t.interaction.interaction),t.interactions.snap(t);function o(){return JSON.parse(t.interaction.format.writeFeature(t.interaction.Feature,{dataProjection:"EPSG:"+t.interaction.srid||t.srid,featureProjection:"EPSG:"+t.srid}))}function n(r){t.interaction.snap?.remove?.(),t.Map.getTargetElement().style.cursor="default",t.popup(null),t.Map.removeInteraction(t.interaction.interaction),t.interaction.source.clear(),t.Map.removeLayer(t.interaction.Layer),t.interaction.callback?.(r)}}function It(e){let t=this;t.interaction?.finish(),t.interaction={finish:o,Layer:new ol.layer.Vector({source:new ol.source.Vector}),...e},t.interaction.Layer.getSource().clear(),t.Map.addLayer(t.interaction.Layer),t.Map.getTargetElement().style.cursor="zoom-in",t.interaction.interaction=new ol.interaction.Draw({source:t.interaction.Layer.getSource(),type:"Circle",geometryFunction:ol.interaction.Draw.createBox(),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#ddd",width:1}),fill:new ol.style.Stroke({color:"#fff9"})})}),t.interaction.interaction.on("drawend",n=>{t.fitView(n.feature.getGeometry().getExtent()),o()}),t.Map.addInteraction(t.interaction.interaction);function o(){t.Map.getTargetElement().style.cursor="auto",t.Map.removeInteraction(t.interaction.interaction),t.Map.removeLayer(t.interaction.Layer),t.interaction.Layer.getSource().clear(),t.interaction.callback?.()}}function zt(e){if(!e.interaction.snap)return;e.interaction.snap={remove:()=>{e.interaction.layer.featureSource&&(e.interaction.layer.featureSource.un("tileloadend",t),e.Map.removeLayer(e.interaction.snap.vectorTileLayer),e.interaction.layer.featureSource.clear()),e.Map.removeInteraction(e.interaction.snap.interaction)}};function t(o){e.interaction.snap.source.addFeatures(o.tile.getFeatures())}e.interaction.layer.featureSource?(e.interaction.snap.source=new ol.source.Vector,e.interaction.layer.featureSource.on("tileloadend",t),e.interaction.snap.vectorTileLayer=new ol.layer.VectorTile({source:e.interaction.layer.featureSource,opacity:0}),e.Map.addLayer(e.interaction.snap.vectorTileLayer)):e.interaction.snap.source=e.interaction.layer.L.getSource(),e.interaction.snap.interaction=new ol.interaction.Snap({source:e.interaction.snap.source}),e.Map.addInteraction(e.interaction.snap.interaction)}var At=e=>{Object.assign(e,{srid:e.locale.srid||"3857",addLayer:St,fitView:Ct,geoJSON:Lt,getBounds:Et,infotip:$t,locate:Mt,metrics:{distance:s=>ol.sphere.getLength(new ol.geom.LineString([s.getInteriorPoint().getCoordinates(),e.position])),area:s=>ol.sphere.getArea(s),length:s=>ol.sphere.getLength(s)},popup:Tt,allFeatures:jt,layers:{},locations:{},interactions:{highlight:Ot.bind(e),draw:Pt.bind(e),modify:Ft.bind(e),zoom:It.bind(e),snap:zt}});let t=mapp.hooks?.current?.z||e.locale.view?.z||e.locale.minZoom||0,o=ol.proj.fromLonLat([parseFloat(mapp.hooks?.current?.lng||e.locale.view?.lng||0),parseFloat(mapp.hooks?.current?.lat||e.locale.view?.lat||0)]);if(e.locale.bounds&&console.warn("locale.bounds have been renamed to locale.extent"),e.locale.extent){let s=parseFloat(e.locale.extent.north||90),l=parseFloat(e.locale.extent.south||-90),a=parseFloat(e.locale.extent.east||180),p=parseFloat(e.locale.extent.west||-180);s-l>=0&&a-p>=0?e.extent=ol.proj.transformExtent([p,l,a,s],"EPSG:4326",`EPSG:${e.srid}`):console.warn("Invalid extent. Ensure north >= south and east >= west. Global extent is assumed.")}e.Map=new ol.Map({target:e.target,interactions:ol.interaction.defaults.defaults({mouseWheelZoom:e.scrollWheelZoom&&{duration:250,timeout:80}||!1,pinchRotate:e.pinchRotate&&{threshold:3}||!1}),moveTolerance:5,controls:e.controls||[],view:new ol.View({projection:`EPSG:${e.srid}`,zoom:t,minZoom:e.locale.minZoom,maxZoom:e.locale.maxZoom,center:o,extent:e.extent})});let n;if(new ResizeObserver(()=>{n&&clearTimeout(n),n=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new Event("resize"))},400)}).observe(e.Map.getTargetElement()),e.locale.maskBounds&&console.warn("locale.maskBounds is set as mask:true in locale.extent"),e.locale.extent?.mask){let s=[[180,90],[180,-90],[-180,-90],[-180,90],[180,90]],l=[[e.locale.extent.east,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.north]],a=new ol.Feature({geometry:new ol.geom.Polygon([s,l]).transform("EPSG:4326",`EPSG:${e.srid}`)});e.Map.addLayer(new ol.layer.Vector({source:new ol.source.Vector({features:[a]}),style:new ol.style.Style({fill:new ol.style.Fill({color:"#00000044"})}),zIndex:1/0}))}e.scalebar&&e.Map.addControl(new ol.control.ScaleLine({units:e.scalebar})),e.attribution&&(typeof e.attribution!="object"&&(e.attribution={}),e.attribution.target=e.attribution.target||e.Map.getTargetElement().appendChild(mapp.utils.html.node`
          <div class="attribution-links">`),e.attribution.check=()=>{let s=Object.assign({},e.attribution.links||{});Object.values(e.layers).forEach(l=>{l.display&&l.attribution&&Object.assign(s,l.attribution)}),mapp.utils.render(e.attribution.target,mapp.utils.html`${Object.entries(s).map(l=>mapp.utils.html`
              <a target="_blank" href="${l[1]}">${l[0]}`)}`)}),e.Map.on("pointermove",s=>{e.position=s.coordinate,e.pointerLocation={x:s.originalEvent.clientX,y:s.originalEvent.clientY}}),e.Map.getTargetElement().addEventListener("mouseout",()=>{e.infotip(null),e.position=null,e.pointerLocation={x:null,y:null}}),e.Map.getTargetElement().addEventListener("changeEnd",r);function r(){if(!e.hooks)return;let s=ol.proj.transform(e.Map.getView().getCenter(),`EPSG:${e.srid}`,"EPSG:4326");mapp.hooks.set({lat:Math.round((s[1]+Number.EPSILON)*1e5)/1e5,lng:Math.round((s[0]+Number.EPSILON)*1e5)/1e5,z:Math.round((e.Map.getView().getZoom()+Number.EPSILON)*100)/100})}let i;return e.Map.on("moveend",()=>{clearTimeout(i),i=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new CustomEvent("changeEnd"))},500)}),i=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new CustomEvent("changeEnd"))},500),e};var he={};A(he,{svg_templates:()=>en});async function en(e){typeof mapp.utils.svgSymbols.templates!="object"&&(mapp.utils.svgSymbols.templates={});let t=Object.entries(e).map(o=>fetch(o[1]).then(n=>n.text()).then(n=>{mapp.utils.svgSymbols.templates[o[0]]=n}));await Promise.all(t)}self.mapp=function(e){return R.parse(),Object.assign(e,{version:"4.7.2",hash:"4026463d6e57c02f0da8ad676d81f59e47baacc8",language:R.current.language||"en",dictionaries:nt,dictionary:new Proxy({},{get:function(t,o,n){return e.dictionaries[e.language][o]?e.dictionaries[e.language][o]:e.dictionaries.en[o]}}),hooks:R,layer:bt,location:kt,Mapview:At,utils:We,plugins:he}),e}({});})();
/*! (c) Andrea Giammarchi - ISC */
//# sourceMappingURL=mapp.js.map

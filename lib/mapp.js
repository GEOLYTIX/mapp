(()=>{var vo=Object.create;var de=Object.defineProperty;var bo=Object.getOwnPropertyDescriptor;var wo=Object.getOwnPropertyNames;var xo=Object.getPrototypeOf,So=Object.prototype.hasOwnProperty;var he=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var j=(e,t)=>{for(var r in t)de(e,r,{get:t[r],enumerable:!0})},ko=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of wo(t))!So.call(e,o)&&o!==r&&de(e,o,{get:()=>t[o],enumerable:!(n=bo(t,o))||n.enumerable});return e};var me=(e,t,r)=>(r=e!=null?vo(xo(e)):{},ko(t||!e||!e.__esModule?de(r,"default",{value:e,enumerable:!0}):r,e));var Q=class extends Map{set(t,r){return super.set(t,r),r}},L=class extends WeakMap{set(t,r){return super.set(t,r),r}};var Mo=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Eo=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,Co=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,Lo=/[\x01\x02]/g,It=(e,t,r)=>{let n=0;return e.join("").trim().replace(Eo,(o,i,s,a)=>{let l=i+s.replace(Co,"=$2$1").trimEnd();return a.length&&(l+=r||Mo.test(i)?" /":"></"+i),"<"+l+">"}).replace(Lo,o=>o===""?"<!--"+t+n+++"-->":t+n++)};var va=1,ba=111,$o=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},Pt=(e,t)=>e.nodeType===111?1/t<0?t?$o(e):e.lastChild:t?e.valueOf():e.firstChild:e,Ft=e=>{let{firstChild:t,lastChild:r}=e;if(t===r)return r||e;let{childNodes:n}=e,o=[...n];return{ELEMENT_NODE:1,nodeType:111,firstChild:t,lastChild:r,valueOf(){return n.length!==o.length&&e.append(...o),e}}};var{isArray:ge}=Array,{indexOf:To,slice:jo}=[];var Ot=!1,X=class{constructor(t,r){Ot=!0,this._=(...n)=>t(...n,r)}},ka=(e,t)=>new X(e,t),qt=e=>t=>{for(let r in t){let n=r==="role"?r:`aria-${r}`,o=t[r];o==null?e.removeAttribute(n):e.setAttribute(n,o)}},ye=e=>e==null?e:e.valueOf(),_t=(e,t)=>{let r,n=!0,o=document.createAttributeNS(null,t);return i=>{let s=Ot&&i instanceof X?i._(e,t):ye(i);r!==s&&((r=s)==null?n||(e.removeAttributeNode(o),n=!0):(o.value=s,n&&(e.setAttributeNodeNS(o),n=!1)))}},At=(e,t,r)=>n=>{let o=!!ye(n);r!==o&&((r=o)?e.setAttribute(t,""):e.removeAttribute(t))},Io=({dataset:e})=>t=>{for(let r in t){let n=t[r];n==null?delete e[r]:e[r]=n}},ve=(e,t)=>{let r,n,o=t.slice(2);return!(t in e)&&(n=t.toLowerCase())in e&&(o=n.slice(2)),i=>{let s=ge(i)?i:[i,!1];r!==s[0]&&(r&&e.removeEventListener(o,r,s[1]),(r=s[0])&&e.addEventListener(o,r,s[1]))}},zt=e=>{let t;return r=>{t!==r&&(t=r,typeof r=="function"?r(e):r.current=e)}},Nt=(e,t)=>t==="dataset"?Io(e):r=>{e[t]=r},Dt=e=>{let t;return r=>{let n=ye(r);t!=n&&(t=n,e.textContent=n??"")}};var Bt=(e,t,r,n,o)=>{let i=r.length,s=t.length,a=i,l=0,c=0,u=null;for(;l<s||c<a;)if(s===l){let p=a<i?c?n(r[c-1],-0).nextSibling:n(r[a-c],0):o;for(;c<a;)e.insertBefore(n(r[c++],1),p)}else if(a===c)for(;l<s;)(!u||!u.has(t[l]))&&e.removeChild(n(t[l],-1)),l++;else if(t[l]===r[c])l++,c++;else if(t[s-1]===r[a-1])s--,a--;else if(t[l]===r[a-1]&&r[c]===t[s-1]){let p=n(t[--s],-1).nextSibling;e.insertBefore(n(r[c++],1),n(t[l++],-1).nextSibling),e.insertBefore(n(r[--a],1),p),t[s]=r[a]}else{if(!u){u=new Map;let p=c;for(;p<a;)u.set(r[p],p++)}if(u.has(t[l])){let p=u.get(t[l]);if(c<p&&p<a){let d=l,f=1;for(;++d<s&&d<a&&u.get(t[d])===p+f;)f++;if(f>p-c){let h=n(t[l],0);for(;c<p;)e.insertBefore(n(r[c++],1),h)}else e.replaceChild(n(r[c++],1),n(t[l++],-1))}else l++}else e.removeChild(n(t[l++],-1))}return r};var{isArray:_,prototype:Po}=Array,{indexOf:be}=Po,{createDocumentFragment:Fo,createElement:Oo,createElementNS:qo,createTextNode:we,createTreeWalker:xe,importNode:Se}=new Proxy({},{get:(e,t)=>document[t].bind(document)}),_o=e=>{let t=Oo("template");return t.innerHTML=e,t.content},Y,Ao=e=>{Y||(Y=qo("http://www.w3.org/2000/svg","svg")),Y.innerHTML=e;let t=Fo();return t.append(...Y.childNodes),t},Vt=(e,t)=>t?Ao(e):_o(e);var zo=({childNodes:e},t)=>e[t],A=(e,t,r)=>Bt(e.parentNode,t,r,Pt,e),No=e=>{let t,r,n=[],o=i=>{switch(typeof i){case"string":case"number":case"boolean":t!==i&&(t=i,r||(r=we("")),r.data=i,n=A(e,n,[r]));break;case"object":case"undefined":if(i==null){t!=i&&(t=i,n=A(e,n,[]));break}if(_(i)){t=i,i.length===0?n=A(e,n,[]):typeof i[0]=="object"?n=A(e,n,i):o(String(i));break}if(t!==i)if("ELEMENT_NODE"in i)t=i,n=A(e,n,i.nodeType===11?[...i.childNodes]:[i]);else{let s=i.valueOf();s!==i&&o(s)}break;case"function":o(i(e));break}};return o},Do=(e,t)=>{switch(t[0]){case"?":return At(e,t.slice(1),!1);case".":return Nt(e,t.slice(1));case"@":return ve(e,"on"+t.slice(1));case"o":if(t[1]==="n")return ve(e,t)}switch(t){case"ref":return zt(e);case"aria":return qt(e)}return _t(e,t)};function Gt(e){let{type:t,path:r}=e,n=r.reduceRight(zo,this);return t==="node"?No(n):t==="attr"?Do(n,e.name):Dt(n)}var ke=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(be.call(r.childNodes,e)),e=r,{parentNode:r}=e;return t},z="is\xB5",Rt=new L,Bo=/^(?:textarea|script|style|title|plaintext|xmp)$/,I=()=>({stack:[],entry:null,wire:null}),Vo=(e,t)=>{let{content:r,updates:n}=Ro(e,t);return{type:e,template:t,content:r,updates:n,wire:null}},Go=(e,t)=>{let r=e==="svg",n=It(t,z,r),o=Vt(n,r),i=xe(o,129),s=[],a=t.length-1,l=0,c=`${z}${l}`;for(;l<a;){let u=i.nextNode();if(!u)throw`bad template: ${n}`;if(u.nodeType===8)u.data===c&&(s.push({type:"node",path:ke(u)}),c=`${z}${++l}`);else{for(;u.hasAttribute(c);)s.push({type:"attr",path:ke(u),name:u.getAttribute(c)}),u.removeAttribute(c),c=`${z}${++l}`;Bo.test(u.localName)&&u.textContent.trim()===`<!--${c}-->`&&(u.textContent="",s.push({type:"text",path:ke(u)}),c=`${z}${++l}`)}}return{content:o,nodes:s}},Ro=(e,t)=>{let{content:r,nodes:n}=Rt.get(t)||Rt.set(t,Go(e,t)),o=Se(r,!0),i=n.map(Gt,o);return{content:o,updates:i}},N=(e,{type:t,template:r,values:n})=>{let o=Zt(e,n),{entry:i}=e;(!i||i.template!==r||i.type!==t)&&(e.entry=i=Vo(t,r));let{content:s,updates:a,wire:l}=i;for(let c=0;c<o;c++)a[c](n[c]);return l||(i.wire=Ft(s))},Zt=({stack:e},t)=>{let{length:r}=t;for(let n=0;n<r;n++){let o=t[n];o instanceof E?t[n]=N(e[n]||(e[n]=I()),o):_(o)?Zt(e[n]||(e[n]=I()),o):e[n]=null}return r<e.length&&e.splice(r),r},E=class{constructor(t,r,n){this.type=t,this.template=r,this.values=n}};var Ut=e=>{let t=new L,r=n=>(o,...i)=>N(n,{type:e,template:o,values:i});return Object.assign((n,...o)=>new E(e,n,o),{for(n,o){let i=t.get(n)||t.set(n,new Q);return i.get(o)||i.set(o,r(I()))},node:(n,...o)=>N(I(),new E(e,n,o)).valueOf()})},Kt=new L,Me=(e,t)=>{let r=typeof t=="function"?t():t,n=Kt.get(e)||Kt.set(e,I()),o=r instanceof E?N(n,r):r;return o!==n.wire&&(n.wire=o,e.replaceChildren(o.valueOf())),e},Ee=Ut("html"),m=Ut("svg");var nt={};j(nt,{BayesianClassifier:()=>U,PerceptronModel:()=>K,addToMean:()=>vr,approxEqual:()=>Gr,average:()=>y,averageSimple:()=>Ke,bayesian:()=>U,bernoulliDistribution:()=>jr,binomialDistribution:()=>Ir,bisect:()=>Dr,chiSquaredDistributionTable:()=>Qe,chiSquaredGoodnessOfFit:()=>Fr,chunk:()=>cr,ckmeans:()=>fr,coefficientOfVariation:()=>Er,combinations:()=>Re,combinationsReplacement:()=>Ze,combineMeans:()=>Ue,combineVariances:()=>br,cumulativeStdLogisticProbability:()=>_r,cumulativeStdNormalProbability:()=>qr,epsilon:()=>$,equalIntervalBreaks:()=>dr,erf:()=>Ye,errorFunction:()=>Ye,extent:()=>nr,extentSorted:()=>ar,factorial:()=>We,gamma:()=>Je,gammaln:()=>Tr,geometricMean:()=>wr,harmonicMean:()=>Sr,interquartileRange:()=>ne,inverseErrorFunction:()=>et,iqr:()=>ne,jenks:()=>pr,kMeansCluster:()=>Br,kde:()=>Xe,kernelDensityEstimation:()=>Xe,linearRegression:()=>Xt,linearRegressionLine:()=>Yt,logAverage:()=>xr,logit:()=>zr,mad:()=>ze,max:()=>V,maxSorted:()=>ir,mean:()=>y,meanSimple:()=>Ke,median:()=>oe,medianAbsoluteDeviation:()=>ze,medianSorted:()=>kr,min:()=>qe,minSorted:()=>or,mode:()=>tr,modeFast:()=>rr,modeSorted:()=>Oe,numericSort:()=>B,perceptron:()=>K,permutationTest:()=>Nr,permutationsHeap:()=>yr,poissonDistribution:()=>Pr,probit:()=>Ar,product:()=>sr,quantile:()=>R,quantileRank:()=>lr,quantileRankSorted:()=>Ae,quantileSorted:()=>G,quickselect:()=>P,rSquared:()=>er,relativeError:()=>rt,rms:()=>He,rootMeanSquare:()=>He,sample:()=>De,sampleCorrelation:()=>Ge,sampleCovariance:()=>Ve,sampleKurtosis:()=>gr,sampleRankCorrelation:()=>hr,sampleSkewness:()=>mr,sampleStandardDeviation:()=>F,sampleVariance:()=>Z,sampleWithReplacement:()=>ur,shuffle:()=>Ne,shuffleInPlace:()=>ie,sign:()=>ae,silhouette:()=>tt,silhouetteMetric:()=>Vr,standardDeviation:()=>Fe,standardNormalTable:()=>O,subtractFromMean:()=>Mr,sum:()=>Ie,sumNthPowerDeviations:()=>re,sumSimple:()=>_e,tTest:()=>Cr,tTestTwoSample:()=>Lr,uniqueCountSorted:()=>Be,variance:()=>Pe,wilcoxonRankSum:()=>$r,zScore:()=>Or});function Xt(e){var t,r,n=e.length;if(n===1)t=0,r=e[0][1];else{for(var o=0,i=0,s=0,a=0,l,c,u,p=0;p<n;p++)l=e[p],c=l[0],u=l[1],o+=c,i+=u,s+=c*c,a+=c*u;t=(n*a-o*i)/(n*s-o*o),r=i/n-t*o/n}return{m:t,b:r}}function Yt(e){return function(t){return e.b+e.m*t}}function Ie(e){if(e.length===0)return 0;var t=e[0],r=0,n;if(typeof t!="number")return NaN;for(var o=1;o<e.length;o++){if(typeof e[o]!="number")return NaN;n=t+e[o],Math.abs(t)>=Math.abs(e[o])?r+=t-n+e[o]:r+=e[o]-n+t,t=n}return t+r}function y(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ie(e)/e.length}function re(e,t){var r=y(e),n=0,o,i;if(t===2)for(i=0;i<e.length;i++)o=e[i]-r,n+=o*o;else for(i=0;i<e.length;i++)n+=Math.pow(e[i]-r,t);return n}function Pe(e){if(e.length===0)throw new Error("variance requires at least one data point");return re(e,2)/e.length}function Fe(e){if(e.length===1)return 0;var t=Pe(e);return Math.sqrt(t)}function er(e,t){if(e.length<2)return 1;for(var r=0,n=0;n<e.length;n++)r+=e[n][1];for(var o=r/e.length,i=0,s=0;s<e.length;s++)i+=Math.pow(o-e[s][1],2);for(var a=0,l=0;l<e.length;l++)a+=Math.pow(e[l][1]-t(e[l][0]),2);return 1-a/i}function Oe(e){if(e.length===0)throw new Error("mode requires at least one data point");if(e.length===1)return e[0];for(var t=e[0],r=NaN,n=0,o=1,i=1;i<e.length+1;i++)e[i]!==t?(o>n&&(n=o,r=t),o=1,t=e[i]):o++;return r}function B(e){return e.slice().sort(function(t,r){return t-r})}function tr(e){return Oe(B(e))}function rr(e){for(var t=new Map,r,n=0,o=0;o<e.length;o++){var i=t.get(e[o]);i===void 0?i=1:i++,i>n&&(r=e[o],n=i),t.set(e[o],i)}if(n===0)throw new Error("mode requires at last one data point");return r}function qe(e){if(e.length===0)throw new Error("min requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function V(e){if(e.length===0)throw new Error("max requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function nr(e){if(e.length===0)throw new Error("extent requires at least one data point");for(var t=e[0],r=e[0],n=1;n<e.length;n++)e[n]>r&&(r=e[n]),e[n]<t&&(t=e[n]);return[t,r]}function or(e){return e[0]}function ir(e){return e[e.length-1]}function ar(e){return[e[0],e[e.length-1]]}function _e(e){for(var t=0,r=0;r<e.length;r++){if(typeof e[r]!="number")return NaN;t+=e[r]}return t}function sr(e){for(var t=1,r=0;r<e.length;r++)t*=e[r];return t}function G(e,t){var r=e.length*t;if(e.length===0)throw new Error("quantile requires at least one data point.");if(t<0||t>1)throw new Error("quantiles must be between 0 and 1");return t===1?e[e.length-1]:t===0?e[0]:r%1!==0?e[Math.ceil(r)-1]:e.length%2===0?(e[r-1]+e[r])/2:e[r]}function P(e,t,r,n){for(r=r||0,n=n||e.length-1;n>r;){if(n-r>600){var o=n-r+1,i=t-r+1,s=Math.log(o),a=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*a*(o-a)/o);i-o/2<0&&(l*=-1);var c=Math.max(r,Math.floor(t-i*a/o+l)),u=Math.min(n,Math.floor(t+(o-i)*a/o+l));P(e,t,c,u)}var p=e[t],d=r,f=n;for(D(e,r,t),e[n]>p&&D(e,r,n);d<f;){for(D(e,d,f),d++,f--;e[d]<p;)d++;for(;e[f]>p;)f--}e[r]===p?D(e,r,f):(f++,D(e,f,n)),f<=t&&(r=f+1),t<=f&&(n=f-1)}}function D(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function R(e,t){var r=e.slice();if(Array.isArray(t)){Zo(r,t);for(var n=[],o=0;o<t.length;o++)n[o]=G(r,t[o]);return n}else{var i=Wt(r.length,t);return Ht(r,i,0,r.length-1),G(r,t)}}function Ht(e,t,r,n){t%1===0?P(e,t,r,n):(t=Math.floor(t),P(e,t,r,n),P(e,t+1,t+1,n))}function Zo(e,t){for(var r=[0],n=0;n<t.length;n++)r.push(Wt(e.length,t[n]));r.push(e.length-1),r.sort(Uo);for(var o=[0,r.length-1];o.length;){var i=Math.ceil(o.pop()),s=Math.floor(o.pop());if(!(i-s<=1)){var a=Math.floor((s+i)/2);Ht(e,r[a],Math.floor(r[s]),Math.ceil(r[i])),o.push(s,a,a,i)}}}function Uo(e,t){return e-t}function Wt(e,t){var r=e*t;return t===1?e-1:t===0?0:r%1!==0?Math.ceil(r)-1:e%2===0?r-.5:r}function Ae(e,t){if(t<e[0])return 0;if(t>e[e.length-1])return 1;var r=Ko(e,t);if(e[r]!==t)return r/e.length;r++;var n=Ho(e,t);if(n===r)return r/e.length;var o=n-r+1,i=o*(n+r)/2,s=i/o;return s/e.length}function Ko(e,t){for(var r=0,n=0,o=e.length;n<o;)r=n+o>>>1,t<=e[r]?o=r:n=-~r;return n}function Ho(e,t){for(var r=0,n=0,o=e.length;n<o;)r=n+o>>>1,t>=e[r]?n=-~r:o=r;return n}function lr(e,t){var r=B(e);return Ae(r,t)}function ne(e){var t=R(e,.75),r=R(e,.25);if(typeof t=="number"&&typeof r=="number")return t-r}function oe(e){return+R(e,.5)}function ze(e){for(var t=oe(e),r=[],n=0;n<e.length;n++)r.push(Math.abs(e[n]-t));return oe(r)}function cr(e,t){var r=[];if(t<1)throw new Error("chunk size must be a positive number");if(Math.floor(t)!==t)throw new Error("chunk size must be an integer");for(var n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}function ur(e,t,r){if(e.length===0)return[];r=r||Math.random;for(var n=e.length,o=[],i=0;i<t;i++){var s=Math.floor(r()*n);o.push(e[s])}return o}function ie(e,t){t=t||Math.random;for(var r=e.length,n,o;r>0;)o=Math.floor(t()*r--),n=e[r],e[r]=e[o],e[o]=n;return e}function Ne(e,t){var r=e.slice();return ie(r,t)}function De(e,t,r){var n=Ne(e,r);return n.slice(0,t)}function ee(e,t){for(var r=[],n=0;n<e;n++){for(var o=[],i=0;i<t;i++)o.push(0);r.push(o)}return r}function Be(e){for(var t=0,r,n=0;n<e.length;n++)(n===0||e[n]!==r)&&(r=e[n],t++);return t}function Ce(e,t,r,n){var o;if(e>0){var i=(r[t]-r[e-1])/(t-e+1);o=n[t]-n[e-1]-(t-e+1)*i*i}else o=n[t]-r[t]*r[t]/(t+1);return o<0?0:o}function Le(e,t,r,n,o,i,s){if(!(e>t)){var a=Math.floor((e+t)/2);n[r][a]=n[r-1][a-1],o[r][a]=a;var l=r;e>r&&(l=Math.max(l,o[r][e-1]||0)),l=Math.max(l,o[r-1][a]||0);var c=a-1;t<n[0].length-1&&(c=Math.min(c,o[r][t+1]||0));for(var u,p,d,f,h=c;h>=l&&(u=Ce(h,a,i,s),!(u+n[r-1][l-1]>=n[r][a]));--h)p=Ce(l,a,i,s),d=p+n[r-1][l-1],d<n[r][a]&&(n[r][a]=d,o[r][a]=l),l++,f=u+n[r-1][h-1],f<n[r][a]&&(n[r][a]=f,o[r][a]=h);Le(e,a-1,r,n,o,i,s),Le(a+1,t,r,n,o,i,s)}}function Wo(e,t,r){for(var n=t[0].length,o=e[Math.floor(n/2)],i=[],s=[],a=0,l=void 0;a<n;++a)l=e[a]-o,a===0?(i.push(l),s.push(l*l)):(i.push(i[a-1]+l),s.push(s[a-1]+l*l)),t[0][a]=Ce(0,a,i,s),r[0][a]=0;for(var c,u=1;u<t.length;++u)u<t.length-1?c=u:c=n-1,Le(c,n-1,u,t,r,i,s)}function fr(e,t){if(t>e.length)throw new Error("cannot generate more classes than there are data values");var r=B(e),n=Be(r);if(n===1)return[r];var o=ee(t,r.length),i=ee(t,r.length);Wo(r,o,i);for(var s=[],a=i[0].length-1,l=i.length-1;l>=0;l--){var c=i[l][a];s[l]=r.slice(c,a+1),l>0&&(a=c-1)}return s}function Jo(e,t,r){var n=e.length,o=[],i=r;for(o[r]=e[e.length-1];i>0;)o[i-1]=e[t[n][i]-1],n=t[n][i]-1,i--;return o}function Qo(e,t){var r=[],n=[],o,i,s=0;for(o=0;o<e.length+1;o++){var a=[],l=[];for(i=0;i<t+1;i++)a.push(0),l.push(0);r.push(a),n.push(l)}for(o=1;o<t+1;o++)for(r[1][o]=1,n[1][o]=0,i=2;i<e.length+1;i++)n[i][o]=1/0;for(var c=2;c<e.length+1;c++){for(var u=0,p=0,d=0,f=0,h=1;h<c+1;h++){var b=c-h+1,v=e[b-1];if(d++,u+=v,p+=v*v,s=p-u*u/d,f=b-1,f!==0)for(i=2;i<t+1;i++)n[c][i]>=s+n[f][i-1]&&(r[c][i]=b,n[c][i]=s+n[f][i-1])}r[c][1]=1,n[c][1]=s}return{lowerClassLimits:r,varianceCombinations:n}}function pr(e,t){if(t>e.length)return null;e=e.slice().sort(function(o,i){return o-i});var r=Qo(e,t),n=r.lowerClassLimits;return Jo(e,n,t)}function dr(e,t){if(e.length<2)return e;for(var r=qe(e),n=V(e),o=[r],i=(n-r)/t,s=1;s<t;s++)o.push(o[0]+i*s);return o.push(n),o}function Ve(e,t){if(e.length!==t.length)throw new Error("sampleCovariance requires samples with equal lengths");if(e.length<2)throw new Error("sampleCovariance requires at least two data points in each sample");for(var r=y(e),n=y(t),o=0,i=0;i<e.length;i++)o+=(e[i]-r)*(t[i]-n);var s=e.length-1;return o/s}function Z(e){if(e.length<2)throw new Error("sampleVariance requires at least two data points");var t=re(e,2),r=e.length-1;return t/r}function F(e){var t=Z(e);return Math.sqrt(t)}function Ge(e,t){var r=Ve(e,t),n=F(e),o=F(t);return r/n/o}function hr(e,t){for(var r=e.map(function(a,l){return[a,l]}).sort(function(a,l){return a[0]-l[0]}).map(function(a){return a[1]}),n=t.map(function(a,l){return[a,l]}).sort(function(a,l){return a[0]-l[0]}).map(function(a){return a[1]}),o=Array(r.length),i=Array(r.length),s=0;s<r.length;s++)o[r[s]]=s,i[n[s]]=s;return Ge(o,i)}function mr(e){if(e.length<3)throw new Error("sampleSkewness requires at least three data points");for(var t=y(e),r,n=0,o=0,i=0;i<e.length;i++)r=e[i]-t,n+=r*r,o+=r*r*r;var s=e.length-1,a=Math.sqrt(n/s),l=e.length,c=Math.pow(a,3);return l*o/((l-1)*(l-2)*c)}function gr(e){var t=e.length;if(t<4)throw new Error("sampleKurtosis requires at least four data points");for(var r=y(e),n,o=0,i=0,s=0;s<t;s++)n=e[s]-r,o+=n*n,i+=n*n*n*n;return(t-1)/((t-2)*(t-3))*(t*(t+1)*i/(o*o)-3*(t-1))}function yr(e){for(var t=new Array(e.length),r=[e.slice()],n=0;n<e.length;n++)t[n]=0;for(var o=0;o<e.length;)if(t[o]<o){var i=0;o%2!==0&&(i=t[o]);var s=e[i];e[i]=e[o],e[o]=s,r.push(e.slice()),t[o]++,o=0}else t[o]=0,o++;return r}function Re(e,t){var r,n,o=[],i,s;for(r=0;r<e.length;r++)if(t===1)o.push([e[r]]);else for(i=Re(e.slice(r+1,e.length),t-1),n=0;n<i.length;n++)s=i[n],s.unshift(e[r]),o.push(s);return o}function Ze(e,t){for(var r=[],n=0;n<e.length;n++)if(t===1)r.push([e[n]]);else for(var o=Ze(e.slice(n,e.length),t-1),i=0;i<o.length;i++)r.push([e[n]].concat(o[i]));return r}function vr(e,t,r){return e+(r-e)/(t+1)}function Ue(e,t,r,n){return(e*t+r*n)/(t+n)}function br(e,t,r,n,o,i){var s=Ue(t,r,o,i);return(r*(e+Math.pow(t-s,2))+i*(n+Math.pow(o-s,2)))/(r+i)}function wr(e){if(e.length===0)throw new Error("geometricMean requires at least one data point");for(var t=1,r=0;r<e.length;r++){if(e[r]<0)throw new Error("geometricMean requires only non-negative numbers as input");t*=e[r]}return Math.pow(t,1/e.length)}function xr(e){if(e.length===0)throw new Error("logAverage requires at least one data point");for(var t=0,r=0;r<e.length;r++){if(e[r]<0)throw new Error("logAverage requires only non-negative numbers as input");t+=Math.log(e[r])}return Math.exp(t/e.length)}function Sr(e){if(e.length===0)throw new Error("harmonicMean requires at least one data point");for(var t=0,r=0;r<e.length;r++){if(e[r]<=0)throw new Error("harmonicMean requires only positive numbers as input");t+=1/e[r]}return e.length/t}function Ke(e){if(e.length===0)throw new Error("meanSimple requires at least one data point");return _e(e)/e.length}function kr(e){return G(e,.5)}function Mr(e,t,r){return(e*t-r)/(t-1)}function He(e){if(e.length===0)throw new Error("rootMeanSquare requires at least one data point");for(var t=0,r=0;r<e.length;r++)t+=Math.pow(e[r],2);return Math.sqrt(t/e.length)}function Er(e){return F(e)/y(e)}function Cr(e,t){var r=y(e),n=Fe(e),o=Math.sqrt(e.length);return(r-t)/(n/o)}function Lr(e,t,r){var n=e.length,o=t.length;if(!n||!o)return null;r||(r=0);var i=y(e),s=y(t),a=Z(e),l=Z(t);if(typeof i=="number"&&typeof s=="number"&&typeof a=="number"&&typeof l=="number"){var c=((n-1)*a+(o-1)*l)/(n+o-2);return(i-s-r)/Math.sqrt(c*(1/n+1/o))}}function $r(e,t){if(!e.length||!t.length)throw new Error("Neither sample can be empty");for(var r=e.map(function(u){return{label:"x",value:u}}).concat(t.map(function(u){return{label:"y",value:u}})).sort(function(u,p){return u.value-p.value}),n=0;n<r.length;n++)r[n].rank=n;for(var o=[r[0].rank],i=1;i<r.length;i++)r[i].value===r[i-1].value?(o.push(r[i].rank),i===r.length-1&&s(r,o)):o.length>1?s(r,o):o=[r[i].rank];function s(u,p){for(var d=(p[0]+p[p.length-1])/2,f=0;f<p.length;f++)u[p[f]].rank=d}for(var a=0,l=0;l<r.length;l++){var c=r[l];c.label==="x"&&(a+=c.rank+1)}return a}var U=function(){this.totalCount=0,this.data={}};U.prototype.train=function(t,r){this.data[r]||(this.data[r]={});for(var n in t){var o=t[n];this.data[r][n]===void 0&&(this.data[r][n]={}),this.data[r][n][o]===void 0&&(this.data[r][n][o]=0),this.data[r][n][o]++}this.totalCount++},U.prototype.score=function(t){var r={},n;for(var o in t){var i=t[o];for(n in this.data)r[n]={},this.data[n][o]?r[n][o+"_"+i]=(this.data[n][o][i]||0)/this.totalCount:r[n][o+"_"+i]=0}var s={};for(n in r){s[n]=0;for(var a in r[n])s[n]+=r[n][a]}return s};var K=function(){this.weights=[],this.bias=0};K.prototype.predict=function(t){if(t.length!==this.weights.length)return null;for(var r=0,n=0;n<this.weights.length;n++)r+=this.weights[n]*t[n];return r+=this.bias,r>0?1:0},K.prototype.train=function(t,r){if(r!==0&&r!==1)return null;t.length!==this.weights.length&&(this.weights=t,this.bias=1);var n=this.predict(t);if(typeof n=="number"&&n!==r){for(var o=r-n,i=0;i<this.weights.length;i++)this.weights[i]+=o*t[i];this.bias+=o}return this};var $=1e-4;function We(e){if(e<0)throw new Error("factorial requires a non-negative value");if(Math.floor(e)!==e)throw new Error("factorial requires an integer input");for(var t=1,r=2;r<=e;r++)t*=r;return t}function Je(e){if(Number.isInteger(e))return e<=0?NaN:We(e-1);if(e--,e<0)return Math.PI/(Math.sin(Math.PI*-e)*Je(-e));var t=Math.pow(e/Math.E,e)*Math.sqrt(2*Math.PI*(e+.16666666666666666)),r=e+1/4,n=1+1/144/Math.pow(r,2)-1/12960/Math.pow(r,3)-257/207360/Math.pow(r,4)-52/2612736/Math.pow(r,5)+5741173/9405849600/Math.pow(r,6)+37529/18811699200/Math.pow(r,7);return t*n}var Jt=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22],Xo=607/128,Yo=Math.log(Math.sqrt(2*Math.PI));function Tr(e){if(e<=0)return 1/0;e--;for(var t=Jt[0],r=1;r<15;r++)t+=Jt[r]/(e+r);var n=Xo+.5+e;return Yo+Math.log(t)-n+(e+.5)*Math.log(n)}function jr(e){if(e<0||e>1)throw new Error("bernoulliDistribution requires probability to be between 0 and 1 inclusive");return[1-e,e]}function Ir(e,t){if(!(t<0||t>1||e<=0||e%1!==0)){var r=0,n=0,o=[],i=1;do o[r]=i*Math.pow(t,r)*Math.pow(1-t,e-r),n+=o[r],r++,i=i*(e-r+1)/r;while(n<1-$);return o}}function Pr(e){if(!(e<=0)){var t=0,r=0,n=[],o=1;do n[t]=Math.exp(-e)*Math.pow(e,t)/o,r+=n[t],t++,o*=t;while(r<1-$);return n}}var Qe={1:{.995:0,.99:0,.975:0,.95:0,.9:.02,.5:.45,.1:2.71,.05:3.84,.025:5.02,.01:6.63,.005:7.88},2:{.995:.01,.99:.02,.975:.05,.95:.1,.9:.21,.5:1.39,.1:4.61,.05:5.99,.025:7.38,.01:9.21,.005:10.6},3:{.995:.07,.99:.11,.975:.22,.95:.35,.9:.58,.5:2.37,.1:6.25,.05:7.81,.025:9.35,.01:11.34,.005:12.84},4:{.995:.21,.99:.3,.975:.48,.95:.71,.9:1.06,.5:3.36,.1:7.78,.05:9.49,.025:11.14,.01:13.28,.005:14.86},5:{.995:.41,.99:.55,.975:.83,.95:1.15,.9:1.61,.5:4.35,.1:9.24,.05:11.07,.025:12.83,.01:15.09,.005:16.75},6:{.995:.68,.99:.87,.975:1.24,.95:1.64,.9:2.2,.5:5.35,.1:10.65,.05:12.59,.025:14.45,.01:16.81,.005:18.55},7:{.995:.99,.99:1.25,.975:1.69,.95:2.17,.9:2.83,.5:6.35,.1:12.02,.05:14.07,.025:16.01,.01:18.48,.005:20.28},8:{.995:1.34,.99:1.65,.975:2.18,.95:2.73,.9:3.49,.5:7.34,.1:13.36,.05:15.51,.025:17.53,.01:20.09,.005:21.96},9:{.995:1.73,.99:2.09,.975:2.7,.95:3.33,.9:4.17,.5:8.34,.1:14.68,.05:16.92,.025:19.02,.01:21.67,.005:23.59},10:{.995:2.16,.99:2.56,.975:3.25,.95:3.94,.9:4.87,.5:9.34,.1:15.99,.05:18.31,.025:20.48,.01:23.21,.005:25.19},11:{.995:2.6,.99:3.05,.975:3.82,.95:4.57,.9:5.58,.5:10.34,.1:17.28,.05:19.68,.025:21.92,.01:24.72,.005:26.76},12:{.995:3.07,.99:3.57,.975:4.4,.95:5.23,.9:6.3,.5:11.34,.1:18.55,.05:21.03,.025:23.34,.01:26.22,.005:28.3},13:{.995:3.57,.99:4.11,.975:5.01,.95:5.89,.9:7.04,.5:12.34,.1:19.81,.05:22.36,.025:24.74,.01:27.69,.005:29.82},14:{.995:4.07,.99:4.66,.975:5.63,.95:6.57,.9:7.79,.5:13.34,.1:21.06,.05:23.68,.025:26.12,.01:29.14,.005:31.32},15:{.995:4.6,.99:5.23,.975:6.27,.95:7.26,.9:8.55,.5:14.34,.1:22.31,.05:25,.025:27.49,.01:30.58,.005:32.8},16:{.995:5.14,.99:5.81,.975:6.91,.95:7.96,.9:9.31,.5:15.34,.1:23.54,.05:26.3,.025:28.85,.01:32,.005:34.27},17:{.995:5.7,.99:6.41,.975:7.56,.95:8.67,.9:10.09,.5:16.34,.1:24.77,.05:27.59,.025:30.19,.01:33.41,.005:35.72},18:{.995:6.26,.99:7.01,.975:8.23,.95:9.39,.9:10.87,.5:17.34,.1:25.99,.05:28.87,.025:31.53,.01:34.81,.005:37.16},19:{.995:6.84,.99:7.63,.975:8.91,.95:10.12,.9:11.65,.5:18.34,.1:27.2,.05:30.14,.025:32.85,.01:36.19,.005:38.58},20:{.995:7.43,.99:8.26,.975:9.59,.95:10.85,.9:12.44,.5:19.34,.1:28.41,.05:31.41,.025:34.17,.01:37.57,.005:40},21:{.995:8.03,.99:8.9,.975:10.28,.95:11.59,.9:13.24,.5:20.34,.1:29.62,.05:32.67,.025:35.48,.01:38.93,.005:41.4},22:{.995:8.64,.99:9.54,.975:10.98,.95:12.34,.9:14.04,.5:21.34,.1:30.81,.05:33.92,.025:36.78,.01:40.29,.005:42.8},23:{.995:9.26,.99:10.2,.975:11.69,.95:13.09,.9:14.85,.5:22.34,.1:32.01,.05:35.17,.025:38.08,.01:41.64,.005:44.18},24:{.995:9.89,.99:10.86,.975:12.4,.95:13.85,.9:15.66,.5:23.34,.1:33.2,.05:36.42,.025:39.36,.01:42.98,.005:45.56},25:{.995:10.52,.99:11.52,.975:13.12,.95:14.61,.9:16.47,.5:24.34,.1:34.28,.05:37.65,.025:40.65,.01:44.31,.005:46.93},26:{.995:11.16,.99:12.2,.975:13.84,.95:15.38,.9:17.29,.5:25.34,.1:35.56,.05:38.89,.025:41.92,.01:45.64,.005:48.29},27:{.995:11.81,.99:12.88,.975:14.57,.95:16.15,.9:18.11,.5:26.34,.1:36.74,.05:40.11,.025:43.19,.01:46.96,.005:49.65},28:{.995:12.46,.99:13.57,.975:15.31,.95:16.93,.9:18.94,.5:27.34,.1:37.92,.05:41.34,.025:44.46,.01:48.28,.005:50.99},29:{.995:13.12,.99:14.26,.975:16.05,.95:17.71,.9:19.77,.5:28.34,.1:39.09,.05:42.56,.025:45.72,.01:49.59,.005:52.34},30:{.995:13.79,.99:14.95,.975:16.79,.95:18.49,.9:20.6,.5:29.34,.1:40.26,.05:43.77,.025:46.98,.01:50.89,.005:53.67},40:{.995:20.71,.99:22.16,.975:24.43,.95:26.51,.9:29.05,.5:39.34,.1:51.81,.05:55.76,.025:59.34,.01:63.69,.005:66.77},50:{.995:27.99,.99:29.71,.975:32.36,.95:34.76,.9:37.69,.5:49.33,.1:63.17,.05:67.5,.025:71.42,.01:76.15,.005:79.49},60:{.995:35.53,.99:37.48,.975:40.48,.95:43.19,.9:46.46,.5:59.33,.1:74.4,.05:79.08,.025:83.3,.01:88.38,.005:91.95},70:{.995:43.28,.99:45.44,.975:48.76,.95:51.74,.9:55.33,.5:69.33,.1:85.53,.05:90.53,.025:95.02,.01:100.42,.005:104.22},80:{.995:51.17,.99:53.54,.975:57.15,.95:60.39,.9:64.28,.5:79.33,.1:96.58,.05:101.88,.025:106.63,.01:112.33,.005:116.32},90:{.995:59.2,.99:61.75,.975:65.65,.95:69.13,.9:73.29,.5:89.33,.1:107.57,.05:113.14,.025:118.14,.01:124.12,.005:128.3},100:{.995:67.33,.99:70.06,.975:74.22,.95:77.93,.9:82.36,.5:99.33,.1:118.5,.05:124.34,.025:129.56,.01:135.81,.005:140.17}};function Fr(e,t,r){for(var n=y(e),o=0,i=1,s=t(n),a=[],l=[],c=0;c<e.length;c++)a[e[c]]===void 0&&(a[e[c]]=0),a[e[c]]++;for(var u=0;u<a.length;u++)a[u]===void 0&&(a[u]=0);for(var p in s)p in a&&(l[+p]=s[p]*e.length);for(var d=l.length-1;d>=0;d--)l[d]<3&&(l[d-1]+=l[d],l.pop(),a[d-1]+=a[d],a.pop());for(var f=0;f<a.length;f++)o+=Math.pow(a[f]-l[f],2)/l[f];var h=a.length-i-1;return Qe[h][r]<o}var ei=Math.sqrt(2*Math.PI),$e={gaussian:function(e){return Math.exp(-.5*e*e)/ei}},Te={nrd:function(e){var t=F(e),r=ne(e);return typeof r=="number"&&(t=Math.min(t,r/1.34)),1.06*t*Math.pow(e.length,-.2)}};function Xe(e,t,r){var n;if(t===void 0)n=$e.gaussian;else if(typeof t=="string"){if(!$e[t])throw new Error('Unknown kernel "'+t+'"');n=$e[t]}else n=t;var o;if(typeof r>"u")o=Te.nrd(e);else if(typeof r=="string"){if(!Te[r])throw new Error('Unknown bandwidth method "'+r+'"');o=Te[r](e)}else o=r;return function(i){var s=0,a=0;for(s=0;s<e.length;s++)a+=n((i-e[s])/o);return a/o/e.length}}function Or(e,t,r){return(e-t)/r}var ti=Math.sqrt(2*Math.PI);function ri(e){for(var t=e,r=e,n=1;n<15;n++)r*=e*e/(2*n+1),t+=r;return Math.round((.5+t/ti*Math.exp(-e*e/2))*1e4)/1e4}var O=[];for(te=0;te<=3.09;te+=.01)O.push(ri(te));function qr(e){var t=Math.abs(e),r=Math.min(Math.round(t*100),O.length-1);return e>=0?O[r]:+(1-O[r]).toFixed(4)}function _r(e){return 1/(Math.exp(-e)+1)}function Ye(e){var t=1/(1+.5*Math.abs(e)),r=t*Math.exp(-e*e+((((((((.17087277*t-.82215223)*t+1.48851587)*t-1.13520398)*t+.27886807)*t-.18628806)*t+.09678418)*t+.37409196)*t+1.00002368)*t-1.26551223);return e>=0?1-r:r-1}function et(e){var t=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),r=Math.sqrt(Math.sqrt(Math.pow(2/(Math.PI*t)+Math.log(1-e*e)/2,2)-Math.log(1-e*e)/t)-(2/(Math.PI*t)+Math.log(1-e*e)/2));return e>=0?r:-r}function Ar(e){return e===0?e=$:e>=1&&(e=1-$),Math.sqrt(2)*et(2*e-1)}function zr(e){if(e<=0||e>=1)throw new Error("p must be strictly between zero and one");return Math.log(e/(1-e))}function Nr(e,t,r,n,o){if(n===void 0&&(n=1e4),r===void 0&&(r="two_side"),r!=="two_side"&&r!=="greater"&&r!=="less")throw new Error("`alternative` must be either 'two_side', 'greater', or 'less'.");for(var i=y(e),s=y(t),a=i-s,l=new Array(n),c=e.concat(t),u=Math.floor(c.length/2),p=0;p<n;p++){ie(c,o);var d=c.slice(0,u),f=c.slice(u,c.length),h=y(d)-y(f);l[p]=h}var b=0;if(r==="two_side")for(var v=0;v<=n;v++)Math.abs(l[v])>=Math.abs(a)&&(b+=1);else if(r==="greater")for(var S=0;S<=n;S++)l[S]>=a&&(b+=1);else for(var w=0;w<=n;w++)l[w]<=a&&(b+=1);return b/n}function ae(e){if(typeof e=="number")return e<0?-1:e===0?0:1;throw new TypeError("not a number")}function Dr(e,t,r,n,o){if(typeof e!="function")throw new TypeError("func must be a function");for(var i=0;i<n;i++){var s=(t+r)/2;if(e(s)===0||Math.abs((r-t)/2)<o)return s;ae(e(s))===ae(e(t))?t=s:r=s}throw new Error("maximum number of iterations exceeded")}function je(e,t){for(var r=0,n=0;n<e.length;n++){var o=e[n]-t[n];r+=o*o}return Math.sqrt(r)}function Br(e,t,r){r===void 0&&(r=Math.random);for(var n=null,o=De(e,t,r),i=null,s=Number.MAX_VALUE;s!==0;)i=ni(e,o),n=o,o=oi(e,i,t),s=ii(o,n);return{labels:i,centroids:o}}function ni(e,t){return e.map(function(r){for(var n=Number.MAX_VALUE,o=-1,i=0;i<t.length;i++){var s=je(r,t[i]);s<n&&(n=s,o=i)}return o})}function oi(e,t,r){for(var n=e[0].length,o=ee(r,n),i=Array(r).fill(0),s=e.length,a=0;a<s;a++){for(var l=e[a],c=t[a],u=o[c],p=0;p<n;p++)u[p]+=l[p];i[c]+=1}for(var d=0;d<r;d++){if(i[d]===0)throw new Error("Centroid "+d+" has no friends");for(var f=o[d],h=0;h<n;h++)f[h]/=i[d]}return o}function ii(e,t){for(var r=0,n=0;n<e.length;n++)r+=je(e[n],t[n]);return r}function tt(e,t){if(e.length!==t.length)throw new Error("must have exactly as many labels as points");for(var r=ai(t),n=si(e),o=[],i=0;i<e.length;i++){var s=0;if(r[t[i]].length>1){var a=Qt(i,r[t[i]],n),l=li(i,t,r,n);s=(l-a)/Math.max(a,l)}o.push(s)}return o}function ai(e){for(var t=1+V(e),r=Array(t),n=0;n<e.length;n++){var o=e[n];r[o]===void 0&&(r[o]=[]),r[o].push(n)}return r}function si(e){for(var t=e.length,r=ee(t,t),n=0;n<t;n++)for(var o=0;o<n;o++)r[n][o]=je(e[n],e[o]),r[o][n]=r[n][o];return r}function li(e,t,r,n){for(var o=t[e],i=Number.MAX_VALUE,s=0;s<r.length;s++)if(s!==o){var a=Qt(e,r[s],n);a<i&&(i=a)}return i}function Qt(e,t,r){for(var n=0,o=0;o<t.length;o++)n+=r[e][t[o]];return n/t.length}function Vr(e,t){var r=tt(e,t);return V(r)}function rt(e,t){return e===0&&t===0?0:Math.abs((e-t)/t)}function Gr(e,t,r){return r===void 0&&(r=$),rt(e,t)<=r}var te;function ot(e,t={}){if(!Array.isArray(e)){console.warn("Array argument for csvDownload must be an array");return}t.separator??=",";let r=e.map(i=>(Array.isArray(t.fields)?ci(i,t.fields):Object.values(i)).join(t.separator));t.type??="text/csv;charset=utf-8;",t.join??=`\r
`,t.title??="file",t.header&&Array.isArray(t.fields)&&r.unshift(t.fields.map(i=>i.title||i.field));let n=new Blob([r.join(t.join)],{type:t.type}),o=document.createElement("a");o.download=`${t.title}.csv`,o.href=URL.createObjectURL(n),o.dataset.downloadurl=["csv",o.download,o.href].join(":"),o.style.display="none",document.body.append(o),o.click(),o.remove()}function ci(e,t){return t.map(r=>{if(r.field){if(typeof e[r.field]=="string"&&r.string)return`"${e[r.field].replaceAll('"','\\"')}"`;if(r.formatter==="toLocaleString"){let n=parseFloat(e[r.field]);return isNaN(n)?void 0:`"${n.toLocaleString(r.locale||navigator.language,r.options)}"`}return e[r.field]}})}var it,Rr;async function ui(){it||(it=new Promise(async e=>{import("https://cdn.skypack.dev/convert@4").then(t=>e(Rr=t.convert))})),await it}var Zr=async(e,t)=>(await ui(),e=parseFloat(e),t.units&&t.convertTo&&(e=Rr(e,t.units).to(t.convertTo)),e=e.toFixed(t.decimals||0),e=e.toLocaleString(t.locale||"en-GB"),`${t.prefix||""}${e}${t.suffix||""}`);function Ur(e){let t=document.body.appendChild(mapp.utils.html.node`
    <textarea style="visibility=none;">`);t.value=e,t.select(),document.execCommand("copy"),t.remove()}function Kr(e){if(e.indexOf(";base64,")==-1){let i=e.split(","),s=i[0].split(":")[1],a=i[1];return new Blob([a],{type:s})}let t=e.split(";base64,"),r=t[0].split(":")[1],n=window.atob(t[1]),o=new Uint8Array(n.length);for(let i=0;i<n.length;++i)o[i]=n.charCodeAt(i);return new Blob([o],{type:r})}var Hr=(e,t)=>isNaN(t)?e:e.length===7?e+(t&&parseInt(t*255).toString(16)||"00"):e.length===4?e+parseInt(t*15).toString(16):e;function at(e,t=[".js",".mjs"]){if(Array.isArray(e))return new Promise(r=>{let n=e.filter(o=>t.some(i=>o.endsWith(i))).map(o=>new Promise((i,s)=>import(o).then(a=>{i(a)}).catch(a=>{console.warn(`Failed to load plugin: ${o}`),console.error(a),s(a)})));Promise.allSettled(n).then(()=>{r()}).catch(o=>{console.error(o),r()})})}function Wr(e,t={}){navigator.geolocation.getCurrentPosition(e,r=>console.error(r),t)}function H(e,...t){if(!t.length)return e;let r=t.shift();if(st(e)&&st(r)){let n=Object.getPrototypeOf(e);for(let o in r)n[o]?console.warn(`Prototype polution detected for key: ${o}`):r[o]instanceof HTMLElement?console.warn(r[o]):st(r[o])?(e[o]??={},H(e[o],r[o])):e[o]=r[o]}return H(e,...t)}function st(e){if(e===!0||e===!1||e===null||Array.isArray(e))return!1;if(typeof e=="object")return!0}var Jr=e=>e?Object.entries(e).filter(r=>r[1]===0||!!r[1]).filter(r=>r[1]!=="{}").filter(r=>typeof r[1]!="object"||r[1].length||Object.values(r[1]).some(n=>typeof n=="object"&&Object.keys(n).length)).map(r=>typeof r[1]=="object"&&!Array.isArray(r[1])?`${r[0]}=${encodeURIComponent(JSON.stringify(r[1]))}`:encodeURI(`${r[0]}=${r[1]}`)).join("&"):"";function Qr(e){if(!e.mapview)return;function t(n){return Array.isArray(n)?1+Math.max(0,...n.map(t)):0}let r={type:"Polygon",drawend:n=>{let i=n.feature.getGeometry(),s=e.mapview.interaction.snap.source.getFeatures();s=s.filter(a=>{let l=a.getGeometry().getCoordinates();return l=l.flat(t(l)-2),l.some(c=>i.intersectsCoordinate(c))}),e.drawendCallback&&e.drawendCallback(s)},...e};e.mapview.interactions.draw(r)}var Xr=e=>new Promise((t,r)=>{Promise.all(e).then(t).catch(n=>{console.error(n),r(n)})});var Yr=e=>{if(typeof e.queryparams!="object"){console.warn("queryparams must be an object");return}e.queryparams.layer=e.queryparams.layer||e.viewport,e.queryparams.table&&=typeof e.queryparams.table=="string"?e.queryparams.table:fi(e);let t=e.viewport&&e.layer.mapview.getBounds(),r=e.queryparams.center&&ol.proj.transform(e.layer.mapview.Map.getView().getCenter(),`EPSG:${e.layer.mapview.srid}`,"EPSG:4326");return{...e.queryparams,template:encodeURIComponent(e.query),filter:e.queryparams.filter?e.layer.filter?.current:void 0,locale:e.queryparams.layer?e.layer.mapview.locale.key:void 0,layer:e.queryparams.layer?e.layer.key:void 0,id:e.queryparams.id?e.location?.id:void 0,qID:e.queryparams.qID?e.location?.layer?.qID:void 0,email:e.queryparams.email?mapp.user.email:void 0,lat:r&&r[1],lng:r&&r[0],z:e.queryparams?.z&&e.layer.mapview.Map.getView().getZoom(),viewport:t&&[t.west,t.south,t.east,t.north,e.layer.mapview.srid],fieldValues:void 0}};function fi(e){return e.location?.layer?.table||e.layer?.table||e.location?.layer?.tableCurrent?.()||e.layer?.tableCurrent?.()||e.location?.layer?.tableCurrent?.()||e.layer?.tables&&Object.values(e.layer.tables).find(t=>!!t)||e.location?.layer?.tables&&Object.values(e.location?.layer.tables).find(t=>!!t)}function lt(e,t){if(!e)return;let r=[];return e=Array.isArray(e)?e:[e],e.forEach(n=>{if(n.icon){let o=function(i,s){let a=s.scale||1;a*=i.scale||1,a*=i.clusterScale||1,a*=i.zoomInScale||1,a*=i.zoomOutScale||1,a*=i.highlightScale||1,s.url=s.url||s.svg||mapp.utils.svgSymbols[s.type||"dot"](s,t),s.url&&r.push(new ol.style.Style({image:new ol.style.Icon({src:s.url,crossOrigin:"anonymous",scale:a,anchor:s.anchor||[.5,.5]}),zIndex:i.zIndex}))};Array.isArray(n.icon)?n.icon.forEach(i=>o(n,i)):o(n,n.icon)}if(n.fillColor||n.strokeColor){let o=n.fillColor&&new ol.style.Fill({color:mapp.utils.hexa(n.fillColor,n.fillOpacity)}),i=n.strokeColor&&new ol.style.Stroke({color:mapp.utils.hexa(n.strokeColor,n.strokeOpacity),width:parseFloat(n.strokeWidth||1)});r.push(new ol.style.Style({fill:o,stroke:i,zIndex:n.zIndex}))}if(typeof n.label?.text<"u"){let o=new ol.style.Text({font:n.label.font||"12px sans-serif",text:String(n.label.text),overflow:n.label.overflow,offsetY:n.label.offsetY,offsetX:n.label.offsetX,stroke:n.label.strokeColor&&new ol.style.Stroke({color:n.label.strokeColor,width:n.label.strokeWidth||1}),fill:new ol.style.Fill({color:n.label.fillColor||"#000"})});r.push(new ol.style.Style({text:o,zIndex:n.zIndex}))}}),t?.set?.("Styles",r,!0),r}var ut={};j(ut,{circle:()=>wi,diamond:()=>gi,dot:()=>pi,markerColor:()=>bi,markerLetter:()=>vi,semiCircle:()=>yi,square:()=>mi,target:()=>di,template:()=>xi,triangle:()=>hi});var k=new XMLSerializer,ct={dot:new Map};function pi(e){let t=Object.values({fillColor:e.fillColor}).reduce((n,o)=>n+o);if(ct.dot.has(t))return ct.dot.get(t);let r=m.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 r=10 fill='#333'></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#fff"}></circle>`;return r=`data:image/svg+xml,${encodeURIComponent(k.serializeToString(r))}`,ct.dot.set(t,r),r}function di(e){let t=m.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 fill='#333' r=10 opacity=0.4></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#FFF"}>`;return e.layers&&Object.entries(e.layers).forEach(r=>{t.appendChild(m.node`<circle cx=12 cy=12 r=${parseFloat(r[0])*10} fill=${r[1]}>`)}),`data:image/svg+xml,${encodeURIComponent(k.serializeToString(t))}`}function hi(e){let t=m.node`
    <svg width=24 height=24 viewBox='${"0 0 24 24"}' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        points="12,4.68 2,22 22,22" 
        fill="#333" stroke="#333" opacity=0.4 stroke-opacity=0.4 stroke-width=3
        stroke-linejoin="round"/>`;return t.appendChild(m.node`
    <polygon
      fill=${e.fillColor||"#FFF"} stroke=${e.fillColor||"#FFF"} stroke-width=2
      points="12,4.68 2,22 22,22"  stroke-linejoin="round"/>`),e.layers&&Object.entries(e.layers).forEach(r=>{function n(s,a){return 12+(s-12)*a}function o(s,a){return 16+(s-16)*a}let i=`${n(12,r[0])},${o(4.68,r[0])} ${n(2,r[0])}, ${o(22,r[0])} ${n(22,r[0])}, ${o(22,r[0])}`;t.appendChild(m.node`
      <polygon
        points="${i}"
        fill=${r[1]}
        stroke=${r[1]||"#FFF"}
        stroke-width=1
        stroke-linejoin="round"/>`)}),`data:image/svg+xml,${encodeURIComponent(k.serializeToString(t))}`}function mi(e){let t=m.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <rect fill='#333' opacity=0.3 width=20 height=20 x=2 y=2 rx=1></rect>
      <rect fill=${e.fillColor||"#FFF"} width=20 height=20 x=0 y=0 rx=1></rect>`;return e.layers&&Object.entries(e.layers).forEach(r=>{t.appendChild(m.node`
      <rect fill=${r[1]}
        width=${parseFloat(r[0])*20}
        height=${parseFloat(r[0])*20}
        x=${10*(1-parseFloat(r[0]))}
        y=${10*(1-parseFloat(r[0]))} rx=${parseFloat(r[0])}></rect>`)}),`data:image/svg+xml,${encodeURIComponent(k.serializeToString(t))}`}function gi(e){let t=m.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        fill='#333'
        opacity=0.3
        points="12 0, 24 12, 12 24, 0 12"></polygon>
      <polygon
        fill=${e.fillColor||"#FFF"}
        points="12 0, 24 12, 12 24, 0 12"></polygon>`;function r(n,o){return 12+(n-12)*o}return e.layers&&Object.entries(e.layers).forEach(n=>{let o=`${r(12,n[0])} ${r(0,n[0])},${r(24,n[0])} ${r(12,n[0])},${r(12,n[0])} ${r(24,n[0])}, ${r(0,n[0])} ${r(12,n[0])}`;t.appendChild(m.node`
      <polygon
        fill=${n[1]||"#FFF"}
        points="${o}"></polygon>`)}),`data:image/svg+xml,${encodeURIComponent(k.serializeToString(t))}`}function yi(e){let t=m.node`
    <svg width=30 height=30 viewBox='0 0 20 24' xmlns='http://www.w3.org/2000/svg'>
      <defs>
        <clipPath id="cut-off-shade">
          <rect x="0" y="0" width="24" height="11"/>
        </clipPath>
        <clipPath id="cut-off">
          <rect x="0" y="0" width="24" height="10"/>
        </clipPath>
      </defs>
      <circle cx="11" cy="10" r="10" clip-path="url(#cut-off-shade)" fill="#333" opacity=0.4></circle>
      <circle cx=10 cy=10 r=10 fill=${e.fillColor||"#FFF"} clip-path="url(#cut-off-shade)">`;return e.layers&&Object.entries(e.layers).forEach(r=>{t.appendChild(m.node`
      <circle cx=10 cy=10 r=${parseFloat(r[0])*10} fill=${r[1]} clip-path="url(#cut-off-shade)">`)}),`data:image/svg+xml,${encodeURIComponent(k.serializeToString(t))}`}function vi(e){let t=m.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path fill="${e.color}"
        d="M 12 1.969 C 7.878 1.969 4.813 5.239 4.813 9.328 C 4.813 10.554 5.222 12.189 6.244 14.028 C 8.289 17.504 12 22 12 22 C 12 22 16.055 17.504 18.099 14.028 C 19.122 12.189 19.341 10.963 19.341 9.328 C 19.341 5.239 16.054 1.969 12 1.969 Z"/>
      <circle cx="12.17192400568182" cy="8.918683238636365" r="5.109789772727275" fill="rgb(255, 255, 255)"/>
      <text x="12" y="12" style="text-anchor: middle; font-weight: 600; font-size: 9px; font-family: sans-serif; fill: rgb(85, 85, 85);">
      ${e.letter}`;return`data:image/svg+xml,${encodeURIComponent(k.serializeToString(t))}`}function bi(e){let t=m.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path style="opacity: 0.5;" fill="${e.colorMarker}"
        d="M 10.797 1.238 C 6.308 1.238 2.716 4.83 2.716 9.32 C 2.716 11.116 3.165 12.463 4.287 14.483 C 6.532 18.3 9.952 23.234 9.952 23.234 C 9.952 23.234 15.063 18.3 17.308 14.483 C 18.43 12.463 18.879 11.116 18.879 9.32 C 18.879 4.83 15.287 1.238 10.797 1.238 Z"/>
      <path fill="${e.colorMarker}"
        d="M 10 1.238 C 5.51 1.238 2.144 4.83 2.144 9.32 C 2.144 10.667 2.593 12.463 3.716 14.483 C 5.961 18.3 10 23.238 10 23.238 C 10 23.238 14.491 18.3 16.736 14.483 C 17.859 12.463 18.1 11.116 18.1 9.32 C 18.1 4.83 14.49 1.238 10 1.238 Z"/>
      <circle cx="10.226" cy="8.871" r="5.612" opacity="0.8" fill="rgb(255, 255, 255)"/>
      <circle cx="10.226" cy="8.871" r="2.806" opacity="0.8" fill="${e.colorDot}"/>`;return`data:image/svg+xml,${encodeURIComponent(k.serializeToString(t))}`}function wi(e){let t=m.node`
    <svg width=24 height=24 viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=16 cy=16 r=10
        stroke="${e.strokeColor||"#333"}"
        stroke-width="${e.strokeWidth||1}"
        fill="#ffffff33">`;return`data:image/svg+xml,${encodeURIComponent(k.serializeToString(t))}`}function xi(e){let t=mapp.utils.svgSymbols.templates?.[e.template];if(t)return typeof e.substitute=="object"&&Object.entries(e.substitute).forEach(r=>{t=t.replaceAll(r[0],r[1])}),`data:image/svg+xml,${encodeURIComponent(t)}`}var ft={};j(ft,{add:()=>ki,deleteDB:()=>Si,get:()=>Mi,openDB:()=>se,put:()=>Ei});var C;async function se(e){let t=e.toString(),r=new Promise((n,o)=>{let i=indexedDB.open(`${mapp.user.email} - ${mapp.user.title}`,3);i.onerror=s=>{console.error(i.error),n(i)},i.onsuccess=s=>{s.target.result.objectStoreNames.contains(t)||(console.warn(`UserIDB doesn't contain "${t}" objectStore.`),C=null,n()),C=s.target.result,n()},i.onupgradeneeded=s=>{s.target.result.createObjectStore(t,{keyPath:"key"})}});return await r,r}function Si(){mapp.user&&(indexedDB.deleteDatabase(`${mapp.user.email} - ${mapp.user.title}`),console.log("Database deleted"))}async function ki(e,t){C||await se(e);let r=new Promise((n,o)=>{let a=C.transaction([e],"readwrite").objectStore(e).add(t);a.onerror=l=>{console.error(a.error),n(a)},a.onsuccess=l=>{n(l.target.result)}});return await r,r}async function Mi(e,t){C||await se(e);let r=new Promise((n,o)=>{let a=C.transaction([e],"readwrite").objectStore(e).get(t);a.onerror=l=>{console.error(a.error),o(a)},a.onsuccess=l=>{n(a.result)}});return await r,r}async function Ei(e,t){C||await se(e);let r=new Promise((n,o)=>{let a=C.transaction([e],"readwrite").objectStore(e).put(t);a.onerror=l=>{console.error(a.error),o(a)},a.onsuccess=l=>{n(a.result)}});return await r,r}var pt={};j(pt,{datasets:()=>Ci,getLocation:()=>Li});function Ci(e,t){t.provider||(t.xhr?.abort(),t.xhr=new XMLHttpRequest,t.qterm&&r(t)),t.datasets?.forEach(n=>{n.xhr?.abort(),n.xhr=new XMLHttpRequest,r({layer:t.layer,table:t.table,query:t.query,qterm:t.qterm,label:t.label,title:t.title,limit:t.limit,no_result:t.no_result,leading_wildcard:t.leading_wildcard,callback:t.callback,maxZoom:t.maxZoom,...n})});function r(n){let o=t.mapview.layers[n.layer];if(!o){console.warn("No layer definition for gazetteer search.");return}if(!o.table&&!n.table){console.warn("No table definition for gazetteer search.");return}n.xhr.open("GET",t.mapview.host+"/api/query?"+mapp.utils.paramString({template:n.query||"gaz_query",label:n.label||n.qterm,qterm:n.qterm,qID:o.qID,locale:t.mapview.locale.key,layer:o.key,filter:o.filter?.current,table:n.table||o.table,wildcard:"*",term:`${n.leading_wildcard?"*":""}${e}*`,limit:n.limit||10})),n.xhr.setRequestHeader("Content-Type","application/json"),n.xhr.responseType="json",n.xhr.onload=i=>{if(t.input.value.length&&!(i.target.status>=300)){if(!i.target.response){if(n.no_result===null)return;t.list.append(mapp.utils.html.node`
          <li>
            <span class="label">${n.title||o.name}</span>
            <span>${n.no_result||mapp.dictionary.no_results}</span>`);return}[i.target.response].flat().forEach(s=>{t.list.append(mapp.utils.html.node`
          <li onclick=${a=>{if(n.callback)return n.callback(s,n);mapp.location.get({layer:o,id:s.id}).then(l=>l?.flyTo?.(n.maxZoom))}}>
            <span class="label">${n.title||o.name}</span>
            <span>${s.label}</span>`)})}},n.xhr.send()}}function Li(e,t){if(typeof t.callback=="function"){t.callback(e);return}let r=ol.proj.transform([e.lng,e.lat],"EPSG:4326",`EPSG:${t.mapview.srid}`);if(!ol.extent.containsCoordinate(t.mapview.extent,r)){alert(mapp.dictionary.invalid_lat_lon);return}Object.assign(e,{layer:{mapview:t.mapview},Layers:[],hook:e.label});let n=[{title:e.label,value:e.source,inline:!0},{type:"pin",value:[e.lng,e.lat],srid:"4326",class:"display-none",location:e}];t.streetview&&t.streetview.key&&n.push({type:"streetview",key:t.streetview.key,location:e}),mapp.location.decorate(Object.assign(e,{infoj:n})),t.mapview.locations[e.hook]=e,e.flyTo(t.maxZoom)}var tn=e=>{let t=e.getGeometry();if(t.getType()==="Point")return new ol.geom.Point(t.getCoordinates());let r=t.getCoordinates(),n=en(r);return n===2?new ol.geom.MultiPoint(r):(r=n>3?r.flat(2):r[0],new ol.geom.MultiPoint(r))};function en(e){return Array.isArray(e)?1+Math.max(0,...e.map(en)):0}var dt=new Map,rn=e=>new Promise(t=>{if(!e){console.error("xhr params are falsy.");return}if(e=typeof e=="string"?{url:e}:e,!e.url){console.error("no xhr request url has been provided.");return}if(e.cache&&dt.has(e))return t(dt.get(e));e.method??=e.body?"POST":"GET";let r=new XMLHttpRequest;if(r.open(e.method,e.url),e.requestHeader!==null){let n={"Content-Type":"application/json",...e.requestHeader};Object.entries(n).forEach(o=>r.setRequestHeader(...o))}r.responseType=e.responseType||"json",r.onload=n=>{if(n.target.status>=400){t(new Error(n.target.status));return}e.cache&&dt.set(e,n.target.response),t(e.resolveTarget?n.target:n.target.response)},r.onerror=n=>t(new Error(n)),r.send(e.body)});function nn(e){e.prefix??="",e.suffix??="";let t=e.newValue!==void 0?parseFloat(e.newValue):parseFloat(e.value);return e.localeString="",e.formatterParams===void 0&&(e.formatterParams={locale:mapp.language}),e.formatterParams===null&&!isNaN(t)?e.localeString=t.toString():isNaN(t)||(e.formatterParams.locale??=mapp.language,e.formatterParams.options??={},e.formatterParams.options.maximumFractionDigits??=e.round||e.type==="integer"?0:2,e.localeString=t.toLocaleString(e.formatterParams.locale,e.formatterParams.options)),e.lastCharacter||="",e.stringValue=`${e.prefix}${e.localeString}${e.lastCharacter}${e.suffix}`,e.stringValue}function on(e){if(!e.stringValue)return null;let t=e.stringValue;if(e.prefix&&(t=t.replace(e.prefix,"")),e.suffix&&(t=t.replace(e.suffix,"")),t.length&&e.formatterParams?.locale){let r=1234.5.toLocaleString(e.formatterParams?.locale).match(/(\D+)/g);t=t.split(r[0]).join(""),delete e.lastCharacter,t.endsWith(r[1])&&(e.lastCharacter=r[1]),t.endsWith(r[1]+0)&&(e.lastCharacter=r[1]+0),t=t.split(r[1]).join(".")}return t===""?null:parseFloat(t)}var $i=(e,t)=>e.size===t.size&&[...e].every(r=>t.has(r)),Ti=(...e)=>t=>e.reduce((r,n)=>n(r),t),an={stats:nt,render:Me,html:Ee,svg:m,convert:Zr,areSetsEqual:$i,compose:Ti,copyToClipboard:Ur,csvDownload:ot,dataURLtoBlob:Kr,formatNumericValue:nn,unformatStringValue:on,gazetteer:pt,getCurrentPosition:Wr,hexa:Hr,loadPlugins:at,merge:H,olScript:()=>mapp.ol.load(),paramString:Jr,polygonIntersectFeatures:Qr,promiseAll:Xr,queryParams:Yr,style:lt,svgSymbols:ut,userIndexedDB:ft,verticeGeoms:tn,xhr:rn};var g={current:{layers:[],locations:[]},set:Ii,parse:ji,remove:sn,removeAll:Pi,push:Fi,filter:Oi},le=g;function ji(){let e=new URL(window.location.href);for(let[t,r]of e.searchParams.entries()){if(r==="false"){g.current[t]=!1;continue}if(r==="true"){g.current[t]=!0;continue}if(t==="locations"||t==="layers"){g.current[t]=decodeURIComponent(r).split(",");continue}g.current[t]=r.includes(",")?decodeURIComponent(r).split(","):r}g.current.token&&(e.searchParams.delete("token"),window.history.replaceState({},document.title,e.toString()),delete g.current.token)}function Ii(e){Object.assign(g.current,e),W()}function sn(e){Array.isArray(g.current[e])?g.current[e].length=0:delete g.current[e],W()}function Pi(){Object.keys(g.current).forEach(e=>sn(e)),W()}function Fi(e,t){g.current[e]?g.current[e].indexOf(t)<0&&g.current[e].push(t):g.current[e]=[t],W()}function Oi(e,t){g.current[e]=g.current[e].filter(r=>r!==t),W()}function W(){try{window.history.pushState({},document.title,`?${mapp.utils.paramString(g.current)}`)}catch(e){console.log(e)}}var ln={save:"Save",cancel:"Cancel",confirm_delete:"Are you sure you want to delete this feature? This cannot be undone.",invalid_geometry:"Invalid geometry",no_results:"No results for this search"};var cn={save:"Speichern",cancel:"Abbrechen",confirm_delete:"Best\xE4tigung des L\xF6schvorgang",invalid_geometry:"Ung\xFCltige Geometrie",no_results:"Suche ist ergebnislos"};var un={save:"Sauvegarde",cancel:"Annuler",confirm_delete:"\xCAtes-vous s\xFBr de vouloir supprimer ? \xC7a ne peut pas \xEAtre annul\xE9.",invalid_geometry:"G\xE9om\xE9trie non valide",no_results:"Pas de r\xE9sultats pour cette recherche"};var fn={save:"Zapisz",cancel:"Zrezygnuj",confirm_delete:"Czy jeste\u015B pewny, \u017Ce chcesz usun\u0105\u0107? To nie mo\u017Ce by\u0107 cofni\u0119te.",invalid_geometry:"Wadliwa geometria",no_results:"Brak wynik\xF3w dla tego poszukiwania"};var pn={save:"\u4FDD\u5B58",cancel:"\u30AD\u30E3\u30F3\u30BB\u30EB",confirm_delete:"\u30D5\u30A3\u30FC\u30C1\u30E3\u3092\u672C\u5F53\u306B\u524A\u9664\u3057\u307E\u3059\u304B\u3002\u53D6\u308A\u6D88\u3057\u4E0D\u53EF",invalid_geometry:"\u7121\u52B9\u306E\u30B8\u30AA\u30E1\u30C8\u30EA\u30FC",no_results:"\u7D50\u679C\u306A\u3057"};var dn={save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",confirm_delete:"\u60A8\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F \u8FD9\u5C06\u65E0\u6CD5\u64A4\u6D88\u3002",invalid_geometry:"\u65E0\u6548\u56FE\u5F62",no_results:"\u672A\u627E\u5230\u76F8\u5173\u7ED3\u679C"};var hn={save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",confirm_delete:"\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F \u9019\u5C07\u7121\u6CD5\u64A4\u92B7\u3002",invalid_geometry:"\u7121\u6548\u5716\u5F62",no_results:"\u672A\u627E\u5230\u76F8\u95DC\u7D50\u679C"};var mn={save:"Salvar",cancel:"Cancelar",confirm_delete:"\xBFEstas seguro que quieres borrarlo? No se puede deshacer.",invalid_geometry:"Geometr\xEDa no v\xE1lida",no_results:"No hay resultados para esta b\xFAsqueda"};var gn={save:"Salva",cancel:"Cancella",confirm_delete:"Sei sicuro di voler eliminare questo elemento? Questa operazione non pu\xF2 essere annullata. ",invalid_geometry:"Geometria non valida",no_results:"Nessun risultato per questa ricerca"};var yn={save:"Kaydet",cancel:"Iptal Et",confirm_delete:"Bu sekli silmek istediginizden emin misiniz? Bu islem geri alinamaz.",invalid_geometry:"Gecersiz geometri",no_results:"Sonuc bulunamadi"};var vn={save:"\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01",cancel:"\u0E22\u0E01\u0E40\u0E25\u0E34\u0E01",confirm_delete:"\u0E04\u0E38\u0E13\u0E41\u0E19\u0E48\u0E43\u0E08\u0E2B\u0E23\u0E37\u0E2D\u0E44\u0E21\u0E48\u0E27\u0E48\u0E32\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E04\u0E38\u0E13\u0E25\u0E31\u0E01\u0E29\u0E13\u0E30\u0E19\u0E35\u0E49 \u0E2A\u0E34\u0E48\u0E07\u0E19\u0E35\u0E49\u0E44\u0E21\u0E48\u0E2A\u0E32\u0E21\u0E32\u0E23\u0E16\u0E22\u0E01\u0E40\u0E25\u0E34\u0E01\u0E44\u0E14\u0E49",invalid_geometry:"\u0E40\u0E23\u0E02\u0E32\u0E04\u0E13\u0E34\u0E15\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07",no_results:"\u0E44\u0E21\u0E48\u0E21\u0E35\u0E1C\u0E25\u0E25\u0E31\u0E1E\u0E18\u0E4C\u0E2A\u0E33\u0E2B\u0E23\u0E31\u0E1A\u0E01\u0E32\u0E23\u0E04\u0E49\u0E19\u0E2B\u0E32\u0E19\u0E35\u0E49"};var bn={en:ln,de:cn,fr:un,pl:fn,ja:pn,zh:dn,zh_tw:hn,esp:mn,it:gn,tr:yn,th:vn};async function ht(e){if(await mapp.layer.formats[e.format]?.(e),!!e.L)return Object.assign(e,{show:qi,showCallbacks:[],hide:_i,hideCallbacks:[],tableCurrent:Ai,geomCurrent:zi,zoomToExtent:Ni}),e.edit&&(console.warn(`Layer: ${e.key}, please update edit:{} to use draw:{} as layer.edit has been superseeded with layer.draw to be in line with the OL drawing interaction.`),e.draw=Object.assign(e.draw||{},e.edit)),e.draw??={},e.draw?.delete&&console.warn(`Layer: ${e.key}, please move draw.delete to use layer.deleteLocation:true.`),e.filter={current:{},...e.filter},e.L.setOpacity(e.style?.opacity||1),Array.isArray(e.infoj_skip)&&e.infoj.filter(t=>[t.key,t.field,t.query,t.type,t.group].some(r=>e.infoj_skip.includes(r))).forEach(t=>t.skipEntry=!0),Object.keys(e).forEach(t=>{typeof mapp.layer[t]=="function"&&mapp.layer[t]?.(e),typeof mapp.plugins[t]=="function"&&mapp.plugins[t]?.(e)}),e}function qi(){this.mapview.hooks&&mapp.hooks.push("layers",this.key),this.display=!0;try{this.mapview.Map.addLayer(this.L)}catch{}this.reload instanceof Function&&this.reload(),this.mapview.attribution?.check(),this.showCallbacks?.forEach(e=>e instanceof Function&&e(this))}function _i(){this.display=!1,this.mapview.Map.removeLayer(this.L),this.mapview.attribution?.check(),this.mapview.hooks&&!this.zoomDisplay&&mapp.hooks.filter("layers",this.key),this.hideCallbacks?.forEach(e=>e instanceof Function&&e(this))}function Ai(){if(!this.tables)return this.table;let e,t=parseInt(this.mapview.Map.getView().getZoom()),r=Object.keys(this.tables),n=parseInt(r[0]),o=parseInt(r[r.length-1]);return e=this.tables[t],e=t<n?this.tables[n]:e,e=t>o?this.tables[o]:e,e}function zi(){if(!this.geoms)return this.geom;let e,t=parseInt(this.mapview.Map.getView().getZoom()),r=Object.keys(this.geoms),n=parseInt(r[0]),o=parseInt(r[r.length-1]);return e=this.geoms[t],e=t<n?this.geoms[n]:e,e=t>o?this.geoms[o]:e,e}async function Ni(e){let t=await mapp.utils.xhr(`${this.mapview.host}/api/query/layer_extent?`+mapp.utils.paramString({dbs:this.dbs,locale:this.mapview.locale.key,layer:this.key,table:this.table||Object.values(this.tables)[0]||Object.values(this.tables)[1],geom:this.geom,proj:this.srid,srid:this.mapview.srid,filter:this.filter.current}));if(!t)return!1;let r=/\((.*?)\)/.exec(t.box2d)[1].replace(/ /g,",");return this.mapview.fitView(r.split(",").map(n=>parseFloat(n)),e),!0}var mt,ce=null;async function Di(){return ce?new ce.Map(...arguments):(mt||(mt=new Promise(async e=>{console.warn("The mbtiles layer format uses an outdated version of the maplibre-gl library. Please change the format to maplibre"),Promise.all([import("https://cdn.skypack.dev/pin/maplibre-gl@v1.15.3-OFxGDsJNZ70P0Qa7CzNE/mode=imports,min/optimized/maplibre-gl.js")]).then(t=>{ce=t[0],e()}).catch(t=>{console.error(t.message),alert("Failed to load MaplibreGL library. Please reload the browser.")})})),await mt,new ce.Map(...arguments))}var wn=async e=>{let t=`mapp-layer-${e.key} mbtiles`;e.container=mapp.utils.html.node`<div 
    class=${t}
    style="visibility: hidden; position: absolute; width: 100%; height: 100%;">`,e.mapview.Map.getTargetElement().prepend(e.container),e.Map=await Di({container:e.container,style:e.mbStyle,accessToken:e.accessToken,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1,preserveDrawingBuffer:e.preserveDrawingBuffer}),e.L=new ol.layer.Layer({key:e.key,className:`mapp-layer-${e.key}`,zIndex:e.zIndex,render:r=>{if(e.display)return e.container.style.visibility="visible",e.Map.jumpTo({center:ol.proj.toLonLat(r.viewState.center),zoom:r.viewState.zoom-1,bearing:-r.viewState.rotation*180/Math.PI,animate:!1}),e.container}}),e.mapview.Map.getTargetElement().addEventListener("resize",()=>e.Map.resize())};var xn=async e=>{e.style??={},e.style.mapType??="roadmap",e.L=new ol.layer.WebGLTile({key:e.key,className:`mapp-layer-${e.key}`,zIndex:e.zIndex,source:new ol.source.Google({key:e.apiKey,scale:"scaleFactor2x",highDpi:!0,mapType:e.style.mapType,layerTypes:e.style.layerTypes})})};var gt,T=window.maplibregl;async function Bi(){if(T)return new T.Map(...arguments);if(gt||(gt=new Promise(async e=>{try{T=(await import("https://esm.sh/maplibre-gl@4.0.2")).default,["deferred","loaded"].includes(T.getRTLTextPluginStatus())||T.setRTLTextPlugin("https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js",!0),e()}catch{console.error("Failed to load maplibre-gl library."),e()}})),await gt,!!T)return new T.Map(...arguments)}var kn=async e=>{let t=`mapp-layer-${e.key} maplibre`;e.container=mapp.utils.html.node`<div 
    class=${t}
    style="visibility: hidden; position: absolute; width: 100%; height: 100%;">`,e.mapview.Map.getTargetElement().prepend(e.container),e.Map=await Bi({container:e.container,pixelRatio:1,style:e.style.URL,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1,preserveDrawingBuffer:e.preserveDrawingBuffer,transformRequest:(r,n)=>r.indexOf("mapbox:")===0?Vi(r,n,e.accessToken):{url:r}}),e.Map&&(e.mapview.Map.getTargetElement().addEventListener("resize",()=>e.Map.resize()),e.style.zIndex&&console.warn(`Layer: ${e.key}, layer.style.zIndex has been deprecated. Use layer.zIndex instead.`),e.L=new ol.layer.Layer({key:e.key,zIndex:e.zIndex,render:r=>{if(e.display)return e.container.style.visibility="visible",e.Map.jumpTo({center:ol.proj.toLonLat(r.viewState.center),zoom:r.viewState.zoom-1,bearing:-r.viewState.rotation*180/Math.PI,animate:!1}),e.container}}))};function Vi(e,t,r){if(e.indexOf("/styles/")>-1&&e.indexOf("/sprite")===-1)return{url:Gi(e,r)};if(e.indexOf("/sprites/")>-1)return{url:Zi(e,r)};if(e.indexOf("/fonts/")>-1)return{url:Ri(e,r)};if(e.indexOf("/v4/")>-1)return{url:Sn(e,r)};if(t==="Source")return{url:Sn(e,r)}}function J(e){let t=e.match(/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ue(e,t){let r=J("https://api.mapbox.com");e.protocol=r.protocol,e.authority=r.authority,e.params.push(`access_token=${t}`);let n=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${n}`}function Gi(e,t){let r=J(e);return r.path=`/styles/v1${r.path}`,ue(r,t)}function Ri(e,t){let r=J(e);return r.path=`/fonts/v1${r.path}`,ue(r,t)}function Sn(e,t){let r=J(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),ue(r,t)}function Zi(e,t){let r=J(e),n=r.path.split(".");return r.path=`/styles/v1${n[0]}/sprite.${n[1]}`,ue(r,t)}var Mn=e=>{e.source??="OSM",e.projection??="EPSG:3857",e.paramString??=mapp.utils.paramString(e.params),e.L=new ol.layer.Tile({key:e.key,className:`mapp-layer-${e.key}`,zIndex:e.zIndex,source:new ol.source[e.source]({projection:e.projection,url:e.URI+e.paramString,transition:0})}),e.style?.contextFilter&&(e.L.on("prerender",t=>{t.context&&(t.context.filter=e.style.contextFilter,t.context.globalCompositeOperation="source-over")}),e.L.on("postrender",t=>{t.context&&(t.context.filter="none")}))};var Ln=e=>{if(e.srid??="3857",e.srid!=="3857"){console.warn(`Layer ${e.key} must be set to use SRID 3857.`);return}mapp.layer.styleParser(e),e.params??={},e.mvt_cache&&console.warn(`Layer ${e.key} mvt_cache has been disabled.`),delete e.params.viewport,mapp.layer.changeEnd(e),e.reload=()=>{if(e.wkt_properties){Cn(e);return}e.source.clear(),e.source.refresh(),e.featureSource.refresh()},e.clones=new Set,e.featureSource=new ol.source.VectorTile({format:new ol.format.MVT({featureClass:ol.Feature}),transition:0,cacheSize:0,tileUrlFunction:En(e)}),e.source=new ol.source.VectorTile({format:new ol.format.MVT,transition:e.transition,cacheSize:e.cacheSize}),e.wkt_properties?(e.source.setTileUrlFunction(Ui(e)),e.mapview.Map.getTargetElement().addEventListener("changeEnd",()=>Cn(e))):e.source.setTileUrlFunction(En(e)),e.L=new ol.layer.VectorTile({key:e.key,className:`mapp-layer-${e.key}`,zIndex:e.zIndex,source:e.source,renderBuffer:200,style:mapp.layer.featureStyle(e)})};function Ui(e){return t=>{let r=e.tableCurrent();if(!r){e.source.clear();return}if(!e.display&&!e.clones?.size){e.source.clear();return}let n=e.geomCurrent();return`${e.mapview.host}/api/query?${mapp.utils.paramString({template:"mvt",z:t[0],x:t[1],y:t[2],locale:e.mapview.locale.key,layer:e.key,srid:e.mapview.srid,table:r,geom:n})}`}}function En(e){return t=>{let r=e.tableCurrent();if(!r){e.source.clear();return}if(!e.display&&!e.clones?.size){e.source.clear();return}let n=e.geomCurrent();return e.params.fields=[...new Set([e.params.default_fields,Array.isArray(e.style.theme?.fields)?e.style.theme.fields:e.style.theme?.field,e.style.theme?.field,e.style.label?.field].flat().filter(i=>!!i))],`${e.mapview.host}/api/query?${mapp.utils.paramString({template:"mvt",z:t[0],x:t[1],y:t[2],locale:e.mapview.locale.key,layer:e.key,table:r,geom:n,filter:e.filter?.current,...e.params})}`}}function Cn(e){e.xhr?.abort();let t=e.tableCurrent();if((!t||!e.display)&&!e.clones?.size)return e.source.clear();let r=e.geomCurrent();e.params.fields=[...new Set([e.params.default_fields,Array.isArray(e.style.theme?.fields)?e.style.theme.fields:e.style.theme?.field,e.style.theme?.field,e.style.label?.field].flat().filter(s=>!!s))];let n=e.mapview.getBounds(),o=[n.west,n.south,n.east,n.north,e.mapview.srid],i=e.mapview.Map.getView().getZoom();e.xhr=new XMLHttpRequest,e.xhr.responseType="json",e.xhr.onload=s=>{if(e.featuresObject={},!s.target?.response){e.L.changed();return}mapp.layer.featureFormats.wkt_properties(e,s.target.response),e.L.changed()},e.xhr.open("GET",`${e.mapview.host}/api/query?${mapp.utils.paramString({template:"wkt",locale:e.mapview.locale.key,layer:e.key,table:t,geom:r,no_geom:!0,viewport:o,z:i,filter:e.filter?.current,...e.params})}`),e.xhr.send()}function q(e){if(!e.srid){console.warn(`Vector Layer: ${e.key} missing SRID.`);return}mapp.layer.styleParser(e),e.properties&&console.warn(`Layer: ${e.key}, layer.properties{} are no longer required for wkt & geojson datasets.`),e.params??={},Hi(e),e.setSource=t=>{if(t===null){e.L.setSource(null),mapp.layer.featureFields.reset(e),mapp.layer.featureFields.process(e);return}if(t){if(e.source=new ol.source.Vector({features:mapp.layer.featureFormats[e.format](e,[t].flat())}),delete e.xhr,e.fade&&mapp.layer.fade(e),e.cluster?.distance){e.cluster.source=new ol.source.Cluster({distance:e.cluster.distance,source:e.source}),e.L.setSource(e.cluster.source);return}e.L.setSource(e.source)}},mapp.layer.changeEnd(e),e.reload=Ki,e.L=new ol.layer[e.vectorImage&&"VectorImage"||"Vector"]({key:e.key,className:`mapp-layer-${e.key}`,zIndex:e.zIndex,style:e.styleFunction||mapp.layer.featureStyle(e)}),e.setSource(e.features),(e.tables||e.params.viewport)&&e.mapview.Map.getTargetElement().addEventListener("changeEnd",()=>{if(!e.tableCurrent()){e.L.setSource(null);return}e.display&&(clearTimeout(e.timeout),e.timeout=setTimeout(()=>e.reload(),100))}),e.cluster?.distance&&e.L.on("change",t=>{if(!e.cluster.source)return;delete e.max_size;let r=e.cluster.source.getFeatures().map(n=>{let o=n.get("features");if(n.set("id",o[0].get("id"),!0),o.length>1)n.set("count",o.length,!0);else{let i=o[0].getProperties();Object.entries(i.properties||{}).forEach(s=>{n.set(s[0],s[1],!0)})}return o.length});r.length&&(e.max_size=Math.max(...r))})}function Ki(){let e=this;if(e.features)return;let t=e.tableCurrent();if(!t)return;let r=e.geomCurrent();e.fade&&mapp.layer.fade(e,!0),e.params.fields=[...new Set([e.params.default_fields,Array.isArray(e.style.theme?.fields)?e.style.theme.fields:e.style.theme?.field,e.style.theme?.field,e.style.label?.field,e.cluster?.label].flat().filter(o=>!!o))];let n=e.mapview.getBounds();e.params.viewport&&=[n.west,n.south,n.east,n.north,e.mapview.srid],e.params.z&&=e.mapview.Map.getView().getZoom(),clearTimeout(e.timeout),e.timeout=setTimeout(()=>{e.xhr=mapp.utils.xhr(`${e.mapview.host}/api/query?${mapp.utils.paramString({template:e.params.template||e.format,locale:e.mapview.locale.key,layer:e.key,table:t,geom:r,srid:e.srid,filter:e.filter?.current,...e.params})}`).then(o=>{o instanceof Error||e.setSource(o)})},100)}function Hi(e){if(typeof e.cluster=="object"){if(e.cluster.distance&&e.cluster.resolution){console.warn(`Layer: ${e.key}, cluster.distance and cluster.resolution are mutually exclusive. You cannot use them both on the same layer. Please remove one of them. `);return}if(!e.cluster.distance&&!e.cluster.resolution){console.warn(`Layer: ${e.key}, cluster.distance or cluster.resolution must be set.`);return}if(e.cluster.distance<1){console.warn(`Layer: ${e.key}, cluster.distance is less than 1 [pixel]. The cluster config will be removed.`),delete e.cluster;return}if(e.cluster.resolution){if(typeof e.cluster.resolution=="number")e.params.resolution=parseFloat(e.cluster.resolution);else{console.warn(`Layer: ${e.key}, cluster.resolution must be a number.`);return}if(e.srid==="4326"){console.warn(`Layer: ${e.key}, srid 4326 is not allowed for cluster.resolution layers.`);return}e.params.viewport=!0,e.params.z=!0,e.format="cluster",e.params.template??=e.cluster.hexgrid?"cluster_hex":"cluster"}}}var $n={mbtiles:wn,googleMapTiles:xn,maplibre:kn,tiles:Mn,mvt:Ln,cluster:q,geojson:q,wkt:q,vector:q};function fe(e,t){if(!e?.fade)return;clearTimeout(e.fade);let r=e.L.getOpacity(),n;if(t){if(r<=0)return;n=Math.max(r-.2,0)}else{if(r>=1)return;n=Math.min(r+.2,1)}let o=100,i=Date.now(),s=()=>{let l=Date.now()-i;if(l<o){let c=l/o,u=r+(n-r)*c;e.L.setOpacity(u),requestAnimationFrame(s)}else e.L.setOpacity(n)};s(),e.fade=setTimeout(()=>fe(e,t),o)}function Tn(e){e.tables&&e.mapview.Map.getTargetElement().addEventListener("changeEnd",t);function t(){if(!e.tableCurrent()){e.display&&(e.zoomDisplay=!0,e.hide());return}e.zoomDisplay&&(delete e.zoomDisplay,e.show())}}function jn(e,t){if(!t.style.hover.display)return;let r=t.mapview.interaction?.current?.key?.toString();if(!r)return;let n=mapp.utils.paramString({dbs:t.dbs,locale:t.mapview.locale.key,layer:t.key,filter:e.properties.count>1&&t.filter?.current,template:t.style.hover.query||"infotip",qID:t.qID,id:e.properties.id,table:t.tableCurrent(),geom:t.geom,field:t.style.hover.field,coords:e.properties.count>1&&ol.proj.transform(e.getGeometry().getCoordinates(),`EPSG:${t.mapview.srid}`,`EPSG:${t.srid}`)});mapp.utils.xhr(`${t.mapview.host}/api/query?${n}`).then(o=>{if(o){if(typeof t.style.hover.render=="function"){let i=t.style.hover.render(o);t.mapview.infotip(i);return}o.label!=""&&t.mapview.interaction?.current?.key===r&&t.mapview.infotip(o.label)}})}var In={ni:Wi};function Pn(e,t){return Object.keys(e).some(r=>{let n=Object.keys(e[r])[0];return In[n]&&In[n](r,e[r][n],t)})}function Wi(e,t,r){return new Set(t).has(r.properties[e])}var yt={};j(yt,{cluster:()=>Yi,geojson:()=>Ji,wkt:()=>Qi,wkt_properties:()=>Xi});function Ji(e,t){let r=new ol.format.GeoJSON;return mapp.layer.featureFields.reset(e),t.map(n=>{let o=n.properties;return e.featureFields?.[e.style?.theme?.field]&&e.featureFields[e.style.theme.field].values.push(o[e.style.theme.field]),new ol.Feature({id:n.id,geometry:r.readGeometry(n.geometry,{dataProjection:"EPSG:"+e.srid,featureProjection:"EPSG:"+e.mapview.srid}),properties:o})})}function Qi(e,t){if(!Array.isArray(t))return;let r=new ol.format.WKT;mapp.layer.featureFields.reset(e);let n=t.map(o=>{let i={};return e.params.fields?.forEach((s,a)=>{e.featureFields[s]&&e.featureFields[s].values.push(o[a+2]),i[s]=o[a+2]}),new ol.Feature({id:o.shift(),geometry:r.readGeometry(o.shift(),{dataProjection:"EPSG:"+e.srid,featureProjection:"EPSG:"+e.mapview.srid}),properties:i})});return mapp.layer.featureFields.process(e),n}function Xi(e,t){mapp.layer.featureFields.reset(e);for(let r of t){let n={id:r[0]};e.params.fields?.forEach((o,i)=>{e.featureFields[o]&&e.featureFields[o].values.push(r[i+1]),n[o]=r[i+1]}),e.featuresObject[r.shift()]=n}mapp.layer.featureFields.process(e)}function Yi(e,t){return e.max_size=1,t.map((r,n)=>{let o=new ol.geom.Point(r.shift()),i=r.shift();e.max_size=e.max_size>i?e.max_size:i;let s=r.shift(),a={count:i};return e.params.fields.forEach((l,c)=>{a[l]=r[c]}),new ol.Feature({id:s,geometry:o,...a})})}var bt={};j(bt,{distribution:()=>vt,process:()=>ta,reset:()=>ea});function ea(e){e.featureFields??={},e.style.theme?.field&&(e.featureFields[e.style.theme.field]={values:[]})}function ta(e){Object.hasOwn(vt,e.style?.theme?.distribution)&&(vt[e.style.theme.distribution](e),mapp.ui.layers.legends[e.style.theme.type](e))}var vt={jenks:ra,count:na};function ra(e){let t=e.style.theme,r=Math.min(e.featureFields[t.field].values.length,t.categories.length);e.featureFields[t.field].values=e.featureFields[t.field].values.map(parseFloat),e.featureFields[t.field].jenks=mapp.utils.stats.jenks(e.featureFields[t.field].values,r);let n;t.categories.forEach((o,i)=>{n=n===e.featureFields[t.field].jenks[i]?void 0:e.featureFields[t.field].jenks[i],o.value=n,o.label=n})}function na(e){let t=e.style.theme;e.featureFields[t.field].values.forEach(r=>{e.featureFields[t.field][r]??=0,e.featureFields[t.field][r]++})}var wt=e=>{return function(a){if(e.style.cache!==null){let l=a.get("Styles");if(l)return l}return t(a),a.properties===null||(e.style.filter||e.style.theme?.filter)&&e.filter.current&&Object.keys(e.filter.current).length&&mapp.layer.featureFilter(e.filter.current,a)?null:(a.style=e.style.default,Object.hasOwn(mapp.layer.themes,e.style.theme?.type)&&mapp.layer.themes[e.style.theme?.type]?.(e.style.theme,a),r(a),n(a),o(a),i(a),mapp.utils.style(a.style,a))};function t(s){if(e.featuresObject){let a=s.get("id").toString();s.properties={id:a,...e.featuresObject[a]}}else s.properties=s.getProperties();if(Array.isArray(e.featureLookup)){let a=e.featureLookup.find(l=>l[e.featureLookupId||"id"]===s.properties.id);if(!a){s.properties=null;return}Object.assign(s.properties,a)}s.properties?.properties&&(Object.assign(s.properties,s.properties.properties),delete s.properties.properties)}function r(s){if(!s.properties?.count||s.properties.count===1||!e.style.cluster)return;let a=parseFloat(e.style.cluster.clusterScale);s.style={...s.style,...e.style.cluster},a&&(s.style.clusterScale=e.style.cluster.logScale?Math.log(a)/Math.log(e.max_size)*Math.log(s.properties.size||s.properties.count):1+a/e.max_size*(s.properties.size||s.properties.count)),e.style.cluster.zoomInScale&&(s.style.zoomInScale=e.style.cluster.zoomInScale*e.mapview.Map.getView().getZoom()),e.style.cluster.zoomOutScale&&(s.style.zoomOutScale=e.style.cluster.zoomOutScale/e.mapview.Map.getView().getZoom())}function n(s){e.style.highlight&&e.highlight&&e.highlight===(s.get("id")||s.getId())&&(s.style={...s.style,...e.style.highlight})}function o(s){if(s.properties&&s.style){if(!e.style.label?.display){delete s.style.label;return}s.style.label=structuredClone(e.style.label),s.style.label.text=s.style.label.count&&s.properties.count>1&&s.properties.count||void 0,s.style.label.text??=s.properties[s.style.label.field]||s.properties.label,s.style.label?.minZoom>e.mapview.Map.getView().getZoom()&&delete s.style.label,s.style.label?.maxZoom<e.mapview.Map.getView().getZoom()&&delete s.style.label}}function i(s){e.style.selected!==void 0&&e.mapview?.locations[`${e.key}!${s.properties.id}`]&&(s.style=e.style.selected)}};var Fn=new Set(["anchor","scale","url","svg","type"]),On=new Set(["zIndex","strokeColor","strokeWidth","strokeOpacity","fillOpacity","fillColor","clusterScale","zoomInScale","zoomOutScale","highlightScale",...Fn]);function xt(e){e.style??={},typeof e.style.highlight=="object"&&(e.style.highlight.zIndex??=1/0,e.style.highlight.highlightScale=e.style.highlight.scale,delete e.style.highlight.scale),t(e),e.style?.theme&&n(e.style.theme,e),e.style?.themes&&Object.keys(e.style.themes).forEach(a=>{n(e.style.themes[a],e)}),e.style?.themes&&(Object.keys(e.style.themes).forEach(a=>{e.style.themes[a].title??=a,e.style.themes[a].skip&&delete e.style.themes[a]}),e.style.theme=typeof e.style.theme=="object"?e.style.theme:e.style.themes[e.style.theme||Object.keys(e.style.themes)[0]]),e.style?.hovers&&(e.style.hover=typeof e.style.hover=="object"?e.style.hover:e.style.hovers[e.style.hover||Object.keys(e.style.hovers)[0]]),e.style?.hover&&(e.style.hover.method??=mapp.layer.featureHover),e.style?.labels&&(e.style.label=typeof e.style.label=="object"?e.style.label:e.style.labels[e.style.label||Object.keys(e.style.labels)[0]]);function t(a){a.style.default||(console.warn(`Layer: ${a.key} has no implicit default style. Please add style.default.`),a.style.default=a.cluster?{icon:{type:"dot"}}:{strokeColor:"#333",fillColor:"#fff9"}),a.style.default.style&&(console.warn(`Layer: ${a.key} has a style object within the default style configuration.`),a.style.default=a.style.default.style,delete a.style.default.style),i(a.style.default),r(a),a.hover&&(console.warn(`Layer: ${a.key}, layer.hover{} should be defined within layer.style{}.`),a.style.hover=a.hover,delete a.hover),a.style?.hovers&&a.style?.hover&&(console.warn(`Layer: ${a.key}, cannot use both layer.style.hover and layer.style.hovers. Layer.style.hover has been deleted.`),delete a.style.hover),a.style?.labels&&a.style?.label&&(console.warn(`Layer: ${a.key}, cannot use both layer.style.label and layer.style.labels. Layer.style.label has been deleted.`),delete a.style.label),a.style.zIndex&&console.warn(`Layer: ${a.key}, layer.style.zIndex has been deprecated. Use layer.zIndex instead.`)}function r(a){a.cluster&&(a.style.default.icon||(a.style.default={icon:{type:"dot"}},console.warn(`Cluster Layer: ${a.key} has no default icon. 'Dot' will be assigned.`)),Object.keys(a.style.default).filter(l=>!["icon","scale"].includes(l)).forEach(l=>{console.warn(`Cluster Layer: ${a.key}; ${l} key removed from default style.`),delete a.style.default[l]}),a.style.cluster={clusterScale:1,icon:{type:"dot"},...a.style.cluster},a.style.cluster.icon||(a.style.cluster={...a.style.cluster,...a.style.cluster.style},delete a.style.cluster.style,a.style.cluster.icon=s(a.style.cluster)))}function n(a,l){typeof a=="string"&&(a=l.style.themes?.[a]),typeof a.style=="object"&&(a.style={...structuredClone(l.style.default),...a.style}),typeof a.cat=="object"&&(a.categories=Object.keys(a.cat).map(c=>{let u=a.cat[c];return u.label??=c,u.value??=c,u}),delete a.cat),Array.isArray(a.cat_arr)&&(a.categories=a.cat_arr,delete a.cat_arr),a.type==="graduated"&&(["less_than","greater_than"].includes(a.graduated_breaks)||(console.warn(`You must provide a graduated_breaks value of either greater_than or less_than for graduated theme on layer: ${l.key}; field: ${a.field}. less_than is assumed.`),a.graduated_breaks??="less_than"),a.graduated_breaks==="greater_than"&&a.categories.reverse()),a.categories?.forEach(c=>{c.label??=c.value,c.icon&&(c.style={icon:c.icon},delete c.icon),o(c,structuredClone(l.style.default))}),a.type==="categorized"&&Array.isArray(a.fields)&&a.categories.forEach(c=>{a.fields.includes(c.field)||console.warn(`Layer: ${l.key}; Cat ${c.label} missed valid field.`),c.style.icon||(console.warn(`Layer: ${l.key}; Cat ${c.label} has invalid icon style.`),c.style.icon={type:"dot"})})}function o(a,l){if(a.style??={},Array.isArray(a.style))return;if(a.icon&&(a.style={icon:a.icon},delete a.icon),a.style.icon){if(Array.isArray(a.style.icon)||a.style.icon.type||a.style.icon.svg)return;l.icon&&!Array.isArray(l.icon)&&(a.style.icon={...l.icon,...a.style.icon});return}let c={};Object.keys(l).filter(u=>On.has(u)).forEach(u=>c[u]=l[u]),a.style={...c,...a.style},Object.keys(a).filter(u=>On.has(u)).forEach(u=>{a.style[u]=a[u],delete a[u]}),i(a.style),!a.style.icon&&l.icon&&(console.warn(`Layer:${e.key}, Failed to evaluate icon: ${JSON.stringify(a)}. Default icon will be assigned.`),a.style.icon=l.icon)}function i(a){a.icon||Object.keys(a).filter(l=>Fn.has(l)).forEach(l=>{a.icon??={},a.icon[l]=a[l],delete a[l]})}function s(a){return Array.isArray(a)&&a.length===1?s(a[0]):a.svg||a.url||Object.hasOwn(mapp.utils.svgSymbols,a.type)?a:(console.warn(`Layer:${e.key}, Failed to evaluate icon: ${JSON.stringify(a)}. Please check configuration.`),{type:"dot"})}}function St(e,t){t.style={...t.style,...e.style}}function kt(e,t){if(!t.properties||t.properties.features?.length>1)return;let r;if(Array.isArray(e.fields)){t.style.icon=e.fields.map(i=>{let s=t.properties[i],a=e.categories.find(l=>(l.value===encodeURIComponent(s)||l.value===s)&&l.field===i);if(a)return r||=Array.isArray(a.style.icon),a.style.icon}).filter(i=>!!i),r&&(t.style.icon=t.style.icon.flat());return}let n=t.properties[e.field],o=e.categories.find(i=>i.value===encodeURIComponent(n)||i.value===n);o&&(t.style={...t.style,...o.style})}function qn(e,t){e.lookup||(e.lookup={},e.boxes=[],e.index=0);let r=e.field||"id",n=t.properties[r];if(!n)return;if(e.lookup[n]){t.style=e.lookup[n].style;return}let o={extent:t.getGeometry().getExtent()},i=e.boxes.filter(l=>!(o.extent[0]>l.extent[2]||o.extent[2]<l.extent[0]||o.extent[1]>l.extent[3]||o.extent[3]<l.extent[1]));e.boxes.push(o);let s=new Set(i.map(l=>l.themeIdx));e.index++,e.index===e.categories.length&&(e.index=0);let a=!s.has(e.index)&&parseInt(e.index);if(a===!1){for(let l=0;l<e.categories.length;l++)if(!s.has(l)){a=l;break}}a===!1&&(a=parseInt(e.index)),o.themeIdx=a,e.lookup[n]=e.categories[a],t.style=e.lookup[n].style}function _n(e,t){if(!t.properties)return;let r=Array.isArray(t.properties.features)?t.properties.features.reduce((n,o)=>n+Number(o.getProperties().properties[e.field]),0):parseFloat(t.properties[e.field]);if(!isNaN(r)&&r!==null){let n={less_than:s=>a=>s<=a.value,greater_than:s=>a=>s>=a.value},o=e.categories.findIndex(n[e.graduated_breaks](r)),i=e.categories.at(o);t.style={...t.style,...i.style}}}var An={decorate:ht,changeEnd:Tn,formats:$n,featureFormats:yt,featureFields:bt,featureHover:jn,featureFilter:Pn,featureStyle:wt,fade:fe,styleParser:xt,Style:oa,themes:{basic:St,categorized:kt,distributed:qn,graduated:_n}};function oa(e){return console.warn("The mapp.layer.Style() method has been superseeded by the mapp.layer.featureStyle() method."),wt(e)}async function Mt(e,t,r){if(!e)return;let n={layer:r,table:r.tableCurrent(),new:!0};if(t.default_fields&&(t.defaults??={},Object.entries(t.default_fields).forEach(o=>{t.defaults[o[0]]=t[o[1]]})),n.id=await mapp.utils.xhr({method:"POST",url:`${r.mapview.host}/api/query?`+mapp.utils.paramString({template:"location_new",locale:r.mapview.locale.key,layer:r.key,table:n.table}),body:JSON.stringify({[r.geom]:e.geometry,...t?.defaults,...r.draw?.defaults})}),r.format==="mvt"){let o=function(s){r.features=r.features.concat(s.tile.getFeatures())},i=function(){r.features?.find(a=>a.properties?.id===n.id)?r.source.un("tileloadend",o):r.reload()};r.features=[],r.source.on("tileloadend",o),setTimeout(i,1e3)}r.reload(),mapp.location.get(n)}function Et(e){return Object.assign(e,{flyTo:la,Layers:[],remove:ia,removeCallbacks:[],removeEdits:ua,restoreEdits:fa,trash:ca,update:aa,syncFields:sa,updateCallbacks:[]}),e}function ia(){delete this.remove,this.layer.mapview.hooks&&mapp.hooks.filter("locations",this.hook),delete this.layer.mapview.locations[this.hook],this.view instanceof HTMLElement&&this.view.remove(),this.Layers?.forEach(e=>this.layer.mapview.Map.removeLayer(e)),this.layer.mapview.interaction.type!=="highlight"&&this.layer.mapview.interactions.highlight(),this.layer.reload&&this.layer.reload(),this.removeCallbacks?.forEach(e=>typeof e=="function"&&e(this))}async function aa(){if(this.infoj.some(n=>n.invalid))return alert("Unable to update location with invalid entry value."),new Error("Unable to update.");this.infoj.filter(n=>n.jsonb_key).filter(n=>n.jsonb_field).filter(n=>typeof n.newValue<"u").forEach(n=>{n.newValue={jsonb:{[n.jsonb_field]:{[n.jsonb_key]:n.newValue}}}}),this.infoj.filter(n=>n.json_field).filter(n=>n.json_key).filter(n=>typeof n.newValue<"u").forEach(n=>{let o=this.infoj.find(i=>i.field===n.json_field);o.newValue??=o.value||{},o.newValue[n.json_key]=n.newValue,delete n.newValue});let e=Object.fromEntries(this.infoj.filter(n=>typeof n.newValue<"u").map(n=>[n.field,n.newValue]));if(!Object.keys(e).length)return;if(await mapp.utils.xhr({method:"POST",url:`${this.layer.mapview.host}/api/query?`+mapp.utils.paramString({template:"location_update",locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id}),body:JSON.stringify(e)})instanceof Error){alert("Location update has failed."),this.view?.classList.remove("disabled");return}let r=this.infoj.filter(n=>typeof n.newValue<"u").map(n=>(n.value=n.newValue,delete n.newValue,n.dependents)).flat().filter(n=>n!==void 0);r.length&&await this.syncFields([...new Set(r)]),this.layer.reload(),this.updateCallbacks?.forEach(n=>typeof n=="function"&&n(this))}async function sa(e){let t=await mapp.utils.xhr(`${this.layer.mapview.host}/api/query?`+mapp.utils.paramString({template:"location_get",locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id,fields:e.join()}));if(!t||t instanceof Error){console.warn("No data returned from location_get request using ID:",this.id);return}else if(Array.isArray(t)){console.warn(`Location response returned more than one record for Layer: ${this.layer.key}.`),console.log("Location Get Response:",t);return}this.infoj.filter(r=>typeof t[r.field]<"u").forEach(r=>{r.value=t[r.field]})}function la(e){let t=new ol.source.Vector;this.Layers.forEach(r=>{let n=r.getSource();typeof n.getFeatures=="function"&&t.addFeatures(n.getFeatures())}),this.layer.mapview.fitView(t.getExtent(),{maxZoom:e})}async function ca(){confirm(mapp.dictionary.confirm_delete)&&(await mapp.utils.xhr(`${this.layer.mapview.host}/api/query?`+mapp.utils.paramString({template:"location_delete",locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id})),this.remove())}function ua(){this.infoj.forEach(e=>{e.edit&&(delete e.newValue,e._edit=e.edit,delete e.edit)})}function fa(){this.infoj.forEach(e=>{e._edit&&(e.edit=e._edit,delete e._edit)})}async function zn(e,t=e.layer.mapview.locations){if(e.layer.mapview.interaction?.getLocation instanceof Function){e.layer.mapview.interaction?.getLocation(e);return}if(!(!e.layer||!e.id)&&(e.hook=`${e.layer.key}!${e.id}`,!e.layer.mapview.interaction?.locations?.has(e.hook))){if(e.layer.mapview.interaction?.locations?.add(e.hook),t[e.hook]){t[e.hook].remove(),delete t[e.hook],e.layer.mapview.interaction?.locations?.delete(e.hook);return}return e.locale=e.layer.mapview.locale.key,await Ct(e),mapp.location.decorate(e),t[e.hook]=e,e.layer.mapview.interaction?.locations?.delete(e.hook),e.record&&e.layer.mapview.hooks&&mapp.hooks.push("locations",e.hook),e}}async function Ct(e){if(!e.layer){console.warn("No layer provided for getLocationInfoj()");return}typeof e.layer=="string"&&(e.layer=await mapp.utils.xhr(`${mapp.host}/api/workspace/layer?locale=${e.locale}&layer=${e.layer}`)),e.table??=e.layer.table||Object.values(e.layer.tables).find(r=>!!r);let t=await mapp.utils.xhr(`${mapp.host}/api/query?`+mapp.utils.paramString({template:"location_get",locale:e.locale,layer:e.layer.key,table:e.table,id:e.id}));if(!t||t instanceof Error){console.warn("No data returned from location_get request using ID:",e.id);return}else if(Array.isArray(t)){console.warn(`Location response returned more than one record for Layer: ${e.layer.key}.`),console.log("Location Get Response:",t);return}return e.layer.infoj??=[{field:e.layer.qID}],e.infoj=e.layer.infoj?.map(r=>({...structuredClone(r),title:r.title||t[r.field+"_label"],value:t[r.field],location:e})),e.infoj}async function Nn(e){let t=e.feature.getProperties(),r=e.feature.getGeometry(),n=r.getCoordinates(),o=ol.proj.transform(n,"EPSG:"+e.mapview.srid,"EPSG:"+e.layer.srid),i=await mapp.utils.xhr(`${e.mapview.host}/api/query/get_nnearest?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.layer.key,geom:e.layer.geom,qID:e.layer.qID,label:e.layer.cluster?.label||e.layer.qID,table:e.table,filter:e.layer.filter?.current,n:t.count>(e.max||99)?e.max||99:t.count,x:o[0],y:o[1],coords:o})),s=mapp.utils.html.node`
    <div style="max-width: 66vw; max-height: 300px; overflow-x: hidden;">
      <ul>
      ${i.map(a=>mapp.utils.html.node`
        <li
          onclick=${l=>{e.mapview.popup(null),mapp.location.get({layer:e.layer,table:e.table,id:a.id,marker:ol.proj.transform(a.coords,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid)})}}>${a.label||'"'+e.layer.cluster?.label+'"'}`)}`;e.mapview.popup({coords:ol.proj.transform(o,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid),content:s,autoPan:!0})}var Dn={create:Mt,decorate:Et,get:zn,getInfoj:Ct,nnearest:Nn};function Lt(e){typeof e.attribution=="object"&&(e.attribution.target??=e.target,e.attribution.node=mapp.utils.html.node`
    <div class="map-attribution">${e.attribution.logo}`,e.attribution.target.append(e.attribution.node),e.attribution.linksTarget=mapp.utils.html.node`<div class="attribution-links">`,e.attribution.node.append(e.attribution.linksTarget),e.attribution.links??={},e.attribution.check=()=>{let t=structuredClone(e.attribution.links);Object.values(e.layers).filter(n=>!!n.display).filter(n=>!!n.attribution).forEach(n=>Object.assign(t,n.attribution));let r=Object.entries(t).map(n=>mapp.utils.html`
      <a target="_blank" href="${n[1]}">${n[0]}`);mapp.utils.render(e.attribution.linksTarget,mapp.utils.html.node`${r}`)})}async function Bn(e){if(!Array.isArray(e))return;let t=this.hooks&&new Set(mapp.hooks.current.layers);for(let r=0;r<e.length;r++){let n=mapp.utils.merge({},this.locale.layer||{},e[r]);if(n.err&&n.err.forEach(o=>console.error(o)),n.zIndex??=r,n.mapview=this,t?.size&&(n.display=t.has(n.key)),!!n.format){if(!mapp.layer.formats[n.format]){console.error(`Layer: ${n.key}; Format: ${n.format} is unknown.`);continue}await mapp.layer.decorate(n),n.L&&(this.layers[n.key]=n,n.display&&n.show())}}return this.renderComplete=new Promise(r=>{this.Map.once("rendercomplete",r)}),e}function Vn(e,t={}){if(!Array.isArray(e)||!e.every(r=>isFinite(r))){console.warn("Attempted to call fitView method with invalid extent");return}this.Map.getView().fit(e,{padding:[50,50,50,50],duration:1e3,...t})}function Gn(e){let t=this.Map.getView().calculateExtent();if(!e)return{south:t[1],west:t[0],north:t[3],east:t[2]};let r=ol.proj.transformExtent(t,`EPSG:${this.srid}`,`EPSG:${e}`);return{south:r[1],west:r[0],north:r[3],east:r[2]}}var Rn;function Zn(e){typeof e.format=="string"&&Object.hasOwn(ol.format,e.format)&&(Rn=new ol.format[e.format]);let t,r=e.geometry||(typeof e.value=="string"?JSON.parse(e.value):e.value);if(e.Style??=mapp.utils.style(e.style),!r)return;try{t=Rn.readFeature({type:"Feature",geometry:r},{dataProjection:`EPSG:${e.dataProjection||e.srid||this.srid}`,featureProjection:`EPSG:${this.srid}`})}catch(o){console.error(o);return}if(!t)return;let n=new ol.layer.Vector({source:new ol.source.Vector({features:[t]}),zIndex:e.zIndex,style:e.Style});return this.Map.addLayer(n),n}function Un(e){return e.format="GeoJSON",this.geometry(e)}var x={};function Kn(e){let t=this;if(x.node?.remove(),!t.position||(t.Map.un("pointermove",r),!e))return;if(e instanceof HTMLElement)x.node=e;else if(typeof e=="object"){console.warn(`Content type object cannot be rendered in infotip: ${JSON.stringify(e)}`);return}else t.locale.xss_check&&/[()]/.test(e)&&console.warn(`Potential XSS detected in infotip content ${e}`),x.node=mapp.utils.html.node`<div class="infotip box-shadow">`,x.node.innerHTML=e;t.Map.getTargetElement().append(x.node),t.Map.on("pointermove",r),r();function r(){x.node.style.opacity=1,x.node.style.left=t.pointerLocation.x-x.node.offsetWidth/2+"px",x.node.style.top=t.pointerLocation.y-x.node.offsetHeight-15+"px"}}function Hn(e){if(this._locate=this._locate||Object.assign({icon:{svg:`${this.host}/icons/locator.svg`,scale:.05},feature:new ol.Feature({geometry:new ol.geom.Point([0,0])})},e||{}),this._locate.active=!this._locate.active,this._locate.L||(this._locate.L=new ol.layer.Vector({source:new ol.source.Vector({features:[this._locate.feature]}),zIndex:999,style:mapp.utils.style({icon:this._locate.icon})})),!this._locate.active){this.Map.removeLayer(this._locate.L);return}this.Map.addLayer(this._locate.L),mapp.utils.getCurrentPosition(t=>{let r=ol.proj.fromLonLat([parseFloat(t.coords.longitude),parseFloat(t.coords.latitude)]);this._locate.feature.getGeometry().setCoordinates(r),this.Map.getView().animate({center:r,zoom:this.locale.maxZoom})})}var M={};function Wn(e){if(typeof e>"u")return M.node?.parentNode;let t=this;t.infotip(null),M.node?.remove(),e&&(M.node=mapp.utils.html.node`<div class="popup box-shadow">`,M.node.appendChild(e.content),M.overlay&&t.Map.removeOverlay(M.overlay),M.overlay=new ol.Overlay({element:M.node,position:e.coords||t.position,positioning:"bottom-center",autoPan:e.autoPan,insertFirst:!0,autoPanAnimation:{duration:250}}),t.Map.addOverlay(M.overlay))}function Jn(e,t){t.popup(null);let r=[];if(t.Map.forEachFeatureAtPixel(e.pixel,(o,i)=>{let s={F:o,L:i,layer:t.layers[i.get("key")],id:o.get("id")||o.getId()};r.push(s)},{layerFilter:t.interaction.layerFilter,hitTolerance:t.interaction.hitTolerance}),!r.length)return;let n=mapp.utils.html.node`
      <div style="max-width: 66vw; max-height: 300px; overflow-x: hidden;">
        <ul>
        ${r.map(o=>mapp.utils.html.node`
          <li onclick=${i=>{t.interaction.getFeature(o),t.popup(null)}}
        }}>${o.L.get("key")} [${o.id}]`)}`;t.popup({content:n,autoPan:!0})}function Qn(e){let t=this;t.interaction?.finish(),t.interaction={type:"highlight",finish:d,clear:u,highlight:a,getFeature:p,hitTolerance:5,candidates:{},candidateKeys:new Set,locations:new Set,longClickMethod:t.allFeatures,longClickMS:500,layerFilter:f=>Object.values(this.layers).some(h=>h.qID&&h.L===f),...e},t.Map.on("pointermove",s),t.Map.on("click",c),t.Map.getTargetElement().addEventListener("mousedown",o),t.Map.getTargetElement().addEventListener("touchstart",n),t.Map.getTargetElement().addEventListener("mouseup",i),t.Map.getTargetElement().addEventListener("mouseleave",r);function r(){t.interaction.candidateKeys=new Set,u()}function n(f){f.preventDefault()}function o(){t.interaction.longClickMethod&&(delete t.interaction.longClick,t.interaction.longClickTimeout&&clearTimeout(t.interaction.longClickTimeout),t.interaction.longClickTimeout=setTimeout(()=>{t.interaction.longClick=!0,t.Map.getTargetElement().style.cursor="wait"},t.interaction.longClickMS))}function i(){t.Map.getTargetElement().style.cursor="auto"}function s(f){t.interaction.longClickTimeout&&clearTimeout(t.interaction.longClickTimeout);let h={};if(t.Map.forEachFeatureAtPixel(f.pixel,(v,S)=>{let w={key:`${S.get("key")||ol.util.getUid(S)}!${v.get("id")||v.getId()||ol.util.getUid(v)}`,F:v,L:S};h[w.key]=w},{layerFilter:t.interaction.layerFilter,hitTolerance:t.interaction.hitTolerance}),mapp.utils.areSetsEqual(t.interaction.candidateKeys,new Set(Object.keys(h))))return;if(!Object.keys(h).length){t.interaction.candidateKeys=new Set,u();return}let b=h[Object.keys(h).find(v=>!t.interaction.candidateKeys.has(v))]||t.interaction.current?.key&&h[t.interaction.current?.key]||h[Object.keys(h)[0]];t.interaction.candidateKeys=new Set(Object.keys(h)),t.interaction.current?.key!==b.key&&t.interaction.highlight(b,f)}function a(f,h){if(u(),t.interaction.current=Object.assign(f,{layer:t.layers[f.L.get("key")],id:f.F.get("id")||f.F.getId()}),t.interaction.current.layer.highlight=f.id,h.originalEvent.pointerType!=="mouse"){h.type!=="pointermove"&&t.interaction.getFeature(t.interaction.current),u();return}t.interaction.current.layer.infoj&&(t.Map.getTargetElement().style.cursor="pointer"),typeof t.interaction.current.layer.style?.hover?.method=="function"&&t.interaction.current.layer.style.hover.method(f.F,t.interaction.current.layer),t.interaction.current.layer.format!=="mvt"&&t.interaction.current.layer.style.highlight&&typeof t.interaction.current.F.setStyle=="function"?(f.F.set("Styles",null,!0),f.F.set("highlight",!0,!0),t.interaction.current.F.setStyle()):t.interaction.current.layer.style.highlight&&t.interaction.current.layer.L.changed()}let l;function c(f){if(t.Map.getTargetElement().style.cursor="auto",t.interaction.longClickTimeout&&clearTimeout(t.interaction.longClickTimeout),t.interaction.longClick&&typeof t.interaction.longClickMethod=="function"){t.interaction.longClickMethod(f,t);return}if(!l){if(l=setTimeout(()=>{l=null},600),f.originalEvent.pointerType==="touch"){t.interaction.candidateKeys=new Set,f.type="touchClick",s(f);return}if(t.popup(null),t.interaction.current){t.interaction.getFeature(t.interaction.current);return}typeof t.interaction.noLocationClick=="function"&&t.interaction.noLocationClick(f)}}function u(){t.interaction.current&&(t.infotip(null),t.Map.getTargetElement().style.cursor="auto",delete t.interaction.current.layer.highlight,t.interaction.current.layer.format!=="mvt"&&typeof t.interaction.current.F.setStyle=="function"?(t.interaction.current.F.set("Styles",null,!0),t.interaction.current.F.set("highlight",!1,!0),t.interaction.current.F.setStyle()):t.interaction.current.layer.style.highlight&&t.interaction.current.layer.L.changed(),delete t.interaction.current)}function p(f){if(!f.layer.infoj)return;if(f.F.getProperties().count>1){let b=f.F.get("features");if(Array.isArray(b)){let v=b.map(w=>{let pe=w.getProperties();return{id:pe.id,label:pe.properties[f.layer.cluster?.label]}}),S=mapp.utils.html.node`
        <div style="max-width: 66vw; max-height: 300px; overflow-x: hidden;">
          <ul>
          ${v.map(w=>mapp.utils.html.node`
            <li
              onclick=${pe=>{t.popup(null),mapp.location.get({layer:f.layer,table:f.layer.table||f.layer.tableCurrent(),id:w.id})}}>${w.label||w.id}`)}`;t.popup({coords:f.F.getGeometry().getCoordinates(),content:S,autoPan:!0});return}mapp.location.nnearest({mapview:t,layer:f.layer,table:f.layer.table||f.layer.tableCurrent(),feature:f.F});return}mapp.location.get({layer:f.layer,table:f.layer.table||f.layer.tableCurrent(),id:f.id})}function d(){u(),t.popup(null),t.Map.un("pointermove",s),t.Map.un("click",c),t.Map.getTargetElement().removeEventListener("mousedown",o),t.Map.getTargetElement().removeEventListener("touchstart",n),t.Map.getTargetElement().removeEventListener("mouseup",i),t.Map.getTargetElement().removeEventListener("mouseleave",r),t.interaction.callback?.()}}function Xn(e){let t=this;t.interaction?.finish(),t.interaction={type:"draw",finish:o,getFeature:n,format:new ol.format.GeoJSON,source:new ol.source.Vector,Layer:new ol.layer.Vector({zIndex:e.layer?.zIndex||99}),drawend:mapp.ui?.elements.contextMenu.draw.bind(this),vertices:[],condition:i=>{if(t.interaction.wait)return!1;if(i.originalEvent.buttons===2){t.interaction.interaction.removeLastPoint(),t.interaction.vertices.pop();let s=new ol.MapBrowserEvent("pointermove",t.Map,i.originalEvent);return t.interaction.interaction.handleEvent(s),t.interaction.conditions?.forEach(a=>typeof a=="function"&&a(i)),!1}if(i.originalEvent.buttons===1)return t.interaction.vertices.push(i.coordinate),t.popup(null),t.interaction.conditions?.forEach(s=>typeof s=="function"&&s(i)),!0},style:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})],...e},t.Map.getTargetElement().style.cursor="crosshair",t.interaction.Layer.setSource(t.interaction.source),t.Map.addLayer(t.interaction.Layer),document.addEventListener("keyup",r);function r(i){i.key==="Escape"&&t.interaction.finish()}t.interaction.interaction=new ol.interaction.Draw(t.interaction),t.interaction.interaction.on("drawstart",i=>{let s=i.feature.getGeometry();async function a(){t.popup({content:mapp.utils.html.node`
          <div style="padding: 5px">
          ${await mapp.utils.convert(t.metrics[t.interaction.tooltip.metric](s),t.interaction.tooltip)}`})}t.interaction.tooltip&&s.on("change",t.interaction.tooltip.onChange||a),t.interaction.source.clear(),t.popup(null)}),typeof t.interaction.drawend=="function"&&t.interaction.interaction.on("drawend",t.interaction.drawend),t.Map.addInteraction(t.interaction.interaction),t.interactions.snap(t);function n(){return JSON.parse(t.interaction.format.writeFeature(t.interaction.source.getFeatures()[0],{dataProjection:"EPSG:"+t.interaction.layer?.srid||t.interaction.srid||t.srid,featureProjection:"EPSG:"+t.srid}))}function o(i){document.removeEventListener("keyup",r),t.interaction.snap?.remove?.(),t.Map.getTargetElement().style.cursor="default",t.popup(null),t.Map.removeInteraction(t.interaction.interaction),t.Map.removeLayer(t.interaction.Layer),t.interaction.callback?.(i)}}function Yn(e){let t=this;t.interaction?.finish(),t.interaction={type:"modify",finish:n,format:new ol.format.GeoJSON,source:new ol.source.Vector,Layer:new ol.layer.Vector({zIndex:1/0}),vertices:[],modifyend:mapp.ui?.elements.contextMenu.modify.bind(this),getFeature:r,Style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})],deleteCondition:o=>{if(o.type==="singleclick"){let i=t.interaction.Feature.getGeometry(),s=i.getType();if(s==="Point")return;let a=i.getCoordinates();if(s==="LineString"&&a.length<3||s==="Polygon"&&a[0].length<=4)return;t.popup({coords:i.getClosestPoint(o.coordinate),content:mapp.utils.html.node`<ul>
            <li
              onclick=${()=>{t.interaction.interaction.removePoint(),t.interaction.vertices.push(t.interaction.Feature.getGeometry().getClosestPoint(o.coordinate))}}>${mapp.dictionary.delete_vertex}`})}},...e},t.Map.getTargetElement().style.cursor="crosshair",t.interaction.source.addFeature(t.interaction.Feature),t.interaction.Layer.setSource(t.interaction.source),t.interaction.Layer.setStyle(t.interaction.Style),t.Map.addLayer(t.interaction.Layer),t.interaction.interaction=new ol.interaction.Modify(t.interaction),t.interaction.interaction.on("modifystart",o=>{t.popup(null)}),typeof t.interaction.modifyend=="function"&&t.interaction.interaction.on("modifyend",t.interaction.modifyend),t.Map.addInteraction(t.interaction.interaction),t.interactions.snap(t);function r(){return JSON.parse(t.interaction.format.writeFeature(t.interaction.Feature,{dataProjection:"EPSG:"+t.interaction.srid||t.srid,featureProjection:"EPSG:"+t.srid}))}function n(o){t.interaction.snap?.remove?.(),t.Map.getTargetElement().style.cursor="default",t.popup(null),t.Map.removeInteraction(t.interaction.interaction),t.interaction.source.clear(),t.Map.removeLayer(t.interaction.Layer),t.interaction.callback?.(o)}}function eo(e){let t=this;t.interaction?.finish(),t.interaction={finish:r,Layer:new ol.layer.Vector({source:new ol.source.Vector}),...e},t.interaction.Layer.getSource().clear(),t.Map.addLayer(t.interaction.Layer),t.Map.getTargetElement().style.cursor="zoom-in",t.interaction.interaction=new ol.interaction.Draw({source:t.interaction.Layer.getSource(),type:"Circle",geometryFunction:ol.interaction.Draw.createBox(),style:{"stroke-color":"#ddd","fill-color":"#fff9"}}),t.interaction.interaction.on("drawend",n=>{t.fitView(n.feature.getGeometry().getExtent()),r()}),t.Map.addInteraction(t.interaction.interaction);function r(){t.Map.getTargetElement().style.cursor="auto",t.Map.removeInteraction(t.interaction.interaction),t.Map.removeLayer(t.interaction.Layer),t.interaction.Layer.getSource().clear(),t.interaction.callback?.()}}function to(e){if(!e.interaction.snap)return;if(e.interaction.snap===!0&&(e.interaction.snap={layer:e.interaction.layer.key}),typeof e.interaction.snap=="string"&&(e.interaction.snap={layer:e.interaction.snap}),e.interaction.snap={remove:()=>{e.interaction.layer.featureSource&&(e.interaction.layer.featureSource.un("tileloadend",t),e.Map.removeLayer(e.interaction.snap.vectorTileLayer),e.interaction.layer.featureSource.clear()),e.Map.removeInteraction(e.interaction.snap.interaction)},...e.interaction.snap},!e.layers[e.interaction.snap.layer]){console.warn(`Unable to snap to layer:${e.interaction.snap.layer} as it is not found in mapview.layers.`);return}e.interaction.snap.layer&&=e.layers[e.interaction.snap.layer]||e.interaction.layer,e.interaction.snap.layer??=e.interaction.layer,e.interaction.snap.layer.show();function t(r){let n=r.tile.getFeatures();try{e.interaction.snap.source.addFeatures(n)}catch{}}e.interaction.snap.layer.featureSource?(e.interaction.snap.source=new ol.source.Vector,e.interaction.snap.layer.featureSource.on("tileloadend",t),e.interaction.snap.vectorTileLayer=new ol.layer.VectorTile({source:e.interaction.snap.layer.featureSource,opacity:0}),e.Map.addLayer(e.interaction.snap.vectorTileLayer)):e.interaction.snap.source=e.interaction.snap.layer.L.getSource(),e.interaction.snap.interaction=new ol.interaction.Snap({source:e.interaction.snap.source}),e.Map.addInteraction(e.interaction.snap.interaction)}function $t(e){e.host??=mapp.host,Object.assign(e,{srid:e.locale.srid||"3857",addLayer:Bn,fitView:Vn,geometry:Zn,geoJSON:Un,getBounds:Gn,infotip:Kn,locate:Hn,metrics:{distance:u=>ol.sphere.getLength(new ol.geom.LineString([u.getInteriorPoint().getCoordinates(),e.position])),area:u=>ol.sphere.getArea(u),length:u=>ol.sphere.getLength(u)},popup:Wn,allFeatures:Jn,layers:{},locations:{},interactions:{highlight:Qn.bind(e),draw:Xn.bind(e),modify:Yn.bind(e),zoom:eo.bind(e),snap:to}}),e.view??=e.locale.view;let t=mapp.hooks?.current?.z||e.view?.z||e.locale.minZoom||0,r=ol.proj.fromLonLat([parseFloat(mapp.hooks?.current?.lng||e.view?.lng||0),parseFloat(mapp.hooks?.current?.lat||e.view?.lat||0)]);e.locale.bounds&&console.warn("locale.bounds have been renamed to locale.extent");let n=parseFloat(e.locale.extent?.north||90),o=parseFloat(e.locale.extent?.south||-90),i=parseFloat(e.locale.extent?.east||180),s=parseFloat(e.locale.extent?.west||-180);n-o>=0&&i-s>=0?e.extent=ol.proj.transformExtent([s,o,i,n],"EPSG:4326",`EPSG:${e.srid}`):(console.warn("Invalid extent. Ensure north >= south and east >= west. Global extent is assumed."),e.extent=ol.proj.transformExtent([-180,-90,180,90],"EPSG:4326",`EPSG:${e.srid}`)),e.Map=new ol.Map({target:e.target,interactions:ol.interaction.defaults.defaults({mouseWheelZoom:e.scrollWheelZoom&&{duration:250,timeout:80}||!1,pinchRotate:e.pinchRotate&&{threshold:3}||!1}),moveTolerance:5,controls:e.controls||[],view:new ol.View({projection:`EPSG:${e.srid}`,zoom:t,minZoom:e.locale.minZoom,maxZoom:e.locale.maxZoom,center:r,extent:e.extent})});let a;if(new ResizeObserver(()=>{a&&clearTimeout(a),a=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new Event("resize"))},400)}).observe(e.Map.getTargetElement()),e.locale.maskBounds&&console.warn("locale.maskBounds is set as mask:true in locale.extent"),e.locale.extent?.mask){let u=[[180,90],[180,-90],[-180,-90],[-180,90],[180,90]],p=[[e.locale.extent.east,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.north]],d=new ol.Feature({geometry:new ol.geom.Polygon([u,p]).transform("EPSG:4326",`EPSG:${e.srid}`)});e.Map.addLayer(new ol.layer.Vector({source:new ol.source.Vector({features:[d]}),style:{"fill-color":"#0004"},zIndex:1/0}))}e.locale.showScaleBar&&(console.warn("locale.showScaleBar is deprecated. Use locale.ScaleLine.metric or locale.ScaleLine.imperial instead."),e.locale.ScaleLine="metric"),e.locale.scalebar&&(console.warn("locale.scalebar is deprecated. Use locale.ScaleLine.metric or locale.ScaleLine.imperial instead."),e.locale.ScaleLine=e.locale.scalebar),e.locale.ScaleLine&&e.Map.addControl(new ol.control.ScaleLine({units:e.locale.ScaleLine==="imperial"?"imperial":"metric"})),Lt(e),e.Map.on("pointermove",u=>{e.position=u.coordinate,e.pointerLocation={x:u.originalEvent.clientX,y:u.originalEvent.clientY}}),e.Map.getTargetElement().addEventListener("mouseout",()=>{e.infotip(null),e.position=null,e.pointerLocation={x:null,y:null}}),e.Map.getTargetElement().addEventListener("changeEnd",l);function l(){if(!e.hooks)return;let u=ol.proj.transform(e.Map.getView().getCenter(),`EPSG:${e.srid}`,"EPSG:4326");mapp.hooks.set({lat:Math.round((u[1]+Number.EPSILON)*1e5)/1e5,lng:Math.round((u[0]+Number.EPSILON)*1e5)/1e5,z:Math.round((e.Map.getView().getZoom()+Number.EPSILON)*100)/100})}let c;return e.Map.on("moveend",()=>{clearTimeout(c),c=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new CustomEvent("changeEnd"))},500)}),c=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new CustomEvent("changeEnd"))},500),e.loadPlugins?(async u=>{await mapp.utils.loadPlugins(u.locale.plugins),u.locale.syncPlugins??=[];let p=new Set(u.locale.syncPlugins);for(let f of u.locale.syncPlugins)typeof mapp.plugins[f]=="function"&&await mapp.plugins[f](u.locale[f],u);let d=Object.keys(u.locale).filter(f=>!p.has(f)).filter(f=>typeof mapp.plugins[f]=="function").map(f=>mapp.plugins[f](u.locale[f],u));return await Promise.all(d),u})(e):e}function ro(e,t){let r=document.getElementById("mapButton");r&&mapp.user?.admin&&r.appendChild(mapp.utils.html.node`
    <a
      title=${mapp.dictionary.toolbar_admin}
      href="${mapp.host+"/api/user/admin"}">
      <div class="mask-icon supervisor-account">`)}function no(e,t){let r=document.getElementById("mapButton");if(!r)return;let n=mapp.utils.html.node`
      <button
        title=${mapp.dictionary.toolbar_current_location}
        onclick=${o}><div class="mask-icon feature-info">`;r.append(n);function o(){n.firstChild.classList.toggle("active")?t.interactions.highlight({getFeature:i=>{let s=i.F.getProperties();delete s.Styles,e.geometry||delete s.geometry,Array.isArray(s.features)&&(s.features=e.features?s.features.map(c=>c.getProperties().properties[i.layer.cluster.label]):s.features.length),e.log&&console.log(i.F);let a={id:i.id,layer:i.layer.key,properties:s},l=mapp.utils.html.node`<pre
            style="padding: 1em;"
            >${JSON.stringify(a,void 0,2)}`;t.popup({content:l})},callback:()=>{n.firstChild.classList.remove("active")}}):t.interactions.highlight()}}function oo(e,t){let r=document.getElementById("mapButton");if(!r)return;function n(i){i.target.classList.toggle("active"),document.body.classList.toggle("fullscreen"),t.Map.updateSize(),Object.values(t.layers).forEach(s=>s.mbMap?.resize())}let o=mapp.utils.html.node`
    <button
      class="mobile-display-none"
      title=${mapp.dictionary.toolbar_fullscreen}
      onclick=${n}>
      <div class="mask-icon map">`;r.append(o)}function so(e,t){t.locale&&io(t.locale,e)}function io(e,t){for(let[r,n]of Object.entries(e))ao(n,t)||typeof n=="string"&&pa(e,r,n,t)}function ao(e,t){if(Array.isArray(e))return e.forEach(r=>ao(r,t)),!0;if(e instanceof Object)return io(e,t),!0}function pa(e,t,r,n){let o=n.filter(i=>i.key===t).findLast(i=>i.value===r);o&&(e[t]=o[mapp?.user?.language||mapp.language]||o.default||r)}function lo(e,t){let r=document.getElementById("mapButton");if(!r)return;let n=mapp.utils.html.node`
    <button
      title=${mapp.dictionary.toolbar_current_location}
      onclick=${o=>{o.target.classList.toggle("active"),t.locate()}}><div class="mask-icon gps-not-fixed">`;r.append(n)}function co(e,t){let r=document.getElementById("mapButton");if(!r||!document.head.dataset.login)return;let n=`mask-icon ${mapp.user?"logout":"lock-open"}`;r.appendChild(mapp.utils.html.node`
    <a
      title=${mapp.user?mapp.dictionary.toolbar_logout:mapp.dictionary.toolbar_login}
      href=${mapp.user?"?logout=true":"?login=true"}>
      <div class=${n}>`)}async function uo(e,t){typeof mapp.utils.svgSymbols.templates!="object"&&(mapp.utils.svgSymbols.templates={});let r=Object.entries(e).map(n=>fetch(n[1]).then(o=>o.text()).then(o=>{mapp.utils.svgSymbols.templates[n[0]]=o}));await Promise.all(r)}function fo(e,t){if(!mapp.user?.email){console.warn("The userIDB plugin requires a mapp.user");return}let r=document.getElementById("mapButton");r&&(e.title??="Update userIDB locale",r.append(mapp.utils.html.node`
    <button
      title=${e.title}
      onclick=${()=>{let n=mapp.utils.merge({},t.locale);n.layers.forEach(o=>{typeof o=="object"&&da(o,t.layers[o.key])}),mapp.utils.userIndexedDB.put("locales",n),alert(`User ${mapp.user.email} IndexedDB updated.`)}}>
      <div class="mask-icon" style="mask-image:url(https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/rule_settings/default/24px.svg)">`))}function da(e,t){if(t)return Object.keys(t).forEach(r=>{t[r]!==void 0&&(t[r]===null&&(e[r]=null),typeof t[r]!="function"&&typeof t[r]!="object"&&(e[r]=t[r]))}),e}function po(e,t){let r=document.getElementById("mapButton");if(!r)return;let n=r.appendChild(mapp.utils.html.node`
    <button
      id="btnZoomIn"
      .disabled=${t.Map.getView().getZoom()>=t.locale.maxZoom}
      title=${mapp.dictionary.toolbar_zoom_in}
      onclick=${i=>{let s=parseInt(t.Map.getView().getZoom()+1);t.Map.getView().setZoom(s),i.target.disabled=s>=t.locale.maxZoom}}><div class="mask-icon add">`),o=r.appendChild(mapp.utils.html.node`
    <button
      id="btnZoomOut"
      .disabled=${t.Map.getView().getZoom()<=t.locale.minZoom}
      title=${mapp.dictionary.toolbar_zoom_out}
      onclick=${i=>{let s=parseInt(t.Map.getView().getZoom()-1);t.Map.getView().setZoom(s),i.target.disabled=s<=t.locale.minZoom}}><div class="mask-icon remove">`);t.Map.getTargetElement().addEventListener("changeEnd",()=>{let i=t.Map.getView().getZoom();n.disabled=i>=t.locale.maxZoom,o.disabled=i<=t.locale.minZoom})}function ho(e,t){let r=document.getElementById("mapButton");if(!r)return;function n(i){if(i.target.classList.contains("active")){t.interactions.highlight();return}i.target.classList.add("active"),t.interactions.zoom({callback:()=>{i.target.classList.remove("active"),delete t.interaction,setTimeout(()=>{!t.interaction&&t.interactions.highlight()},400)}})}let o=mapp.utils.html.node`
    <button
      class="mobile-display-none"
      title=${mapp.dictionary.toolbar_zoom_to_area}
      onclick=${n}>
      <div class="mask-icon pageview">`;r.append(o)}var Tt;function go(e){Tt=document.getElementById("mapButton"),Tt&&e&&(Array.isArray(e)?e.forEach(mo):mo(e))}function mo(e){if(!e?.href){console.warn("You must provide a href for the link_button plugin.");return}e.target??="_blank",e.css_class??="mask-icon",e.title??=mapp.dictionary.link;let t=mapp.utils.html.node`
    <a
      title=${e.title}
      href=${e.href}
      target=${e.target}><div
      class=${e.css_class}
      style=${e.css_style}>`;Tt.append(t)}var ha={admin:ro,feature_info:no,fullscreen:oo,keyvalue_dictionary:so,locator:lo,login:co,svg_templates:uo,userIDB:fo,zoomBtn:po,zoomToArea:ho,link_button:go},yo=ha;le.parse();var jt={current:10,load:async()=>await new Promise(e=>{let t=document.createElement("script");t.type="application/javascript",t.src="https://cdn.jsdelivr.net/npm/ol@v10.0.0/dist/ol.js",t.onload=e,document.head.append(t),console.warn("Openlayers library loaded from script tag.")})};if(window.ol===void 0)console.warn("Openlayers has not been loaded.");else{let e=parseFloat(ol?.util.VERSION);console.log(`OpenLayers version ${e}`),e<jt.current&&console.warn(`Update the current OpenLayers version:${ol?.util.VERSION} to ${jt.current}.`)}self.mapp={ol:jt,version:"4.10.1\u03B1",hash:"764bcdf453b6807e7192dde6f5bc872c3d0c2572",host:document.head?.dataset?.dir||"",language:le.current.language||"en",dictionaries:bn,dictionary:new Proxy({},{get:function(e,t,r){return mapp.dictionaries[mapp.language][t]?mapp.dictionaries[mapp.language][t]:mapp.dictionaries.en[t]}}),hooks:le,layer:An,location:Dn,Mapview:$t,utils:an,plugins:yo};})();
/*! Bundled license information:

@webreflection/uparser/esm/index.js:
  (*! (c) Andrea Giammarchi - ISC *)
*/
//# sourceMappingURL=mapp.js.map
